(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))h(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const T of v.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&h(T)}).observe(document,{childList:!0,subtree:!0});function l(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerPolicy&&(v.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?v.credentials="include":m.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function h(m){if(m.ep)return;m.ep=!0;const v=l(m);fetch(m.href,v)}})();function by(t,r){const l=Object.create(null),h=t.split(",");for(let m=0;m<h.length;m++)l[h[m]]=!0;return r?m=>!!l[m.toLowerCase()]:m=>!!l[m]}function xy(t){if(yn(t)){const r={};for(let l=0;l<t.length;l++){const h=t[l],m=nr(h)?mS(h):xy(h);if(m)for(const v in m)r[v]=m[v]}return r}else{if(nr(t))return t;if(Ci(t))return t}}const dS=/;(?![^(]*\))/g,pS=/:([^]+)/,fS=/\/\*.*?\*\//gs;function mS(t){const r={};return t.replace(fS,"").split(dS).forEach(l=>{if(l){const h=l.split(pS);h.length>1&&(r[h[0].trim()]=h[1].trim())}}),r}function wy(t){let r="";if(nr(t))r=t;else if(yn(t))for(let l=0;l<t.length;l++){const h=wy(t[l]);h&&(r+=h+" ")}else if(Ci(t))for(const l in t)t[l]&&(r+=l+" ");return r.trim()}const gS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",_S=by(gS);function B1(t){return!!t||t===""}const N_=t=>nr(t)?t:t==null?"":yn(t)||Ci(t)&&(t.toString===$1||!wn(t.toString))?JSON.stringify(t,F1,2):String(t),F1=(t,r)=>r&&r.__v_isRef?F1(t,r.value):yu(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((l,[h,m])=>(l[`${h} =>`]=m,l),{})}:j1(r)?{[`Set(${r.size})`]:[...r.values()]}:Ci(r)&&!yn(r)&&!U1(r)?String(r):r,xi={},_u=[],zo=()=>{},yS=()=>!1,vS=/^on[^a-z]/,xm=t=>vS.test(t),Ty=t=>t.startsWith("onUpdate:"),zr=Object.assign,Ey=(t,r)=>{const l=t.indexOf(r);l>-1&&t.splice(l,1)},bS=Object.prototype.hasOwnProperty,Wn=(t,r)=>bS.call(t,r),yn=Array.isArray,yu=t=>wm(t)==="[object Map]",j1=t=>wm(t)==="[object Set]",wn=t=>typeof t=="function",nr=t=>typeof t=="string",ky=t=>typeof t=="symbol",Ci=t=>t!==null&&typeof t=="object",N1=t=>Ci(t)&&wn(t.then)&&wn(t.catch),$1=Object.prototype.toString,wm=t=>$1.call(t),xS=t=>wm(t).slice(8,-1),U1=t=>wm(t)==="[object Object]",Sy=t=>nr(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,$f=by(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Tm=t=>{const r=Object.create(null);return l=>r[l]||(r[l]=t(l))},wS=/-(\w)/g,us=Tm(t=>t.replace(wS,(r,l)=>l?l.toUpperCase():"")),TS=/\B([A-Z])/g,Ru=Tm(t=>t.replace(TS,"-$1").toLowerCase()),Em=Tm(t=>t.charAt(0).toUpperCase()+t.slice(1)),c_=Tm(t=>t?`on${Em(t)}`:""),_d=(t,r)=>!Object.is(t,r),u_=(t,r)=>{for(let l=0;l<t.length;l++)t[l](r)},Zf=(t,r,l)=>{Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value:l})},ES=t=>{const r=parseFloat(t);return isNaN(r)?t:r};let Zb;const kS=()=>Zb||(Zb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Jr;class V1{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Jr,!r&&Jr&&(this.index=(Jr.scopes||(Jr.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const l=Jr;try{return Jr=this,r()}finally{Jr=l}}}on(){Jr=this}off(){Jr=this.parent}stop(r){if(this._active){let l,h;for(l=0,h=this.effects.length;l<h;l++)this.effects[l].stop();for(l=0,h=this.cleanups.length;l<h;l++)this.cleanups[l]();if(this.scopes)for(l=0,h=this.scopes.length;l<h;l++)this.scopes[l].stop(!0);if(!this.detached&&this.parent&&!r){const m=this.parent.scopes.pop();m&&m!==this&&(this.parent.scopes[this.index]=m,m.index=this.index)}this.parent=void 0,this._active=!1}}}function G1(t){return new V1(t)}function SS(t,r=Jr){r&&r.active&&r.effects.push(t)}function Z1(){return Jr}function AS(t){Jr&&Jr.cleanups.push(t)}const Ay=t=>{const r=new Set(t);return r.w=0,r.n=0,r},q1=t=>(t.w&Da)>0,W1=t=>(t.n&Da)>0,IS=({deps:t})=>{if(t.length)for(let r=0;r<t.length;r++)t[r].w|=Da},CS=t=>{const{deps:r}=t;if(r.length){let l=0;for(let h=0;h<r.length;h++){const m=r[h];q1(m)&&!W1(m)?m.delete(t):r[l++]=m,m.w&=~Da,m.n&=~Da}r.length=l}},qf=new WeakMap;let ld=0,Da=1;const $_=30;let Mo;const Zl=Symbol(""),U_=Symbol("");class Iy{constructor(r,l=null,h){this.fn=r,this.scheduler=l,this.active=!0,this.deps=[],this.parent=void 0,SS(this,h)}run(){if(!this.active)return this.fn();let r=Mo,l=Pa;for(;r;){if(r===this)return;r=r.parent}try{return this.parent=Mo,Mo=this,Pa=!0,Da=1<<++ld,ld<=$_?IS(this):qb(this),this.fn()}finally{ld<=$_&&CS(this),Da=1<<--ld,Mo=this.parent,Pa=l,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Mo===this?this.deferStop=!0:this.active&&(qb(this),this.onStop&&this.onStop(),this.active=!1)}}function qb(t){const{deps:r}=t;if(r.length){for(let l=0;l<r.length;l++)r[l].delete(t);r.length=0}}let Pa=!0;const H1=[];function Du(){H1.push(Pa),Pa=!1}function Ou(){const t=H1.pop();Pa=t===void 0?!0:t}function Zr(t,r,l){if(Pa&&Mo){let h=qf.get(t);h||qf.set(t,h=new Map);let m=h.get(l);m||h.set(l,m=Ay()),X1(m)}}function X1(t,r){let l=!1;ld<=$_?W1(t)||(t.n|=Da,l=!q1(t)):l=!t.has(Mo),l&&(t.add(Mo),Mo.deps.push(t))}function Ns(t,r,l,h,m,v){const T=qf.get(t);if(!T)return;let s=[];if(r==="clear")s=[...T.values()];else if(l==="length"&&yn(t)){const S=Number(h);T.forEach((z,O)=>{(O==="length"||O>=S)&&s.push(z)})}else switch(l!==void 0&&s.push(T.get(l)),r){case"add":yn(t)?Sy(l)&&s.push(T.get("length")):(s.push(T.get(Zl)),yu(t)&&s.push(T.get(U_)));break;case"delete":yn(t)||(s.push(T.get(Zl)),yu(t)&&s.push(T.get(U_)));break;case"set":yu(t)&&s.push(T.get(Zl));break}if(s.length===1)s[0]&&V_(s[0]);else{const S=[];for(const z of s)z&&S.push(...z);V_(Ay(S))}}function V_(t,r){const l=yn(t)?t:[...t];for(const h of l)h.computed&&Wb(h);for(const h of l)h.computed||Wb(h)}function Wb(t,r){(t!==Mo||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}function MS(t,r){var l;return(l=qf.get(t))===null||l===void 0?void 0:l.get(r)}const PS=by("__proto__,__v_isRef,__isVue"),K1=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(ky)),LS=Cy(),zS=Cy(!1,!0),RS=Cy(!0),Hb=DS();function DS(){const t={};return["includes","indexOf","lastIndexOf"].forEach(r=>{t[r]=function(...l){const h=Hn(this);for(let v=0,T=this.length;v<T;v++)Zr(h,"get",v+"");const m=h[r](...l);return m===-1||m===!1?h[r](...l.map(Hn)):m}}),["push","pop","shift","unshift","splice"].forEach(r=>{t[r]=function(...l){Du();const h=Hn(this)[r].apply(this,l);return Ou(),h}}),t}function OS(t){const r=Hn(this);return Zr(r,"has",t),r.hasOwnProperty(t)}function Cy(t=!1,r=!1){return function(h,m,v){if(m==="__v_isReactive")return!t;if(m==="__v_isReadonly")return t;if(m==="__v_isShallow")return r;if(m==="__v_raw"&&v===(t?r?JS:tw:r?ew:Q1).get(h))return h;const T=yn(h);if(!t){if(T&&Wn(Hb,m))return Reflect.get(Hb,m,v);if(m==="hasOwnProperty")return OS}const s=Reflect.get(h,m,v);return(ky(m)?K1.has(m):PS(m))||(t||Zr(h,"get",m),r)?s:Ii(s)?T&&Sy(m)?s:s.value:Ci(s)?t?nw(s):Ga(s):s}}const BS=Y1(),FS=Y1(!0);function Y1(t=!1){return function(l,h,m,v){let T=l[h];if(Eu(T)&&Ii(T)&&!Ii(m))return!1;if(!t&&(!Wf(m)&&!Eu(m)&&(T=Hn(T),m=Hn(m)),!yn(l)&&Ii(T)&&!Ii(m)))return T.value=m,!0;const s=yn(l)&&Sy(h)?Number(h)<l.length:Wn(l,h),S=Reflect.set(l,h,m,v);return l===Hn(v)&&(s?_d(m,T)&&Ns(l,"set",h,m):Ns(l,"add",h,m)),S}}function jS(t,r){const l=Wn(t,r);t[r];const h=Reflect.deleteProperty(t,r);return h&&l&&Ns(t,"delete",r,void 0),h}function NS(t,r){const l=Reflect.has(t,r);return(!ky(r)||!K1.has(r))&&Zr(t,"has",r),l}function $S(t){return Zr(t,"iterate",yn(t)?"length":Zl),Reflect.ownKeys(t)}const J1={get:LS,set:BS,deleteProperty:jS,has:NS,ownKeys:$S},US={get:RS,set(t,r){return!0},deleteProperty(t,r){return!0}},VS=zr({},J1,{get:zS,set:FS}),My=t=>t,km=t=>Reflect.getPrototypeOf(t);function Cf(t,r,l=!1,h=!1){t=t.__v_raw;const m=Hn(t),v=Hn(r);l||(r!==v&&Zr(m,"get",r),Zr(m,"get",v));const{has:T}=km(m),s=h?My:l?zy:yd;if(T.call(m,r))return s(t.get(r));if(T.call(m,v))return s(t.get(v));t!==m&&t.get(r)}function Mf(t,r=!1){const l=this.__v_raw,h=Hn(l),m=Hn(t);return r||(t!==m&&Zr(h,"has",t),Zr(h,"has",m)),t===m?l.has(t):l.has(t)||l.has(m)}function Pf(t,r=!1){return t=t.__v_raw,!r&&Zr(Hn(t),"iterate",Zl),Reflect.get(t,"size",t)}function Xb(t){t=Hn(t);const r=Hn(this);return km(r).has.call(r,t)||(r.add(t),Ns(r,"add",t,t)),this}function Kb(t,r){r=Hn(r);const l=Hn(this),{has:h,get:m}=km(l);let v=h.call(l,t);v||(t=Hn(t),v=h.call(l,t));const T=m.call(l,t);return l.set(t,r),v?_d(r,T)&&Ns(l,"set",t,r):Ns(l,"add",t,r),this}function Yb(t){const r=Hn(this),{has:l,get:h}=km(r);let m=l.call(r,t);m||(t=Hn(t),m=l.call(r,t)),h&&h.call(r,t);const v=r.delete(t);return m&&Ns(r,"delete",t,void 0),v}function Jb(){const t=Hn(this),r=t.size!==0,l=t.clear();return r&&Ns(t,"clear",void 0,void 0),l}function Lf(t,r){return function(h,m){const v=this,T=v.__v_raw,s=Hn(T),S=r?My:t?zy:yd;return!t&&Zr(s,"iterate",Zl),T.forEach((z,O)=>h.call(m,S(z),S(O),v))}}function zf(t,r,l){return function(...h){const m=this.__v_raw,v=Hn(m),T=yu(v),s=t==="entries"||t===Symbol.iterator&&T,S=t==="keys"&&T,z=m[t](...h),O=l?My:r?zy:yd;return!r&&Zr(v,"iterate",S?U_:Zl),{next(){const{value:B,done:Z}=z.next();return Z?{value:B,done:Z}:{value:s?[O(B[0]),O(B[1])]:O(B),done:Z}},[Symbol.iterator](){return this}}}}function Ta(t){return function(...r){return t==="delete"?!1:this}}function GS(){const t={get(v){return Cf(this,v)},get size(){return Pf(this)},has:Mf,add:Xb,set:Kb,delete:Yb,clear:Jb,forEach:Lf(!1,!1)},r={get(v){return Cf(this,v,!1,!0)},get size(){return Pf(this)},has:Mf,add:Xb,set:Kb,delete:Yb,clear:Jb,forEach:Lf(!1,!0)},l={get(v){return Cf(this,v,!0)},get size(){return Pf(this,!0)},has(v){return Mf.call(this,v,!0)},add:Ta("add"),set:Ta("set"),delete:Ta("delete"),clear:Ta("clear"),forEach:Lf(!0,!1)},h={get(v){return Cf(this,v,!0,!0)},get size(){return Pf(this,!0)},has(v){return Mf.call(this,v,!0)},add:Ta("add"),set:Ta("set"),delete:Ta("delete"),clear:Ta("clear"),forEach:Lf(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(v=>{t[v]=zf(v,!1,!1),l[v]=zf(v,!0,!1),r[v]=zf(v,!1,!0),h[v]=zf(v,!0,!0)}),[t,l,r,h]}const[ZS,qS,WS,HS]=GS();function Py(t,r){const l=r?t?HS:WS:t?qS:ZS;return(h,m,v)=>m==="__v_isReactive"?!t:m==="__v_isReadonly"?t:m==="__v_raw"?h:Reflect.get(Wn(l,m)&&m in h?l:h,m,v)}const XS={get:Py(!1,!1)},KS={get:Py(!1,!0)},YS={get:Py(!0,!1)},Q1=new WeakMap,ew=new WeakMap,tw=new WeakMap,JS=new WeakMap;function QS(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function eA(t){return t.__v_skip||!Object.isExtensible(t)?0:QS(xS(t))}function Ga(t){return Eu(t)?t:Ly(t,!1,J1,XS,Q1)}function tA(t){return Ly(t,!1,VS,KS,ew)}function nw(t){return Ly(t,!0,US,YS,tw)}function Ly(t,r,l,h,m){if(!Ci(t)||t.__v_raw&&!(r&&t.__v_isReactive))return t;const v=m.get(t);if(v)return v;const T=eA(t);if(T===0)return t;const s=new Proxy(t,T===2?h:l);return m.set(t,s),s}function La(t){return Eu(t)?La(t.__v_raw):!!(t&&t.__v_isReactive)}function Eu(t){return!!(t&&t.__v_isReadonly)}function Wf(t){return!!(t&&t.__v_isShallow)}function iw(t){return La(t)||Eu(t)}function Hn(t){const r=t&&t.__v_raw;return r?Hn(r):t}function ku(t){return Zf(t,"__v_skip",!0),t}const yd=t=>Ci(t)?Ga(t):t,zy=t=>Ci(t)?nw(t):t;function rw(t){Pa&&Mo&&(t=Hn(t),X1(t.dep||(t.dep=Ay())))}function ow(t,r){t=Hn(t);const l=t.dep;l&&V_(l)}function Ii(t){return!!(t&&t.__v_isRef===!0)}function Ni(t){return sw(t,!1)}function Sm(t){return sw(t,!0)}function sw(t,r){return Ii(t)?t:new nA(t,r)}class nA{constructor(r,l){this.__v_isShallow=l,this.dep=void 0,this.__v_isRef=!0,this._rawValue=l?r:Hn(r),this._value=l?r:yd(r)}get value(){return rw(this),this._value}set value(r){const l=this.__v_isShallow||Wf(r)||Eu(r);r=l?r:Hn(r),_d(r,this._rawValue)&&(this._rawValue=r,this._value=l?r:yd(r),ow(this))}}function fn(t){return Ii(t)?t.value:t}const iA={get:(t,r,l)=>fn(Reflect.get(t,r,l)),set:(t,r,l,h)=>{const m=t[r];return Ii(m)&&!Ii(l)?(m.value=l,!0):Reflect.set(t,r,l,h)}};function aw(t){return La(t)?t:new Proxy(t,iA)}function rA(t){const r=yn(t)?new Array(t.length):{};for(const l in t)r[l]=sA(t,l);return r}class oA{constructor(r,l,h){this._object=r,this._key=l,this._defaultValue=h,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return MS(Hn(this._object),this._key)}}function sA(t,r,l){const h=t[r];return Ii(h)?h:new oA(t,r,l)}var lw;class aA{constructor(r,l,h,m){this._setter=l,this.dep=void 0,this.__v_isRef=!0,this[lw]=!1,this._dirty=!0,this.effect=new Iy(r,()=>{this._dirty||(this._dirty=!0,ow(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!m,this.__v_isReadonly=h}get value(){const r=Hn(this);return rw(r),(r._dirty||!r._cacheable)&&(r._dirty=!1,r._value=r.effect.run()),r._value}set value(r){this._setter(r)}}lw="__v_isReadonly";function lA(t,r,l=!1){let h,m;const v=wn(t);return v?(h=t,m=zo):(h=t.get,m=t.set),new aA(h,m,v||!m,l)}function za(t,r,l,h){let m;try{m=h?t(...h):t()}catch(v){Am(v,r,l)}return m}function Ro(t,r,l,h){if(wn(t)){const v=za(t,r,l,h);return v&&N1(v)&&v.catch(T=>{Am(T,r,l)}),v}const m=[];for(let v=0;v<t.length;v++)m.push(Ro(t[v],r,l,h));return m}function Am(t,r,l,h=!0){const m=r?r.vnode:null;if(r){let v=r.parent;const T=r.proxy,s=l;for(;v;){const z=v.ec;if(z){for(let O=0;O<z.length;O++)if(z[O](t,T,s)===!1)return}v=v.parent}const S=r.appContext.config.errorHandler;if(S){za(S,null,10,[t,T,s]);return}}cA(t,l,m,h)}function cA(t,r,l,h=!0){console.error(t)}let vd=!1,G_=!1;const _r=[];let ls=0;const vu=[];let Os=null,$l=0;const cw=Promise.resolve();let Ry=null;function Dy(t){const r=Ry||cw;return t?r.then(this?t.bind(this):t):r}function uA(t){let r=ls+1,l=_r.length;for(;r<l;){const h=r+l>>>1;bd(_r[h])<t?r=h+1:l=h}return r}function Oy(t){(!_r.length||!_r.includes(t,vd&&t.allowRecurse?ls+1:ls))&&(t.id==null?_r.push(t):_r.splice(uA(t.id),0,t),uw())}function uw(){!vd&&!G_&&(G_=!0,Ry=cw.then(dw))}function hA(t){const r=_r.indexOf(t);r>ls&&_r.splice(r,1)}function dA(t){yn(t)?vu.push(...t):(!Os||!Os.includes(t,t.allowRecurse?$l+1:$l))&&vu.push(t),uw()}function Qb(t,r=vd?ls+1:0){for(;r<_r.length;r++){const l=_r[r];l&&l.pre&&(_r.splice(r,1),r--,l())}}function hw(t){if(vu.length){const r=[...new Set(vu)];if(vu.length=0,Os){Os.push(...r);return}for(Os=r,Os.sort((l,h)=>bd(l)-bd(h)),$l=0;$l<Os.length;$l++)Os[$l]();Os=null,$l=0}}const bd=t=>t.id==null?1/0:t.id,pA=(t,r)=>{const l=bd(t)-bd(r);if(l===0){if(t.pre&&!r.pre)return-1;if(r.pre&&!t.pre)return 1}return l};function dw(t){G_=!1,vd=!0,_r.sort(pA);const r=zo;try{for(ls=0;ls<_r.length;ls++){const l=_r[ls];l&&l.active!==!1&&za(l,null,14)}}finally{ls=0,_r.length=0,hw(),vd=!1,Ry=null,(_r.length||vu.length)&&dw()}}function fA(t,r,...l){if(t.isUnmounted)return;const h=t.vnode.props||xi;let m=l;const v=r.startsWith("update:"),T=v&&r.slice(7);if(T&&T in h){const O=`${T==="modelValue"?"model":T}Modifiers`,{number:B,trim:Z}=h[O]||xi;Z&&(m=l.map(me=>nr(me)?me.trim():me)),B&&(m=l.map(ES))}let s,S=h[s=c_(r)]||h[s=c_(us(r))];!S&&v&&(S=h[s=c_(Ru(r))]),S&&Ro(S,t,6,m);const z=h[s+"Once"];if(z){if(!t.emitted)t.emitted={};else if(t.emitted[s])return;t.emitted[s]=!0,Ro(z,t,6,m)}}function pw(t,r,l=!1){const h=r.emitsCache,m=h.get(t);if(m!==void 0)return m;const v=t.emits;let T={},s=!1;if(!wn(t)){const S=z=>{const O=pw(z,r,!0);O&&(s=!0,zr(T,O))};!l&&r.mixins.length&&r.mixins.forEach(S),t.extends&&S(t.extends),t.mixins&&t.mixins.forEach(S)}return!v&&!s?(Ci(t)&&h.set(t,null),null):(yn(v)?v.forEach(S=>T[S]=null):zr(T,v),Ci(t)&&h.set(t,T),T)}function Im(t,r){return!t||!xm(r)?!1:(r=r.slice(2).replace(/Once$/,""),Wn(t,r[0].toLowerCase()+r.slice(1))||Wn(t,Ru(r))||Wn(t,r))}let yr=null,Cm=null;function Hf(t){const r=yr;return yr=t,Cm=t&&t.type.__scopeId||null,r}function mA(t){Cm=t}function gA(){Cm=null}function $n(t,r=yr,l){if(!r||t._n)return t;const h=(...m)=>{h._d&&lx(-1);const v=Hf(r);let T;try{T=t(...m)}finally{Hf(v),h._d&&lx(1)}return T};return h._n=!0,h._c=!0,h._d=!0,h}function h_(t){const{type:r,vnode:l,proxy:h,withProxy:m,props:v,propsOptions:[T],slots:s,attrs:S,emit:z,render:O,renderCache:B,data:Z,setupState:me,ctx:_e,inheritAttrs:Ie}=t;let Te,ve;const $e=Hf(t);try{if(l.shapeFlag&4){const qe=m||h;Te=as(O.call(qe,qe,B,v,me,Z,_e)),ve=S}else{const qe=r;Te=as(qe.length>1?qe(v,{attrs:S,slots:s,emit:z}):qe(v,null)),ve=r.props?S:_A(S)}}catch(qe){dd.length=0,Am(qe,t,1),Te=en(Oa)}let Fe=Te;if(ve&&Ie!==!1){const qe=Object.keys(ve),{shapeFlag:fe}=Fe;qe.length&&fe&7&&(T&&qe.some(Ty)&&(ve=yA(ve,T)),Fe=Su(Fe,ve))}return l.dirs&&(Fe=Su(Fe),Fe.dirs=Fe.dirs?Fe.dirs.concat(l.dirs):l.dirs),l.transition&&(Fe.transition=l.transition),Te=Fe,Hf($e),Te}const _A=t=>{let r;for(const l in t)(l==="class"||l==="style"||xm(l))&&((r||(r={}))[l]=t[l]);return r},yA=(t,r)=>{const l={};for(const h in t)(!Ty(h)||!(h.slice(9)in r))&&(l[h]=t[h]);return l};function vA(t,r,l){const{props:h,children:m,component:v}=t,{props:T,children:s,patchFlag:S}=r,z=v.emitsOptions;if(r.dirs||r.transition)return!0;if(l&&S>=0){if(S&1024)return!0;if(S&16)return h?ex(h,T,z):!!T;if(S&8){const O=r.dynamicProps;for(let B=0;B<O.length;B++){const Z=O[B];if(T[Z]!==h[Z]&&!Im(z,Z))return!0}}}else return(m||s)&&(!s||!s.$stable)?!0:h===T?!1:h?T?ex(h,T,z):!0:!!T;return!1}function ex(t,r,l){const h=Object.keys(r);if(h.length!==Object.keys(t).length)return!0;for(let m=0;m<h.length;m++){const v=h[m];if(r[v]!==t[v]&&!Im(l,v))return!0}return!1}function bA({vnode:t,parent:r},l){for(;r&&r.subTree===t;)(t=r.vnode).el=l,r=r.parent}const xA=t=>t.__isSuspense;function wA(t,r){r&&r.pendingBranch?yn(t)?r.effects.push(...t):r.effects.push(t):dA(t)}function ql(t,r){if(Bi){let l=Bi.provides;const h=Bi.parent&&Bi.parent.provides;h===l&&(l=Bi.provides=Object.create(h)),l[t]=r}}function $i(t,r,l=!1){const h=Bi||yr;if(h){const m=h.parent==null?h.vnode.appContext&&h.vnode.appContext.provides:h.parent.provides;if(m&&t in m)return m[t];if(arguments.length>1)return l&&wn(r)?r.call(h.proxy):r}}const Rf={};function vr(t,r,l){return fw(t,r,l)}function fw(t,r,{immediate:l,deep:h,flush:m,onTrack:v,onTrigger:T}=xi){const s=Z1()===(Bi==null?void 0:Bi.scope)?Bi:null;let S,z=!1,O=!1;if(Ii(t)?(S=()=>t.value,z=Wf(t)):La(t)?(S=()=>t,h=!0):yn(t)?(O=!0,z=t.some(Fe=>La(Fe)||Wf(Fe)),S=()=>t.map(Fe=>{if(Ii(Fe))return Fe.value;if(La(Fe))return gu(Fe);if(wn(Fe))return za(Fe,s,2)})):wn(t)?r?S=()=>za(t,s,2):S=()=>{if(!(s&&s.isUnmounted))return B&&B(),Ro(t,s,3,[Z])}:S=zo,r&&h){const Fe=S;S=()=>gu(Fe())}let B,Z=Fe=>{B=ve.onStop=()=>{za(Fe,s,4)}},me;if(Td)if(Z=zo,r?l&&Ro(r,s,3,[S(),O?[]:void 0,Z]):S(),m==="sync"){const Fe=fI();me=Fe.__watcherHandles||(Fe.__watcherHandles=[])}else return zo;let _e=O?new Array(t.length).fill(Rf):Rf;const Ie=()=>{if(ve.active)if(r){const Fe=ve.run();(h||z||(O?Fe.some((qe,fe)=>_d(qe,_e[fe])):_d(Fe,_e)))&&(B&&B(),Ro(r,s,3,[Fe,_e===Rf?void 0:O&&_e[0]===Rf?[]:_e,Z]),_e=Fe)}else ve.run()};Ie.allowRecurse=!!r;let Te;m==="sync"?Te=Ie:m==="post"?Te=()=>Vr(Ie,s&&s.suspense):(Ie.pre=!0,s&&(Ie.id=s.uid),Te=()=>Oy(Ie));const ve=new Iy(S,Te);r?l?Ie():_e=ve.run():m==="post"?Vr(ve.run.bind(ve),s&&s.suspense):ve.run();const $e=()=>{ve.stop(),s&&s.scope&&Ey(s.scope.effects,ve)};return me&&me.push($e),$e}function TA(t,r,l){const h=this.proxy,m=nr(t)?t.includes(".")?mw(h,t):()=>h[t]:t.bind(h,h);let v;wn(r)?v=r:(v=r.handler,l=r);const T=Bi;Au(this);const s=fw(m,v.bind(h),l);return T?Au(T):Wl(),s}function mw(t,r){const l=r.split(".");return()=>{let h=t;for(let m=0;m<l.length&&h;m++)h=h[l[m]];return h}}function gu(t,r){if(!Ci(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),Ii(t))gu(t.value,r);else if(yn(t))for(let l=0;l<t.length;l++)gu(t[l],r);else if(j1(t)||yu(t))t.forEach(l=>{gu(l,r)});else if(U1(t))for(const l in t)gu(t[l],r);return t}function Dr(t){return wn(t)?{setup:t,name:t.name}:t}const ud=t=>!!t.type.__asyncLoader,gw=t=>t.type.__isKeepAlive;function EA(t,r){_w(t,"a",r)}function kA(t,r){_w(t,"da",r)}function _w(t,r,l=Bi){const h=t.__wdc||(t.__wdc=()=>{let m=l;for(;m;){if(m.isDeactivated)return;m=m.parent}return t()});if(Mm(r,h,l),l){let m=l.parent;for(;m&&m.parent;)gw(m.parent.vnode)&&SA(h,r,l,m),m=m.parent}}function SA(t,r,l,h){const m=Mm(r,t,h,!0);ec(()=>{Ey(h[r],m)},l)}function Mm(t,r,l=Bi,h=!1){if(l){const m=l[t]||(l[t]=[]),v=r.__weh||(r.__weh=(...T)=>{if(l.isUnmounted)return;Du(),Au(l);const s=Ro(r,l,t,T);return Wl(),Ou(),s});return h?m.unshift(v):m.push(v),v}}const Us=t=>(r,l=Bi)=>(!Td||t==="sp")&&Mm(t,(...h)=>r(...h),l),AA=Us("bm"),Pm=Us("m"),IA=Us("bu"),CA=Us("u"),MA=Us("bum"),ec=Us("um"),PA=Us("sp"),LA=Us("rtg"),zA=Us("rtc");function RA(t,r=Bi){Mm("ec",t,r)}function Ol(t,r,l,h){const m=t.dirs,v=r&&r.dirs;for(let T=0;T<m.length;T++){const s=m[T];v&&(s.oldValue=v[T].value);let S=s.dir[h];S&&(Du(),Ro(S,l,8,[t.el,s,t,r]),Ou())}}const yw="components";function gr(t,r){return OA(yw,t,!0,r)||t}const DA=Symbol();function OA(t,r,l=!0,h=!1){const m=yr||Bi;if(m){const v=m.type;if(t===yw){const s=cI(v,!1);if(s&&(s===r||s===us(r)||s===Em(us(r))))return v}const T=tx(m[t]||v[t],r)||tx(m.appContext[t],r);return!T&&h?v:T}}function tx(t,r){return t&&(t[r]||t[us(r)]||t[Em(us(r))])}function xd(t,r,l={},h,m){if(yr.isCE||yr.parent&&ud(yr.parent)&&yr.parent.isCE)return r!=="default"&&(l.name=r),en("slot",l,h&&h());let v=t[r];v&&v._c&&(v._d=!1),Lr();const T=v&&vw(v(l)),s=tc(eo,{key:l.key||T&&T.key||`_${r}`},T||(h?h():[]),T&&t._===1?64:-2);return!m&&s.scopeId&&(s.slotScopeIds=[s.scopeId+"-s"]),v&&v._c&&(v._d=!0),s}function vw(t){return t.some(r=>Kf(r)?!(r.type===Oa||r.type===eo&&!vw(r.children)):!0)?t:null}const Z_=t=>t?Pw(t)?$y(t)||t.proxy:Z_(t.parent):null,hd=zr(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Z_(t.parent),$root:t=>Z_(t.root),$emit:t=>t.emit,$options:t=>By(t),$forceUpdate:t=>t.f||(t.f=()=>Oy(t.update)),$nextTick:t=>t.n||(t.n=Dy.bind(t.proxy)),$watch:t=>TA.bind(t)}),d_=(t,r)=>t!==xi&&!t.__isScriptSetup&&Wn(t,r),BA={get({_:t},r){const{ctx:l,setupState:h,data:m,props:v,accessCache:T,type:s,appContext:S}=t;let z;if(r[0]!=="$"){const me=T[r];if(me!==void 0)switch(me){case 1:return h[r];case 2:return m[r];case 4:return l[r];case 3:return v[r]}else{if(d_(h,r))return T[r]=1,h[r];if(m!==xi&&Wn(m,r))return T[r]=2,m[r];if((z=t.propsOptions[0])&&Wn(z,r))return T[r]=3,v[r];if(l!==xi&&Wn(l,r))return T[r]=4,l[r];q_&&(T[r]=0)}}const O=hd[r];let B,Z;if(O)return r==="$attrs"&&Zr(t,"get",r),O(t);if((B=s.__cssModules)&&(B=B[r]))return B;if(l!==xi&&Wn(l,r))return T[r]=4,l[r];if(Z=S.config.globalProperties,Wn(Z,r))return Z[r]},set({_:t},r,l){const{data:h,setupState:m,ctx:v}=t;return d_(m,r)?(m[r]=l,!0):h!==xi&&Wn(h,r)?(h[r]=l,!0):Wn(t.props,r)||r[0]==="$"&&r.slice(1)in t?!1:(v[r]=l,!0)},has({_:{data:t,setupState:r,accessCache:l,ctx:h,appContext:m,propsOptions:v}},T){let s;return!!l[T]||t!==xi&&Wn(t,T)||d_(r,T)||(s=v[0])&&Wn(s,T)||Wn(h,T)||Wn(hd,T)||Wn(m.config.globalProperties,T)},defineProperty(t,r,l){return l.get!=null?t._.accessCache[r]=0:Wn(l,"value")&&this.set(t,r,l.value,null),Reflect.defineProperty(t,r,l)}};let q_=!0;function FA(t){const r=By(t),l=t.proxy,h=t.ctx;q_=!1,r.beforeCreate&&nx(r.beforeCreate,t,"bc");const{data:m,computed:v,methods:T,watch:s,provide:S,inject:z,created:O,beforeMount:B,mounted:Z,beforeUpdate:me,updated:_e,activated:Ie,deactivated:Te,beforeDestroy:ve,beforeUnmount:$e,destroyed:Fe,unmounted:qe,render:fe,renderTracked:et,renderTriggered:Pe,errorCaptured:Ge,serverPrefetch:Ye,expose:dt,inheritAttrs:wt,components:Tn,directives:Zt,filters:si}=r;if(z&&jA(z,h,null,t.appContext.config.unwrapInjectedRef),T)for(const rn in T){const Ft=T[rn];wn(Ft)&&(h[rn]=Ft.bind(l))}if(m){const rn=m.call(l,l);Ci(rn)&&(t.data=Ga(rn))}if(q_=!0,v)for(const rn in v){const Ft=v[rn],ni=wn(Ft)?Ft.bind(l,l):wn(Ft.get)?Ft.get.bind(l,l):zo,Jt=!wn(Ft)&&wn(Ft.set)?Ft.set.bind(l):zo,Mn=zi({get:ni,set:Jt});Object.defineProperty(h,rn,{enumerable:!0,configurable:!0,get:()=>Mn.value,set:Fn=>Mn.value=Fn})}if(s)for(const rn in s)bw(s[rn],h,l,rn);if(S){const rn=wn(S)?S.call(l):S;Reflect.ownKeys(rn).forEach(Ft=>{ql(Ft,rn[Ft])})}O&&nx(O,t,"c");function Cn(rn,Ft){yn(Ft)?Ft.forEach(ni=>rn(ni.bind(l))):Ft&&rn(Ft.bind(l))}if(Cn(AA,B),Cn(Pm,Z),Cn(IA,me),Cn(CA,_e),Cn(EA,Ie),Cn(kA,Te),Cn(RA,Ge),Cn(zA,et),Cn(LA,Pe),Cn(MA,$e),Cn(ec,qe),Cn(PA,Ye),yn(dt))if(dt.length){const rn=t.exposed||(t.exposed={});dt.forEach(Ft=>{Object.defineProperty(rn,Ft,{get:()=>l[Ft],set:ni=>l[Ft]=ni})})}else t.exposed||(t.exposed={});fe&&t.render===zo&&(t.render=fe),wt!=null&&(t.inheritAttrs=wt),Tn&&(t.components=Tn),Zt&&(t.directives=Zt)}function jA(t,r,l=zo,h=!1){yn(t)&&(t=W_(t));for(const m in t){const v=t[m];let T;Ci(v)?"default"in v?T=$i(v.from||m,v.default,!0):T=$i(v.from||m):T=$i(v),Ii(T)&&h?Object.defineProperty(r,m,{enumerable:!0,configurable:!0,get:()=>T.value,set:s=>T.value=s}):r[m]=T}}function nx(t,r,l){Ro(yn(t)?t.map(h=>h.bind(r.proxy)):t.bind(r.proxy),r,l)}function bw(t,r,l,h){const m=h.includes(".")?mw(l,h):()=>l[h];if(nr(t)){const v=r[t];wn(v)&&vr(m,v)}else if(wn(t))vr(m,t.bind(l));else if(Ci(t))if(yn(t))t.forEach(v=>bw(v,r,l,h));else{const v=wn(t.handler)?t.handler.bind(l):r[t.handler];wn(v)&&vr(m,v,t)}}function By(t){const r=t.type,{mixins:l,extends:h}=r,{mixins:m,optionsCache:v,config:{optionMergeStrategies:T}}=t.appContext,s=v.get(r);let S;return s?S=s:!m.length&&!l&&!h?S=r:(S={},m.length&&m.forEach(z=>Xf(S,z,T,!0)),Xf(S,r,T)),Ci(r)&&v.set(r,S),S}function Xf(t,r,l,h=!1){const{mixins:m,extends:v}=r;v&&Xf(t,v,l,!0),m&&m.forEach(T=>Xf(t,T,l,!0));for(const T in r)if(!(h&&T==="expose")){const s=NA[T]||l&&l[T];t[T]=s?s(t[T],r[T]):r[T]}return t}const NA={data:ix,props:jl,emits:jl,methods:jl,computed:jl,beforeCreate:Ir,created:Ir,beforeMount:Ir,mounted:Ir,beforeUpdate:Ir,updated:Ir,beforeDestroy:Ir,beforeUnmount:Ir,destroyed:Ir,unmounted:Ir,activated:Ir,deactivated:Ir,errorCaptured:Ir,serverPrefetch:Ir,components:jl,directives:jl,watch:UA,provide:ix,inject:$A};function ix(t,r){return r?t?function(){return zr(wn(t)?t.call(this,this):t,wn(r)?r.call(this,this):r)}:r:t}function $A(t,r){return jl(W_(t),W_(r))}function W_(t){if(yn(t)){const r={};for(let l=0;l<t.length;l++)r[t[l]]=t[l];return r}return t}function Ir(t,r){return t?[...new Set([].concat(t,r))]:r}function jl(t,r){return t?zr(zr(Object.create(null),t),r):r}function UA(t,r){if(!t)return r;if(!r)return t;const l=zr(Object.create(null),t);for(const h in r)l[h]=Ir(t[h],r[h]);return l}function VA(t,r,l,h=!1){const m={},v={};Zf(v,zm,1),t.propsDefaults=Object.create(null),xw(t,r,m,v);for(const T in t.propsOptions[0])T in m||(m[T]=void 0);l?t.props=h?m:tA(m):t.type.props?t.props=m:t.props=v,t.attrs=v}function GA(t,r,l,h){const{props:m,attrs:v,vnode:{patchFlag:T}}=t,s=Hn(m),[S]=t.propsOptions;let z=!1;if((h||T>0)&&!(T&16)){if(T&8){const O=t.vnode.dynamicProps;for(let B=0;B<O.length;B++){let Z=O[B];if(Im(t.emitsOptions,Z))continue;const me=r[Z];if(S)if(Wn(v,Z))me!==v[Z]&&(v[Z]=me,z=!0);else{const _e=us(Z);m[_e]=H_(S,s,_e,me,t,!1)}else me!==v[Z]&&(v[Z]=me,z=!0)}}}else{xw(t,r,m,v)&&(z=!0);let O;for(const B in s)(!r||!Wn(r,B)&&((O=Ru(B))===B||!Wn(r,O)))&&(S?l&&(l[B]!==void 0||l[O]!==void 0)&&(m[B]=H_(S,s,B,void 0,t,!0)):delete m[B]);if(v!==s)for(const B in v)(!r||!Wn(r,B))&&(delete v[B],z=!0)}z&&Ns(t,"set","$attrs")}function xw(t,r,l,h){const[m,v]=t.propsOptions;let T=!1,s;if(r)for(let S in r){if($f(S))continue;const z=r[S];let O;m&&Wn(m,O=us(S))?!v||!v.includes(O)?l[O]=z:(s||(s={}))[O]=z:Im(t.emitsOptions,S)||(!(S in h)||z!==h[S])&&(h[S]=z,T=!0)}if(v){const S=Hn(l),z=s||xi;for(let O=0;O<v.length;O++){const B=v[O];l[B]=H_(m,S,B,z[B],t,!Wn(z,B))}}return T}function H_(t,r,l,h,m,v){const T=t[l];if(T!=null){const s=Wn(T,"default");if(s&&h===void 0){const S=T.default;if(T.type!==Function&&wn(S)){const{propsDefaults:z}=m;l in z?h=z[l]:(Au(m),h=z[l]=S.call(null,r),Wl())}else h=S}T[0]&&(v&&!s?h=!1:T[1]&&(h===""||h===Ru(l))&&(h=!0))}return h}function ww(t,r,l=!1){const h=r.propsCache,m=h.get(t);if(m)return m;const v=t.props,T={},s=[];let S=!1;if(!wn(t)){const O=B=>{S=!0;const[Z,me]=ww(B,r,!0);zr(T,Z),me&&s.push(...me)};!l&&r.mixins.length&&r.mixins.forEach(O),t.extends&&O(t.extends),t.mixins&&t.mixins.forEach(O)}if(!v&&!S)return Ci(t)&&h.set(t,_u),_u;if(yn(v))for(let O=0;O<v.length;O++){const B=us(v[O]);rx(B)&&(T[B]=xi)}else if(v)for(const O in v){const B=us(O);if(rx(B)){const Z=v[O],me=T[B]=yn(Z)||wn(Z)?{type:Z}:Object.assign({},Z);if(me){const _e=ax(Boolean,me.type),Ie=ax(String,me.type);me[0]=_e>-1,me[1]=Ie<0||_e<Ie,(_e>-1||Wn(me,"default"))&&s.push(B)}}}const z=[T,s];return Ci(t)&&h.set(t,z),z}function rx(t){return t[0]!=="$"}function ox(t){const r=t&&t.toString().match(/^\s*(function|class) (\w+)/);return r?r[2]:t===null?"null":""}function sx(t,r){return ox(t)===ox(r)}function ax(t,r){return yn(r)?r.findIndex(l=>sx(l,t)):wn(r)&&sx(r,t)?0:-1}const Tw=t=>t[0]==="_"||t==="$stable",Fy=t=>yn(t)?t.map(as):[as(t)],ZA=(t,r,l)=>{if(r._n)return r;const h=$n((...m)=>Fy(r(...m)),l);return h._c=!1,h},Ew=(t,r,l)=>{const h=t._ctx;for(const m in t){if(Tw(m))continue;const v=t[m];if(wn(v))r[m]=ZA(m,v,h);else if(v!=null){const T=Fy(v);r[m]=()=>T}}},kw=(t,r)=>{const l=Fy(r);t.slots.default=()=>l},qA=(t,r)=>{if(t.vnode.shapeFlag&32){const l=r._;l?(t.slots=Hn(r),Zf(r,"_",l)):Ew(r,t.slots={})}else t.slots={},r&&kw(t,r);Zf(t.slots,zm,1)},WA=(t,r,l)=>{const{vnode:h,slots:m}=t;let v=!0,T=xi;if(h.shapeFlag&32){const s=r._;s?l&&s===1?v=!1:(zr(m,r),!l&&s===1&&delete m._):(v=!r.$stable,Ew(r,m)),T=r}else r&&(kw(t,r),T={default:1});if(v)for(const s in m)!Tw(s)&&!(s in T)&&delete m[s]};function Sw(){return{app:null,config:{isNativeTag:yS,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let HA=0;function XA(t,r){return function(h,m=null){wn(h)||(h=Object.assign({},h)),m!=null&&!Ci(m)&&(m=null);const v=Sw(),T=new Set;let s=!1;const S=v.app={_uid:HA++,_component:h,_props:m,_container:null,_context:v,_instance:null,version:mI,get config(){return v.config},set config(z){},use(z,...O){return T.has(z)||(z&&wn(z.install)?(T.add(z),z.install(S,...O)):wn(z)&&(T.add(z),z(S,...O))),S},mixin(z){return v.mixins.includes(z)||v.mixins.push(z),S},component(z,O){return O?(v.components[z]=O,S):v.components[z]},directive(z,O){return O?(v.directives[z]=O,S):v.directives[z]},mount(z,O,B){if(!s){const Z=en(h,m);return Z.appContext=v,O&&r?r(Z,z):t(Z,z,B),s=!0,S._container=z,z.__vue_app__=S,$y(Z.component)||Z.component.proxy}},unmount(){s&&(t(null,S._container),delete S._container.__vue_app__)},provide(z,O){return v.provides[z]=O,S}};return S}}function X_(t,r,l,h,m=!1){if(yn(t)){t.forEach((Z,me)=>X_(Z,r&&(yn(r)?r[me]:r),l,h,m));return}if(ud(h)&&!m)return;const v=h.shapeFlag&4?$y(h.component)||h.component.proxy:h.el,T=m?null:v,{i:s,r:S}=t,z=r&&r.r,O=s.refs===xi?s.refs={}:s.refs,B=s.setupState;if(z!=null&&z!==S&&(nr(z)?(O[z]=null,Wn(B,z)&&(B[z]=null)):Ii(z)&&(z.value=null)),wn(S))za(S,s,12,[T,O]);else{const Z=nr(S),me=Ii(S);if(Z||me){const _e=()=>{if(t.f){const Ie=Z?Wn(B,S)?B[S]:O[S]:S.value;m?yn(Ie)&&Ey(Ie,v):yn(Ie)?Ie.includes(v)||Ie.push(v):Z?(O[S]=[v],Wn(B,S)&&(B[S]=O[S])):(S.value=[v],t.k&&(O[t.k]=S.value))}else Z?(O[S]=T,Wn(B,S)&&(B[S]=T)):me&&(S.value=T,t.k&&(O[t.k]=T))};T?(_e.id=-1,Vr(_e,l)):_e()}}}const Vr=wA;function KA(t){return YA(t)}function YA(t,r){const l=kS();l.__VUE__=!0;const{insert:h,remove:m,patchProp:v,createElement:T,createText:s,createComment:S,setText:z,setElementText:O,parentNode:B,nextSibling:Z,setScopeId:me=zo,insertStaticContent:_e}=t,Ie=(ne,ge,ze,We=null,ot=null,ft=null,Tt=!1,ht=null,yt=!!ge.dynamicChildren)=>{if(ne===ge)return;ne&&!sd(ne,ge)&&(We=pt(ne),Fn(ne,ot,ft,!0),ne=null),ge.patchFlag===-2&&(yt=!1,ge.dynamicChildren=null);const{type:at,ref:zt,shapeFlag:It}=ge;switch(at){case Lm:Te(ne,ge,ze,We);break;case Oa:ve(ne,ge,ze,We);break;case p_:ne==null&&$e(ge,ze,We,Tt);break;case eo:Tn(ne,ge,ze,We,ot,ft,Tt,ht,yt);break;default:It&1?fe(ne,ge,ze,We,ot,ft,Tt,ht,yt):It&6?Zt(ne,ge,ze,We,ot,ft,Tt,ht,yt):(It&64||It&128)&&at.process(ne,ge,ze,We,ot,ft,Tt,ht,yt,gn)}zt!=null&&ot&&X_(zt,ne&&ne.ref,ft,ge||ne,!ge)},Te=(ne,ge,ze,We)=>{if(ne==null)h(ge.el=s(ge.children),ze,We);else{const ot=ge.el=ne.el;ge.children!==ne.children&&z(ot,ge.children)}},ve=(ne,ge,ze,We)=>{ne==null?h(ge.el=S(ge.children||""),ze,We):ge.el=ne.el},$e=(ne,ge,ze,We)=>{[ne.el,ne.anchor]=_e(ne.children,ge,ze,We,ne.el,ne.anchor)},Fe=({el:ne,anchor:ge},ze,We)=>{let ot;for(;ne&&ne!==ge;)ot=Z(ne),h(ne,ze,We),ne=ot;h(ge,ze,We)},qe=({el:ne,anchor:ge})=>{let ze;for(;ne&&ne!==ge;)ze=Z(ne),m(ne),ne=ze;m(ge)},fe=(ne,ge,ze,We,ot,ft,Tt,ht,yt)=>{Tt=Tt||ge.type==="svg",ne==null?et(ge,ze,We,ot,ft,Tt,ht,yt):Ye(ne,ge,ot,ft,Tt,ht,yt)},et=(ne,ge,ze,We,ot,ft,Tt,ht)=>{let yt,at;const{type:zt,props:It,shapeFlag:$t,transition:Kt,dirs:cn}=ne;if(yt=ne.el=T(ne.type,ft,It&&It.is,It),$t&8?O(yt,ne.children):$t&16&&Ge(ne.children,yt,null,We,ot,ft&&zt!=="foreignObject",Tt,ht),cn&&Ol(ne,null,We,"created"),Pe(yt,ne,ne.scopeId,Tt,We),It){for(const Ln in It)Ln!=="value"&&!$f(Ln)&&v(yt,Ln,null,It[Ln],ft,ne.children,We,ot,xt);"value"in It&&v(yt,"value",null,It.value),(at=It.onVnodeBeforeMount)&&ss(at,We,ne)}cn&&Ol(ne,null,We,"beforeMount");const Pn=(!ot||ot&&!ot.pendingBranch)&&Kt&&!Kt.persisted;Pn&&Kt.beforeEnter(yt),h(yt,ge,ze),((at=It&&It.onVnodeMounted)||Pn||cn)&&Vr(()=>{at&&ss(at,We,ne),Pn&&Kt.enter(yt),cn&&Ol(ne,null,We,"mounted")},ot)},Pe=(ne,ge,ze,We,ot)=>{if(ze&&me(ne,ze),We)for(let ft=0;ft<We.length;ft++)me(ne,We[ft]);if(ot){let ft=ot.subTree;if(ge===ft){const Tt=ot.vnode;Pe(ne,Tt,Tt.scopeId,Tt.slotScopeIds,ot.parent)}}},Ge=(ne,ge,ze,We,ot,ft,Tt,ht,yt=0)=>{for(let at=yt;at<ne.length;at++){const zt=ne[at]=ht?Aa(ne[at]):as(ne[at]);Ie(null,zt,ge,ze,We,ot,ft,Tt,ht)}},Ye=(ne,ge,ze,We,ot,ft,Tt)=>{const ht=ge.el=ne.el;let{patchFlag:yt,dynamicChildren:at,dirs:zt}=ge;yt|=ne.patchFlag&16;const It=ne.props||xi,$t=ge.props||xi;let Kt;ze&&Bl(ze,!1),(Kt=$t.onVnodeBeforeUpdate)&&ss(Kt,ze,ge,ne),zt&&Ol(ge,ne,ze,"beforeUpdate"),ze&&Bl(ze,!0);const cn=ot&&ge.type!=="foreignObject";if(at?dt(ne.dynamicChildren,at,ht,ze,We,cn,ft):Tt||Ft(ne,ge,ht,null,ze,We,cn,ft,!1),yt>0){if(yt&16)wt(ht,ge,It,$t,ze,We,ot);else if(yt&2&&It.class!==$t.class&&v(ht,"class",null,$t.class,ot),yt&4&&v(ht,"style",It.style,$t.style,ot),yt&8){const Pn=ge.dynamicProps;for(let Ln=0;Ln<Pn.length;Ln++){const ai=Pn[Ln],Fi=It[ai],Mi=$t[ai];(Mi!==Fi||ai==="value")&&v(ht,ai,Fi,Mi,ot,ne.children,ze,We,xt)}}yt&1&&ne.children!==ge.children&&O(ht,ge.children)}else!Tt&&at==null&&wt(ht,ge,It,$t,ze,We,ot);((Kt=$t.onVnodeUpdated)||zt)&&Vr(()=>{Kt&&ss(Kt,ze,ge,ne),zt&&Ol(ge,ne,ze,"updated")},We)},dt=(ne,ge,ze,We,ot,ft,Tt)=>{for(let ht=0;ht<ge.length;ht++){const yt=ne[ht],at=ge[ht],zt=yt.el&&(yt.type===eo||!sd(yt,at)||yt.shapeFlag&70)?B(yt.el):ze;Ie(yt,at,zt,null,We,ot,ft,Tt,!0)}},wt=(ne,ge,ze,We,ot,ft,Tt)=>{if(ze!==We){if(ze!==xi)for(const ht in ze)!$f(ht)&&!(ht in We)&&v(ne,ht,ze[ht],null,Tt,ge.children,ot,ft,xt);for(const ht in We){if($f(ht))continue;const yt=We[ht],at=ze[ht];yt!==at&&ht!=="value"&&v(ne,ht,at,yt,Tt,ge.children,ot,ft,xt)}"value"in We&&v(ne,"value",ze.value,We.value)}},Tn=(ne,ge,ze,We,ot,ft,Tt,ht,yt)=>{const at=ge.el=ne?ne.el:s(""),zt=ge.anchor=ne?ne.anchor:s("");let{patchFlag:It,dynamicChildren:$t,slotScopeIds:Kt}=ge;Kt&&(ht=ht?ht.concat(Kt):Kt),ne==null?(h(at,ze,We),h(zt,ze,We),Ge(ge.children,ze,zt,ot,ft,Tt,ht,yt)):It>0&&It&64&&$t&&ne.dynamicChildren?(dt(ne.dynamicChildren,$t,ze,ot,ft,Tt,ht),(ge.key!=null||ot&&ge===ot.subTree)&&Aw(ne,ge,!0)):Ft(ne,ge,ze,zt,ot,ft,Tt,ht,yt)},Zt=(ne,ge,ze,We,ot,ft,Tt,ht,yt)=>{ge.slotScopeIds=ht,ne==null?ge.shapeFlag&512?ot.ctx.activate(ge,ze,We,Tt,yt):si(ge,ze,We,ot,ft,Tt,yt):At(ne,ge,yt)},si=(ne,ge,ze,We,ot,ft,Tt)=>{const ht=ne.component=oI(ne,We,ot);if(gw(ne)&&(ht.ctx.renderer=gn),sI(ht),ht.asyncDep){if(ot&&ot.registerDep(ht,Cn),!ne.el){const yt=ht.subTree=en(Oa);ve(null,yt,ge,ze)}return}Cn(ht,ne,ge,ze,ot,ft,Tt)},At=(ne,ge,ze)=>{const We=ge.component=ne.component;if(vA(ne,ge,ze))if(We.asyncDep&&!We.asyncResolved){rn(We,ge,ze);return}else We.next=ge,hA(We.update),We.update();else ge.el=ne.el,We.vnode=ge},Cn=(ne,ge,ze,We,ot,ft,Tt)=>{const ht=()=>{if(ne.isMounted){let{next:zt,bu:It,u:$t,parent:Kt,vnode:cn}=ne,Pn=zt,Ln;Bl(ne,!1),zt?(zt.el=cn.el,rn(ne,zt,Tt)):zt=cn,It&&u_(It),(Ln=zt.props&&zt.props.onVnodeBeforeUpdate)&&ss(Ln,Kt,zt,cn),Bl(ne,!0);const ai=h_(ne),Fi=ne.subTree;ne.subTree=ai,Ie(Fi,ai,B(Fi.el),pt(Fi),ne,ot,ft),zt.el=ai.el,Pn===null&&bA(ne,ai.el),$t&&Vr($t,ot),(Ln=zt.props&&zt.props.onVnodeUpdated)&&Vr(()=>ss(Ln,Kt,zt,cn),ot)}else{let zt;const{el:It,props:$t}=ge,{bm:Kt,m:cn,parent:Pn}=ne,Ln=ud(ge);if(Bl(ne,!1),Kt&&u_(Kt),!Ln&&(zt=$t&&$t.onVnodeBeforeMount)&&ss(zt,Pn,ge),Bl(ne,!0),It&&sn){const ai=()=>{ne.subTree=h_(ne),sn(It,ne.subTree,ne,ot,null)};Ln?ge.type.__asyncLoader().then(()=>!ne.isUnmounted&&ai()):ai()}else{const ai=ne.subTree=h_(ne);Ie(null,ai,ze,We,ne,ot,ft),ge.el=ai.el}if(cn&&Vr(cn,ot),!Ln&&(zt=$t&&$t.onVnodeMounted)){const ai=ge;Vr(()=>ss(zt,Pn,ai),ot)}(ge.shapeFlag&256||Pn&&ud(Pn.vnode)&&Pn.vnode.shapeFlag&256)&&ne.a&&Vr(ne.a,ot),ne.isMounted=!0,ge=ze=We=null}},yt=ne.effect=new Iy(ht,()=>Oy(at),ne.scope),at=ne.update=()=>yt.run();at.id=ne.uid,Bl(ne,!0),at()},rn=(ne,ge,ze)=>{ge.component=ne;const We=ne.vnode.props;ne.vnode=ge,ne.next=null,GA(ne,ge.props,We,ze),WA(ne,ge.children,ze),Du(),Qb(),Ou()},Ft=(ne,ge,ze,We,ot,ft,Tt,ht,yt=!1)=>{const at=ne&&ne.children,zt=ne?ne.shapeFlag:0,It=ge.children,{patchFlag:$t,shapeFlag:Kt}=ge;if($t>0){if($t&128){Jt(at,It,ze,We,ot,ft,Tt,ht,yt);return}else if($t&256){ni(at,It,ze,We,ot,ft,Tt,ht,yt);return}}Kt&8?(zt&16&&xt(at,ot,ft),It!==at&&O(ze,It)):zt&16?Kt&16?Jt(at,It,ze,We,ot,ft,Tt,ht,yt):xt(at,ot,ft,!0):(zt&8&&O(ze,""),Kt&16&&Ge(It,ze,We,ot,ft,Tt,ht,yt))},ni=(ne,ge,ze,We,ot,ft,Tt,ht,yt)=>{ne=ne||_u,ge=ge||_u;const at=ne.length,zt=ge.length,It=Math.min(at,zt);let $t;for($t=0;$t<It;$t++){const Kt=ge[$t]=yt?Aa(ge[$t]):as(ge[$t]);Ie(ne[$t],Kt,ze,null,ot,ft,Tt,ht,yt)}at>zt?xt(ne,ot,ft,!0,!1,It):Ge(ge,ze,We,ot,ft,Tt,ht,yt,It)},Jt=(ne,ge,ze,We,ot,ft,Tt,ht,yt)=>{let at=0;const zt=ge.length;let It=ne.length-1,$t=zt-1;for(;at<=It&&at<=$t;){const Kt=ne[at],cn=ge[at]=yt?Aa(ge[at]):as(ge[at]);if(sd(Kt,cn))Ie(Kt,cn,ze,null,ot,ft,Tt,ht,yt);else break;at++}for(;at<=It&&at<=$t;){const Kt=ne[It],cn=ge[$t]=yt?Aa(ge[$t]):as(ge[$t]);if(sd(Kt,cn))Ie(Kt,cn,ze,null,ot,ft,Tt,ht,yt);else break;It--,$t--}if(at>It){if(at<=$t){const Kt=$t+1,cn=Kt<zt?ge[Kt].el:We;for(;at<=$t;)Ie(null,ge[at]=yt?Aa(ge[at]):as(ge[at]),ze,cn,ot,ft,Tt,ht,yt),at++}}else if(at>$t)for(;at<=It;)Fn(ne[at],ot,ft,!0),at++;else{const Kt=at,cn=at,Pn=new Map;for(at=cn;at<=$t;at++){const Ri=ge[at]=yt?Aa(ge[at]):as(ge[at]);Ri.key!=null&&Pn.set(Ri.key,at)}let Ln,ai=0;const Fi=$t-cn+1;let Mi=!1,No=0;const ar=new Array(Fi);for(at=0;at<Fi;at++)ar[at]=0;for(at=Kt;at<=It;at++){const Ri=ne[at];if(ai>=Fi){Fn(Ri,ot,ft,!0);continue}let Ui;if(Ri.key!=null)Ui=Pn.get(Ri.key);else for(Ln=cn;Ln<=$t;Ln++)if(ar[Ln-cn]===0&&sd(Ri,ge[Ln])){Ui=Ln;break}Ui===void 0?Fn(Ri,ot,ft,!0):(ar[Ui-cn]=at+1,Ui>=No?No=Ui:Mi=!0,Ie(Ri,ge[Ui],ze,null,ot,ft,Tt,ht,yt),ai++)}const no=Mi?JA(ar):_u;for(Ln=no.length-1,at=Fi-1;at>=0;at--){const Ri=cn+at,Ui=ge[Ri],mo=Ri+1<zt?ge[Ri+1].el:We;ar[at]===0?Ie(null,Ui,ze,mo,ot,ft,Tt,ht,yt):Mi&&(Ln<0||at!==no[Ln]?Mn(Ui,ze,mo,2):Ln--)}}},Mn=(ne,ge,ze,We,ot=null)=>{const{el:ft,type:Tt,transition:ht,children:yt,shapeFlag:at}=ne;if(at&6){Mn(ne.component.subTree,ge,ze,We);return}if(at&128){ne.suspense.move(ge,ze,We);return}if(at&64){Tt.move(ne,ge,ze,gn);return}if(Tt===eo){h(ft,ge,ze);for(let It=0;It<yt.length;It++)Mn(yt[It],ge,ze,We);h(ne.anchor,ge,ze);return}if(Tt===p_){Fe(ne,ge,ze);return}if(We!==2&&at&1&&ht)if(We===0)ht.beforeEnter(ft),h(ft,ge,ze),Vr(()=>ht.enter(ft),ot);else{const{leave:It,delayLeave:$t,afterLeave:Kt}=ht,cn=()=>h(ft,ge,ze),Pn=()=>{It(ft,()=>{cn(),Kt&&Kt()})};$t?$t(ft,cn,Pn):Pn()}else h(ft,ge,ze)},Fn=(ne,ge,ze,We=!1,ot=!1)=>{const{type:ft,props:Tt,ref:ht,children:yt,dynamicChildren:at,shapeFlag:zt,patchFlag:It,dirs:$t}=ne;if(ht!=null&&X_(ht,null,ze,ne,!0),zt&256){ge.ctx.deactivate(ne);return}const Kt=zt&1&&$t,cn=!ud(ne);let Pn;if(cn&&(Pn=Tt&&Tt.onVnodeBeforeUnmount)&&ss(Pn,ge,ne),zt&6)Xe(ne.component,ze,We);else{if(zt&128){ne.suspense.unmount(ze,We);return}Kt&&Ol(ne,null,ge,"beforeUnmount"),zt&64?ne.type.remove(ne,ge,ze,ot,gn,We):at&&(ft!==eo||It>0&&It&64)?xt(at,ge,ze,!1,!0):(ft===eo&&It&384||!ot&&zt&16)&&xt(yt,ge,ze),We&&hi(ne)}(cn&&(Pn=Tt&&Tt.onVnodeUnmounted)||Kt)&&Vr(()=>{Pn&&ss(Pn,ge,ne),Kt&&Ol(ne,null,ge,"unmounted")},ze)},hi=ne=>{const{type:ge,el:ze,anchor:We,transition:ot}=ne;if(ge===eo){fi(ze,We);return}if(ge===p_){qe(ne);return}const ft=()=>{m(ze),ot&&!ot.persisted&&ot.afterLeave&&ot.afterLeave()};if(ne.shapeFlag&1&&ot&&!ot.persisted){const{leave:Tt,delayLeave:ht}=ot,yt=()=>Tt(ze,ft);ht?ht(ne.el,ft,yt):yt()}else ft()},fi=(ne,ge)=>{let ze;for(;ne!==ge;)ze=Z(ne),m(ne),ne=ze;m(ge)},Xe=(ne,ge,ze)=>{const{bum:We,scope:ot,update:ft,subTree:Tt,um:ht}=ne;We&&u_(We),ot.stop(),ft&&(ft.active=!1,Fn(Tt,ne,ge,ze)),ht&&Vr(ht,ge),Vr(()=>{ne.isUnmounted=!0},ge),ge&&ge.pendingBranch&&!ge.isUnmounted&&ne.asyncDep&&!ne.asyncResolved&&ne.suspenseId===ge.pendingId&&(ge.deps--,ge.deps===0&&ge.resolve())},xt=(ne,ge,ze,We=!1,ot=!1,ft=0)=>{for(let Tt=ft;Tt<ne.length;Tt++)Fn(ne[Tt],ge,ze,We,ot)},pt=ne=>ne.shapeFlag&6?pt(ne.component.subTree):ne.shapeFlag&128?ne.suspense.next():Z(ne.anchor||ne.el),Bt=(ne,ge,ze)=>{ne==null?ge._vnode&&Fn(ge._vnode,null,null,!0):Ie(ge._vnode||null,ne,ge,null,null,null,ze),Qb(),hw(),ge._vnode=ne},gn={p:Ie,um:Fn,m:Mn,r:hi,mt:si,mc:Ge,pc:Ft,pbc:dt,n:pt,o:t};let En,sn;return r&&([En,sn]=r(gn)),{render:Bt,hydrate:En,createApp:XA(Bt,En)}}function Bl({effect:t,update:r},l){t.allowRecurse=r.allowRecurse=l}function Aw(t,r,l=!1){const h=t.children,m=r.children;if(yn(h)&&yn(m))for(let v=0;v<h.length;v++){const T=h[v];let s=m[v];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=m[v]=Aa(m[v]),s.el=T.el),l||Aw(T,s)),s.type===Lm&&(s.el=T.el)}}function JA(t){const r=t.slice(),l=[0];let h,m,v,T,s;const S=t.length;for(h=0;h<S;h++){const z=t[h];if(z!==0){if(m=l[l.length-1],t[m]<z){r[h]=m,l.push(h);continue}for(v=0,T=l.length-1;v<T;)s=v+T>>1,t[l[s]]<z?v=s+1:T=s;z<t[l[v]]&&(v>0&&(r[h]=l[v-1]),l[v]=h)}}for(v=l.length,T=l[v-1];v-- >0;)l[v]=T,T=r[T];return l}const QA=t=>t.__isTeleport,eo=Symbol(void 0),Lm=Symbol(void 0),Oa=Symbol(void 0),p_=Symbol(void 0),dd=[];let Po=null;function Lr(t=!1){dd.push(Po=t?null:[])}function eI(){dd.pop(),Po=dd[dd.length-1]||null}let wd=1;function lx(t){wd+=t}function Iw(t){return t.dynamicChildren=wd>0?Po||_u:null,eI(),wd>0&&Po&&Po.push(t),t}function Ra(t,r,l,h,m,v){return Iw(Gr(t,r,l,h,m,v,!0))}function tc(t,r,l,h,m){return Iw(en(t,r,l,h,m,!0))}function Kf(t){return t?t.__v_isVNode===!0:!1}function sd(t,r){return t.type===r.type&&t.key===r.key}const zm="__vInternal",Cw=({key:t})=>t??null,Uf=({ref:t,ref_key:r,ref_for:l})=>t!=null?nr(t)||Ii(t)||wn(t)?{i:yr,r:t,k:r,f:!!l}:t:null;function Gr(t,r=null,l=null,h=0,m=null,v=t===eo?0:1,T=!1,s=!1){const S={__v_isVNode:!0,__v_skip:!0,type:t,props:r,key:r&&Cw(r),ref:r&&Uf(r),scopeId:Cm,slotScopeIds:null,children:l,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:v,patchFlag:h,dynamicProps:m,dynamicChildren:null,appContext:null,ctx:yr};return s?(jy(S,l),v&128&&t.normalize(S)):l&&(S.shapeFlag|=nr(l)?8:16),wd>0&&!T&&Po&&(S.patchFlag>0||v&6)&&S.patchFlag!==32&&Po.push(S),S}const en=tI;function tI(t,r=null,l=null,h=0,m=null,v=!1){if((!t||t===DA)&&(t=Oa),Kf(t)){const s=Su(t,r,!0);return l&&jy(s,l),wd>0&&!v&&Po&&(s.shapeFlag&6?Po[Po.indexOf(t)]=s:Po.push(s)),s.patchFlag|=-2,s}if(uI(t)&&(t=t.__vccOpts),r){r=nI(r);let{class:s,style:S}=r;s&&!nr(s)&&(r.class=wy(s)),Ci(S)&&(iw(S)&&!yn(S)&&(S=zr({},S)),r.style=xy(S))}const T=nr(t)?1:xA(t)?128:QA(t)?64:Ci(t)?4:wn(t)?2:0;return Gr(t,r,l,h,m,T,v,!0)}function nI(t){return t?iw(t)||zm in t?zr({},t):t:null}function Su(t,r,l=!1){const{props:h,ref:m,patchFlag:v,children:T}=t,s=r?Ny(h||{},r):h;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:s,key:s&&Cw(s),ref:r&&r.ref?l&&m?yn(m)?m.concat(Uf(r)):[m,Uf(r)]:Uf(r):m,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:T,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:r&&t.type!==eo?v===-1?16:v|16:v,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Su(t.ssContent),ssFallback:t.ssFallback&&Su(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function to(t=" ",r=0){return en(Lm,null,t,r)}function Mw(t="",r=!1){return r?(Lr(),tc(Oa,null,t)):en(Oa,null,t)}function as(t){return t==null||typeof t=="boolean"?en(Oa):yn(t)?en(eo,null,t.slice()):typeof t=="object"?Aa(t):en(Lm,null,String(t))}function Aa(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Su(t)}function jy(t,r){let l=0;const{shapeFlag:h}=t;if(r==null)r=null;else if(yn(r))l=16;else if(typeof r=="object")if(h&65){const m=r.default;m&&(m._c&&(m._d=!1),jy(t,m()),m._c&&(m._d=!0));return}else{l=32;const m=r._;!m&&!(zm in r)?r._ctx=yr:m===3&&yr&&(yr.slots._===1?r._=1:(r._=2,t.patchFlag|=1024))}else wn(r)?(r={default:r,_ctx:yr},l=32):(r=String(r),h&64?(l=16,r=[to(r)]):l=8);t.children=r,t.shapeFlag|=l}function Ny(...t){const r={};for(let l=0;l<t.length;l++){const h=t[l];for(const m in h)if(m==="class")r.class!==h.class&&(r.class=wy([r.class,h.class]));else if(m==="style")r.style=xy([r.style,h.style]);else if(xm(m)){const v=r[m],T=h[m];T&&v!==T&&!(yn(v)&&v.includes(T))&&(r[m]=v?[].concat(v,T):T)}else m!==""&&(r[m]=h[m])}return r}function ss(t,r,l,h=null){Ro(t,r,7,[l,h])}const iI=Sw();let rI=0;function oI(t,r,l){const h=t.type,m=(r?r.appContext:t.appContext)||iI,v={uid:rI++,vnode:t,type:h,parent:r,appContext:m,root:null,next:null,subTree:null,effect:null,update:null,scope:new V1(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(m.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ww(h,m),emitsOptions:pw(h,m),emit:null,emitted:null,propsDefaults:xi,inheritAttrs:h.inheritAttrs,ctx:xi,data:xi,props:xi,attrs:xi,slots:xi,refs:xi,setupState:xi,setupContext:null,suspense:l,suspenseId:l?l.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return v.ctx={_:v},v.root=r?r.root:v,v.emit=fA.bind(null,v),t.ce&&t.ce(v),v}let Bi=null;const Nd=()=>Bi||yr,Au=t=>{Bi=t,t.scope.on()},Wl=()=>{Bi&&Bi.scope.off(),Bi=null};function Pw(t){return t.vnode.shapeFlag&4}let Td=!1;function sI(t,r=!1){Td=r;const{props:l,children:h}=t.vnode,m=Pw(t);VA(t,l,m,r),qA(t,h);const v=m?aI(t,r):void 0;return Td=!1,v}function aI(t,r){const l=t.type;t.accessCache=Object.create(null),t.proxy=ku(new Proxy(t.ctx,BA));const{setup:h}=l;if(h){const m=t.setupContext=h.length>1?zw(t):null;Au(t),Du();const v=za(h,t,0,[t.props,m]);if(Ou(),Wl(),N1(v)){if(v.then(Wl,Wl),r)return v.then(T=>{cx(t,T,r)}).catch(T=>{Am(T,t,0)});t.asyncDep=v}else cx(t,v,r)}else Lw(t,r)}function cx(t,r,l){wn(r)?t.type.__ssrInlineRender?t.ssrRender=r:t.render=r:Ci(r)&&(t.setupState=aw(r)),Lw(t,l)}let ux;function Lw(t,r,l){const h=t.type;if(!t.render){if(!r&&ux&&!h.render){const m=h.template||By(t).template;if(m){const{isCustomElement:v,compilerOptions:T}=t.appContext.config,{delimiters:s,compilerOptions:S}=h,z=zr(zr({isCustomElement:v,delimiters:s},T),S);h.render=ux(m,z)}}t.render=h.render||zo}Au(t),Du(),FA(t),Ou(),Wl()}function lI(t){return new Proxy(t.attrs,{get(r,l){return Zr(t,"get","$attrs"),r[l]}})}function zw(t){const r=h=>{t.exposed=h||{}};let l;return{get attrs(){return l||(l=lI(t))},slots:t.slots,emit:t.emit,expose:r}}function $y(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(aw(ku(t.exposed)),{get(r,l){if(l in r)return r[l];if(l in hd)return hd[l](t)},has(r,l){return l in r||l in hd}}))}function cI(t,r=!0){return wn(t)?t.displayName||t.name:t.name||r&&t.__name}function uI(t){return wn(t)&&"__vccOpts"in t}const zi=(t,r)=>lA(t,r,Td);function hI(){return Rw().slots}function dI(){return Rw().attrs}function Rw(){const t=Nd();return t.setupContext||(t.setupContext=zw(t))}function hs(t,r,l){const h=arguments.length;return h===2?Ci(r)&&!yn(r)?Kf(r)?en(t,null,[r]):en(t,r):en(t,null,r):(h>3?l=Array.prototype.slice.call(arguments,2):h===3&&Kf(l)&&(l=[l]),en(t,r,l))}const pI=Symbol(""),fI=()=>$i(pI),mI="3.2.47",gI="http://www.w3.org/2000/svg",Ul=typeof document<"u"?document:null,hx=Ul&&Ul.createElement("template"),_I={insert:(t,r,l)=>{r.insertBefore(t,l||null)},remove:t=>{const r=t.parentNode;r&&r.removeChild(t)},createElement:(t,r,l,h)=>{const m=r?Ul.createElementNS(gI,t):Ul.createElement(t,l?{is:l}:void 0);return t==="select"&&h&&h.multiple!=null&&m.setAttribute("multiple",h.multiple),m},createText:t=>Ul.createTextNode(t),createComment:t=>Ul.createComment(t),setText:(t,r)=>{t.nodeValue=r},setElementText:(t,r)=>{t.textContent=r},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ul.querySelector(t),setScopeId(t,r){t.setAttribute(r,"")},insertStaticContent(t,r,l,h,m,v){const T=l?l.previousSibling:r.lastChild;if(m&&(m===v||m.nextSibling))for(;r.insertBefore(m.cloneNode(!0),l),!(m===v||!(m=m.nextSibling)););else{hx.innerHTML=h?`<svg>${t}</svg>`:t;const s=hx.content;if(h){const S=s.firstChild;for(;S.firstChild;)s.appendChild(S.firstChild);s.removeChild(S)}r.insertBefore(s,l)}return[T?T.nextSibling:r.firstChild,l?l.previousSibling:r.lastChild]}};function yI(t,r,l){const h=t._vtc;h&&(r=(r?[r,...h]:[...h]).join(" ")),r==null?t.removeAttribute("class"):l?t.setAttribute("class",r):t.className=r}function vI(t,r,l){const h=t.style,m=nr(l);if(l&&!m){if(r&&!nr(r))for(const v in r)l[v]==null&&K_(h,v,"");for(const v in l)K_(h,v,l[v])}else{const v=h.display;m?r!==l&&(h.cssText=l):r&&t.removeAttribute("style"),"_vod"in t&&(h.display=v)}}const dx=/\s*!important$/;function K_(t,r,l){if(yn(l))l.forEach(h=>K_(t,r,h));else if(l==null&&(l=""),r.startsWith("--"))t.setProperty(r,l);else{const h=bI(t,r);dx.test(l)?t.setProperty(Ru(h),l.replace(dx,""),"important"):t[h]=l}}const px=["Webkit","Moz","ms"],f_={};function bI(t,r){const l=f_[r];if(l)return l;let h=us(r);if(h!=="filter"&&h in t)return f_[r]=h;h=Em(h);for(let m=0;m<px.length;m++){const v=px[m]+h;if(v in t)return f_[r]=v}return r}const fx="http://www.w3.org/1999/xlink";function xI(t,r,l,h,m){if(h&&r.startsWith("xlink:"))l==null?t.removeAttributeNS(fx,r.slice(6,r.length)):t.setAttributeNS(fx,r,l);else{const v=_S(r);l==null||v&&!B1(l)?t.removeAttribute(r):t.setAttribute(r,v?"":l)}}function wI(t,r,l,h,m,v,T){if(r==="innerHTML"||r==="textContent"){h&&T(h,m,v),t[r]=l??"";return}if(r==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=l;const S=l??"";(t.value!==S||t.tagName==="OPTION")&&(t.value=S),l==null&&t.removeAttribute(r);return}let s=!1;if(l===""||l==null){const S=typeof t[r];S==="boolean"?l=B1(l):l==null&&S==="string"?(l="",s=!0):S==="number"&&(l=0,s=!0)}try{t[r]=l}catch{}s&&t.removeAttribute(r)}function TI(t,r,l,h){t.addEventListener(r,l,h)}function EI(t,r,l,h){t.removeEventListener(r,l,h)}function kI(t,r,l,h,m=null){const v=t._vei||(t._vei={}),T=v[r];if(h&&T)T.value=h;else{const[s,S]=SI(r);if(h){const z=v[r]=CI(h,m);TI(t,s,z,S)}else T&&(EI(t,s,T,S),v[r]=void 0)}}const mx=/(?:Once|Passive|Capture)$/;function SI(t){let r;if(mx.test(t)){r={};let h;for(;h=t.match(mx);)t=t.slice(0,t.length-h[0].length),r[h[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Ru(t.slice(2)),r]}let m_=0;const AI=Promise.resolve(),II=()=>m_||(AI.then(()=>m_=0),m_=Date.now());function CI(t,r){const l=h=>{if(!h._vts)h._vts=Date.now();else if(h._vts<=l.attached)return;Ro(MI(h,l.value),r,5,[h])};return l.value=t,l.attached=II(),l}function MI(t,r){if(yn(r)){const l=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{l.call(t),t._stopped=!0},r.map(h=>m=>!m._stopped&&h&&h(m))}else return r}const gx=/^on[a-z]/,PI=(t,r,l,h,m=!1,v,T,s,S)=>{r==="class"?yI(t,h,m):r==="style"?vI(t,l,h):xm(r)?Ty(r)||kI(t,r,l,h,T):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):LI(t,r,h,m))?wI(t,r,h,v,T,s,S):(r==="true-value"?t._trueValue=h:r==="false-value"&&(t._falseValue=h),xI(t,r,h,m))};function LI(t,r,l,h){return h?!!(r==="innerHTML"||r==="textContent"||r in t&&gx.test(r)&&wn(l)):r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&t.tagName==="INPUT"||r==="type"&&t.tagName==="TEXTAREA"||gx.test(r)&&nr(l)?!1:r in t}const zI=zr({patchProp:PI},_I);let _x;function RI(){return _x||(_x=KA(zI))}const DI=(...t)=>{const r=RI().createApp(...t),{mount:l}=r;return r.mount=h=>{const m=OI(h);if(!m)return;const v=r._component;!wn(v)&&!v.render&&!v.template&&(v.template=m.innerHTML),m.innerHTML="";const T=l(m,!1,m instanceof SVGElement);return m instanceof Element&&(m.removeAttribute("v-cloak"),m.setAttribute("data-v-app","")),T},r};function OI(t){return nr(t)?document.querySelector(t):t}var BI=!1;/*!
  * pinia v2.0.33
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */let Dw;const Rm=t=>Dw=t,Ow=Symbol();function Y_(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var pd;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(pd||(pd={}));function FI(){const t=G1(!0),r=t.run(()=>Ni({}));let l=[],h=[];const m=ku({install(v){Rm(m),m._a=v,v.provide(Ow,m),v.config.globalProperties.$pinia=m,h.forEach(T=>l.push(T)),h=[]},use(v){return!this._a&&!BI?h.push(v):l.push(v),this},_p:l,_a:null,_e:t,_s:new Map,state:r});return m}const Bw=()=>{};function yx(t,r,l,h=Bw){t.push(r);const m=()=>{const v=t.indexOf(r);v>-1&&(t.splice(v,1),h())};return!l&&Z1()&&AS(m),m}function au(t,...r){t.slice().forEach(l=>{l(...r)})}function J_(t,r){t instanceof Map&&r instanceof Map&&r.forEach((l,h)=>t.set(h,l)),t instanceof Set&&r instanceof Set&&r.forEach(t.add,t);for(const l in r){if(!r.hasOwnProperty(l))continue;const h=r[l],m=t[l];Y_(m)&&Y_(h)&&t.hasOwnProperty(l)&&!Ii(h)&&!La(h)?t[l]=J_(m,h):t[l]=h}return t}const jI=Symbol();function NI(t){return!Y_(t)||!t.hasOwnProperty(jI)}const{assign:Sa}=Object;function $I(t){return!!(Ii(t)&&t.effect)}function UI(t,r,l,h){const{state:m,actions:v,getters:T}=r,s=l.state.value[t];let S;function z(){s||(l.state.value[t]=m?m():{});const O=rA(l.state.value[t]);return Sa(O,v,Object.keys(T||{}).reduce((B,Z)=>(B[Z]=ku(zi(()=>{Rm(l);const me=l._s.get(t);return T[Z].call(me,me)})),B),{}))}return S=Fw(t,z,r,l,h,!0),S}function Fw(t,r,l={},h,m,v){let T;const s=Sa({actions:{}},l),S={deep:!0};let z,O,B=ku([]),Z=ku([]),me;const _e=h.state.value[t];!v&&!_e&&(h.state.value[t]={}),Ni({});let Ie;function Te(Pe){let Ge;z=O=!1,typeof Pe=="function"?(Pe(h.state.value[t]),Ge={type:pd.patchFunction,storeId:t,events:me}):(J_(h.state.value[t],Pe),Ge={type:pd.patchObject,payload:Pe,storeId:t,events:me});const Ye=Ie=Symbol();Dy().then(()=>{Ie===Ye&&(z=!0)}),O=!0,au(B,Ge,h.state.value[t])}const ve=v?function(){const{state:Ge}=l,Ye=Ge?Ge():{};this.$patch(dt=>{Sa(dt,Ye)})}:Bw;function $e(){T.stop(),B=[],Z=[],h._s.delete(t)}function Fe(Pe,Ge){return function(){Rm(h);const Ye=Array.from(arguments),dt=[],wt=[];function Tn(At){dt.push(At)}function Zt(At){wt.push(At)}au(Z,{args:Ye,name:Pe,store:fe,after:Tn,onError:Zt});let si;try{si=Ge.apply(this&&this.$id===t?this:fe,Ye)}catch(At){throw au(wt,At),At}return si instanceof Promise?si.then(At=>(au(dt,At),At)).catch(At=>(au(wt,At),Promise.reject(At))):(au(dt,si),si)}}const qe={_p:h,$id:t,$onAction:yx.bind(null,Z),$patch:Te,$reset:ve,$subscribe(Pe,Ge={}){const Ye=yx(B,Pe,Ge.detached,()=>dt()),dt=T.run(()=>vr(()=>h.state.value[t],wt=>{(Ge.flush==="sync"?O:z)&&Pe({storeId:t,type:pd.direct,events:me},wt)},Sa({},S,Ge)));return Ye},$dispose:$e},fe=Ga(qe);h._s.set(t,fe);const et=h._e.run(()=>(T=G1(),T.run(()=>r())));for(const Pe in et){const Ge=et[Pe];if(Ii(Ge)&&!$I(Ge)||La(Ge))v||(_e&&NI(Ge)&&(Ii(Ge)?Ge.value=_e[Pe]:J_(Ge,_e[Pe])),h.state.value[t][Pe]=Ge);else if(typeof Ge=="function"){const Ye=Fe(Pe,Ge);et[Pe]=Ye,s.actions[Pe]=Ge}}return Sa(fe,et),Sa(Hn(fe),et),Object.defineProperty(fe,"$state",{get:()=>h.state.value[t],set:Pe=>{Te(Ge=>{Sa(Ge,Pe)})}}),h._p.forEach(Pe=>{Sa(fe,T.run(()=>Pe({store:fe,app:h._a,pinia:h,options:s})))}),_e&&v&&l.hydrate&&l.hydrate(fe.$state,_e),z=!0,O=!0,fe}function jw(t,r,l){let h,m;const v=typeof r=="function";typeof t=="string"?(h=t,m=v?l:r):(m=t,h=t.id);function T(s,S){const z=Nd();return s=s||z&&$i(Ow,null),s&&Rm(s),s=Dw,s._s.has(h)||(v?Fw(h,r,m,s):UI(h,m,s)),s._s.get(h)}return T.$id=h,T}const VI="modulepreload",GI=function(t){return"/"+t},vx={},Bs=function(r,l,h){if(!l||l.length===0)return r();const m=document.getElementsByTagName("link");return Promise.all(l.map(v=>{if(v=GI(v),v in vx)return;vx[v]=!0;const T=v.endsWith(".css"),s=T?'[rel="stylesheet"]':"";if(!!h)for(let O=m.length-1;O>=0;O--){const B=m[O];if(B.href===v&&(!T||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${s}`))return;const z=document.createElement("link");if(z.rel=T?"stylesheet":VI,T||(z.as="script",z.crossOrigin=""),z.href=v,document.head.appendChild(z),T)return new Promise((O,B)=>{z.addEventListener("load",O),z.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${v}`)))})})).then(()=>r())},cu={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let uu,Nw,Dm,$w=!1,Yf=!1,Uy=!1,Qr=!1,bx=null,Q_=!1;const ZI={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1},Uw=t=>{const r=new URL(t,ir.$resourcesUrl$);return r.origin!==Ud.location.origin?r.href:r.pathname},Xl=(t,r="")=>()=>{},xx="http://www.w3.org/1999/xlink",wx={},qI="http://www.w3.org/2000/svg",WI="http://www.w3.org/1999/xhtml",HI=t=>t!=null,Vy=t=>(t=typeof t,t==="object"||t==="function");function XI(t){var r,l,h;return(h=(l=(r=t.head)===null||r===void 0?void 0:r.querySelector('meta[name="csp-nonce"]'))===null||l===void 0?void 0:l.getAttribute("content"))!==null&&h!==void 0?h:void 0}const Gt=(t,r,...l)=>{let h=null,m=null,v=null,T=!1,s=!1;const S=[],z=B=>{for(let Z=0;Z<B.length;Z++)h=B[Z],Array.isArray(h)?z(h):h!=null&&typeof h!="boolean"&&((T=typeof t!="function"&&!Vy(h))&&(h=String(h)),T&&s?S[S.length-1].$text$+=h:S.push(T?Jf(null,h):h),s=T)};if(z(l),r){r.key&&(m=r.key),r.name&&(v=r.name);{const B=r.className||r.class;B&&(r.class=typeof B!="object"?B:Object.keys(B).filter(Z=>B[Z]).join(" "))}}if(typeof t=="function")return t(r===null?{}:r,S,YI);const O=Jf(t,null);return O.$attrs$=r,S.length>0&&(O.$children$=S),O.$key$=m,O.$name$=v,O},Jf=(t,r)=>{const l={$flags$:0,$tag$:t,$text$:r,$elm$:null,$children$:null};return l.$attrs$=null,l.$key$=null,l.$name$=null,l},wr={},KI=t=>t&&t.$tag$===wr,YI={forEach:(t,r)=>t.map(Tx).forEach(r),map:(t,r)=>t.map(Tx).map(r).map(JI)},Tx=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),JI=t=>{if(typeof t.vtag=="function"){const l=Object.assign({},t.vattrs);return t.vkey&&(l.key=t.vkey),t.vname&&(l.name=t.vname),Gt(t.vtag,l,...t.vchildren||[])}const r=Jf(t.vtag,t.vtext);return r.$attrs$=t.vattrs,r.$children$=t.vchildren,r.$key$=t.vkey,r.$name$=t.vname,r},QI=t=>Qw.map(r=>r(t)).find(r=>!!r),eC=t=>Qw.push(t),tC=t=>Bu(t).$modeName$,nC=(t,r)=>t!=null&&!Vy(t)?r&4?t==="false"?!1:t===""||!!t:r&2?parseFloat(t):r&1?String(t):t:t,iC=t=>t,po=(t,r,l)=>{const h=iC(t);return{emit:m=>rC(h,r,{bubbles:!!(l&4),composed:!!(l&2),cancelable:!!(l&1),detail:m})}},rC=(t,r,l)=>{const h=ir.ce(r,l);return t.dispatchEvent(h),h},Ex=new WeakMap,oC=(t,r,l)=>{let h=em.get(t);PC&&l?(h=h||new CSSStyleSheet,typeof h=="string"?h=r:h.replaceSync(r)):h=r,em.set(t,h)},sC=(t,r,l,h)=>{var m;let v=Vw(r,l);const T=em.get(v);if(t=t.nodeType===11?t:Do,T)if(typeof T=="string"){t=t.head||t;let s=Ex.get(t),S;if(s||Ex.set(t,s=new Set),!s.has(v)){{S=Do.createElement("style"),S.innerHTML=T;const z=(m=ir.$nonce$)!==null&&m!==void 0?m:XI(Do);z!=null&&S.setAttribute("nonce",z),t.insertBefore(S,t.querySelector("link"))}s&&s.add(v)}}else t.adoptedStyleSheets.includes(T)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,T]);return v},aC=t=>{const r=t.$cmpMeta$,l=t.$hostElement$,h=r.$flags$,m=Xl("attachStyles",r.$tagName$),v=sC(l.shadowRoot?l.shadowRoot:l.getRootNode(),r,t.$modeName$);h&10&&(l["s-sc"]=v,l.classList.add(v+"-h"),h&2&&l.classList.add(v+"-s")),m()},Vw=(t,r)=>"sc-"+(r&&t.$flags$&32?t.$tagName$+"-"+r:t.$tagName$),kx=(t,r,l,h,m,v)=>{if(l!==h){let T=Cx(t,r),s=r.toLowerCase();if(r==="class"){const S=t.classList,z=Sx(l),O=Sx(h);S.remove(...z.filter(B=>B&&!O.includes(B))),S.add(...O.filter(B=>B&&!z.includes(B)))}else if(r==="style"){for(const S in l)(!h||h[S]==null)&&(S.includes("-")?t.style.removeProperty(S):t.style[S]="");for(const S in h)(!l||h[S]!==l[S])&&(S.includes("-")?t.style.setProperty(S,h[S]):t.style[S]=h[S])}else if(r!=="key")if(r==="ref")h&&h(t);else if(!t.__lookupSetter__(r)&&r[0]==="o"&&r[1]==="n")r[2]==="-"?r=r.slice(3):Cx(Ud,s)?r=s.slice(2):r=s[2]+r.slice(3),l&&ir.rel(t,r,l,!1),h&&ir.ael(t,r,h,!1);else{const S=Vy(h);if((T||S&&h!==null)&&!m)try{if(t.tagName.includes("-"))t[r]=h;else{const O=h??"";r==="list"?T=!1:(l==null||t[r]!=O)&&(t[r]=O)}}catch{}let z=!1;s!==(s=s.replace(/^xlink\:?/,""))&&(r=s,z=!0),h==null||h===!1?(h!==!1||t.getAttribute(r)==="")&&(z?t.removeAttributeNS(xx,r):t.removeAttribute(r)):(!T||v&4||m)&&!S&&(h=h===!0?"":h,z?t.setAttributeNS(xx,r,h):t.setAttribute(r,h))}}},lC=/\s/,Sx=t=>t?t.split(lC):[],Gw=(t,r,l,h)=>{const m=r.$elm$.nodeType===11&&r.$elm$.host?r.$elm$.host:r.$elm$,v=t&&t.$attrs$||wx,T=r.$attrs$||wx;for(h in v)h in T||kx(m,h,v[h],void 0,l,r.$flags$);for(h in T)kx(m,h,v[h],T[h],l,r.$flags$)},Qf=(t,r,l,h)=>{const m=r.$children$[l];let v=0,T,s,S;if($w||(Uy=!0,m.$tag$==="slot"&&(uu&&h.classList.add(uu+"-s"),m.$flags$|=m.$children$?2:1)),m.$text$!==null)T=m.$elm$=Do.createTextNode(m.$text$);else if(m.$flags$&1)T=m.$elm$=Do.createTextNode("");else{if(Qr||(Qr=m.$tag$==="svg"),T=m.$elm$=Do.createElementNS(Qr?qI:WI,m.$flags$&2?"slot-fb":m.$tag$),Qr&&m.$tag$==="foreignObject"&&(Qr=!1),Gw(null,m,Qr),HI(uu)&&T["s-si"]!==uu&&T.classList.add(T["s-si"]=uu),m.$children$)for(v=0;v<m.$children$.length;++v)s=Qf(t,m,v,T),s&&T.appendChild(s);m.$tag$==="svg"?Qr=!1:T.tagName==="foreignObject"&&(Qr=!0)}return T["s-hn"]=Dm,m.$flags$&3&&(T["s-sr"]=!0,T["s-cr"]=Nw,T["s-sn"]=m.$name$||"",S=t&&t.$children$&&t.$children$[l],S&&S.$tag$===m.$tag$&&t.$elm$&&Ed(t.$elm$,!1)),T},Ed=(t,r)=>{ir.$flags$|=1;const l=t.childNodes;for(let h=l.length-1;h>=0;h--){const m=l[h];m["s-hn"]!==Dm&&m["s-ol"]&&(Ww(m).insertBefore(m,Gy(m)),m["s-ol"].remove(),m["s-ol"]=void 0,Uy=!0),r&&Ed(m,r)}ir.$flags$&=-2},Zw=(t,r,l,h,m,v)=>{let T=t["s-cr"]&&t["s-cr"].parentNode||t,s;for(T.shadowRoot&&T.tagName===Dm&&(T=T.shadowRoot);m<=v;++m)h[m]&&(s=Qf(null,l,m,t),s&&(h[m].$elm$=s,T.insertBefore(s,Gy(r))))},qw=(t,r,l,h,m)=>{for(;r<=l;++r)(h=t[r])&&(m=h.$elm$,Kw(h),Yf=!0,m["s-ol"]?m["s-ol"].remove():Ed(m,!0),m.remove())},cC=(t,r,l,h)=>{let m=0,v=0,T=0,s=0,S=r.length-1,z=r[0],O=r[S],B=h.length-1,Z=h[0],me=h[B],_e,Ie;for(;m<=S&&v<=B;)if(z==null)z=r[++m];else if(O==null)O=r[--S];else if(Z==null)Z=h[++v];else if(me==null)me=h[--B];else if(Df(z,Z))hu(z,Z),z=r[++m],Z=h[++v];else if(Df(O,me))hu(O,me),O=r[--S],me=h[--B];else if(Df(z,me))(z.$tag$==="slot"||me.$tag$==="slot")&&Ed(z.$elm$.parentNode,!1),hu(z,me),t.insertBefore(z.$elm$,O.$elm$.nextSibling),z=r[++m],me=h[--B];else if(Df(O,Z))(z.$tag$==="slot"||me.$tag$==="slot")&&Ed(O.$elm$.parentNode,!1),hu(O,Z),t.insertBefore(O.$elm$,z.$elm$),O=r[--S],Z=h[++v];else{for(T=-1,s=m;s<=S;++s)if(r[s]&&r[s].$key$!==null&&r[s].$key$===Z.$key$){T=s;break}T>=0?(Ie=r[T],Ie.$tag$!==Z.$tag$?_e=Qf(r&&r[v],l,T,t):(hu(Ie,Z),r[T]=void 0,_e=Ie.$elm$),Z=h[++v]):(_e=Qf(r&&r[v],l,v,t),Z=h[++v]),_e&&Ww(z.$elm$).insertBefore(_e,Gy(z.$elm$))}m>S?Zw(t,h[B+1]==null?null:h[B+1].$elm$,l,h,v,B):v>B&&qw(r,m,S)},Df=(t,r)=>t.$tag$===r.$tag$?t.$tag$==="slot"?t.$name$===r.$name$:t.$key$===r.$key$:!1,Gy=t=>t&&t["s-ol"]||t,Ww=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,hu=(t,r)=>{const l=r.$elm$=t.$elm$,h=t.$children$,m=r.$children$,v=r.$tag$,T=r.$text$;let s;T===null?(Qr=v==="svg"?!0:v==="foreignObject"?!1:Qr,v==="slot"||Gw(t,r,Qr),h!==null&&m!==null?cC(l,h,r,m):m!==null?(t.$text$!==null&&(l.textContent=""),Zw(l,null,r,m,0,m.length-1)):h!==null&&qw(h,0,h.length-1),Qr&&v==="svg"&&(Qr=!1)):(s=l["s-cr"])?s.parentNode.textContent=T:t.$text$!==T&&(l.data=T)},Hw=t=>{const r=t.childNodes;let l,h,m,v,T,s;for(h=0,m=r.length;h<m;h++)if(l=r[h],l.nodeType===1){if(l["s-sr"]){for(T=l["s-sn"],l.hidden=!1,v=0;v<m;v++)if(s=r[v].nodeType,r[v]["s-hn"]!==l["s-hn"]||T!==""){if(s===1&&T===r[v].getAttribute("slot")){l.hidden=!0;break}}else if(s===1||s===3&&r[v].textContent.trim()!==""){l.hidden=!0;break}}Hw(l)}},Co=[],Xw=t=>{let r,l,h,m,v,T,s=0;const S=t.childNodes,z=S.length;for(;s<z;s++){if(r=S[s],r["s-sr"]&&(l=r["s-cr"])&&l.parentNode)for(h=l.parentNode.childNodes,m=r["s-sn"],T=h.length-1;T>=0;T--)l=h[T],!l["s-cn"]&&!l["s-nr"]&&l["s-hn"]!==r["s-hn"]&&(Ax(l,m)?(v=Co.find(O=>O.$nodeToRelocate$===l),Yf=!0,l["s-sn"]=l["s-sn"]||m,v?v.$slotRefNode$=r:Co.push({$slotRefNode$:r,$nodeToRelocate$:l}),l["s-sr"]&&Co.map(O=>{Ax(O.$nodeToRelocate$,l["s-sn"])&&(v=Co.find(B=>B.$nodeToRelocate$===l),v&&!O.$slotRefNode$&&(O.$slotRefNode$=v.$slotRefNode$))})):Co.some(O=>O.$nodeToRelocate$===l)||Co.push({$nodeToRelocate$:l}));r.nodeType===1&&Xw(r)}},Ax=(t,r)=>t.nodeType===1?t.getAttribute("slot")===null&&r===""||t.getAttribute("slot")===r:t["s-sn"]===r?!0:r==="",Kw=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(Kw)},uC=(t,r)=>{const l=t.$hostElement$,h=t.$cmpMeta$,m=t.$vnode$||Jf(null,null),v=KI(r)?r:Gt(null,null,r);Dm=l.tagName,h.$attrsToReflect$&&(v.$attrs$=v.$attrs$||{},h.$attrsToReflect$.map(([T,s])=>v.$attrs$[s]=l[T])),v.$tag$=null,v.$flags$|=4,t.$vnode$=v,v.$elm$=m.$elm$=l.shadowRoot||l,uu=l["s-sc"],Nw=l["s-cr"],$w=(h.$flags$&1)!==0,Yf=!1,hu(m,v);{if(ir.$flags$|=1,Uy){Xw(v.$elm$);let T,s,S,z,O,B,Z=0;for(;Z<Co.length;Z++)T=Co[Z],s=T.$nodeToRelocate$,s["s-ol"]||(S=Do.createTextNode(""),S["s-nr"]=s,s.parentNode.insertBefore(s["s-ol"]=S,s));for(Z=0;Z<Co.length;Z++)if(T=Co[Z],s=T.$nodeToRelocate$,T.$slotRefNode$){for(z=T.$slotRefNode$.parentNode,O=T.$slotRefNode$.nextSibling,S=s["s-ol"];S=S.previousSibling;)if(B=S["s-nr"],B&&B["s-sn"]===s["s-sn"]&&z===B.parentNode&&(B=B.nextSibling,!B||!B["s-nr"])){O=B;break}(!O&&z!==s.parentNode||s.nextSibling!==O)&&s!==O&&(!s["s-hn"]&&s["s-ol"]&&(s["s-hn"]=s["s-ol"].parentNode.nodeName),z.insertBefore(s,O))}else s.nodeType===1&&(s.hidden=!0)}Yf&&Hw(v.$elm$),ir.$flags$&=-2,Co.length=0}},hC=(t,r)=>{},Zy=(t,r)=>(t.$flags$|=16,hC(t,t.$ancestorComponent$),Ba(()=>dC(t,r))),dC=(t,r)=>{const l=t.$hostElement$,h=Xl("scheduleUpdate",t.$cmpMeta$.$tagName$),m=l;let v;return r?v=bu(m,"componentWillLoad"):v=bu(m,"componentWillUpdate"),v=Ix(v,()=>bu(m,"componentWillRender")),h(),Ix(v,()=>pC(t,m,r))},pC=async(t,r,l)=>{const h=t.$hostElement$,m=Xl("update",t.$cmpMeta$.$tagName$);h["s-rc"],l&&aC(t);const v=Xl("render",t.$cmpMeta$.$tagName$);fC(t,r,h),v(),m(),mC(t)},fC=(t,r,l)=>{try{bx=r,r=r.render&&r.render(),t.$flags$&=-17,t.$flags$|=2,(cu.hasRenderFn||cu.reflect)&&(cu.vdomRender||cu.reflect)&&(cu.hydrateServerSide||uC(t,r))}catch(s){$d(s,t.$hostElement$)}return bx=null,null},mC=t=>{const r=t.$cmpMeta$.$tagName$,l=t.$hostElement$,h=Xl("postUpdate",r),m=l;t.$ancestorComponent$,bu(m,"componentDidRender"),t.$flags$&64?(bu(m,"componentDidUpdate"),h()):(t.$flags$|=64,bu(m,"componentDidLoad"),h())},ey=t=>{{const r=Bu(t),l=r.$hostElement$.isConnected;return l&&(r.$flags$&18)===2&&Zy(r,!1),l}},bu=(t,r,l)=>{if(t&&t[r])try{return t[r](l)}catch(h){$d(h)}},Ix=(t,r)=>t&&t.then?t.then(r):r(),gC=(t,r)=>Bu(t).$instanceValues$.get(r),_C=(t,r,l,h)=>{const m=Bu(t),v=t,T=m.$instanceValues$.get(r),s=m.$flags$,S=v;l=nC(l,h.$members$[r][0]);const z=Number.isNaN(T)&&Number.isNaN(l);if(l!==T&&!z){m.$instanceValues$.set(r,l);{if(h.$watchers$&&s&128){const B=h.$watchers$[r];B&&B.map(Z=>{try{S[Z](l,T,r)}catch(me){$d(me,v)}})}if((s&18)===2){if(S.componentShouldUpdate&&S.componentShouldUpdate(l,T,r)===!1)return;Zy(m,!1)}}}},yC=(t,r,l)=>{if(r.$members$){t.watchers&&(r.$watchers$=t.watchers);const h=Object.entries(r.$members$),m=t.prototype;h.map(([v,[T]])=>{(T&31||T&32)&&Object.defineProperty(m,v,{get(){return gC(this,v)},set(s){_C(this,v,s,r)},configurable:!0,enumerable:!0})});{const v=new Map;m.attributeChangedCallback=function(T,s,S){ir.jmp(()=>{const z=v.get(T);if(this.hasOwnProperty(z))S=this[z],delete this[z];else if(m.hasOwnProperty(z)&&typeof this[z]=="number"&&this[z]==S)return;this[z]=S===null&&typeof this[z]=="boolean"?!1:S})},t.observedAttributes=h.filter(([T,s])=>s[0]&15).map(([T,s])=>{const S=s[1]||T;return v.set(S,T),s[0]&512&&r.$attrsToReflect$.push([T,S]),S})}}return t},vC=async(t,r,l,h,m)=>{if(!(r.$flags$&32)&&(m=t.constructor,r.$flags$|=32,customElements.whenDefined(l.$tagName$).then(()=>r.$flags$|=128),m.style)){let T=m.style;typeof T!="string"&&(T=T[r.$modeName$=QI(t)]);const s=Vw(l,r.$modeName$);if(!em.has(s)){const S=Xl("registerStyles",l.$tagName$);oC(s,T,!!(l.$flags$&1)),S()}}r.$ancestorComponent$,(()=>Zy(r,!0))()},bC=t=>{},xC=t=>{if(!(ir.$flags$&1)){const r=Bu(t),l=r.$cmpMeta$,h=Xl("connectedCallback",l.$tagName$);r.$flags$&1?(Yw(t,r,l.$listeners$),bC(r.$lazyInstance$)):(r.$flags$|=1,l.$flags$&12&&wC(t),l.$members$&&Object.entries(l.$members$).map(([m,[v]])=>{if(v&31&&t.hasOwnProperty(m)){const T=t[m];delete t[m],t[m]=T}}),vC(t,r,l)),h()}},wC=t=>{const r=t["s-cr"]=Do.createComment("");r["s-cn"]=!0,t.insertBefore(r,t.firstChild)},TC=t=>{if(!(ir.$flags$&1)){const r=Bu(t);r.$rmListeners$&&(r.$rmListeners$.map(l=>l()),r.$rmListeners$=void 0)}},Tr=(t,r)=>{const l={$flags$:r[0],$tagName$:r[1]};l.$members$=r[2],l.$listeners$=r[3],l.$watchers$=t.$watchers$,l.$attrsToReflect$=[];const h=t.prototype.connectedCallback,m=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){AC(this,l)},connectedCallback(){xC(this),h&&h.call(this)},disconnectedCallback(){TC(this),m&&m.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(l.$flags$&16)})}}),t.is=l.$tagName$,yC(t,l)},Yw=(t,r,l,h)=>{l&&l.map(([m,v,T])=>{const s=kC(t,m),S=EC(r,T),z=SC(m);ir.ael(s,v,S,z),(r.$rmListeners$=r.$rmListeners$||[]).push(()=>ir.rel(s,v,S,z))})},EC=(t,r)=>l=>{try{cu.lazyLoad||t.$hostElement$[r](l)}catch(h){$d(h)}},kC=(t,r)=>r&4?Do:r&8?Ud:r&16?Do.body:t,SC=t=>CC?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,Jw=new WeakMap,Bu=t=>Jw.get(t),AC=(t,r)=>{const l={$flags$:0,$hostElement$:t,$cmpMeta$:r,$instanceValues$:new Map};return Yw(t,l,r.$listeners$),Jw.set(t,l)},Cx=(t,r)=>r in t,$d=(t,r)=>(0,console.error)(t,r),em=new Map,Qw=[],Ud=typeof window<"u"?window:{},Do=Ud.document||{head:{}},Er=Ud.HTMLElement||class{},ir={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,r,l,h)=>t.addEventListener(r,l,h),rel:(t,r,l,h)=>t.removeEventListener(r,l,h),ce:(t,r)=>new CustomEvent(t,r)},IC=t=>{Object.assign(ir,t)},CC=(()=>{let t=!1;try{Do.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),MC=t=>Promise.resolve(t),PC=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),ty=[],eT=[],tT=(t,r)=>l=>{t.push(l),Q_||(Q_=!0,r&&ir.$flags$&4?LC(ny):ir.raf(ny))},Mx=t=>{for(let r=0;r<t.length;r++)try{t[r](performance.now())}catch(l){$d(l)}t.length=0},ny=()=>{Mx(ty),Mx(eT),(Q_=ty.length>0)&&ir.raf(ny)},LC=t=>MC().then(t),kd=tT(ty,!1),Ba=tT(eT,!0);/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const zC="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='square' stroke-miterlimit='10' stroke-width='48' d='M244 400L100 256l144-144M120 256h292' class='ionicon-fill-none'/></svg>",RC="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='48' d='M328 112L184 256l144 144' class='ionicon-fill-none'/></svg>",DC="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z'/></svg>";/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */class OC{constructor(){this.m=new Map}reset(r){this.m=new Map(Object.entries(r))}get(r,l){const h=this.m.get(r);return h!==void 0?h:l}getBoolean(r,l=!1){const h=this.m.get(r);return h===void 0?l:typeof h=="string"?h==="true":!!h}getNumber(r,l){const h=parseFloat(this.m.get(r));return isNaN(h)?l!==void 0?l:NaN:h}set(r,l){this.m.set(r,l)}}const Oi=new OC,BC=t=>{try{const r=t.sessionStorage.getItem(nT);return r!==null?JSON.parse(r):{}}catch{return{}}},FC=(t,r)=>{try{t.sessionStorage.setItem(nT,JSON.stringify(r))}catch{return}},jC=t=>{const r={};return t.location.search.slice(1).split("&").map(l=>l.split("=")).map(([l,h])=>[decodeURIComponent(l),decodeURIComponent(h)]).filter(([l])=>NC(l,Px)).map(([l,h])=>[l.slice(Px.length),h]).forEach(([l,h])=>{r[l]=h}),r},NC=(t,r)=>t.substr(0,r.length)===r,Px="ionic:",nT="ionic-persist-config",$C=t=>iT(t),Ma=(t,r)=>(typeof t=="string"&&(r=t,t=void 0),$C(t).includes(r)),iT=(t=window)=>{if(typeof t>"u")return[];t.Ionic=t.Ionic||{};let r=t.Ionic.platforms;return r==null&&(r=t.Ionic.platforms=UC(t),r.forEach(l=>t.document.documentElement.classList.add(`plt-${l}`))),r},UC=t=>{const r=Oi.get("platform");return Object.keys(Lx).filter(l=>{const h=r==null?void 0:r[l];return typeof h=="function"?h(t):Lx[l](t)})},VC=t=>Om(t)&&!oT(t),qy=t=>!!(Kl(t,/iPad/i)||Kl(t,/Macintosh/i)&&Om(t)),GC=t=>Kl(t,/iPhone/i),ZC=t=>Kl(t,/iPhone|iPod/i)||qy(t),rT=t=>Kl(t,/android|sink/i),qC=t=>rT(t)&&!Kl(t,/mobile/i),WC=t=>{const r=t.innerWidth,l=t.innerHeight,h=Math.min(r,l),m=Math.max(r,l);return h>390&&h<520&&m>620&&m<800},HC=t=>{const r=t.innerWidth,l=t.innerHeight,h=Math.min(r,l),m=Math.max(r,l);return qy(t)||qC(t)||h>460&&h<820&&m>780&&m<1400},Om=t=>JC(t,"(any-pointer:coarse)"),XC=t=>!Om(t),oT=t=>sT(t)||aT(t),sT=t=>!!(t.cordova||t.phonegap||t.PhoneGap),aT=t=>{const r=t.Capacitor;return!!(r!=null&&r.isNative)},KC=t=>Kl(t,/electron/i),YC=t=>{var r;return!!(!((r=t.matchMedia)===null||r===void 0)&&r.call(t,"(display-mode: standalone)").matches||t.navigator.standalone)},Kl=(t,r)=>r.test(t.navigator.userAgent),JC=(t,r)=>{var l;return(l=t.matchMedia)===null||l===void 0?void 0:l.call(t,r).matches},Lx={ipad:qy,iphone:GC,ios:ZC,android:rT,phablet:WC,tablet:HC,cordova:sT,capacitor:aT,electron:KC,pwa:YC,mobile:Om,mobileweb:VC,desktop:XC,hybrid:oT};let du;const tr=t=>t&&tC(t)||du,QC=(t={})=>{if(typeof window>"u")return;const r=window.document,l=window,h=l.Ionic=l.Ionic||{},m={};t._ael&&(m.ael=t._ael),t._rel&&(m.rel=t._rel),t._ce&&(m.ce=t._ce),IC(m);const v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},BC(l)),{persistConfig:!1}),h.config),jC(l)),t);Oi.reset(v),Oi.getBoolean("persistConfig")&&FC(l,v),iT(l),h.config=Oi,h.mode=du=Oi.get("mode",r.documentElement.getAttribute("mode")||(Ma(l,"ios")?"ios":"md")),Oi.set("mode",du),r.documentElement.setAttribute("mode",du),r.documentElement.classList.add(du),Oi.getBoolean("_testing")&&Oi.set("animated",!1);const T=S=>{var z;return(z=S.tagName)===null||z===void 0?void 0:z.startsWith("ION-")},s=S=>["ios","md"].includes(S);eC(S=>{for(;S;){const z=S.mode||S.getAttribute("mode");if(z){if(s(z))return z;T(S)&&console.warn('Invalid ionic mode: "'+z+'", expected: "ios" or "md"')}S=S.parentElement}return du})};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const Sd=(t,r)=>{t.componentOnReady?t.componentOnReady().then(l=>r(l)):lT(()=>r(t))},eM=(t,r=[])=>{const l={};return r.forEach(h=>{t.hasAttribute(h)&&(t.getAttribute(h)!==null&&(l[h]=t.getAttribute(h)),t.removeAttribute(h))}),l},tM=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],Bm=(t,r)=>{let l=tM;return r&&r.length>0&&(l=l.filter(h=>!r.includes(h))),eM(t,l)},NB=(t,r,l,h)=>{var m;if(typeof window<"u"){const v=window,T=(m=v==null?void 0:v.Ionic)===null||m===void 0?void 0:m.config;if(T){const s=T.get("_ael");if(s)return s(t,r,l,h);if(T._ael)return T._ael(t,r,l,h)}}return t.addEventListener(r,l,h)},$B=(t,r,l,h)=>{var m;if(typeof window<"u"){const v=window,T=(m=v==null?void 0:v.Ionic)===null||m===void 0?void 0:m.config;if(T){const s=T.get("_rel");if(s)return s(t,r,l,h);if(T._rel)return T._rel(t,r,l,h)}}return t.removeEventListener(r,l,h)},lT=t=>typeof __zone_symbol__requestAnimationFrame=="function"?__zone_symbol__requestAnimationFrame(t):typeof requestAnimationFrame=="function"?requestAnimationFrame(t):setTimeout(t),nM=t=>!!t.shadowRoot&&!!t.attachShadow,cT=(t,r,l)=>Math.max(t,Math.min(r,l)),UB=t=>t.timeStamp||Date.now(),VB=t=>{if(t){const r=t.changedTouches;if(r&&r.length>0){const l=r[0];return{x:l.clientX,y:l.clientY}}if(t.pageX!==void 0)return{x:t.pageX,y:t.pageY}}return{x:0,y:0}},iM=(t,r)=>{if(t??(t={}),r??(r={}),t===r)return!0;const l=Object.keys(t);if(l.length!==Object.keys(r).length)return!1;for(const h of l)if(!(h in r)||t[h]!==r[h])return!1;return!0};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */let g_;const rM=()=>{if(typeof window>"u")return new Map;if(!g_){const t=window;t.Ionicons=t.Ionicons||{},g_=t.Ionicons.map=t.Ionicons.map||new Map}return g_},oM=t=>{let r=__(t.src);return r||(r=uT(t.name,t.icon,t.mode,t.ios,t.md),r?sM(r):t.icon&&(r=__(t.icon),r||(r=__(t.icon[t.mode]),r))?r:null)},sM=t=>{const r=rM().get(t);return r||Uw(`svg/${t}.svg`)},uT=(t,r,l,h,m)=>(l=(l&&Of(l))==="ios"?"ios":"md",h&&l==="ios"?t=Of(h):m&&l==="md"?t=Of(m):(!t&&r&&!hT(r)&&(t=r),tm(t)&&(t=Of(t))),!tm(t)||t.trim()===""||t.replace(/[a-z]|-|\d/gi,"")!==""?null:t),__=t=>tm(t)&&(t=t.trim(),hT(t))?t:null,hT=t=>t.length>0&&/(\/|\.)/.test(t),tm=t=>typeof t=="string",Of=t=>t.toLowerCase(),aM=(t,r=[])=>{const l={};return r.forEach(h=>{t.hasAttribute(h)&&(t.getAttribute(h)!==null&&(l[h]=t.getAttribute(h)),t.removeAttribute(h))}),l},lM=t=>t&&t.dir!==""?t.dir.toLowerCase()==="rtl":(document==null?void 0:document.dir.toLowerCase())==="rtl",cM=t=>{const r=document.createElement("div");r.innerHTML=t;for(let h=r.childNodes.length-1;h>=0;h--)r.childNodes[h].nodeName.toLowerCase()!=="svg"&&r.removeChild(r.childNodes[h]);const l=r.firstElementChild;if(l&&l.nodeName.toLowerCase()==="svg"){const h=l.getAttribute("class")||"";if(l.setAttribute("class",(h+" s-ion-icon").trim()),dT(l))return r.innerHTML}return""},dT=t=>{if(t.nodeType===1){if(t.nodeName.toLowerCase()==="script")return!1;for(let r=0;r<t.attributes.length;r++){const l=t.attributes[r].name;if(tm(l)&&l.toLowerCase().indexOf("on")===0)return!1}for(let r=0;r<t.childNodes.length;r++)if(!dT(t.childNodes[r]))return!1}return!0},uM=t=>t.startsWith("data:image/svg+xml"),hM=t=>t.indexOf(";utf8,")!==-1,Vl=new Map,zx=new Map;let y_;const dM=(t,r)=>{let l=zx.get(t);if(!l)if(typeof fetch<"u"&&typeof document<"u")if(uM(t)&&hM(t)){y_||(y_=new DOMParser);const m=y_.parseFromString(t,"text/html").querySelector("svg");return m&&Vl.set(t,m.outerHTML),Promise.resolve()}else l=fetch(t).then(h=>{if(h.ok)return h.text().then(m=>{m&&r!==!1&&(m=cM(m)),Vl.set(t,m||"")});Vl.set(t,"")}),zx.set(t,l);else return Vl.set(t,""),Promise.resolve();return l},pM=":host{display:inline-block;width:1em;height:1em;contain:strict;fill:currentColor;-webkit-box-sizing:content-box !important;box-sizing:content-box !important}:host .ionicon{stroke:currentColor}.ionicon-fill-none{fill:none}.ionicon-stroke-width{stroke-width:32px;stroke-width:var(--ionicon-stroke-width, 32px)}.icon-inner,.ionicon,svg{display:block;height:100%;width:100%}:host(.flip-rtl) .icon-inner{-webkit-transform:scaleX(-1);transform:scaleX(-1)}:host(.icon-small){font-size:18px !important}:host(.icon-large){font-size:32px !important}:host(.ion-color){color:var(--ion-color-base) !important}:host(.ion-color-primary){--ion-color-base:var(--ion-color-primary, #3880ff)}:host(.ion-color-secondary){--ion-color-base:var(--ion-color-secondary, #0cd1e8)}:host(.ion-color-tertiary){--ion-color-base:var(--ion-color-tertiary, #f4a942)}:host(.ion-color-success){--ion-color-base:var(--ion-color-success, #10dc60)}:host(.ion-color-warning){--ion-color-base:var(--ion-color-warning, #ffce00)}:host(.ion-color-danger){--ion-color-base:var(--ion-color-danger, #f14141)}:host(.ion-color-light){--ion-color-base:var(--ion-color-light, #f4f5f8)}:host(.ion-color-medium){--ion-color-base:var(--ion-color-medium, #989aa2)}:host(.ion-color-dark){--ion-color-base:var(--ion-color-dark, #222428)}",fM=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.iconName=null,this.inheritedAttributes={},this.isVisible=!1,this.mode=mM(),this.lazy=!1,this.sanitize=!0,this.hasAriaHidden=()=>{const{el:t}=this;return t.hasAttribute("aria-hidden")&&t.getAttribute("aria-hidden")==="true"}}componentWillLoad(){this.inheritedAttributes=aM(this.el,["aria-label"])}connectedCallback(){this.waitUntilVisible(this.el,"50px",()=>{this.isVisible=!0,this.loadIcon()})}disconnectedCallback(){this.io&&(this.io.disconnect(),this.io=void 0)}waitUntilVisible(t,r,l){if(this.lazy&&typeof window<"u"&&window.IntersectionObserver){const h=this.io=new window.IntersectionObserver(m=>{m[0].isIntersecting&&(h.disconnect(),this.io=void 0,l())},{rootMargin:r});h.observe(t)}else l()}loadIcon(){if(this.isVisible){const r=oM(this);r&&(Vl.has(r)?this.svgContent=Vl.get(r):dM(r,this.sanitize).then(()=>this.svgContent=Vl.get(r)))}const t=this.iconName=uT(this.name,this.icon,this.mode,this.ios,this.md);t&&(this.ariaLabel=t.replace(/\-/g," "))}render(){const{iconName:t,ariaLabel:r,el:l,inheritedAttributes:h}=this,m=this.mode||"md",v=this.flipRtl||t&&(t.indexOf("arrow")>-1||t.indexOf("chevron")>-1)&&this.flipRtl!==!1;return Gt(wr,Object.assign({"aria-label":r!==void 0&&!this.hasAriaHidden()?r:null,role:"img",class:Object.assign(Object.assign({[m]:!0},gM(this.color)),{[`icon-${this.size}`]:!!this.size,"flip-rtl":!!v&&lM(l)})},h),this.svgContent?Gt("div",{class:"icon-inner",innerHTML:this.svgContent}):Gt("div",{class:"icon-inner"}))}static get assetsDirs(){return["svg"]}get el(){return this}static get watchers(){return{name:["loadIcon"],src:["loadIcon"],icon:["loadIcon"],ios:["loadIcon"],md:["loadIcon"]}}static get style(){return pM}},[1,"ion-icon",{mode:[1025],color:[1],ios:[1],md:[1],flipRtl:[4,"flip-rtl"],name:[513],src:[1],icon:[8],size:[1],lazy:[4],sanitize:[4],svgContent:[32],isVisible:[32],ariaLabel:[32]}]),mM=()=>typeof document<"u"&&document.documentElement.getAttribute("mode")||"md",gM=t=>t?{"ion-color":!0,[`ion-color-${t}`]:!0}:null;function pT(){if(typeof customElements>"u")return;["ion-icon"].forEach(r=>{switch(r){case"ion-icon":customElements.get(r)||customElements.define(r,fM);break}})}/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const Fs=(t,r)=>r.closest(t)!==null,nc=(t,r)=>typeof t=="string"&&t.length>0?Object.assign({"ion-color":!0,[`ion-color-${t}`]:!0},r):r,_M=/^[a-z][a-z0-9+\-.]*:/,Wy=async(t,r,l,h)=>{if(t!=null&&t[0]!=="#"&&!_M.test(t)){const m=document.querySelector("ion-router");if(m)return r!=null&&r.preventDefault(),m.push(t,l,h)}return!1};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const Rx=(t,...r)=>console.warn(`[Ionic Warning]: ${t}`,...r),yM=(t,...r)=>console.error(`<${t.tagName.toLowerCase()}> must be used inside ${r.join(" or ")}.`);/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const vM=":host{left:0;right:0;top:0;bottom:0;position:absolute;contain:strict;pointer-events:none}:host(.unbounded){contain:layout size style}.ripple-effect{border-radius:50%;position:absolute;background-color:currentColor;color:inherit;contain:strict;opacity:0;-webkit-animation:225ms rippleAnimation forwards, 75ms fadeInAnimation forwards;animation:225ms rippleAnimation forwards, 75ms fadeInAnimation forwards;will-change:transform, opacity;pointer-events:none}.fade-out{-webkit-transform:translate(var(--translate-end)) scale(var(--final-scale, 1));transform:translate(var(--translate-end)) scale(var(--final-scale, 1));-webkit-animation:150ms fadeOutAnimation forwards;animation:150ms fadeOutAnimation forwards}@-webkit-keyframes rippleAnimation{from{-webkit-animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1);animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1);-webkit-transform:scale(1);transform:scale(1)}to{-webkit-transform:translate(var(--translate-end)) scale(var(--final-scale, 1));transform:translate(var(--translate-end)) scale(var(--final-scale, 1))}}@keyframes rippleAnimation{from{-webkit-animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1);animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1);-webkit-transform:scale(1);transform:scale(1)}to{-webkit-transform:translate(var(--translate-end)) scale(var(--final-scale, 1));transform:translate(var(--translate-end)) scale(var(--final-scale, 1))}}@-webkit-keyframes fadeInAnimation{from{-webkit-animation-timing-function:linear;animation-timing-function:linear;opacity:0}to{opacity:0.16}}@keyframes fadeInAnimation{from{-webkit-animation-timing-function:linear;animation-timing-function:linear;opacity:0}to{opacity:0.16}}@-webkit-keyframes fadeOutAnimation{from{-webkit-animation-timing-function:linear;animation-timing-function:linear;opacity:0.16}to{opacity:0}}@keyframes fadeOutAnimation{from{-webkit-animation-timing-function:linear;animation-timing-function:linear;opacity:0.16}to{opacity:0}}",bM=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.type="bounded"}async addRipple(t,r){return new Promise(l=>{kd(()=>{const h=this.el.getBoundingClientRect(),m=h.width,v=h.height,T=Math.sqrt(m*m+v*v),s=Math.max(v,m),S=this.unbounded?s:T+wM,z=Math.floor(s*TM),O=S/z;let B=t-h.left,Z=r-h.top;this.unbounded&&(B=m*.5,Z=v*.5);const me=B-z*.5,_e=Z-z*.5,Ie=m*.5-B,Te=v*.5-Z;Ba(()=>{const ve=document.createElement("div");ve.classList.add("ripple-effect");const $e=ve.style;$e.top=_e+"px",$e.left=me+"px",$e.width=$e.height=z+"px",$e.setProperty("--final-scale",`${O}`),$e.setProperty("--translate-end",`${Ie}px, ${Te}px`),(this.el.shadowRoot||this.el).appendChild(ve),setTimeout(()=>{l(()=>{xM(ve)})},225+100)})})})}get unbounded(){return this.type==="unbounded"}render(){const t=tr(this);return Gt(wr,{role:"presentation",class:{[t]:!0,unbounded:this.unbounded}})}get el(){return this}static get style(){return vM}},[1,"ion-ripple-effect",{type:[1],addRipple:[64]}]),xM=t=>{t.classList.add("fade-out"),setTimeout(()=>{t.remove()},200)},wM=10,TM=.5;function Hy(){if(typeof customElements>"u")return;["ion-ripple-effect"].forEach(r=>{switch(r){case"ion-ripple-effect":customElements.get(r)||customElements.define(r,bM);break}})}/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const EM=':host{--overflow:hidden;--ripple-color:currentColor;--border-width:initial;--border-color:initial;--border-style:initial;--color-activated:var(--color);--color-focused:var(--color);--color-hover:var(--color);--box-shadow:none;display:inline-block;width:auto;color:var(--color);font-family:var(--ion-font-family, inherit);text-align:center;text-decoration:none;text-overflow:ellipsis;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:top;vertical-align:-webkit-baseline-middle;-webkit-font-kerning:none;font-kerning:none}:host(.button-disabled){cursor:default;opacity:0.5;pointer-events:none}:host(.button-solid){--background:var(--ion-color-primary, #3880ff);--color:var(--ion-color-primary-contrast, #fff)}:host(.button-outline){--border-color:var(--ion-color-primary, #3880ff);--background:transparent;--color:var(--ion-color-primary, #3880ff)}:host(.button-clear){--border-width:0;--background:transparent;--color:var(--ion-color-primary, #3880ff)}:host(.button-block){display:block}:host(.button-block) .button-native{margin-left:0;margin-right:0;display:block;width:100%;clear:both;contain:content}:host(.button-block) .button-native::after{clear:both}:host(.button-full){display:block}:host(.button-full) .button-native{margin-left:0;margin-right:0;display:block;width:100%;contain:content}:host(.button-full:not(.button-round)) .button-native{border-radius:0;border-right-width:0;border-left-width:0}.button-native{border-radius:var(--border-radius);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-indent:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;display:block;position:relative;width:100%;height:100%;-webkit-transition:var(--transition);transition:var(--transition);border-width:var(--border-width);border-style:var(--border-style);border-color:var(--border-color);outline:none;background:var(--background);line-height:1;-webkit-box-shadow:var(--box-shadow);box-shadow:var(--box-shadow);contain:layout style;cursor:pointer;opacity:var(--opacity);overflow:var(--overflow);z-index:0;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-appearance:none;-moz-appearance:none;appearance:none}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.button-native::-moz-focus-inner{border:0}.button-inner{display:-ms-flexbox;display:flex;position:relative;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-negative:0;flex-shrink:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:100%;height:100%;z-index:1}::slotted(ion-icon){font-size:1.4em;pointer-events:none}::slotted(ion-icon[slot=start]){margin-left:-0.3em;margin-right:0.3em;margin-top:0;margin-bottom:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){::slotted(ion-icon[slot=start]){margin-left:unset;margin-right:unset;-webkit-margin-start:-0.3em;margin-inline-start:-0.3em;-webkit-margin-end:0.3em;margin-inline-end:0.3em}}::slotted(ion-icon[slot=end]){margin-left:0.3em;margin-right:-0.2em;margin-top:0;margin-bottom:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){::slotted(ion-icon[slot=end]){margin-left:unset;margin-right:unset;-webkit-margin-start:0.3em;margin-inline-start:0.3em;-webkit-margin-end:-0.2em;margin-inline-end:-0.2em}}::slotted(ion-icon[slot=icon-only]){font-size:1.8em}ion-ripple-effect{color:var(--ripple-color)}.button-native::after{left:0;right:0;top:0;bottom:0;position:absolute;content:"";opacity:0}:host(.ion-focused){color:var(--color-focused)}:host(.ion-focused) .button-native::after{background:var(--background-focused);opacity:var(--background-focused-opacity)}@media (any-hover: hover){:host(:hover){color:var(--color-hover)}:host(:hover) .button-native::after{background:var(--background-hover);opacity:var(--background-hover-opacity)}}:host(.ion-activated){color:var(--color-activated)}:host(.ion-activated) .button-native::after{background:var(--background-activated);opacity:var(--background-activated-opacity)}:host(.button-solid.ion-color) .button-native{background:var(--ion-color-base);color:var(--ion-color-contrast)}:host(.button-outline.ion-color) .button-native{border-color:var(--ion-color-base);background:transparent;color:var(--ion-color-base)}:host(.button-clear.ion-color) .button-native{background:transparent;color:var(--ion-color-base)}:host(.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{color:var(--ion-toolbar-color, var(--color))}:host(.button-outline.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{border-color:var(--ion-toolbar-color, var(--color, var(--border-color)))}:host(.button-solid.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{background:var(--ion-toolbar-color, var(--background));color:var(--ion-toolbar-background, var(--color))}:host(.button-outline.ion-activated.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{background:var(--ion-toolbar-color, var(--color));color:var(--ion-toolbar-background, var(--background), var(--ion-color-primary-contrast, #fff))}:host{--border-radius:10px;--padding-top:0;--padding-bottom:0;--padding-start:1em;--padding-end:1em;--transition:background-color, opacity 100ms linear;margin-left:2px;margin-right:2px;margin-top:4px;margin-bottom:4px;height:2.8em;font-size:16px;font-weight:500;letter-spacing:-0.03em}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{margin-left:unset;margin-right:unset;-webkit-margin-start:2px;margin-inline-start:2px;-webkit-margin-end:2px;margin-inline-end:2px}}:host(.in-buttons){font-size:17px;font-weight:400}:host(.button-solid){--background-activated:var(--ion-color-primary-shade, #3171e0);--background-focused:var(--ion-color-primary-shade, #3171e0);--background-hover:var(--ion-color-primary-tint, #4c8dff);--background-activated-opacity:1;--background-focused-opacity:1;--background-hover-opacity:1}:host(.button-outline){--border-radius:10px;--border-width:1px;--border-style:solid;--background-activated:var(--ion-color-primary, #3880ff);--background-focused:var(--ion-color-primary, #3880ff);--background-hover:transparent;--background-focused-opacity:.1;--color-activated:var(--ion-color-primary-contrast, #fff)}:host(.button-clear){--background-activated:transparent;--background-activated-opacity:0;--background-focused:var(--ion-color-primary, #3880ff);--background-hover:transparent;--background-focused-opacity:.1;font-size:17px;font-weight:normal;letter-spacing:0}:host(.button-large){--border-radius:12px;--padding-top:0;--padding-start:1em;--padding-end:1em;--padding-bottom:0;height:2.8em;font-size:20px}:host(.button-small){--border-radius:6px;--padding-top:0;--padding-start:0.9em;--padding-end:0.9em;--padding-bottom:0;height:2.1em;font-size:13px}:host(.button-round){--border-radius:64px;--padding-top:0;--padding-start:26px;--padding-end:26px;--padding-bottom:0}:host(.button-strong){font-weight:600}:host(.button-outline.ion-focused.ion-color) .button-native,:host(.button-clear.ion-focused.ion-color) .button-native{color:var(--ion-color-base)}:host(.button-outline.ion-focused.ion-color) .button-native::after,:host(.button-clear.ion-focused.ion-color) .button-native::after{background:var(--ion-color-base)}:host(.button-solid.ion-color.ion-focused) .button-native::after{background:var(--ion-color-shade)}@media (any-hover: hover){:host(.button-clear:not(.ion-activated):hover),:host(.button-outline:not(.ion-activated):hover){opacity:0.6}:host(.button-clear.ion-color:hover) .button-native,:host(.button-outline.ion-color:hover) .button-native{color:var(--ion-color-base)}:host(.button-clear.ion-color:hover) .button-native::after,:host(.button-outline.ion-color:hover) .button-native::after{background:transparent}:host(.button-solid.ion-color:hover) .button-native::after{background:var(--ion-color-tint)}:host(:hover.button-solid.in-toolbar:not(.ion-color):not(.in-toolbar-color):not(.ion-activated)) .button-native::after{background:#fff;opacity:0.1}}:host(.button-clear.ion-activated){opacity:0.4}:host(.button-outline.ion-activated.ion-color) .button-native{color:var(--ion-color-contrast)}:host(.button-outline.ion-activated.ion-color) .button-native::after{background:var(--ion-color-base)}:host(.button-solid.ion-color.ion-activated) .button-native::after{background:var(--ion-color-shade)}',kM=`:host{--overflow:hidden;--ripple-color:currentColor;--border-width:initial;--border-color:initial;--border-style:initial;--color-activated:var(--color);--color-focused:var(--color);--color-hover:var(--color);--box-shadow:none;display:inline-block;width:auto;color:var(--color);font-family:var(--ion-font-family, inherit);text-align:center;text-decoration:none;text-overflow:ellipsis;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:top;vertical-align:-webkit-baseline-middle;-webkit-font-kerning:none;font-kerning:none}:host(.button-disabled){cursor:default;opacity:0.5;pointer-events:none}:host(.button-solid){--background:var(--ion-color-primary, #3880ff);--color:var(--ion-color-primary-contrast, #fff)}:host(.button-outline){--border-color:var(--ion-color-primary, #3880ff);--background:transparent;--color:var(--ion-color-primary, #3880ff)}:host(.button-clear){--border-width:0;--background:transparent;--color:var(--ion-color-primary, #3880ff)}:host(.button-block){display:block}:host(.button-block) .button-native{margin-left:0;margin-right:0;display:block;width:100%;clear:both;contain:content}:host(.button-block) .button-native::after{clear:both}:host(.button-full){display:block}:host(.button-full) .button-native{margin-left:0;margin-right:0;display:block;width:100%;contain:content}:host(.button-full:not(.button-round)) .button-native{border-radius:0;border-right-width:0;border-left-width:0}.button-native{border-radius:var(--border-radius);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-indent:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;display:block;position:relative;width:100%;height:100%;-webkit-transition:var(--transition);transition:var(--transition);border-width:var(--border-width);border-style:var(--border-style);border-color:var(--border-color);outline:none;background:var(--background);line-height:1;-webkit-box-shadow:var(--box-shadow);box-shadow:var(--box-shadow);contain:layout style;cursor:pointer;opacity:var(--opacity);overflow:var(--overflow);z-index:0;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-appearance:none;-moz-appearance:none;appearance:none}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.button-native::-moz-focus-inner{border:0}.button-inner{display:-ms-flexbox;display:flex;position:relative;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-negative:0;flex-shrink:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:100%;height:100%;z-index:1}::slotted(ion-icon){font-size:1.4em;pointer-events:none}::slotted(ion-icon[slot=start]){margin-left:-0.3em;margin-right:0.3em;margin-top:0;margin-bottom:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){::slotted(ion-icon[slot=start]){margin-left:unset;margin-right:unset;-webkit-margin-start:-0.3em;margin-inline-start:-0.3em;-webkit-margin-end:0.3em;margin-inline-end:0.3em}}::slotted(ion-icon[slot=end]){margin-left:0.3em;margin-right:-0.2em;margin-top:0;margin-bottom:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){::slotted(ion-icon[slot=end]){margin-left:unset;margin-right:unset;-webkit-margin-start:0.3em;margin-inline-start:0.3em;-webkit-margin-end:-0.2em;margin-inline-end:-0.2em}}::slotted(ion-icon[slot=icon-only]){font-size:1.8em}ion-ripple-effect{color:var(--ripple-color)}.button-native::after{left:0;right:0;top:0;bottom:0;position:absolute;content:"";opacity:0}:host(.ion-focused){color:var(--color-focused)}:host(.ion-focused) .button-native::after{background:var(--background-focused);opacity:var(--background-focused-opacity)}@media (any-hover: hover){:host(:hover){color:var(--color-hover)}:host(:hover) .button-native::after{background:var(--background-hover);opacity:var(--background-hover-opacity)}}:host(.ion-activated){color:var(--color-activated)}:host(.ion-activated) .button-native::after{background:var(--background-activated);opacity:var(--background-activated-opacity)}:host(.button-solid.ion-color) .button-native{background:var(--ion-color-base);color:var(--ion-color-contrast)}:host(.button-outline.ion-color) .button-native{border-color:var(--ion-color-base);background:transparent;color:var(--ion-color-base)}:host(.button-clear.ion-color) .button-native{background:transparent;color:var(--ion-color-base)}:host(.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{color:var(--ion-toolbar-color, var(--color))}:host(.button-outline.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{border-color:var(--ion-toolbar-color, var(--color, var(--border-color)))}:host(.button-solid.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{background:var(--ion-toolbar-color, var(--background));color:var(--ion-toolbar-background, var(--color))}:host(.button-outline.ion-activated.in-toolbar:not(.ion-color):not(.in-toolbar-color)) .button-native{background:var(--ion-toolbar-color, var(--color));color:var(--ion-toolbar-background, var(--background), var(--ion-color-primary-contrast, #fff))}:host{--border-radius:4px;--padding-top:0;--padding-bottom:0;--padding-start:1.1em;--padding-end:1.1em;--transition:box-shadow 280ms cubic-bezier(.4, 0, .2, 1),
                background-color 15ms linear,
                color 15ms linear;margin-left:2px;margin-right:2px;margin-top:4px;margin-bottom:4px;height:36px;font-size:14px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{margin-left:unset;margin-right:unset;-webkit-margin-start:2px;margin-inline-start:2px;-webkit-margin-end:2px;margin-inline-end:2px}}:host(.button-solid){--background-activated:transparent;--background-hover:var(--ion-color-primary-contrast, #fff);--background-focused:var(--ion-color-primary-contrast, #fff);--background-activated-opacity:0;--background-focused-opacity:.24;--background-hover-opacity:.08;--box-shadow:0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)}:host(.button-solid.ion-activated){--box-shadow:0 5px 5px -3px rgba(0, 0, 0, 0.2), 0 8px 10px 1px rgba(0, 0, 0, 0.14), 0 3px 14px 2px rgba(0, 0, 0, 0.12)}:host(.button-outline){--border-width:2px;--border-style:solid;--box-shadow:none;--background-activated:transparent;--background-focused:var(--ion-color-primary, #3880ff);--background-hover:var(--ion-color-primary, #3880ff);--background-activated-opacity:0;--background-focused-opacity:.12;--background-hover-opacity:.04}:host(.button-outline.ion-activated.ion-color) .button-native{background:transparent}:host(.button-clear){--background-activated:transparent;--background-focused:var(--ion-color-primary, #3880ff);--background-hover:var(--ion-color-primary, #3880ff);--background-activated-opacity:0;--background-focused-opacity:.12;--background-hover-opacity:.04}:host(.button-round){--border-radius:64px;--padding-top:0;--padding-start:26px;--padding-end:26px;--padding-bottom:0}:host(.button-large){--padding-top:0;--padding-start:1em;--padding-end:1em;--padding-bottom:0;height:2.8em;font-size:20px}:host(.button-small){--padding-top:0;--padding-start:0.9em;--padding-end:0.9em;--padding-bottom:0;height:2.1em;font-size:13px}:host(.button-strong){font-weight:bold}::slotted(ion-icon[slot=icon-only]){padding-left:0;padding-right:0;padding-top:0;padding-bottom:0}:host(.button-solid.ion-color.ion-focused) .button-native::after{background:var(--ion-color-contrast)}:host(.button-clear.ion-color.ion-focused) .button-native::after,:host(.button-outline.ion-color.ion-focused) .button-native::after{background:var(--ion-color-base)}@media (any-hover: hover){:host(.button-solid.ion-color:hover) .button-native::after{background:var(--ion-color-contrast)}:host(.button-clear.ion-color:hover) .button-native::after,:host(.button-outline.ion-color:hover) .button-native::after{background:var(--ion-color-base)}}`,SM=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.ionFocus=po(this,"ionFocus",7),this.ionBlur=po(this,"ionBlur",7),this.inItem=!1,this.inListHeader=!1,this.inToolbar=!1,this.inheritedAttributes={},this.buttonType="button",this.disabled=!1,this.routerDirection="forward",this.strong=!1,this.type="button",this.handleClick=t=>{const{el:r}=this;if(this.type==="button")Wy(this.href,t,this.routerDirection,this.routerAnimation);else if(nM(r)){let l=this.findForm();const{form:h}=this;if(!l&&h!==void 0){Rx(typeof h=="string"?`Form with selector: "#${h}" could not be found. Verify that the id is correct and the form is rendered in the DOM.`:'The provided "form" element is invalid. Verify that the form is a HTMLFormElement and rendered in the DOM.',r);return}if(l||(l=r.closest("form")),l){t.preventDefault();const m=document.createElement("button");m.type=this.type,m.style.display="none",l.appendChild(m),m.click(),m.remove()}}},this.onFocus=()=>{this.ionFocus.emit()},this.onBlur=()=>{this.ionBlur.emit()}}componentWillLoad(){this.inToolbar=!!this.el.closest("ion-buttons"),this.inListHeader=!!this.el.closest("ion-list-header"),this.inItem=!!this.el.closest("ion-item")||!!this.el.closest("ion-item-divider"),this.inheritedAttributes=Bm(this.el)}get hasIconOnly(){return!!this.el.querySelector('[slot="icon-only"]')}get rippleType(){return(this.fill===void 0||this.fill==="clear")&&this.hasIconOnly&&this.inToolbar?"unbounded":"bounded"}findForm(){const{form:t}=this;if(t instanceof HTMLFormElement)return t;if(typeof t=="string"){const r=document.getElementById(t);if(r instanceof HTMLFormElement)return r}return null}render(){const t=tr(this),{buttonType:r,type:l,disabled:h,rel:m,target:v,size:T,href:s,color:S,expand:z,hasIconOnly:O,shape:B,strong:Z,inheritedAttributes:me}=this,_e=T===void 0&&this.inItem?"small":T,Ie=s===void 0?"button":"a",Te=Ie==="button"?{type:l}:{download:this.download,href:s,rel:m,target:v};let ve=this.fill;return ve==null&&(ve=this.inToolbar||this.inListHeader?"clear":"solid"),Gt(wr,{onClick:this.handleClick,"aria-disabled":h?"true":null,class:nc(S,{[t]:!0,[r]:!0,[`${r}-${z}`]:z!==void 0,[`${r}-${_e}`]:_e!==void 0,[`${r}-${B}`]:B!==void 0,[`${r}-${ve}`]:!0,[`${r}-strong`]:Z,"in-toolbar":Fs("ion-toolbar",this.el),"in-toolbar-color":Fs("ion-toolbar[color]",this.el),"in-buttons":Fs("ion-buttons",this.el),"button-has-icon-only":O,"button-disabled":h,"ion-activatable":!0,"ion-focusable":!0})},Gt(Ie,Object.assign({},Te,{class:"button-native",part:"native",disabled:h,onFocus:this.onFocus,onBlur:this.onBlur},me),Gt("span",{class:"button-inner"},Gt("slot",{name:"icon-only"}),Gt("slot",{name:"start"}),Gt("slot",null),Gt("slot",{name:"end"})),t==="md"&&Gt("ion-ripple-effect",{type:this.rippleType})))}get el(){return this}static get style(){return{ios:EM,md:kM}}},[33,"ion-button",{color:[513],buttonType:[1025,"button-type"],disabled:[516],expand:[513],fill:[1537],routerDirection:[1,"router-direction"],routerAnimation:[16],download:[1],href:[1],rel:[1],shape:[513],size:[513],strong:[4],target:[1],type:[1],form:[1]}]);function AM(){if(typeof customElements>"u")return;["ion-button","ion-ripple-effect"].forEach(r=>{switch(r){case"ion-button":customElements.get(r)||customElements.define(r,SM);break;case"ion-ripple-effect":customElements.get(r)||Hy();break}})}/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const IM=AM;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const CM=".sc-ion-buttons-ios-h{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-webkit-transform:translateZ(0);transform:translateZ(0);z-index:99}.sc-ion-buttons-ios-s ion-button{--padding-top:0;--padding-bottom:0;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0}.sc-ion-buttons-ios-s ion-button{--padding-start:5px;--padding-end:5px;margin-left:2px;margin-right:2px;height:32px}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.sc-ion-buttons-ios-s ion-button{margin-left:unset;margin-right:unset;-webkit-margin-start:2px;margin-inline-start:2px;-webkit-margin-end:2px;margin-inline-end:2px}}.sc-ion-buttons-ios-s ion-button:not(.button-round){--border-radius:4px}.sc-ion-buttons-ios-h.ion-color.sc-ion-buttons-ios-s .button,.ion-color .sc-ion-buttons-ios-h.sc-ion-buttons-ios-s .button{--color:initial;--border-color:initial;--background-focused:var(--ion-color-contrast)}.sc-ion-buttons-ios-h.ion-color.sc-ion-buttons-ios-s .button-solid,.ion-color .sc-ion-buttons-ios-h.sc-ion-buttons-ios-s .button-solid{--background:var(--ion-color-contrast);--background-focused:#000;--background-focused-opacity:.12;--background-activated:#000;--background-activated-opacity:.12;--background-hover:var(--ion-color-base);--background-hover-opacity:0.45;--color:var(--ion-color-base);--color-focused:var(--ion-color-base)}.sc-ion-buttons-ios-h.ion-color.sc-ion-buttons-ios-s .button-clear,.ion-color .sc-ion-buttons-ios-h.sc-ion-buttons-ios-s .button-clear{--color-activated:var(--ion-color-contrast);--color-focused:var(--ion-color-contrast)}.sc-ion-buttons-ios-h.ion-color.sc-ion-buttons-ios-s .button-outline,.ion-color .sc-ion-buttons-ios-h.sc-ion-buttons-ios-s .button-outline{--color-activated:var(--ion-color-base);--color-focused:var(--ion-color-contrast);--background-activated:var(--ion-color-contrast)}.sc-ion-buttons-ios-s .button-clear,.sc-ion-buttons-ios-s .button-outline{--background-activated:transparent;--background-focused:currentColor;--background-hover:transparent}.sc-ion-buttons-ios-s .button-solid:not(.ion-color){--background-focused:#000;--background-focused-opacity:.12;--background-activated:#000;--background-activated-opacity:.12}.sc-ion-buttons-ios-s ion-icon[slot=start]{margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;margin-right:0.3em;font-size:24px;line-height:0.67}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.sc-ion-buttons-ios-s ion-icon[slot=start]{margin-right:unset;-webkit-margin-end:0.3em;margin-inline-end:0.3em}}.sc-ion-buttons-ios-s ion-icon[slot=end]{margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;margin-left:0.4em;font-size:24px;line-height:0.67}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.sc-ion-buttons-ios-s ion-icon[slot=end]{margin-left:unset;-webkit-margin-start:0.4em;margin-inline-start:0.4em}}.sc-ion-buttons-ios-s ion-icon[slot=icon-only]{padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;font-size:28px;line-height:0.67}",MM=".sc-ion-buttons-md-h{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-webkit-transform:translateZ(0);transform:translateZ(0);z-index:99}.sc-ion-buttons-md-s ion-button{--padding-top:0;--padding-bottom:0;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0}.sc-ion-buttons-md-s ion-button{--padding-top:0;--padding-bottom:0;--padding-start:8px;--padding-end:8px;--box-shadow:none;margin-left:2px;margin-right:2px;height:32px}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.sc-ion-buttons-md-s ion-button{margin-left:unset;margin-right:unset;-webkit-margin-start:2px;margin-inline-start:2px;-webkit-margin-end:2px;margin-inline-end:2px}}.sc-ion-buttons-md-s ion-button:not(.button-round){--border-radius:2px}.sc-ion-buttons-md-h.ion-color.sc-ion-buttons-md-s .button,.ion-color .sc-ion-buttons-md-h.sc-ion-buttons-md-s .button{--color:initial;--color-focused:var(--ion-color-contrast);--color-hover:var(--ion-color-contrast);--background-activated:transparent;--background-focused:var(--ion-color-contrast);--background-hover:var(--ion-color-contrast)}.sc-ion-buttons-md-h.ion-color.sc-ion-buttons-md-s .button-solid,.ion-color .sc-ion-buttons-md-h.sc-ion-buttons-md-s .button-solid{--background:var(--ion-color-contrast);--background-activated:transparent;--background-focused:var(--ion-color-shade);--background-hover:var(--ion-color-base);--color:var(--ion-color-base);--color-focused:var(--ion-color-base);--color-hover:var(--ion-color-base)}.sc-ion-buttons-md-h.ion-color.sc-ion-buttons-md-s .button-outline,.ion-color .sc-ion-buttons-md-h.sc-ion-buttons-md-s .button-outline{--border-color:var(--ion-color-contrast)}.sc-ion-buttons-md-s .button-has-icon-only.button-clear{--padding-top:12px;--padding-end:12px;--padding-bottom:12px;--padding-start:12px;--border-radius:50%;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;width:48px;height:48px}.sc-ion-buttons-md-s .button{--background-hover:currentColor}.sc-ion-buttons-md-s .button-solid{--color:var(--ion-toolbar-background, var(--ion-background-color, #fff));--background:var(--ion-toolbar-color, var(--ion-text-color, #424242));--background-activated:transparent;--background-focused:currentColor}.sc-ion-buttons-md-s .button-outline{--color:initial;--background:transparent;--background-activated:transparent;--background-focused:currentColor;--background-hover:currentColor;--border-color:currentColor}.sc-ion-buttons-md-s .button-clear{--color:initial;--background:transparent;--background-activated:transparent;--background-focused:currentColor;--background-hover:currentColor}.sc-ion-buttons-md-s ion-icon[slot=start]{margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;margin-right:0.3em;font-size:1.4em}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.sc-ion-buttons-md-s ion-icon[slot=start]{margin-right:unset;-webkit-margin-end:0.3em;margin-inline-end:0.3em}}.sc-ion-buttons-md-s ion-icon[slot=end]{margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;margin-left:0.4em;font-size:1.4em}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.sc-ion-buttons-md-s ion-icon[slot=end]{margin-left:unset;-webkit-margin-start:0.4em;margin-inline-start:0.4em}}.sc-ion-buttons-md-s ion-icon[slot=icon-only]{padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;font-size:1.8em}",PM=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.collapse=!1}render(){const t=tr(this);return Gt(wr,{class:{[t]:!0,["buttons-collapse"]:this.collapse}})}static get style(){return{ios:CM,md:MM}}},[34,"ion-buttons",{collapse:[4]}]);function LM(){if(typeof customElements>"u")return;["ion-buttons"].forEach(r=>{switch(r){case"ion-buttons":customElements.get(r)||customElements.define(r,PM);break}})}/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const zM=LM;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const RM=t=>t&&t.dir!==""?t.dir.toLowerCase()==="rtl":(document==null?void 0:document.dir.toLowerCase())==="rtl";/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const DM=':host{--background:var(--ion-background-color, #fff);--color:var(--ion-text-color, #000);--padding-top:0px;--padding-bottom:0px;--padding-start:0px;--padding-end:0px;--keyboard-offset:0px;--offset-top:0px;--offset-bottom:0px;--overflow:auto;display:block;position:relative;-ms-flex:1;flex:1;width:100%;height:100%;margin:0 !important;padding:0 !important;font-family:var(--ion-font-family, inherit);contain:size style}:host(.ion-color) .inner-scroll{background:var(--ion-color-base);color:var(--ion-color-contrast)}:host(.outer-content){--background:var(--ion-color-step-50, #f2f2f2)}#background-content{left:0px;right:0px;top:calc(var(--offset-top) * -1);bottom:calc(var(--offset-bottom) * -1);position:absolute;background:var(--background)}.inner-scroll{left:0px;right:0px;top:calc(var(--offset-top) * -1);bottom:calc(var(--offset-bottom) * -1);padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:calc(var(--padding-top) + var(--offset-top));padding-bottom:calc(var(--padding-bottom) + var(--keyboard-offset) + var(--offset-bottom));position:absolute;color:var(--color);-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden;-ms-touch-action:pan-x pan-y pinch-zoom;touch-action:pan-x pan-y pinch-zoom}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.inner-scroll{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.scroll-y,.scroll-x{-webkit-overflow-scrolling:touch;z-index:0;will-change:scroll-position}.scroll-y{overflow-y:var(--overflow);overscroll-behavior-y:contain}.scroll-x{overflow-x:var(--overflow);overscroll-behavior-x:contain}.overscroll::before,.overscroll::after{position:absolute;width:1px;height:1px;content:""}.overscroll::before{bottom:-1px}.overscroll::after{top:-1px}:host(.content-sizing){display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;min-height:0;contain:none}:host(.content-sizing) .inner-scroll{position:relative;top:0;bottom:0;margin-top:calc(var(--offset-top) * -1);margin-bottom:calc(var(--offset-bottom) * -1)}.transition-effect{display:none;position:absolute;width:100%;height:100vh;opacity:0;pointer-events:none}:host(.content-ltr) .transition-effect{left:-100%;}:host(.content-rtl) .transition-effect{right:-100%;}.transition-cover{position:absolute;right:0;width:100%;height:100%;background:black;opacity:0.1}.transition-shadow{display:block;position:absolute;width:10px;height:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAgCAYAAAAIXrg4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTE3MDgzRkQ5QTkyMTFFOUEwNzQ5MkJFREE1NUY2MjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTE3MDgzRkU5QTkyMTFFOUEwNzQ5MkJFREE1NUY2MjQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMTcwODNGQjlBOTIxMUU5QTA3NDkyQkVEQTU1RjYyNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxMTcwODNGQzlBOTIxMUU5QTA3NDkyQkVEQTU1RjYyNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmePEuQAAABNSURBVHjaYvz//z8DIxAwMDAwATGMhmFmPDQuOSZks0AMmoJBaQHjkPfB0Lfg/2gQjVow+HPy/yHvg9GiYjQfjMbBqAWjFgy/4hogwADYqwdzxy5BuwAAAABJRU5ErkJggg==);background-repeat:repeat-y;background-size:10px 16px}:host(.content-ltr) .transition-shadow{right:0;}:host(.content-rtl) .transition-shadow{left:0;-webkit-transform:scaleX(-1);transform:scaleX(-1)}::slotted([slot=fixed]){position:absolute;-webkit-transform:translateZ(0);transform:translateZ(0)}',OM=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.ionScrollStart=po(this,"ionScrollStart",7),this.ionScroll=po(this,"ionScroll",7),this.ionScrollEnd=po(this,"ionScrollEnd",7),this.watchDog=null,this.isScrolling=!1,this.lastScroll=0,this.queued=!1,this.cTop=-1,this.cBottom=-1,this.isMainContent=!0,this.resizeTimeout=null,this.detail={scrollTop:0,scrollLeft:0,type:"scroll",event:void 0,startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,data:void 0,isScrolling:!0},this.fullscreen=!1,this.scrollX=!1,this.scrollY=!0,this.scrollEvents=!1}connectedCallback(){this.isMainContent=this.el.closest("ion-menu, ion-popover, ion-modal")===null}disconnectedCallback(){this.onScrollEnd()}onAppLoad(){this.resize()}onResize(){this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.resizeTimeout=setTimeout(()=>{this.el.offsetParent!==null&&this.resize()},100)}shouldForceOverscroll(){const{forceOverscroll:t}=this,r=tr(this);return t===void 0?r==="ios"&&Ma("ios"):t}resize(){this.fullscreen?kd(()=>this.readDimensions()):(this.cTop!==0||this.cBottom!==0)&&(this.cTop=this.cBottom=0,ey(this))}readDimensions(){const t=FM(this.el),r=Math.max(this.el.offsetTop,0),l=Math.max(t.offsetHeight-r-this.el.offsetHeight,0);(r!==this.cTop||l!==this.cBottom)&&(this.cTop=r,this.cBottom=l,ey(this))}onScroll(t){const r=Date.now(),l=!this.isScrolling;this.lastScroll=r,l&&this.onScrollStart(),!this.queued&&this.scrollEvents&&(this.queued=!0,kd(h=>{this.queued=!1,this.detail.event=t,jM(this.detail,this.scrollEl,h,l),this.ionScroll.emit(this.detail)}))}async getScrollElement(){return this.scrollEl||await new Promise(t=>Sd(this.el,t)),Promise.resolve(this.scrollEl)}async getBackgroundElement(){return this.backgroundContentEl||await new Promise(t=>Sd(this.el,t)),Promise.resolve(this.backgroundContentEl)}scrollToTop(t=0){return this.scrollToPoint(void 0,0,t)}async scrollToBottom(t=0){const r=await this.getScrollElement(),l=r.scrollHeight-r.clientHeight;return this.scrollToPoint(void 0,l,t)}async scrollByPoint(t,r,l){const h=await this.getScrollElement();return this.scrollToPoint(t+h.scrollLeft,r+h.scrollTop,l)}async scrollToPoint(t,r,l=0){const h=await this.getScrollElement();if(l<32){r!=null&&(h.scrollTop=r),t!=null&&(h.scrollLeft=t);return}let m,v=0;const T=new Promise(Z=>m=Z),s=h.scrollTop,S=h.scrollLeft,z=r!=null?r-s:0,O=t!=null?t-S:0,B=Z=>{const me=Math.min(1,(Z-v)/l)-1,_e=Math.pow(me,3)+1;z!==0&&(h.scrollTop=Math.floor(_e*z+s)),O!==0&&(h.scrollLeft=Math.floor(_e*O+S)),_e<1?requestAnimationFrame(B):m()};return requestAnimationFrame(Z=>{v=Z,B(Z)}),T}onScrollStart(){this.isScrolling=!0,this.ionScrollStart.emit({isScrolling:!0}),this.watchDog&&clearInterval(this.watchDog),this.watchDog=setInterval(()=>{this.lastScroll<Date.now()-120&&this.onScrollEnd()},100)}onScrollEnd(){this.watchDog&&clearInterval(this.watchDog),this.watchDog=null,this.isScrolling&&(this.isScrolling=!1,this.ionScrollEnd.emit({isScrolling:!1}))}render(){const{isMainContent:t,scrollX:r,scrollY:l,el:h}=this,m=RM(h)?"rtl":"ltr",v=tr(this),T=this.shouldForceOverscroll(),s=v==="ios",S=t?"main":"div";return this.resize(),Gt(wr,{class:nc(this.color,{[v]:!0,"content-sizing":Fs("ion-popover",this.el),overscroll:T,[`content-${m}`]:!0}),style:{"--offset-top":`${this.cTop}px`,"--offset-bottom":`${this.cBottom}px`}},Gt("div",{ref:z=>this.backgroundContentEl=z,id:"background-content",part:"background"}),Gt(S,{class:{"inner-scroll":!0,"scroll-x":r,"scroll-y":l,overscroll:(r||l)&&T},ref:z=>this.scrollEl=z,onScroll:this.scrollEvents?z=>this.onScroll(z):void 0,part:"scroll"},Gt("slot",null)),s?Gt("div",{class:"transition-effect"},Gt("div",{class:"transition-cover"}),Gt("div",{class:"transition-shadow"})):null,Gt("slot",{name:"fixed"}))}get el(){return this}static get style(){return DM}},[1,"ion-content",{color:[513],fullscreen:[4],forceOverscroll:[1028,"force-overscroll"],scrollX:[4,"scroll-x"],scrollY:[4,"scroll-y"],scrollEvents:[4,"scroll-events"],getScrollElement:[64],getBackgroundElement:[64],scrollToTop:[64],scrollToBottom:[64],scrollByPoint:[64],scrollToPoint:[64]},[[8,"appload","onAppLoad"],[9,"resize","onResize"]]]),BM=t=>{var r;return t.parentElement?t.parentElement:!((r=t.parentNode)===null||r===void 0)&&r.host?t.parentNode.host:null},FM=t=>{const r=t.closest("ion-tabs");if(r)return r;const l=t.closest("ion-app, ion-page, .ion-page, page-inner, .popover-content");return l||BM(t)},jM=(t,r,l,h)=>{const m=t.currentX,v=t.currentY,T=t.currentTime,s=r.scrollLeft,S=r.scrollTop,z=l-T;if(h&&(t.startTime=l,t.startX=s,t.startY=S,t.velocityX=t.velocityY=0),t.currentTime=l,t.currentX=t.scrollLeft=s,t.currentY=t.scrollTop=S,t.deltaX=s-t.startX,t.deltaY=S-t.startY,z>0&&z<100){const O=(s-m)/z,B=(S-v)/z;t.velocityX=O*.7+t.velocityX*.3,t.velocityY=B*.7+t.velocityY*.3}};function NM(){if(typeof customElements>"u")return;["ion-content"].forEach(r=>{switch(r){case"ion-content":customElements.get(r)||customElements.define(r,OM);break}})}const $M=NM;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const UM=async(t,r,l,h,m,v)=>{var T;if(t)return t.attachViewToDom(r,l,m,h);if(!v&&typeof l!="string"&&!(l instanceof HTMLElement))throw new Error("framework delegate is missing");const s=typeof l=="string"?(T=r.ownerDocument)===null||T===void 0?void 0:T.createElement(l):l;return h&&h.forEach(S=>s.classList.add(S)),m&&Object.assign(s,m),r.appendChild(s),await new Promise(S=>Sd(s,S)),s},VM=(t,r)=>{if(r){if(t){const l=r.parentElement;return t.removeViewFromDom(l,r)}r.remove()}return Promise.resolve()},Xy="ionViewWillEnter",Ky="ionViewDidEnter",Yy="ionViewWillLeave",Jy="ionViewDidLeave",GM=()=>Bs(()=>import("./ios.transition-31dda1bc.js"),["assets/ios.transition-31dda1bc.js","assets/animation-82b7ec7e.js"]),ZM=()=>Bs(()=>import("./md.transition-dc02000d.js"),["assets/md.transition-dc02000d.js","assets/animation-82b7ec7e.js"]),qM=t=>new Promise((r,l)=>{Ba(()=>{WM(t),HM(t).then(h=>{h.animation&&h.animation.destroy(),Dx(t),r(h)},h=>{Dx(t),l(h)})})}),WM=t=>{const r=t.enteringEl,l=t.leavingEl;eP(r,l,t.direction),t.showGoBack?r.classList.add("can-go-back"):r.classList.remove("can-go-back"),Bx(r,!1),r.style.setProperty("pointer-events","none"),l&&(Bx(l,!1),l.style.setProperty("pointer-events","none"))},HM=async t=>{const r=await XM(t);return r&&ZI.isBrowser?KM(r,t):YM(t)},Dx=t=>{const r=t.enteringEl,l=t.leavingEl;r.classList.remove("ion-page-invisible"),r.style.removeProperty("pointer-events"),l!==void 0&&(l.classList.remove("ion-page-invisible"),l.style.removeProperty("pointer-events"))},XM=async t=>!t.leavingEl||!t.animated||t.duration===0?void 0:t.animationBuilder?t.animationBuilder:t.mode==="ios"?(await GM()).iosTransitionAnimation:(await ZM()).mdTransitionAnimation,KM=async(t,r)=>{await fT(r,!0);const l=t(r.baseEl,r);mT(r.enteringEl,r.leavingEl);const h=await QM(l,r);return r.progressCallback&&r.progressCallback(void 0),h&&gT(r.enteringEl,r.leavingEl),{hasCompleted:h,animation:l}},YM=async t=>{const r=t.enteringEl,l=t.leavingEl;return await fT(t,!1),mT(r,l),gT(r,l),{hasCompleted:!0}},fT=async(t,r)=>{const h=(t.deepWait!==void 0?t.deepWait:r)?[iy(t.enteringEl),iy(t.leavingEl)]:[Ox(t.enteringEl),Ox(t.leavingEl)];await Promise.all(h),await JM(t.viewIsReady,t.enteringEl)},JM=async(t,r)=>{t&&await t(r)},QM=(t,r)=>{const l=r.progressCallback,h=new Promise(m=>{t.onFinish(v=>m(v===1))});return l?(t.progressStart(!0),l(t)):t.play(),h},mT=(t,r)=>{nm(r,Yy),nm(t,Xy)},gT=(t,r)=>{nm(t,Ky),nm(r,Jy)},nm=(t,r)=>{if(t){const l=new CustomEvent(r,{bubbles:!1,cancelable:!1});t.dispatchEvent(l)}},Ox=t=>t?new Promise(r=>Sd(t,r)):Promise.resolve(),iy=async t=>{const r=t;if(r){if(r.componentOnReady!=null){if(await r.componentOnReady()!=null)return}else if(r.__registerHost!=null){await new Promise(h=>lT(h));return}await Promise.all(Array.from(r.children).map(iy))}},Bx=(t,r)=>{r?(t.setAttribute("aria-hidden","true"),t.classList.add("ion-page-hidden")):(t.hidden=!1,t.removeAttribute("aria-hidden"),t.classList.remove("ion-page-hidden"))},eP=(t,r,l)=>{t!==void 0&&(t.style.zIndex=l==="back"?"99":"101"),r!==void 0&&(r.style.zIndex="100")},GB=t=>{if(t.classList.contains("ion-page"))return t;const r=t.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs");return r||t};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const ho=typeof window<"u"?window:void 0;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const tP=":host{position:absolute;z-index:999}:host(.fab-horizontal-center){left:50%;margin-left:-28px}:host-context([dir=rtl]):host(.fab-horizontal-center),:host-context([dir=rtl]).fab-horizontal-center{left:unset;right:unset;right:50%}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.fab-horizontal-center){margin-left:unset;-webkit-margin-start:-28px;margin-inline-start:-28px}}:host(.fab-horizontal-start){left:calc(10px + var(--ion-safe-area-left, 0px))}:host-context([dir=rtl]):host(.fab-horizontal-start),:host-context([dir=rtl]).fab-horizontal-start{left:unset;right:unset;right:calc(10px + var(--ion-safe-area-left, 0px))}:host(.fab-horizontal-end){right:calc(10px + var(--ion-safe-area-right, 0px))}:host-context([dir=rtl]):host(.fab-horizontal-end),:host-context([dir=rtl]).fab-horizontal-end{left:unset;right:unset;left:calc(10px + var(--ion-safe-area-right, 0px))}:host(.fab-vertical-top){top:10px}:host(.fab-vertical-top.fab-edge){top:-28px}:host(.fab-vertical-bottom){bottom:10px}:host(.fab-vertical-bottom.fab-edge){bottom:-28px}:host(.fab-vertical-center){margin-top:-28px;top:50%}",nP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.edge=!1,this.activated=!1}activatedChanged(){const t=this.activated,r=this.getFab();r&&(r.activated=t),Array.from(this.el.querySelectorAll("ion-fab-list")).forEach(l=>{l.activated=t})}componentDidLoad(){this.activated&&this.activatedChanged()}async close(){this.activated=!1}getFab(){return this.el.querySelector("ion-fab-button")}async toggle(){!!this.el.querySelector("ion-fab-list")&&(this.activated=!this.activated)}render(){const{horizontal:t,vertical:r,edge:l}=this,h=tr(this);return Gt(wr,{class:{[h]:!0,[`fab-horizontal-${t}`]:t!==void 0,[`fab-vertical-${r}`]:r!==void 0,"fab-edge":l}},Gt("slot",null))}get el(){return this}static get watchers(){return{activated:["activatedChanged"]}}static get style(){return tP}},[1,"ion-fab",{horizontal:[1],vertical:[1],edge:[4],activated:[1028],close:[64],toggle:[64]}]);function iP(){if(typeof customElements>"u")return;["ion-fab"].forEach(r=>{switch(r){case"ion-fab":customElements.get(r)||customElements.define(r,nP);break}})}const rP=iP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const oP=':host{--color-activated:var(--color);--color-focused:var(--color);--color-hover:var(--color);--background-hover:var(--ion-color-primary-contrast, #fff);--background-hover-opacity:.08;--transition:background-color, opacity 100ms linear;--ripple-color:currentColor;--border-radius:50%;--border-width:0;--border-style:none;--border-color:initial;--padding-top:0;--padding-end:0;--padding-bottom:0;--padding-start:0;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;display:block;width:56px;height:56px;font-size:14px;text-align:center;text-overflow:ellipsis;text-transform:none;white-space:nowrap;-webkit-font-kerning:none;font-kerning:none}.button-native{border-radius:var(--border-radius);padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-indent:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;display:block;position:relative;width:100%;height:100%;-webkit-transform:var(--transform);transform:var(--transform);-webkit-transition:var(--transition);transition:var(--transition);border-width:var(--border-width);border-style:var(--border-style);border-color:var(--border-color);outline:none;background:var(--background);background-clip:padding-box;color:var(--color);-webkit-box-shadow:var(--box-shadow);box-shadow:var(--box-shadow);contain:strict;cursor:pointer;overflow:hidden;z-index:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-box-sizing:border-box;box-sizing:border-box}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}::slotted(ion-icon){line-height:1}.button-native::after{left:0;right:0;top:0;bottom:0;position:absolute;content:"";opacity:0}.button-inner{left:0;right:0;top:0;display:-ms-flexbox;display:flex;position:absolute;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-negative:0;flex-shrink:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%;-webkit-transition:all ease-in-out 300ms;transition:all ease-in-out 300ms;-webkit-transition-property:opacity, -webkit-transform;transition-property:opacity, -webkit-transform;transition-property:transform, opacity;transition-property:transform, opacity, -webkit-transform;z-index:1}:host(.fab-button-disabled){cursor:default;opacity:0.5;pointer-events:none}@media (any-hover: hover){:host(:hover) .button-native{color:var(--color-hover)}:host(:hover) .button-native::after{background:var(--background-hover);opacity:var(--background-hover-opacity)}}:host(.ion-focused) .button-native{color:var(--color-focused)}:host(.ion-focused) .button-native::after{background:var(--background-focused);opacity:var(--background-focused-opacity)}:host(.ion-activated) .button-native{color:var(--color-activated)}:host(.ion-activated) .button-native::after{background:var(--background-activated);opacity:var(--background-activated-opacity)}::slotted(ion-icon){line-height:1}:host(.fab-button-small){margin-left:8px;margin-right:8px;margin-top:8px;margin-bottom:8px;width:40px;height:40px}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.fab-button-small){margin-left:unset;margin-right:unset;-webkit-margin-start:8px;margin-inline-start:8px;-webkit-margin-end:8px;margin-inline-end:8px}}.close-icon{margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;left:0;right:0;top:0;position:absolute;height:100%;-webkit-transform:scale(0.4) rotateZ(-45deg);transform:scale(0.4) rotateZ(-45deg);-webkit-transition:all ease-in-out 300ms;transition:all ease-in-out 300ms;-webkit-transition-property:opacity, -webkit-transform;transition-property:opacity, -webkit-transform;transition-property:transform, opacity;transition-property:transform, opacity, -webkit-transform;font-size:var(--close-icon-font-size);opacity:0;z-index:1}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.close-icon{margin-left:unset;margin-right:unset;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto}}:host(.fab-button-close-active) .close-icon{-webkit-transform:scale(1) rotateZ(0deg);transform:scale(1) rotateZ(0deg);opacity:1}:host(.fab-button-close-active) .button-inner{-webkit-transform:scale(0.4) rotateZ(45deg);transform:scale(0.4) rotateZ(45deg);opacity:0}ion-ripple-effect{color:var(--ripple-color)}@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){:host(.fab-button-translucent) .button-native{-webkit-backdrop-filter:var(--backdrop-filter);backdrop-filter:var(--backdrop-filter)}}:host(.ion-color) .button-native{background:var(--ion-color-base);color:var(--ion-color-contrast)}:host{--background:var(--ion-color-primary, #3880ff);--background-activated:var(--ion-color-primary-shade, #3171e0);--background-focused:var(--ion-color-primary-shade, #3171e0);--background-hover:var(--ion-color-primary-tint, #4c8dff);--background-activated-opacity:1;--background-focused-opacity:1;--background-hover-opacity:1;--color:var(--ion-color-primary-contrast, #fff);--box-shadow:0 4px 16px rgba(0, 0, 0, 0.12);--transition:0.2s transform cubic-bezier(0.25, 1.11, 0.78, 1.59);--close-icon-font-size:28px}:host(.ion-activated){--box-shadow:0 4px 16px rgba(0, 0, 0, 0.12);--transform:scale(1.1);--transition:0.2s transform ease-out}::slotted(ion-icon){font-size:28px}:host(.fab-button-in-list){--background:var(--ion-color-light, #f4f5f8);--background-activated:var(--ion-color-light-shade, #d7d8da);--background-focused:var(--background-activated);--background-hover:var(--ion-color-light-tint, #f5f6f9);--color:var(--ion-color-light-contrast, #000);--color-activated:var(--ion-color-light-contrast, #000);--color-focused:var(--color-activated);--transition:transform 200ms ease 10ms, opacity 200ms ease 10ms}:host(.fab-button-in-list) ::slotted(ion-icon){font-size:18px}:host(.ion-color.ion-focused) .button-native::after{background:var(--ion-color-shade)}:host(.ion-color.ion-focused) .button-native,:host(.ion-color.ion-activated) .button-native{color:var(--ion-color-contrast)}:host(.ion-color.ion-focused) .button-native::after,:host(.ion-color.ion-activated) .button-native::after{background:var(--ion-color-shade)}@media (any-hover: hover){:host(.ion-color:hover) .button-native{color:var(--ion-color-contrast)}:host(.ion-color:hover) .button-native::after{background:var(--ion-color-tint)}}@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){:host(.fab-button-translucent){--background:rgba(var(--ion-color-primary-rgb, 56, 128, 255), 0.9);--background-hover:rgba(var(--ion-color-primary-rgb, 56, 128, 255), 0.8);--background-focused:rgba(var(--ion-color-primary-rgb, 56, 128, 255), 0.82);--backdrop-filter:saturate(180%) blur(20px)}:host(.fab-button-translucent-in-list){--background:rgba(var(--ion-color-light-rgb, 244, 245, 248), 0.9);--background-hover:rgba(var(--ion-color-light-rgb, 244, 245, 248), 0.8);--background-focused:rgba(var(--ion-color-light-rgb, 244, 245, 248), 0.82)}}@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){@media (any-hover: hover){:host(.fab-button-translucent.ion-color:hover) .button-native{background:rgba(var(--ion-color-base-rgb), 0.8)}}:host(.ion-color.fab-button-translucent) .button-native{background:rgba(var(--ion-color-base-rgb), 0.9)}:host(.ion-color.ion-focused.fab-button-translucent) .button-native,:host(.ion-color.ion-activated.fab-button-translucent) .button-native{background:var(--ion-color-base)}}',sP=':host{--color-activated:var(--color);--color-focused:var(--color);--color-hover:var(--color);--background-hover:var(--ion-color-primary-contrast, #fff);--background-hover-opacity:.08;--transition:background-color, opacity 100ms linear;--ripple-color:currentColor;--border-radius:50%;--border-width:0;--border-style:none;--border-color:initial;--padding-top:0;--padding-end:0;--padding-bottom:0;--padding-start:0;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;display:block;width:56px;height:56px;font-size:14px;text-align:center;text-overflow:ellipsis;text-transform:none;white-space:nowrap;-webkit-font-kerning:none;font-kerning:none}.button-native{border-radius:var(--border-radius);padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-indent:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;display:block;position:relative;width:100%;height:100%;-webkit-transform:var(--transform);transform:var(--transform);-webkit-transition:var(--transition);transition:var(--transition);border-width:var(--border-width);border-style:var(--border-style);border-color:var(--border-color);outline:none;background:var(--background);background-clip:padding-box;color:var(--color);-webkit-box-shadow:var(--box-shadow);box-shadow:var(--box-shadow);contain:strict;cursor:pointer;overflow:hidden;z-index:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;-webkit-box-sizing:border-box;box-sizing:border-box}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}::slotted(ion-icon){line-height:1}.button-native::after{left:0;right:0;top:0;bottom:0;position:absolute;content:"";opacity:0}.button-inner{left:0;right:0;top:0;display:-ms-flexbox;display:flex;position:absolute;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-negative:0;flex-shrink:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%;-webkit-transition:all ease-in-out 300ms;transition:all ease-in-out 300ms;-webkit-transition-property:opacity, -webkit-transform;transition-property:opacity, -webkit-transform;transition-property:transform, opacity;transition-property:transform, opacity, -webkit-transform;z-index:1}:host(.fab-button-disabled){cursor:default;opacity:0.5;pointer-events:none}@media (any-hover: hover){:host(:hover) .button-native{color:var(--color-hover)}:host(:hover) .button-native::after{background:var(--background-hover);opacity:var(--background-hover-opacity)}}:host(.ion-focused) .button-native{color:var(--color-focused)}:host(.ion-focused) .button-native::after{background:var(--background-focused);opacity:var(--background-focused-opacity)}:host(.ion-activated) .button-native{color:var(--color-activated)}:host(.ion-activated) .button-native::after{background:var(--background-activated);opacity:var(--background-activated-opacity)}::slotted(ion-icon){line-height:1}:host(.fab-button-small){margin-left:8px;margin-right:8px;margin-top:8px;margin-bottom:8px;width:40px;height:40px}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.fab-button-small){margin-left:unset;margin-right:unset;-webkit-margin-start:8px;margin-inline-start:8px;-webkit-margin-end:8px;margin-inline-end:8px}}.close-icon{margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;left:0;right:0;top:0;position:absolute;height:100%;-webkit-transform:scale(0.4) rotateZ(-45deg);transform:scale(0.4) rotateZ(-45deg);-webkit-transition:all ease-in-out 300ms;transition:all ease-in-out 300ms;-webkit-transition-property:opacity, -webkit-transform;transition-property:opacity, -webkit-transform;transition-property:transform, opacity;transition-property:transform, opacity, -webkit-transform;font-size:var(--close-icon-font-size);opacity:0;z-index:1}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.close-icon{margin-left:unset;margin-right:unset;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto}}:host(.fab-button-close-active) .close-icon{-webkit-transform:scale(1) rotateZ(0deg);transform:scale(1) rotateZ(0deg);opacity:1}:host(.fab-button-close-active) .button-inner{-webkit-transform:scale(0.4) rotateZ(45deg);transform:scale(0.4) rotateZ(45deg);opacity:0}ion-ripple-effect{color:var(--ripple-color)}@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){:host(.fab-button-translucent) .button-native{-webkit-backdrop-filter:var(--backdrop-filter);backdrop-filter:var(--backdrop-filter)}}:host(.ion-color) .button-native{background:var(--ion-color-base);color:var(--ion-color-contrast)}:host{--background:var(--ion-color-primary, #3880ff);--background-activated:transparent;--background-focused:currentColor;--background-hover:currentColor;--background-activated-opacity:0;--background-focused-opacity:.24;--background-hover-opacity:.08;--color:var(--ion-color-primary-contrast, #fff);--box-shadow:0 3px 5px -1px rgba(0, 0, 0, 0.2), 0 6px 10px 0 rgba(0, 0, 0, 0.14), 0 1px 18px 0 rgba(0, 0, 0, 0.12);--transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1), background-color 280ms cubic-bezier(0.4, 0, 0.2, 1), color 280ms cubic-bezier(0.4, 0, 0.2, 1), opacity 15ms linear 30ms, transform 270ms cubic-bezier(0, 0, 0.2, 1) 0ms;--close-icon-font-size:24px}:host(.ion-activated){--box-shadow:0 7px 8px -4px rgba(0, 0, 0, 0.2), 0 12px 17px 2px rgba(0, 0, 0, 0.14), 0 5px 22px 4px rgba(0, 0, 0, 0.12)}::slotted(ion-icon){font-size:24px}:host(.fab-button-in-list){--color:rgba(var(--ion-text-color-rgb, 0, 0, 0), 0.54);--color-activated:rgba(var(--ion-text-color-rgb, 0, 0, 0), 0.54);--color-focused:var(--color-activated);--background:var(--ion-color-light, #f4f5f8);--background-activated:transparent;--background-focused:var(--ion-color-light-shade, #d7d8da);--background-hover:var(--ion-color-light-tint, #f5f6f9)}:host(.fab-button-in-list) ::slotted(ion-icon){font-size:18px}:host(.ion-color.ion-focused) .button-native{color:var(--ion-color-contrast)}:host(.ion-color.ion-focused) .button-native::after{background:var(--ion-color-contrast)}:host(.ion-color.ion-activated) .button-native{color:var(--ion-color-contrast)}:host(.ion-color.ion-activated) .button-native::after{background:transparent}@media (any-hover: hover){:host(.ion-color:hover) .button-native{color:var(--ion-color-contrast)}:host(.ion-color:hover) .button-native::after{background:var(--ion-color-contrast)}}',aP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.ionFocus=po(this,"ionFocus",7),this.ionBlur=po(this,"ionBlur",7),this.fab=null,this.inheritedAttributes={},this.activated=!1,this.disabled=!1,this.routerDirection="forward",this.show=!1,this.translucent=!1,this.type="button",this.closeIcon=DC,this.onFocus=()=>{this.ionFocus.emit()},this.onBlur=()=>{this.ionBlur.emit()},this.onClick=()=>{const{fab:t}=this;t&&t.toggle()}}connectedCallback(){this.fab=this.el.closest("ion-fab")}componentWillLoad(){this.inheritedAttributes=Bm(this.el)}render(){const{el:t,disabled:r,color:l,href:h,activated:m,show:v,translucent:T,size:s,inheritedAttributes:S}=this,z=Fs("ion-fab-list",t),O=tr(this),B=h===void 0?"button":"a",Z=B==="button"?{type:this.type}:{download:this.download,href:h,rel:this.rel,target:this.target};return Gt(wr,{onClick:this.onClick,"aria-disabled":r?"true":null,class:nc(l,{[O]:!0,"fab-button-in-list":z,"fab-button-translucent-in-list":z&&T,"fab-button-close-active":m,"fab-button-show":v,"fab-button-disabled":r,"fab-button-translucent":T,"ion-activatable":!0,"ion-focusable":!0,[`fab-button-${s}`]:s!==void 0})},Gt(B,Object.assign({},Z,{class:"button-native",part:"native",disabled:r,onFocus:this.onFocus,onBlur:this.onBlur,onClick:me=>Wy(h,me,this.routerDirection,this.routerAnimation)},S),Gt("ion-icon",{"aria-hidden":"true",icon:this.closeIcon,part:"close-icon",class:"close-icon",lazy:!1}),Gt("span",{class:"button-inner"},Gt("slot",null)),O==="md"&&Gt("ion-ripple-effect",null)))}get el(){return this}static get style(){return{ios:oP,md:sP}}},[33,"ion-fab-button",{color:[513],activated:[4],disabled:[4],download:[1],href:[1],rel:[1],routerDirection:[1,"router-direction"],routerAnimation:[16],target:[1],show:[4],translucent:[4],type:[1],size:[1],closeIcon:[1,"close-icon"]}]);function lP(){if(typeof customElements>"u")return;["ion-fab-button","ion-icon","ion-ripple-effect"].forEach(r=>{switch(r){case"ion-fab-button":customElements.get(r)||customElements.define(r,aP);break;case"ion-icon":customElements.get(r)||pT();break;case"ion-ripple-effect":customElements.get(r)||Hy();break}})}const cP=lP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const uP=":host{margin-left:0;margin-right:0;margin-top:66px;margin-bottom:66px;display:none;position:absolute;top:0;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center;min-width:56px;min-height:56px}:host(.fab-list-active){display:-ms-flexbox;display:flex}::slotted(.fab-button-in-list){margin-left:0;margin-right:0;margin-top:8px;margin-bottom:8px;width:40px;height:40px;-webkit-transform:scale(0);transform:scale(0);opacity:0;visibility:hidden}:host(.fab-list-side-top) ::slotted(.fab-button-in-list),:host(.fab-list-side-bottom) ::slotted(.fab-button-in-list){margin-left:0;margin-right:0;margin-top:5px;margin-bottom:5px}:host(.fab-list-side-start) ::slotted(.fab-button-in-list),:host(.fab-list-side-end) ::slotted(.fab-button-in-list){margin-left:5px;margin-right:5px;margin-top:0;margin-bottom:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.fab-list-side-start) ::slotted(.fab-button-in-list),:host(.fab-list-side-end) ::slotted(.fab-button-in-list){margin-left:unset;margin-right:unset;-webkit-margin-start:5px;margin-inline-start:5px;-webkit-margin-end:5px;margin-inline-end:5px}}::slotted(.fab-button-in-list.fab-button-show){-webkit-transform:scale(1);transform:scale(1);opacity:1;visibility:visible}:host(.fab-list-side-top){top:auto;bottom:0;-ms-flex-direction:column-reverse;flex-direction:column-reverse}:host(.fab-list-side-start){margin-left:66px;margin-right:66px;margin-top:0;margin-bottom:0;right:0;-ms-flex-direction:row-reverse;flex-direction:row-reverse}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.fab-list-side-start){margin-left:unset;margin-right:unset;-webkit-margin-start:66px;margin-inline-start:66px;-webkit-margin-end:66px;margin-inline-end:66px}}:host-context([dir=rtl]):host(.fab-list-side-start),:host-context([dir=rtl]).fab-list-side-start{left:unset;right:unset;left:0}:host(.fab-list-side-end){margin-left:66px;margin-right:66px;margin-top:0;margin-bottom:0;left:0;-ms-flex-direction:row;flex-direction:row}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.fab-list-side-end){margin-left:unset;margin-right:unset;-webkit-margin-start:66px;margin-inline-start:66px;-webkit-margin-end:66px;margin-inline-end:66px}}:host-context([dir=rtl]):host(.fab-list-side-end),:host-context([dir=rtl]).fab-list-side-end{left:unset;right:unset;right:0}",hP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.activated=!1,this.side="bottom"}activatedChanged(t){const r=Array.from(this.el.querySelectorAll("ion-fab-button")),l=t?30:0;r.forEach((h,m)=>{setTimeout(()=>h.show=t,m*l)})}render(){const t=tr(this);return Gt(wr,{class:{[t]:!0,"fab-list-active":this.activated,[`fab-list-side-${this.side}`]:!0}},Gt("slot",null))}get el(){return this}static get watchers(){return{activated:["activatedChanged"]}}static get style(){return uP}},[1,"ion-fab-list",{activated:[4],side:[1]}]);function dP(){if(typeof customElements>"u")return;["ion-fab-list"].forEach(r=>{switch(r){case"ion-fab-list":customElements.get(r)||customElements.define(r,hP);break}})}const pP=dP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const fP="ION-CONTENT",_T="ion-content",yT=".ion-content-scroll-host",vT=`${_T}, ${yT}`,Qy=t=>t.tagName===fP,Fx=async t=>Qy(t)?(await new Promise(r=>Sd(t,r)),t.getScrollElement()):t,jx=t=>{const r=t.querySelector(yT);return r||t.querySelector(vT)},ZB=t=>t.closest(vT),qB=(t,r)=>Qy(t)?t.scrollToTop(r):Promise.resolve(t.scrollTo({top:0,left:0,behavior:r>0?"smooth":"auto"})),WB=(t,r,l,h)=>Qy(t)?t.scrollByPoint(r,l,h):Promise.resolve(t.scrollBy({top:l,left:r,behavior:h>0?"smooth":"auto"})),Nx=t=>yM(t,_T);/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const mP=t=>{let r,l,h;const m=()=>{r=()=>{h=!0,t&&t(!0)},l=()=>{h=!1,t&&t(!1)},ho==null||ho.addEventListener("keyboardWillShow",r),ho==null||ho.addEventListener("keyboardWillHide",l)},v=()=>{ho==null||ho.removeEventListener("keyboardWillShow",r),ho==null||ho.removeEventListener("keyboardWillHide",l),r=l=void 0},T=()=>h;return m(),{init:m,destroy:v,isKeyboardVisible:T}};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const gP="all 0.2s ease-in-out",$x=t=>{const r=document.querySelector(`${t}.ion-cloned-element`);if(r!==null)return r;const l=document.createElement(t);return l.classList.add("ion-cloned-element"),l.style.setProperty("display","none"),document.body.appendChild(l),l},Ux=t=>{if(!t)return;const r=t.querySelectorAll("ion-toolbar");return{el:t,toolbars:Array.from(r).map(l=>{const h=l.querySelector("ion-title");return{el:l,background:l.shadowRoot.querySelector(".toolbar-background"),ionTitleEl:h,innerTitleEl:h?h.shadowRoot.querySelector(".toolbar-title"):null,ionButtonsEl:Array.from(l.querySelectorAll("ion-buttons"))}})}},_P=(t,r,l)=>{kd(()=>{const h=t.scrollTop,m=cT(1,1+-h/500,1.1);l.querySelector("ion-refresher.refresher-native")===null&&Ba(()=>{bP(r.toolbars,m)})})},ev=(t,r)=>{t.collapse!=="fade"&&(r===void 0?t.style.removeProperty("--opacity-scale"):t.style.setProperty("--opacity-scale",r.toString()))},yP=(t,r,l)=>{if(!t[0].isIntersecting)return;const h=t[0].intersectionRatio>.9||l<=0?0:(1-t[0].intersectionRatio)*100/75;ev(r.el,h===1?void 0:h)},vP=(t,r,l,h)=>{Ba(()=>{const m=h.scrollTop;yP(t,r,m);const v=t[0],T=v.intersectionRect,s=T.width*T.height,S=v.rootBounds.width*v.rootBounds.height,z=s===0&&S===0,O=Math.abs(T.left-v.boundingClientRect.left),B=Math.abs(T.right-v.boundingClientRect.right),Z=s>0&&(O>=5||B>=5);z||Z||(v.isIntersecting?(cd(r,!1),cd(l)):(T.x===0&&T.y===0||T.width!==0&&T.height!==0)&&m>0&&(cd(r),cd(l,!1),ev(r.el)))})},cd=(t,r=!0)=>{const l=t.el;r?(l.classList.remove("header-collapse-condense-inactive"),l.removeAttribute("aria-hidden")):(l.classList.add("header-collapse-condense-inactive"),l.setAttribute("aria-hidden","true"))},bP=(t=[],r=1,l=!1)=>{t.forEach(h=>{const m=h.ionTitleEl,v=h.innerTitleEl;!m||m.size!=="large"||(v.style.transition=l?gP:"",v.style.transform=`scale3d(${r}, ${r}, 1)`)})},Vx=(t,r,l)=>{kd(()=>{const h=t.scrollTop,m=r.clientHeight,v=l?l.clientHeight:0;if(l!==null&&h<v){r.style.setProperty("--opacity-scale","0"),t.style.setProperty("clip-path",`inset(${m}px 0px 0px 0px)`);return}const T=h-v,S=cT(0,T/10,1);Ba(()=>{t.style.removeProperty("clip-path"),r.style.setProperty("--opacity-scale",S.toString())})})},xP="ion-header{display:block;position:relative;-ms-flex-order:-1;order:-1;width:100%;z-index:10}ion-header ion-toolbar:first-of-type{padding-top:var(--ion-safe-area-top, 0)}.header-ios ion-toolbar:last-of-type{--border-width:0 0 0.55px}@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){.header-background{left:0;right:0;top:0;bottom:0;position:absolute;-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px)}.header-translucent-ios ion-toolbar{--opacity:.8}.header-collapse-condense-inactive .header-background{-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}}.header-ios.ion-no-border ion-toolbar:last-of-type{--border-width:0}.header-collapse-fade ion-toolbar{--opacity-scale:inherit}.header-collapse-condense{z-index:9}.header-collapse-condense ion-toolbar{position:-webkit-sticky;position:sticky;top:0}.header-collapse-condense ion-toolbar:first-of-type{padding-top:7px;z-index:1}.header-collapse-condense ion-toolbar{--background:var(--ion-background-color, #fff);z-index:0}.header-collapse-condense ion-toolbar:last-of-type{--border-width:0px}.header-collapse-condense ion-toolbar ion-searchbar{height:48px;padding-top:0px;padding-bottom:13px}.header-collapse-main{--opacity-scale:1}.header-collapse-main ion-toolbar{--opacity-scale:inherit}.header-collapse-main ion-toolbar.in-toolbar ion-title,.header-collapse-main ion-toolbar.in-toolbar ion-buttons{-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out}.header-collapse-condense-inactive:not(.header-collapse-condense) ion-toolbar.in-toolbar ion-title,.header-collapse-condense-inactive:not(.header-collapse-condense) ion-toolbar.in-toolbar ion-buttons.buttons-collapse{opacity:0;pointer-events:none}.header-collapse-condense-inactive.header-collapse-condense ion-toolbar.in-toolbar ion-title,.header-collapse-condense-inactive.header-collapse-condense ion-toolbar.in-toolbar ion-buttons.buttons-collapse{visibility:hidden}",wP='ion-header{display:block;position:relative;-ms-flex-order:-1;order:-1;width:100%;z-index:10}ion-header ion-toolbar:first-of-type{padding-top:var(--ion-safe-area-top, 0)}.header-md::after{left:0;bottom:-5px;background-position:left 0 top -2px;position:absolute;width:100%;height:5px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAHBAMAAADzDtBxAAAAD1BMVEUAAAAAAAAAAAAAAAAAAABPDueNAAAABXRSTlMUCS0gBIh/TXEAAAAaSURBVAjXYxCEAgY4UIICBmMogMsgFLtAAQCNSwXZKOdPxgAAAABJRU5ErkJggg==);background-repeat:repeat-x;content:""}[dir=rtl] .header-md::after,:host-context([dir=rtl]) .header-md::after{left:unset;right:unset;right:0}[dir=rtl] .header-md::after,:host-context([dir=rtl]) .header-md::after{background-position:right 0 top -2px}.header-collapse-condense{display:none}.header-md.ion-no-border::after{display:none}',TP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.inheritedAttributes={},this.translucent=!1,this.setupFadeHeader=async(t,r)=>{const l=this.scrollEl=await Fx(t);this.contentScrollCallback=()=>{Vx(this.scrollEl,this.el,r)},l.addEventListener("scroll",this.contentScrollCallback),Vx(this.scrollEl,this.el,r)}}componentWillLoad(){this.inheritedAttributes=Bm(this.el)}componentDidLoad(){this.checkCollapsibleHeader()}componentDidUpdate(){this.checkCollapsibleHeader()}disconnectedCallback(){this.destroyCollapsibleHeader()}async checkCollapsibleHeader(){if(tr(this)!=="ios")return;const{collapse:r}=this,l=r==="condense",h=r==="fade";if(this.destroyCollapsibleHeader(),l){const m=this.el.closest("ion-app,ion-page,.ion-page,page-inner"),v=m?jx(m):null;Ba(()=>{const T=$x("ion-title");T.size="large",$x("ion-back-button")}),await this.setupCondenseHeader(v,m)}else if(h){const m=this.el.closest("ion-app,ion-page,.ion-page,page-inner"),v=m?jx(m):null;if(!v){Nx(this.el);return}const T=v.querySelector('ion-header[collapse="condense"]');await this.setupFadeHeader(v,T)}}destroyCollapsibleHeader(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=void 0),this.scrollEl&&this.contentScrollCallback&&(this.scrollEl.removeEventListener("scroll",this.contentScrollCallback),this.contentScrollCallback=void 0),this.collapsibleMainHeader&&(this.collapsibleMainHeader.classList.remove("header-collapse-main"),this.collapsibleMainHeader=void 0)}async setupCondenseHeader(t,r){if(!t||!r){Nx(this.el);return}if(typeof IntersectionObserver>"u")return;this.scrollEl=await Fx(t);const l=r.querySelectorAll("ion-header");if(this.collapsibleMainHeader=Array.from(l).find(T=>T.collapse!=="condense"),!this.collapsibleMainHeader)return;const h=Ux(this.collapsibleMainHeader),m=Ux(this.el);if(!h||!m)return;cd(h,!1),ev(h.el,0);const v=T=>{vP(T,h,m,this.scrollEl)};this.intersectionObserver=new IntersectionObserver(v,{root:t,threshold:[.25,.3,.4,.5,.6,.7,.8,.9,1]}),this.intersectionObserver.observe(m.toolbars[m.toolbars.length-1].el),this.contentScrollCallback=()=>{_P(this.scrollEl,m,t)},this.scrollEl.addEventListener("scroll",this.contentScrollCallback),Ba(()=>{this.collapsibleMainHeader!==void 0&&this.collapsibleMainHeader.classList.add("header-collapse-main")})}render(){const{translucent:t,inheritedAttributes:r}=this,l=tr(this),h=this.collapse||"none",m=Fs("ion-menu",this.el)?"none":"banner";return Gt(wr,Object.assign({role:m,class:{[l]:!0,[`header-${l}`]:!0,["header-translucent"]:this.translucent,[`header-collapse-${h}`]:!0,[`header-translucent-${l}`]:this.translucent}},r),l==="ios"&&t&&Gt("div",{class:"header-background"}),Gt("slot",null))}get el(){return this}static get style(){return{ios:xP,md:wP}}},[36,"ion-header",{collapse:[1],translucent:[4]}]);function EP(){if(typeof customElements>"u")return;["ion-header"].forEach(r=>{switch(r){case"ion-header":customElements.get(r)||customElements.define(r,TP);break}})}const kP=EP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const Gx=(t,r,l,h,m)=>AP(t[1],r[1],l[1],h[1],m).map(v=>SP(t[0],r[0],l[0],h[0],v)),SP=(t,r,l,h,m)=>{const v=3*r*Math.pow(m-1,2),T=-3*l*m+3*l+h*m,s=t*Math.pow(m-1,3);return m*(v+m*T)-s},AP=(t,r,l,h,m)=>(t-=m,r-=m,l-=m,h-=m,CP(h-3*l+3*r-t,3*l-6*r+3*t,3*r-3*t,t).filter(T=>T>=0&&T<=1)),IP=(t,r,l)=>{const h=r*r-4*t*l;return h<0?[]:[(-r+Math.sqrt(h))/(2*t),(-r-Math.sqrt(h))/(2*t)]},CP=(t,r,l,h)=>{if(t===0)return IP(r,l,h);r/=t,l/=t,h/=t;const m=(3*l-r*r)/3,v=(2*r*r*r-9*r*l+27*h)/27;if(m===0)return[Math.pow(-v,1/3)];if(v===0)return[Math.sqrt(-m),-Math.sqrt(-m)];const T=Math.pow(v/2,2)+Math.pow(m/3,3);if(T===0)return[Math.pow(v/2,1/2)-r/3];if(T>0)return[Math.pow(-(v/2)+Math.sqrt(T),1/3)-Math.pow(v/2+Math.sqrt(T),1/3)-r/3];const s=Math.sqrt(Math.pow(-(m/3),3)),S=Math.acos(-(v/(2*Math.sqrt(Math.pow(-(m/3),3))))),z=2*Math.pow(s,1/3);return[z*Math.cos(S/3)-r/3,z*Math.cos((S+2*Math.PI)/3)-r/3,z*Math.cos((S+4*Math.PI)/3)-r/3]};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const MP=":host{--color:initial;display:-ms-flexbox;display:flex;-ms-flex:1;flex:1;-ms-flex-align:center;align-items:center;-webkit-transform:translateZ(0);transform:translateZ(0);color:var(--color)}:host(.ion-color){color:var(--ion-color-base)}.toolbar-title{display:block;width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;pointer-events:auto}:host(.title-small) .toolbar-title{white-space:normal}:host{left:0;top:0;padding-left:90px;padding-right:90px;padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);position:absolute;width:100%;height:100%;-webkit-transform:translateZ(0);transform:translateZ(0);font-size:17px;font-weight:600;text-align:center;-webkit-box-sizing:border-box;box-sizing:border-box;pointer-events:none}:host-context([dir=rtl]){left:unset;right:unset;right:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{padding-left:unset;padding-right:unset;-webkit-padding-start:90px;padding-inline-start:90px;-webkit-padding-end:90px;padding-inline-end:90px}}:host(.title-small){padding-left:9px;padding-right:9px;padding-top:6px;padding-bottom:16px;position:relative;font-size:13px;font-weight:normal}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.title-small){padding-left:unset;padding-right:unset;-webkit-padding-start:9px;padding-inline-start:9px;-webkit-padding-end:9px;padding-inline-end:9px}}:host(.title-large){padding-left:16px;padding-right:16px;padding-top:0;padding-bottom:0;-webkit-transform-origin:left center;transform-origin:left center;bottom:0;-ms-flex-align:end;align-items:flex-end;min-width:100%;padding-bottom:6px;font-size:34px;font-weight:700;text-align:start}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host(.title-large){padding-left:unset;padding-right:unset;-webkit-padding-start:16px;padding-inline-start:16px;-webkit-padding-end:16px;padding-inline-end:16px}}:host(.title-large.title-rtl){-webkit-transform-origin:right center;transform-origin:right center}:host(.title-large.ion-cloned-element){--color:var(--ion-text-color, #000)}:host(.title-large) .toolbar-title{-webkit-transform-origin:inherit;transform-origin:inherit}:host-context([dir=rtl]):host(.title-large) .toolbar-title,:host-context([dir=rtl]).title-large .toolbar-title{-webkit-transform-origin:calc(100% - inherit);transform-origin:calc(100% - inherit)}",PP=":host{--color:initial;display:-ms-flexbox;display:flex;-ms-flex:1;flex:1;-ms-flex-align:center;align-items:center;-webkit-transform:translateZ(0);transform:translateZ(0);color:var(--color)}:host(.ion-color){color:var(--ion-color-base)}.toolbar-title{display:block;width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;pointer-events:auto}:host(.title-small) .toolbar-title{white-space:normal}:host{padding-left:20px;padding-right:20px;padding-top:0;padding-bottom:0;font-size:20px;font-weight:500;letter-spacing:0.0125em}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{padding-left:unset;padding-right:unset;-webkit-padding-start:20px;padding-inline-start:20px;-webkit-padding-end:20px;padding-inline-end:20px}}:host(.title-small){width:100%;height:100%;font-size:15px;font-weight:normal}",LP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.ionStyle=po(this,"ionStyle",7)}sizeChanged(){this.emitStyle()}connectedCallback(){this.emitStyle()}emitStyle(){const t=this.getSize();this.ionStyle.emit({[`title-${t}`]:!0})}getSize(){return this.size!==void 0?this.size:"default"}render(){const t=tr(this),r=this.getSize();return Gt(wr,{class:nc(this.color,{[t]:!0,[`title-${r}`]:!0,"title-rtl":document.dir==="rtl"})},Gt("div",{class:"toolbar-title"},Gt("slot",null)))}get el(){return this}static get watchers(){return{size:["sizeChanged"]}}static get style(){return{ios:MP,md:PP}}},[33,"ion-title",{color:[513],size:[1]}]);function zP(){if(typeof customElements>"u")return;["ion-title"].forEach(r=>{switch(r){case"ion-title":customElements.get(r)||customElements.define(r,LP);break}})}const RP=zP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const DP=":host{--border-width:0;--border-style:solid;--opacity:1;--opacity-scale:1;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;padding-left:var(--ion-safe-area-left);padding-right:var(--ion-safe-area-right);display:block;position:relative;width:100%;color:var(--color);font-family:var(--ion-font-family, inherit);contain:content;z-index:10;-webkit-box-sizing:border-box;box-sizing:border-box}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--ion-safe-area-left);padding-inline-start:var(--ion-safe-area-left);-webkit-padding-end:var(--ion-safe-area-right);padding-inline-end:var(--ion-safe-area-right)}}:host(.ion-color){color:var(--ion-color-contrast)}:host(.ion-color) .toolbar-background{background:var(--ion-color-base)}.toolbar-container{padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);display:-ms-flexbox;display:flex;position:relative;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;-ms-flex-pack:justify;justify-content:space-between;width:100%;min-height:var(--min-height);contain:content;overflow:hidden;z-index:10;-webkit-box-sizing:border-box;box-sizing:border-box}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.toolbar-container{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.toolbar-background{left:0;right:0;top:0;bottom:0;position:absolute;-webkit-transform:translateZ(0);transform:translateZ(0);border-width:var(--border-width);border-style:var(--border-style);border-color:var(--border-color);background:var(--background);contain:strict;opacity:calc(var(--opacity) * var(--opacity-scale));z-index:-1;pointer-events:none}::slotted(ion-progress-bar){left:0;right:0;bottom:0;position:absolute}:host{--background:var(--ion-toolbar-background, var(--ion-color-step-50, #f7f7f7));--color:var(--ion-toolbar-color, var(--ion-text-color, #000));--border-color:var(--ion-toolbar-border-color, var(--ion-border-color, var(--ion-color-step-150, rgba(0, 0, 0, 0.2))));--padding-top:3px;--padding-bottom:3px;--padding-start:4px;--padding-end:4px;--min-height:44px}.toolbar-content{-ms-flex:1;flex:1;-ms-flex-order:4;order:4;min-width:0}:host(.toolbar-segment) .toolbar-content{display:-ms-inline-flexbox;display:inline-flex}:host(.toolbar-searchbar) .toolbar-container{padding-top:0;padding-bottom:0}:host(.toolbar-searchbar) ::slotted(*){-ms-flex-item-align:start;align-self:start}:host(.toolbar-searchbar) ::slotted(ion-chip){margin-top:3px}:host(.toolbar-searchbar) ::slotted(ion-back-button){height:38px}::slotted(ion-buttons){min-height:38px}::slotted([slot=start]){-ms-flex-order:2;order:2}::slotted([slot=secondary]){-ms-flex-order:3;order:3}::slotted([slot=primary]){-ms-flex-order:5;order:5;text-align:end}::slotted([slot=end]){-ms-flex-order:6;order:6;text-align:end}:host(.toolbar-title-large) .toolbar-container{-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:start;align-items:flex-start}:host(.toolbar-title-large) .toolbar-content ion-title{-ms-flex:1;flex:1;-ms-flex-order:8;order:8;min-width:100%}",OP=":host{--border-width:0;--border-style:solid;--opacity:1;--opacity-scale:1;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;padding-left:var(--ion-safe-area-left);padding-right:var(--ion-safe-area-right);display:block;position:relative;width:100%;color:var(--color);font-family:var(--ion-font-family, inherit);contain:content;z-index:10;-webkit-box-sizing:border-box;box-sizing:border-box}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--ion-safe-area-left);padding-inline-start:var(--ion-safe-area-left);-webkit-padding-end:var(--ion-safe-area-right);padding-inline-end:var(--ion-safe-area-right)}}:host(.ion-color){color:var(--ion-color-contrast)}:host(.ion-color) .toolbar-background{background:var(--ion-color-base)}.toolbar-container{padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);display:-ms-flexbox;display:flex;position:relative;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;-ms-flex-pack:justify;justify-content:space-between;width:100%;min-height:var(--min-height);contain:content;overflow:hidden;z-index:10;-webkit-box-sizing:border-box;box-sizing:border-box}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.toolbar-container{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.toolbar-background{left:0;right:0;top:0;bottom:0;position:absolute;-webkit-transform:translateZ(0);transform:translateZ(0);border-width:var(--border-width);border-style:var(--border-style);border-color:var(--border-color);background:var(--background);contain:strict;opacity:calc(var(--opacity) * var(--opacity-scale));z-index:-1;pointer-events:none}::slotted(ion-progress-bar){left:0;right:0;bottom:0;position:absolute}:host{--background:var(--ion-toolbar-background, var(--ion-background-color, #fff));--color:var(--ion-toolbar-color, var(--ion-text-color, #424242));--border-color:var(--ion-toolbar-border-color, var(--ion-border-color, var(--ion-color-step-150, #c1c4cd)));--padding-top:0;--padding-bottom:0;--padding-start:0;--padding-end:0;--min-height:56px}.toolbar-content{-ms-flex:1;flex:1;-ms-flex-order:3;order:3;min-width:0;max-width:100%}::slotted(.buttons-first-slot){margin-left:4px}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){::slotted(.buttons-first-slot){margin-left:unset;-webkit-margin-start:4px;margin-inline-start:4px}}::slotted(.buttons-last-slot){margin-right:4px}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){::slotted(.buttons-last-slot){margin-right:unset;-webkit-margin-end:4px;margin-inline-end:4px}}::slotted([slot=start]){-ms-flex-order:2;order:2}::slotted([slot=secondary]){-ms-flex-order:4;order:4}::slotted([slot=primary]){-ms-flex-order:5;order:5;text-align:end}::slotted([slot=end]){-ms-flex-order:6;order:6;text-align:end}",BP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.childrenStyles=new Map}componentWillLoad(){const t=Array.from(this.el.querySelectorAll("ion-buttons")),r=t.find(m=>m.slot==="start");r&&r.classList.add("buttons-first-slot");const l=t.reverse(),h=l.find(m=>m.slot==="end")||l.find(m=>m.slot==="primary")||l.find(m=>m.slot==="secondary");h&&h.classList.add("buttons-last-slot")}childrenStyle(t){t.stopPropagation();const r=t.target.tagName,l=t.detail,h={},m=this.childrenStyles.get(r)||{};let v=!1;Object.keys(l).forEach(T=>{const s=`toolbar-${T}`,S=l[T];S!==m[s]&&(v=!0),S&&(h[s]=!0)}),v&&(this.childrenStyles.set(r,h),ey(this))}render(){const t=tr(this),r={};return this.childrenStyles.forEach(l=>{Object.assign(r,l)}),Gt(wr,{class:Object.assign(Object.assign({},r),nc(this.color,{[t]:!0,"in-toolbar":Fs("ion-toolbar",this.el)}))},Gt("div",{class:"toolbar-background"}),Gt("div",{class:"toolbar-container"},Gt("slot",{name:"start"}),Gt("slot",{name:"secondary"}),Gt("div",{class:"toolbar-content"},Gt("slot",null)),Gt("slot",{name:"primary"}),Gt("slot",{name:"end"})))}get el(){return this}static get style(){return{ios:DP,md:OP}}},[33,"ion-toolbar",{color:[513]},[[0,"ionStyle","childrenStyle"]]]);function FP(){if(typeof customElements>"u")return;["ion-toolbar"].forEach(r=>{switch(r){case"ion-toolbar":customElements.get(r)||customElements.define(r,BP);break}})}const jP=FP,NP="html.plt-mobile ion-app{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}html.plt-mobile ion-app [contenteditable]{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}ion-app.force-statusbar-padding{--ion-safe-area-top:20px}",$P=Tr(class extends Er{constructor(){super(),this.__registerHost()}componentDidLoad(){VP(async()=>{const t=Ma(window,"hybrid");if(Oi.getBoolean("_testing")||Bs(()=>import("./index10-32867083.js"),[]).then(l=>l.startTapClick(Oi)),Oi.getBoolean("statusTap",t)&&Bs(()=>import("./status-tap-a2206811.js"),[]).then(l=>l.startStatusTap()),Oi.getBoolean("inputShims",UP())){const l=Ma(window,"ios")?"ios":"android";Bs(()=>import("./input-shims-6db39226.js"),[]).then(h=>h.startInputShims(Oi,l))}const r=await Bs(()=>import("./hardware-back-button-77fd2980.js"),[]);Oi.getBoolean("hardwareBackButton",t)?r.startHardwareBackButton():r.blockHardwareBackButton(),typeof window<"u"&&Bs(()=>import("./keyboard-78b51126.js"),[]).then(l=>l.startKeyboardAssist(window)),Bs(()=>import("./focus-visible-56d4fbba.js"),[]).then(l=>this.focusVisible=l.startFocusVisible())})}async setFocus(t){this.focusVisible&&this.focusVisible.setFocus(t)}render(){const t=tr(this);return Gt(wr,{class:{[t]:!0,"ion-page":!0,"force-statusbar-padding":Oi.getBoolean("_forceStatusbarPadding")}})}get el(){return this}static get style(){return NP}},[0,"ion-app",{setFocus:[64]}]),UP=()=>!!(Ma(window,"ios")&&Ma(window,"mobile")||Ma(window,"android")&&Ma(window,"mobileweb")),VP=t=>{"requestIdleCallback"in window?window.requestIdleCallback(t):setTimeout(t,32)};function GP(){if(typeof customElements>"u")return;["ion-app"].forEach(r=>{switch(r){case"ion-app":customElements.get(r)||customElements.define(r,$P);break}})}const ZP=GP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const qP=':host{--background:transparent;--color-focused:currentColor;--color-hover:currentColor;--icon-margin-top:0;--icon-margin-bottom:0;--icon-padding-top:0;--icon-padding-end:0;--icon-padding-bottom:0;--icon-padding-start:0;--margin-top:0;--margin-end:0;--margin-bottom:0;--margin-start:0;--min-width:auto;--min-height:auto;--padding-top:0;--padding-end:0;--padding-bottom:0;--padding-start:0;--opacity:1;--ripple-color:currentColor;--transition:background-color, opacity 100ms linear;display:none;min-width:var(--min-width);min-height:var(--min-height);color:var(--color);font-family:var(--ion-font-family, inherit);text-align:center;text-decoration:none;text-overflow:ellipsis;text-transform:none;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-kerning:none;font-kerning:none}ion-ripple-effect{color:var(--ripple-color)}:host(.ion-color) .button-native{color:var(--ion-color-base)}:host(.show-back-button){display:block}:host(.back-button-disabled){cursor:default;opacity:0.5;pointer-events:none}.button-native{border-radius:var(--border-radius);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin-left:var(--margin-start);margin-right:var(--margin-end);margin-top:var(--margin-top);margin-bottom:var(--margin-bottom);padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-indent:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;display:block;position:relative;width:100%;height:100%;min-height:inherit;-webkit-transition:var(--transition);transition:var(--transition);border:0;outline:none;background:var(--background);line-height:1;cursor:pointer;opacity:var(--opacity);overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:0;-webkit-appearance:none;-moz-appearance:none;appearance:none}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{margin-left:unset;margin-right:unset;-webkit-margin-start:var(--margin-start);margin-inline-start:var(--margin-start);-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.button-inner{display:-ms-flexbox;display:flex;position:relative;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-negative:0;flex-shrink:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:100%;height:100%;z-index:1}ion-icon{padding-left:var(--icon-padding-start);padding-right:var(--icon-padding-end);padding-top:var(--icon-padding-top);padding-bottom:var(--icon-padding-bottom);margin-left:var(--icon-margin-start);margin-right:var(--icon-margin-end);margin-top:var(--icon-margin-top);margin-bottom:var(--icon-margin-bottom);display:inherit;font-size:var(--icon-font-size);font-weight:var(--icon-font-weight);pointer-events:none}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){ion-icon{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--icon-padding-start);padding-inline-start:var(--icon-padding-start);-webkit-padding-end:var(--icon-padding-end);padding-inline-end:var(--icon-padding-end)}}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){ion-icon{margin-left:unset;margin-right:unset;-webkit-margin-start:var(--icon-margin-start);margin-inline-start:var(--icon-margin-start);-webkit-margin-end:var(--icon-margin-end);margin-inline-end:var(--icon-margin-end)}}:host(.ion-focused) .button-native{color:var(--color-focused)}:host(.ion-focused) .button-native::after{background:var(--background-focused);opacity:var(--background-focused-opacity)}.button-native::after{left:0;right:0;top:0;bottom:0;position:absolute;content:"";opacity:0}@media (any-hover: hover){:host(:hover) .button-native{color:var(--color-hover)}:host(:hover) .button-native::after{background:var(--background-hover);opacity:var(--background-hover-opacity)}}:host(.ion-color.ion-focused) .button-native{color:var(--ion-color-base)}@media (any-hover: hover){:host(.ion-color:hover) .button-native{color:var(--ion-color-base)}}:host(.in-toolbar:not(.in-toolbar-color)){color:var(--ion-toolbar-color, var(--color))}:host{--background-hover:transparent;--background-hover-opacity:1;--background-focused:currentColor;--background-focused-opacity:.1;--border-radius:4px;--color:var(--ion-color-primary, #3880ff);--icon-margin-end:-5px;--icon-margin-start:-4px;--icon-font-size:1.85em;--min-height:32px;font-size:17px}.button-native{-webkit-transform:translateZ(0);transform:translateZ(0);overflow:visible;z-index:99}:host(.ion-activated) .button-native{opacity:0.4}@media (any-hover: hover){:host(:hover){opacity:0.6}}:host(.ion-color.ion-focused) .button-native::after{background:var(--ion-color-base)}',WP=':host{--background:transparent;--color-focused:currentColor;--color-hover:currentColor;--icon-margin-top:0;--icon-margin-bottom:0;--icon-padding-top:0;--icon-padding-end:0;--icon-padding-bottom:0;--icon-padding-start:0;--margin-top:0;--margin-end:0;--margin-bottom:0;--margin-start:0;--min-width:auto;--min-height:auto;--padding-top:0;--padding-end:0;--padding-bottom:0;--padding-start:0;--opacity:1;--ripple-color:currentColor;--transition:background-color, opacity 100ms linear;display:none;min-width:var(--min-width);min-height:var(--min-height);color:var(--color);font-family:var(--ion-font-family, inherit);text-align:center;text-decoration:none;text-overflow:ellipsis;text-transform:none;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-kerning:none;font-kerning:none}ion-ripple-effect{color:var(--ripple-color)}:host(.ion-color) .button-native{color:var(--ion-color-base)}:host(.show-back-button){display:block}:host(.back-button-disabled){cursor:default;opacity:0.5;pointer-events:none}.button-native{border-radius:var(--border-radius);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin-left:var(--margin-start);margin-right:var(--margin-end);margin-top:var(--margin-top);margin-bottom:var(--margin-bottom);padding-left:var(--padding-start);padding-right:var(--padding-end);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom);font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-indent:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;display:block;position:relative;width:100%;height:100%;min-height:inherit;-webkit-transition:var(--transition);transition:var(--transition);border:0;outline:none;background:var(--background);line-height:1;cursor:pointer;opacity:var(--opacity);overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:0;-webkit-appearance:none;-moz-appearance:none;appearance:none}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{margin-left:unset;margin-right:unset;-webkit-margin-start:var(--margin-start);margin-inline-start:var(--margin-start);-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-native{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--padding-start);padding-inline-start:var(--padding-start);-webkit-padding-end:var(--padding-end);padding-inline-end:var(--padding-end)}}.button-inner{display:-ms-flexbox;display:flex;position:relative;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-negative:0;flex-shrink:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:100%;height:100%;z-index:1}ion-icon{padding-left:var(--icon-padding-start);padding-right:var(--icon-padding-end);padding-top:var(--icon-padding-top);padding-bottom:var(--icon-padding-bottom);margin-left:var(--icon-margin-start);margin-right:var(--icon-margin-end);margin-top:var(--icon-margin-top);margin-bottom:var(--icon-margin-bottom);display:inherit;font-size:var(--icon-font-size);font-weight:var(--icon-font-weight);pointer-events:none}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){ion-icon{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--icon-padding-start);padding-inline-start:var(--icon-padding-start);-webkit-padding-end:var(--icon-padding-end);padding-inline-end:var(--icon-padding-end)}}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){ion-icon{margin-left:unset;margin-right:unset;-webkit-margin-start:var(--icon-margin-start);margin-inline-start:var(--icon-margin-start);-webkit-margin-end:var(--icon-margin-end);margin-inline-end:var(--icon-margin-end)}}:host(.ion-focused) .button-native{color:var(--color-focused)}:host(.ion-focused) .button-native::after{background:var(--background-focused);opacity:var(--background-focused-opacity)}.button-native::after{left:0;right:0;top:0;bottom:0;position:absolute;content:"";opacity:0}@media (any-hover: hover){:host(:hover) .button-native{color:var(--color-hover)}:host(:hover) .button-native::after{background:var(--background-hover);opacity:var(--background-hover-opacity)}}:host(.ion-color.ion-focused) .button-native{color:var(--ion-color-base)}@media (any-hover: hover){:host(.ion-color:hover) .button-native{color:var(--ion-color-base)}}:host(.in-toolbar:not(.in-toolbar-color)){color:var(--ion-toolbar-color, var(--color))}:host{--border-radius:4px;--background-focused:currentColor;--background-focused-opacity:.12;--background-hover:currentColor;--background-hover-opacity:0.04;--color:currentColor;--icon-margin-end:0;--icon-margin-start:0;--icon-font-size:24px;--icon-font-weight:normal;--min-height:32px;--min-width:44px;--padding-start:12px;--padding-end:12px;font-size:14px;font-weight:500;text-transform:uppercase}:host(.back-button-has-icon-only){--border-radius:50%;min-width:48px;height:48px}.button-native{-webkit-box-shadow:none;box-shadow:none}.button-text{padding-left:4px;padding-right:4px;padding-top:0;padding-bottom:0}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.button-text{padding-left:unset;padding-right:unset;-webkit-padding-start:4px;padding-inline-start:4px;-webkit-padding-end:4px;padding-inline-end:4px}}ion-icon{line-height:0.67;text-align:start}@media (any-hover: hover){:host(.ion-color:hover) .button-native::after{background:var(--ion-color-base)}}:host(.ion-color.ion-focused) .button-native::after{background:var(--ion-color-base)}',HP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inheritedAttributes={},this.disabled=!1,this.type="button",this.onClick=async t=>{const r=this.el.closest("ion-nav");return t.preventDefault(),r&&await r.canGoBack()?r.pop({animationBuilder:this.routerAnimation,skipIfBusy:!0}):Wy(this.defaultHref,t,"back",this.routerAnimation)}}componentWillLoad(){this.inheritedAttributes=Bm(this.el),this.defaultHref===void 0&&(this.defaultHref=Oi.get("backButtonDefaultHref"))}get backButtonIcon(){const t=this.icon;return t??(tr(this)==="ios"?Oi.get("backButtonIcon",RC):Oi.get("backButtonIcon",zC))}get backButtonText(){const t=tr(this)==="ios"?"Back":null;return this.text!=null?this.text:Oi.get("backButtonText",t)}get hasIconOnly(){return this.backButtonIcon&&!this.backButtonText}get rippleType(){return this.hasIconOnly?"unbounded":"bounded"}render(){const{color:t,defaultHref:r,disabled:l,type:h,hasIconOnly:m,backButtonIcon:v,backButtonText:T,icon:s,inheritedAttributes:S}=this,z=r!==void 0,O=tr(this),B=S["aria-label"]||T||"back";return Gt(wr,{onClick:this.onClick,class:nc(t,{[O]:!0,button:!0,"back-button-disabled":l,"back-button-has-icon-only":m,"in-toolbar":Fs("ion-toolbar",this.el),"in-toolbar-color":Fs("ion-toolbar[color]",this.el),"ion-activatable":!0,"ion-focusable":!0,"show-back-button":z})},Gt("button",{type:h,disabled:l,class:"button-native",part:"native","aria-label":B},Gt("span",{class:"button-inner"},v&&Gt("ion-icon",{part:"icon",icon:v,"aria-hidden":"true",lazy:!1,"flip-rtl":s===void 0}),T&&Gt("span",{part:"text","aria-hidden":"true",class:"button-text"},T)),O==="md"&&Gt("ion-ripple-effect",{type:this.rippleType})))}get el(){return this}static get style(){return{ios:qP,md:WP}}},[33,"ion-back-button",{color:[513],defaultHref:[1025,"default-href"],disabled:[516],icon:[1],text:[1],type:[1],routerAnimation:[16]}]);function XP(){if(typeof customElements>"u")return;["ion-back-button","ion-icon","ion-ripple-effect"].forEach(r=>{switch(r){case"ion-back-button":customElements.get(r)||customElements.define(r,HP);break;case"ion-icon":customElements.get(r)||pT();break;case"ion-ripple-effect":customElements.get(r)||Hy();break}})}const KP=XP,YP=":host{left:0;right:0;top:0;bottom:0;position:absolute;contain:layout size style;overflow:hidden;z-index:0}",JP=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.ionNavWillLoad=po(this,"ionNavWillLoad",7),this.ionNavWillChange=po(this,"ionNavWillChange",3),this.ionNavDidChange=po(this,"ionNavDidChange",3),this.gestureOrAnimationInProgress=!1,this.mode=tr(this),this.animated=!0}swipeHandlerChanged(){this.gesture&&this.gesture.enable(this.swipeHandler!==void 0)}async connectedCallback(){const t=()=>{this.gestureOrAnimationInProgress=!0,this.swipeHandler&&this.swipeHandler.onStart()};this.gesture=(await Bs(()=>import("./swipe-back-902a44d2.js"),[])).createSwipeBackGesture(this.el,()=>!this.gestureOrAnimationInProgress&&!!this.swipeHandler&&this.swipeHandler.canStart(),()=>t(),r=>{var l;return(l=this.ani)===null||l===void 0?void 0:l.progressStep(r)},(r,l,h)=>{if(this.ani){this.ani.onFinish(()=>{this.gestureOrAnimationInProgress=!1,this.swipeHandler&&this.swipeHandler.onEnd(r)},{oneTimeCallback:!0});let m=r?-.001:.001;r?m+=Gx([0,0],[.32,.72],[0,1],[1,1],l)[0]:(this.ani.easing("cubic-bezier(1, 0, 0.68, 0.28)"),m+=Gx([0,0],[1,0],[.68,.28],[1,1],l)[0]),this.ani.progressEnd(r?1:0,m,h)}else this.gestureOrAnimationInProgress=!1}),this.swipeHandlerChanged()}componentWillLoad(){this.ionNavWillLoad.emit()}disconnectedCallback(){this.gesture&&(this.gesture.destroy(),this.gesture=void 0)}async commit(t,r,l){const h=await this.lock();let m=!1;try{m=await this.transition(t,r,l)}catch(v){console.error(v)}return h(),m}async setRouteId(t,r,l,h){return{changed:await this.setRoot(t,r,{duration:l==="root"?0:void 0,direction:l==="back"?"back":"forward",animationBuilder:h}),element:this.activeEl}}async getRouteId(){const t=this.activeEl;return t?{id:t.tagName,element:t,params:this.activeParams}:void 0}async setRoot(t,r,l){if(this.activeComponent===t&&iM(r,this.activeParams))return!1;const h=this.activeEl,m=await UM(this.delegate,this.el,t,["ion-page","ion-page-invisible"],r);return this.activeComponent=t,this.activeEl=m,this.activeParams=r,await this.commit(m,h,l),await VM(this.delegate,h),!0}async transition(t,r,l={}){if(r===t)return!1;this.ionNavWillChange.emit();const{el:h,mode:m}=this,v=this.animated&&Oi.getBoolean("animated",!0),T=l.animationBuilder||this.animation||Oi.get("navAnimation");return await qM(Object.assign(Object.assign({mode:m,animated:v,enteringEl:t,leavingEl:r,baseEl:h,progressCallback:l.progressAnimation?s=>{s!==void 0&&!this.gestureOrAnimationInProgress?(this.gestureOrAnimationInProgress=!0,s.onFinish(()=>{this.gestureOrAnimationInProgress=!1,this.swipeHandler&&this.swipeHandler.onEnd(!1)},{oneTimeCallback:!0}),s.progressEnd(0,0,0)):this.ani=s}:void 0},l),{animationBuilder:T})),this.ionNavDidChange.emit(),!0}async lock(){const t=this.waitPromise;let r;return this.waitPromise=new Promise(l=>r=l),t!==void 0&&await t,r}render(){return Gt("slot",null)}get el(){return this}static get watchers(){return{swipeHandler:["swipeHandlerChanged"]}}static get style(){return YP}},[1,"ion-router-outlet",{mode:[1025],delegate:[16],animated:[4],animation:[16],swipeHandler:[16],commit:[64],setRouteId:[64],getRouteId:[64]}]);function QP(){if(typeof customElements>"u")return;["ion-router-outlet"].forEach(r=>{switch(r){case"ion-router-outlet":customElements.get(r)||customElements.define(r,JP);break}})}const eL=QP;/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const tL=":host{padding-left:var(--ion-safe-area-left);padding-right:var(--ion-safe-area-right);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:auto;padding-bottom:var(--ion-safe-area-bottom, 0);border-top:var(--border);background:var(--background);color:var(--color);text-align:center;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:10;-webkit-box-sizing:content-box !important;box-sizing:content-box !important}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--ion-safe-area-left);padding-inline-start:var(--ion-safe-area-left);-webkit-padding-end:var(--ion-safe-area-right);padding-inline-end:var(--ion-safe-area-right)}}:host(.ion-color) ::slotted(ion-tab-button){--background-focused:var(--ion-color-shade);--color-selected:var(--ion-color-contrast)}:host(.ion-color) ::slotted(.tab-selected){color:var(--ion-color-contrast)}:host(.ion-color),:host(.ion-color) ::slotted(ion-tab-button){color:rgba(var(--ion-color-contrast-rgb), 0.7)}:host(.ion-color),:host(.ion-color) ::slotted(ion-tab-button){background:var(--ion-color-base)}:host(.ion-color) ::slotted(ion-tab-button.ion-focused),:host(.tab-bar-translucent) ::slotted(ion-tab-button.ion-focused){background:var(--background-focused)}:host(.tab-bar-translucent) ::slotted(ion-tab-button){background:transparent}:host([slot=top]){padding-top:var(--ion-safe-area-top, 0);padding-bottom:0;border-top:0;border-bottom:var(--border)}:host(.tab-bar-hidden){display:none !important}:host{--background:var(--ion-tab-bar-background, var(--ion-color-step-50, #f7f7f7));--background-focused:var(--ion-tab-bar-background-focused, #e0e0e0);--border:0.55px solid var(--ion-tab-bar-border-color, var(--ion-border-color, var(--ion-color-step-150, rgba(0, 0, 0, 0.2))));--color:var(--ion-tab-bar-color, var(--ion-color-step-400, #999999));--color-selected:var(--ion-tab-bar-color-selected, var(--ion-color-primary, #3880ff));height:50px}@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){:host(.tab-bar-translucent){--background:rgba(var(--ion-background-color-rgb, 255, 255, 255), 0.8);-webkit-backdrop-filter:saturate(210%) blur(20px);backdrop-filter:saturate(210%) blur(20px)}:host(.ion-color.tab-bar-translucent){background:rgba(var(--ion-color-base-rgb), 0.8)}:host(.tab-bar-translucent) ::slotted(ion-tab-button.ion-focused){background:rgba(var(--ion-background-color-rgb, 255, 255, 255), 0.6)}}",nL=":host{padding-left:var(--ion-safe-area-left);padding-right:var(--ion-safe-area-right);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:auto;padding-bottom:var(--ion-safe-area-bottom, 0);border-top:var(--border);background:var(--background);color:var(--color);text-align:center;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:10;-webkit-box-sizing:content-box !important;box-sizing:content-box !important}@supports ((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){:host{padding-left:unset;padding-right:unset;-webkit-padding-start:var(--ion-safe-area-left);padding-inline-start:var(--ion-safe-area-left);-webkit-padding-end:var(--ion-safe-area-right);padding-inline-end:var(--ion-safe-area-right)}}:host(.ion-color) ::slotted(ion-tab-button){--background-focused:var(--ion-color-shade);--color-selected:var(--ion-color-contrast)}:host(.ion-color) ::slotted(.tab-selected){color:var(--ion-color-contrast)}:host(.ion-color),:host(.ion-color) ::slotted(ion-tab-button){color:rgba(var(--ion-color-contrast-rgb), 0.7)}:host(.ion-color),:host(.ion-color) ::slotted(ion-tab-button){background:var(--ion-color-base)}:host(.ion-color) ::slotted(ion-tab-button.ion-focused),:host(.tab-bar-translucent) ::slotted(ion-tab-button.ion-focused){background:var(--background-focused)}:host(.tab-bar-translucent) ::slotted(ion-tab-button){background:transparent}:host([slot=top]){padding-top:var(--ion-safe-area-top, 0);padding-bottom:0;border-top:0;border-bottom:var(--border)}:host(.tab-bar-hidden){display:none !important}:host{--background:var(--ion-tab-bar-background, var(--ion-background-color, #fff));--background-focused:var(--ion-tab-bar-background-focused, #e0e0e0);--border:1px solid var(--ion-tab-bar-border-color, var(--ion-border-color, var(--ion-color-step-150, rgba(0, 0, 0, 0.07))));--color:var(--ion-tab-bar-color, var(--ion-color-step-600, #666666));--color-selected:var(--ion-tab-bar-color-selected, var(--ion-color-primary, #3880ff));height:56px}",iL=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.ionTabBarChanged=po(this,"ionTabBarChanged",7),this.keyboardCtrl=null,this.keyboardVisible=!1,this.translucent=!1}selectedTabChanged(){this.selectedTab!==void 0&&this.ionTabBarChanged.emit({tab:this.selectedTab})}componentWillLoad(){this.selectedTabChanged()}connectedCallback(){this.keyboardCtrl=mP(t=>{this.keyboardVisible=t})}disconnectedCallback(){this.keyboardCtrl&&this.keyboardCtrl.destroy()}render(){const{color:t,translucent:r,keyboardVisible:l}=this,h=tr(this),m=l&&this.el.getAttribute("slot")!=="top";return Gt(wr,{role:"tablist","aria-hidden":m?"true":null,class:nc(t,{[h]:!0,"tab-bar-translucent":r,"tab-bar-hidden":m})},Gt("slot",null))}get el(){return this}static get watchers(){return{selectedTab:["selectedTabChanged"]}}static get style(){return{ios:tL,md:nL}}},[33,"ion-tab-bar",{color:[513],selectedTab:[1,"selected-tab"],translucent:[4],keyboardVisible:[32]}]);function rL(){if(typeof customElements>"u")return;["ion-tab-bar"].forEach(r=>{switch(r){case"ion-tab-bar":customElements.get(r)||customElements.define(r,iL);break}})}const oL=rL;/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const pu=typeof window<"u";function sL(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const ui=Object.assign;function v_(t,r){const l={};for(const h in r){const m=r[h];l[h]=Fo(m)?m.map(t):t(m)}return l}const fd=()=>{},Fo=Array.isArray,aL=/\/$/,lL=t=>t.replace(aL,"");function b_(t,r,l="/"){let h,m={},v="",T="";const s=r.indexOf("#");let S=r.indexOf("?");return s<S&&s>=0&&(S=-1),S>-1&&(h=r.slice(0,S),v=r.slice(S+1,s>-1?s:r.length),m=t(v)),s>-1&&(h=h||r.slice(0,s),T=r.slice(s,r.length)),h=dL(h??r,l),{fullPath:h+(v&&"?")+v+T,path:h,query:m,hash:T}}function cL(t,r){const l=r.query?t(r.query):"";return r.path+(l&&"?")+l+(r.hash||"")}function Zx(t,r){return!r||!t.toLowerCase().startsWith(r.toLowerCase())?t:t.slice(r.length)||"/"}function uL(t,r,l){const h=r.matched.length-1,m=l.matched.length-1;return h>-1&&h===m&&Iu(r.matched[h],l.matched[m])&&bT(r.params,l.params)&&t(r.query)===t(l.query)&&r.hash===l.hash}function Iu(t,r){return(t.aliasOf||t)===(r.aliasOf||r)}function bT(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const l in t)if(!hL(t[l],r[l]))return!1;return!0}function hL(t,r){return Fo(t)?qx(t,r):Fo(r)?qx(r,t):t===r}function qx(t,r){return Fo(r)?t.length===r.length&&t.every((l,h)=>l===r[h]):t.length===1&&t[0]===r}function dL(t,r){if(t.startsWith("/"))return t;if(!t)return r;const l=r.split("/"),h=t.split("/");let m=l.length-1,v,T;for(v=0;v<h.length;v++)if(T=h[v],T!==".")if(T==="..")m>1&&m--;else break;return l.slice(0,m).join("/")+"/"+h.slice(v-(v===h.length?1:0)).join("/")}var Ad;(function(t){t.pop="pop",t.push="push"})(Ad||(Ad={}));var md;(function(t){t.back="back",t.forward="forward",t.unknown=""})(md||(md={}));function pL(t){if(!t)if(pu){const r=document.querySelector("base");t=r&&r.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),lL(t)}const fL=/^[^#]+#/;function mL(t,r){return t.replace(fL,"#")+r}function gL(t,r){const l=document.documentElement.getBoundingClientRect(),h=t.getBoundingClientRect();return{behavior:r.behavior,left:h.left-l.left-(r.left||0),top:h.top-l.top-(r.top||0)}}const Fm=()=>({left:window.pageXOffset,top:window.pageYOffset});function _L(t){let r;if("el"in t){const l=t.el,h=typeof l=="string"&&l.startsWith("#"),m=typeof l=="string"?h?document.getElementById(l.slice(1)):document.querySelector(l):l;if(!m)return;r=gL(m,t)}else r=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.pageXOffset,r.top!=null?r.top:window.pageYOffset)}function Wx(t,r){return(history.state?history.state.position-r:-1)+t}const ry=new Map;function yL(t,r){ry.set(t,r)}function vL(t){const r=ry.get(t);return ry.delete(t),r}let bL=()=>location.protocol+"//"+location.host;function xT(t,r){const{pathname:l,search:h,hash:m}=r,v=t.indexOf("#");if(v>-1){let s=m.includes(t.slice(v))?t.slice(v).length:1,S=m.slice(s);return S[0]!=="/"&&(S="/"+S),Zx(S,"")}return Zx(l,t)+h+m}function xL(t,r,l,h){let m=[],v=[],T=null;const s=({state:Z})=>{const me=xT(t,location),_e=l.value,Ie=r.value;let Te=0;if(Z){if(l.value=me,r.value=Z,T&&T===_e){T=null;return}Te=Ie?Z.position-Ie.position:0}else h(me);m.forEach(ve=>{ve(l.value,_e,{delta:Te,type:Ad.pop,direction:Te?Te>0?md.forward:md.back:md.unknown})})};function S(){T=l.value}function z(Z){m.push(Z);const me=()=>{const _e=m.indexOf(Z);_e>-1&&m.splice(_e,1)};return v.push(me),me}function O(){const{history:Z}=window;Z.state&&Z.replaceState(ui({},Z.state,{scroll:Fm()}),"")}function B(){for(const Z of v)Z();v=[],window.removeEventListener("popstate",s),window.removeEventListener("beforeunload",O)}return window.addEventListener("popstate",s),window.addEventListener("beforeunload",O),{pauseListeners:S,listen:z,destroy:B}}function Hx(t,r,l,h=!1,m=!1){return{back:t,current:r,forward:l,replaced:h,position:window.history.length,scroll:m?Fm():null}}function wL(t){const{history:r,location:l}=window,h={value:xT(t,l)},m={value:r.state};m.value||v(h.value,{back:null,current:h.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function v(S,z,O){const B=t.indexOf("#"),Z=B>-1?(l.host&&document.querySelector("base")?t:t.slice(B))+S:bL()+t+S;try{r[O?"replaceState":"pushState"](z,"",Z),m.value=z}catch(me){console.error(me),l[O?"replace":"assign"](Z)}}function T(S,z){const O=ui({},r.state,Hx(m.value.back,S,m.value.forward,!0),z,{position:m.value.position});v(S,O,!0),h.value=S}function s(S,z){const O=ui({},m.value,r.state,{forward:S,scroll:Fm()});v(O.current,O,!0);const B=ui({},Hx(h.value,S,null),{position:O.position+1},z);v(S,B,!1),h.value=S}return{location:h,state:m,push:s,replace:T}}function TL(t){t=pL(t);const r=wL(t),l=xL(t,r.state,r.location,r.replace);function h(v,T=!0){T||l.pauseListeners(),history.go(v)}const m=ui({location:"",base:t,go:h,createHref:mL.bind(null,t)},r,l);return Object.defineProperty(m,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(m,"state",{enumerable:!0,get:()=>r.state.value}),m}function EL(t){return typeof t=="string"||t&&typeof t=="object"}function wT(t){return typeof t=="string"||typeof t=="symbol"}const Ea={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},TT=Symbol("");var Xx;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(Xx||(Xx={}));function Cu(t,r){return ui(new Error,{type:t,[TT]:!0},r)}function Ds(t,r){return t instanceof Error&&TT in t&&(r==null||!!(t.type&r))}const Kx="[^/]+?",kL={sensitive:!1,strict:!1,start:!0,end:!0},SL=/[.+*?^${}()[\]/\\]/g;function AL(t,r){const l=ui({},kL,r),h=[];let m=l.start?"^":"";const v=[];for(const z of t){const O=z.length?[]:[90];l.strict&&!z.length&&(m+="/");for(let B=0;B<z.length;B++){const Z=z[B];let me=40+(l.sensitive?.25:0);if(Z.type===0)B||(m+="/"),m+=Z.value.replace(SL,"\\$&"),me+=40;else if(Z.type===1){const{value:_e,repeatable:Ie,optional:Te,regexp:ve}=Z;v.push({name:_e,repeatable:Ie,optional:Te});const $e=ve||Kx;if($e!==Kx){me+=10;try{new RegExp(`(${$e})`)}catch(qe){throw new Error(`Invalid custom RegExp for param "${_e}" (${$e}): `+qe.message)}}let Fe=Ie?`((?:${$e})(?:/(?:${$e}))*)`:`(${$e})`;B||(Fe=Te&&z.length<2?`(?:/${Fe})`:"/"+Fe),Te&&(Fe+="?"),m+=Fe,me+=20,Te&&(me+=-8),Ie&&(me+=-20),$e===".*"&&(me+=-50)}O.push(me)}h.push(O)}if(l.strict&&l.end){const z=h.length-1;h[z][h[z].length-1]+=.7000000000000001}l.strict||(m+="/?"),l.end?m+="$":l.strict&&(m+="(?:/|$)");const T=new RegExp(m,l.sensitive?"":"i");function s(z){const O=z.match(T),B={};if(!O)return null;for(let Z=1;Z<O.length;Z++){const me=O[Z]||"",_e=v[Z-1];B[_e.name]=me&&_e.repeatable?me.split("/"):me}return B}function S(z){let O="",B=!1;for(const Z of t){(!B||!O.endsWith("/"))&&(O+="/"),B=!1;for(const me of Z)if(me.type===0)O+=me.value;else if(me.type===1){const{value:_e,repeatable:Ie,optional:Te}=me,ve=_e in z?z[_e]:"";if(Fo(ve)&&!Ie)throw new Error(`Provided param "${_e}" is an array but it is not repeatable (* or + modifiers)`);const $e=Fo(ve)?ve.join("/"):ve;if(!$e)if(Te)Z.length<2&&(O.endsWith("/")?O=O.slice(0,-1):B=!0);else throw new Error(`Missing required param "${_e}"`);O+=$e}}return O||"/"}return{re:T,score:h,keys:v,parse:s,stringify:S}}function IL(t,r){let l=0;for(;l<t.length&&l<r.length;){const h=r[l]-t[l];if(h)return h;l++}return t.length<r.length?t.length===1&&t[0]===40+40?-1:1:t.length>r.length?r.length===1&&r[0]===40+40?1:-1:0}function CL(t,r){let l=0;const h=t.score,m=r.score;for(;l<h.length&&l<m.length;){const v=IL(h[l],m[l]);if(v)return v;l++}if(Math.abs(m.length-h.length)===1){if(Yx(h))return 1;if(Yx(m))return-1}return m.length-h.length}function Yx(t){const r=t[t.length-1];return t.length>0&&r[r.length-1]<0}const ML={type:0,value:""},PL=/[a-zA-Z0-9_]/;function LL(t){if(!t)return[[]];if(t==="/")return[[ML]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function r(me){throw new Error(`ERR (${l})/"${z}": ${me}`)}let l=0,h=l;const m=[];let v;function T(){v&&m.push(v),v=[]}let s=0,S,z="",O="";function B(){z&&(l===0?v.push({type:0,value:z}):l===1||l===2||l===3?(v.length>1&&(S==="*"||S==="+")&&r(`A repeatable param (${z}) must be alone in its segment. eg: '/:ids+.`),v.push({type:1,value:z,regexp:O,repeatable:S==="*"||S==="+",optional:S==="*"||S==="?"})):r("Invalid state to consume buffer"),z="")}function Z(){z+=S}for(;s<t.length;){if(S=t[s++],S==="\\"&&l!==2){h=l,l=4;continue}switch(l){case 0:S==="/"?(z&&B(),T()):S===":"?(B(),l=1):Z();break;case 4:Z(),l=h;break;case 1:S==="("?l=2:PL.test(S)?Z():(B(),l=0,S!=="*"&&S!=="?"&&S!=="+"&&s--);break;case 2:S===")"?O[O.length-1]=="\\"?O=O.slice(0,-1)+S:l=3:O+=S;break;case 3:B(),l=0,S!=="*"&&S!=="?"&&S!=="+"&&s--,O="";break;default:r("Unknown state");break}}return l===2&&r(`Unfinished custom RegExp for param "${z}"`),B(),T(),m}function zL(t,r,l){const h=AL(LL(t.path),l),m=ui(h,{record:t,parent:r,children:[],alias:[]});return r&&!m.record.aliasOf==!r.record.aliasOf&&r.children.push(m),m}function RL(t,r){const l=[],h=new Map;r=e1({strict:!1,end:!0,sensitive:!1},r);function m(O){return h.get(O)}function v(O,B,Z){const me=!Z,_e=DL(O);_e.aliasOf=Z&&Z.record;const Ie=e1(r,O),Te=[_e];if("alias"in O){const Fe=typeof O.alias=="string"?[O.alias]:O.alias;for(const qe of Fe)Te.push(ui({},_e,{components:Z?Z.record.components:_e.components,path:qe,aliasOf:Z?Z.record:_e}))}let ve,$e;for(const Fe of Te){const{path:qe}=Fe;if(B&&qe[0]!=="/"){const fe=B.record.path,et=fe[fe.length-1]==="/"?"":"/";Fe.path=B.record.path+(qe&&et+qe)}if(ve=zL(Fe,B,Ie),Z?Z.alias.push(ve):($e=$e||ve,$e!==ve&&$e.alias.push(ve),me&&O.name&&!Qx(ve)&&T(O.name)),_e.children){const fe=_e.children;for(let et=0;et<fe.length;et++)v(fe[et],ve,Z&&Z.children[et])}Z=Z||ve,(ve.record.components&&Object.keys(ve.record.components).length||ve.record.name||ve.record.redirect)&&S(ve)}return $e?()=>{T($e)}:fd}function T(O){if(wT(O)){const B=h.get(O);B&&(h.delete(O),l.splice(l.indexOf(B),1),B.children.forEach(T),B.alias.forEach(T))}else{const B=l.indexOf(O);B>-1&&(l.splice(B,1),O.record.name&&h.delete(O.record.name),O.children.forEach(T),O.alias.forEach(T))}}function s(){return l}function S(O){let B=0;for(;B<l.length&&CL(O,l[B])>=0&&(O.record.path!==l[B].record.path||!ET(O,l[B]));)B++;l.splice(B,0,O),O.record.name&&!Qx(O)&&h.set(O.record.name,O)}function z(O,B){let Z,me={},_e,Ie;if("name"in O&&O.name){if(Z=h.get(O.name),!Z)throw Cu(1,{location:O});Ie=Z.record.name,me=ui(Jx(B.params,Z.keys.filter($e=>!$e.optional).map($e=>$e.name)),O.params&&Jx(O.params,Z.keys.map($e=>$e.name))),_e=Z.stringify(me)}else if("path"in O)_e=O.path,Z=l.find($e=>$e.re.test(_e)),Z&&(me=Z.parse(_e),Ie=Z.record.name);else{if(Z=B.name?h.get(B.name):l.find($e=>$e.re.test(B.path)),!Z)throw Cu(1,{location:O,currentLocation:B});Ie=Z.record.name,me=ui({},B.params,O.params),_e=Z.stringify(me)}const Te=[];let ve=Z;for(;ve;)Te.unshift(ve.record),ve=ve.parent;return{name:Ie,path:_e,params:me,matched:Te,meta:BL(Te)}}return t.forEach(O=>v(O)),{addRoute:v,resolve:z,removeRoute:T,getRoutes:s,getRecordMatcher:m}}function Jx(t,r){const l={};for(const h of r)h in t&&(l[h]=t[h]);return l}function DL(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:OL(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function OL(t){const r={},l=t.props||!1;if("component"in t)r.default=l;else for(const h in t.components)r[h]=typeof l=="boolean"?l:l[h];return r}function Qx(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function BL(t){return t.reduce((r,l)=>ui(r,l.meta),{})}function e1(t,r){const l={};for(const h in t)l[h]=h in r?r[h]:t[h];return l}function ET(t,r){return r.children.some(l=>l===t||ET(t,l))}const kT=/#/g,FL=/&/g,jL=/\//g,NL=/=/g,$L=/\?/g,ST=/\+/g,UL=/%5B/g,VL=/%5D/g,AT=/%5E/g,GL=/%60/g,IT=/%7B/g,ZL=/%7C/g,CT=/%7D/g,qL=/%20/g;function tv(t){return encodeURI(""+t).replace(ZL,"|").replace(UL,"[").replace(VL,"]")}function WL(t){return tv(t).replace(IT,"{").replace(CT,"}").replace(AT,"^")}function oy(t){return tv(t).replace(ST,"%2B").replace(qL,"+").replace(kT,"%23").replace(FL,"%26").replace(GL,"`").replace(IT,"{").replace(CT,"}").replace(AT,"^")}function HL(t){return oy(t).replace(NL,"%3D")}function XL(t){return tv(t).replace(kT,"%23").replace($L,"%3F")}function KL(t){return t==null?"":XL(t).replace(jL,"%2F")}function im(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function sy(t){const r={};if(t===""||t==="?")return r;const h=(t[0]==="?"?t.slice(1):t).split("&");for(let m=0;m<h.length;++m){const v=h[m].replace(ST," "),T=v.indexOf("="),s=im(T<0?v:v.slice(0,T)),S=T<0?null:im(v.slice(T+1));if(s in r){let z=r[s];Fo(z)||(z=r[s]=[z]),z.push(S)}else r[s]=S}return r}function t1(t){let r="";for(let l in t){const h=t[l];if(l=HL(l),h==null){h!==void 0&&(r+=(r.length?"&":"")+l);continue}(Fo(h)?h.map(v=>v&&oy(v)):[h&&oy(h)]).forEach(v=>{v!==void 0&&(r+=(r.length?"&":"")+l,v!=null&&(r+="="+v))})}return r}function YL(t){const r={};for(const l in t){const h=t[l];h!==void 0&&(r[l]=Fo(h)?h.map(m=>m==null?null:""+m):h==null?h:""+h)}return r}const MT=Symbol(""),n1=Symbol(""),nv=Symbol(""),jm=Symbol(""),ay=Symbol("");function ad(){let t=[];function r(h){return t.push(h),()=>{const m=t.indexOf(h);m>-1&&t.splice(m,1)}}function l(){t=[]}return{add:r,list:()=>t,reset:l}}function Ia(t,r,l,h,m){const v=h&&(h.enterCallbacks[m]=h.enterCallbacks[m]||[]);return()=>new Promise((T,s)=>{const S=B=>{B===!1?s(Cu(4,{from:l,to:r})):B instanceof Error?s(B):EL(B)?s(Cu(2,{from:r,to:B})):(v&&h.enterCallbacks[m]===v&&typeof B=="function"&&v.push(B),T())},z=t.call(h&&h.instances[m],r,l,S);let O=Promise.resolve(z);t.length<3&&(O=O.then(S)),O.catch(B=>s(B))})}function x_(t,r,l,h){const m=[];for(const v of t)for(const T in v.components){let s=v.components[T];if(!(r!=="beforeRouteEnter"&&!v.instances[T]))if(JL(s)){const z=(s.__vccOpts||s)[r];z&&m.push(Ia(z,l,h,v,T))}else{let S=s();m.push(()=>S.then(z=>{if(!z)return Promise.reject(new Error(`Couldn't resolve component "${T}" at "${v.path}"`));const O=sL(z)?z.default:z;v.components[T]=O;const Z=(O.__vccOpts||O)[r];return Z&&Ia(Z,l,h,v,T)()}))}}return m}function JL(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function i1(t){const r=$i(nv),l=$i(jm),h=zi(()=>r.resolve(fn(t.to))),m=zi(()=>{const{matched:S}=h.value,{length:z}=S,O=S[z-1],B=l.matched;if(!O||!B.length)return-1;const Z=B.findIndex(Iu.bind(null,O));if(Z>-1)return Z;const me=r1(S[z-2]);return z>1&&r1(O)===me&&B[B.length-1].path!==me?B.findIndex(Iu.bind(null,S[z-2])):Z}),v=zi(()=>m.value>-1&&nz(l.params,h.value.params)),T=zi(()=>m.value>-1&&m.value===l.matched.length-1&&bT(l.params,h.value.params));function s(S={}){return tz(S)?r[fn(t.replace)?"replace":"push"](fn(t.to)).catch(fd):Promise.resolve()}return{route:h,href:zi(()=>h.value.href),isActive:v,isExactActive:T,navigate:s}}const QL=Dr({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:i1,setup(t,{slots:r}){const l=Ga(i1(t)),{options:h}=$i(nv),m=zi(()=>({[o1(t.activeClass,h.linkActiveClass,"router-link-active")]:l.isActive,[o1(t.exactActiveClass,h.linkExactActiveClass,"router-link-exact-active")]:l.isExactActive}));return()=>{const v=r.default&&r.default(l);return t.custom?v:hs("a",{"aria-current":l.isExactActive?t.ariaCurrentValue:null,href:l.href,onClick:l.navigate,class:m.value},v)}}}),ez=QL;function tz(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const r=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return t.preventDefault&&t.preventDefault(),!0}}function nz(t,r){for(const l in r){const h=r[l],m=t[l];if(typeof h=="string"){if(h!==m)return!1}else if(!Fo(m)||m.length!==h.length||h.some((v,T)=>v!==m[T]))return!1}return!0}function r1(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const o1=(t,r,l)=>t??r??l,iz=Dr({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:r,slots:l}){const h=$i(ay),m=zi(()=>t.route||h.value),v=$i(n1,0),T=zi(()=>{let z=fn(v);const{matched:O}=m.value;let B;for(;(B=O[z])&&!B.components;)z++;return z}),s=zi(()=>m.value.matched[T.value]);ql(n1,zi(()=>T.value+1)),ql(MT,s),ql(ay,m);const S=Ni();return vr(()=>[S.value,s.value,t.name],([z,O,B],[Z,me,_e])=>{O&&(O.instances[B]=z,me&&me!==O&&z&&z===Z&&(O.leaveGuards.size||(O.leaveGuards=me.leaveGuards),O.updateGuards.size||(O.updateGuards=me.updateGuards))),z&&O&&(!me||!Iu(O,me)||!Z)&&(O.enterCallbacks[B]||[]).forEach(Ie=>Ie(z))},{flush:"post"}),()=>{const z=m.value,O=t.name,B=s.value,Z=B&&B.components[O];if(!Z)return s1(l.default,{Component:Z,route:z});const me=B.props[O],_e=me?me===!0?z.params:typeof me=="function"?me(z):me:null,Te=hs(Z,ui({},_e,r,{onVnodeUnmounted:ve=>{ve.component.isUnmounted&&(B.instances[O]=null)},ref:S}));return s1(l.default,{Component:Te,route:z})||Te}}});function s1(t,r){if(!t)return null;const l=t(r);return l.length===1?l[0]:l}const rz=iz;function oz(t){const r=RL(t.routes,t),l=t.parseQuery||sy,h=t.stringifyQuery||t1,m=t.history,v=ad(),T=ad(),s=ad(),S=Sm(Ea);let z=Ea;pu&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const O=v_.bind(null,Xe=>""+Xe),B=v_.bind(null,KL),Z=v_.bind(null,im);function me(Xe,xt){let pt,Bt;return wT(Xe)?(pt=r.getRecordMatcher(Xe),Bt=xt):Bt=Xe,r.addRoute(Bt,pt)}function _e(Xe){const xt=r.getRecordMatcher(Xe);xt&&r.removeRoute(xt)}function Ie(){return r.getRoutes().map(Xe=>Xe.record)}function Te(Xe){return!!r.getRecordMatcher(Xe)}function ve(Xe,xt){if(xt=ui({},xt||S.value),typeof Xe=="string"){const ne=b_(l,Xe,xt.path),ge=r.resolve({path:ne.path},xt),ze=m.createHref(ne.fullPath);return ui(ne,ge,{params:Z(ge.params),hash:im(ne.hash),redirectedFrom:void 0,href:ze})}let pt;if("path"in Xe)pt=ui({},Xe,{path:b_(l,Xe.path,xt.path).path});else{const ne=ui({},Xe.params);for(const ge in ne)ne[ge]==null&&delete ne[ge];pt=ui({},Xe,{params:B(Xe.params)}),xt.params=B(xt.params)}const Bt=r.resolve(pt,xt),gn=Xe.hash||"";Bt.params=O(Z(Bt.params));const En=cL(h,ui({},Xe,{hash:WL(gn),path:Bt.path})),sn=m.createHref(En);return ui({fullPath:En,hash:gn,query:h===t1?YL(Xe.query):Xe.query||{}},Bt,{redirectedFrom:void 0,href:sn})}function $e(Xe){return typeof Xe=="string"?b_(l,Xe,S.value.path):ui({},Xe)}function Fe(Xe,xt){if(z!==Xe)return Cu(8,{from:xt,to:Xe})}function qe(Xe){return Pe(Xe)}function fe(Xe){return qe(ui($e(Xe),{replace:!0}))}function et(Xe){const xt=Xe.matched[Xe.matched.length-1];if(xt&&xt.redirect){const{redirect:pt}=xt;let Bt=typeof pt=="function"?pt(Xe):pt;return typeof Bt=="string"&&(Bt=Bt.includes("?")||Bt.includes("#")?Bt=$e(Bt):{path:Bt},Bt.params={}),ui({query:Xe.query,hash:Xe.hash,params:"path"in Bt?{}:Xe.params},Bt)}}function Pe(Xe,xt){const pt=z=ve(Xe),Bt=S.value,gn=Xe.state,En=Xe.force,sn=Xe.replace===!0,ne=et(pt);if(ne)return Pe(ui($e(ne),{state:typeof ne=="object"?ui({},gn,ne.state):gn,force:En,replace:sn}),xt||pt);const ge=pt;ge.redirectedFrom=xt;let ze;return!En&&uL(h,Bt,pt)&&(ze=Cu(16,{to:ge,from:Bt}),Jt(Bt,Bt,!0,!1)),(ze?Promise.resolve(ze):Ye(ge,Bt)).catch(We=>Ds(We)?Ds(We,2)?We:ni(We):rn(We,ge,Bt)).then(We=>{if(We){if(Ds(We,2))return Pe(ui({replace:sn},$e(We.to),{state:typeof We.to=="object"?ui({},gn,We.to.state):gn,force:En}),xt||ge)}else We=wt(ge,Bt,!0,sn,gn);return dt(ge,Bt,We),We})}function Ge(Xe,xt){const pt=Fe(Xe,xt);return pt?Promise.reject(pt):Promise.resolve()}function Ye(Xe,xt){let pt;const[Bt,gn,En]=sz(Xe,xt);pt=x_(Bt.reverse(),"beforeRouteLeave",Xe,xt);for(const ne of Bt)ne.leaveGuards.forEach(ge=>{pt.push(Ia(ge,Xe,xt))});const sn=Ge.bind(null,Xe,xt);return pt.push(sn),lu(pt).then(()=>{pt=[];for(const ne of v.list())pt.push(Ia(ne,Xe,xt));return pt.push(sn),lu(pt)}).then(()=>{pt=x_(gn,"beforeRouteUpdate",Xe,xt);for(const ne of gn)ne.updateGuards.forEach(ge=>{pt.push(Ia(ge,Xe,xt))});return pt.push(sn),lu(pt)}).then(()=>{pt=[];for(const ne of Xe.matched)if(ne.beforeEnter&&!xt.matched.includes(ne))if(Fo(ne.beforeEnter))for(const ge of ne.beforeEnter)pt.push(Ia(ge,Xe,xt));else pt.push(Ia(ne.beforeEnter,Xe,xt));return pt.push(sn),lu(pt)}).then(()=>(Xe.matched.forEach(ne=>ne.enterCallbacks={}),pt=x_(En,"beforeRouteEnter",Xe,xt),pt.push(sn),lu(pt))).then(()=>{pt=[];for(const ne of T.list())pt.push(Ia(ne,Xe,xt));return pt.push(sn),lu(pt)}).catch(ne=>Ds(ne,8)?ne:Promise.reject(ne))}function dt(Xe,xt,pt){for(const Bt of s.list())Bt(Xe,xt,pt)}function wt(Xe,xt,pt,Bt,gn){const En=Fe(Xe,xt);if(En)return En;const sn=xt===Ea,ne=pu?history.state:{};pt&&(Bt||sn?m.replace(Xe.fullPath,ui({scroll:sn&&ne&&ne.scroll},gn)):m.push(Xe.fullPath,gn)),S.value=Xe,Jt(Xe,xt,pt,sn),ni()}let Tn;function Zt(){Tn||(Tn=m.listen((Xe,xt,pt)=>{if(!fi.listening)return;const Bt=ve(Xe),gn=et(Bt);if(gn){Pe(ui(gn,{replace:!0}),Bt).catch(fd);return}z=Bt;const En=S.value;pu&&yL(Wx(En.fullPath,pt.delta),Fm()),Ye(Bt,En).catch(sn=>Ds(sn,12)?sn:Ds(sn,2)?(Pe(sn.to,Bt).then(ne=>{Ds(ne,20)&&!pt.delta&&pt.type===Ad.pop&&m.go(-1,!1)}).catch(fd),Promise.reject()):(pt.delta&&m.go(-pt.delta,!1),rn(sn,Bt,En))).then(sn=>{sn=sn||wt(Bt,En,!1),sn&&(pt.delta&&!Ds(sn,8)?m.go(-pt.delta,!1):pt.type===Ad.pop&&Ds(sn,20)&&m.go(-1,!1)),dt(Bt,En,sn)}).catch(fd)}))}let si=ad(),At=ad(),Cn;function rn(Xe,xt,pt){ni(Xe);const Bt=At.list();return Bt.length?Bt.forEach(gn=>gn(Xe,xt,pt)):console.error(Xe),Promise.reject(Xe)}function Ft(){return Cn&&S.value!==Ea?Promise.resolve():new Promise((Xe,xt)=>{si.add([Xe,xt])})}function ni(Xe){return Cn||(Cn=!Xe,Zt(),si.list().forEach(([xt,pt])=>Xe?pt(Xe):xt()),si.reset()),Xe}function Jt(Xe,xt,pt,Bt){const{scrollBehavior:gn}=t;if(!pu||!gn)return Promise.resolve();const En=!pt&&vL(Wx(Xe.fullPath,0))||(Bt||!pt)&&history.state&&history.state.scroll||null;return Dy().then(()=>gn(Xe,xt,En)).then(sn=>sn&&_L(sn)).catch(sn=>rn(sn,Xe,xt))}const Mn=Xe=>m.go(Xe);let Fn;const hi=new Set,fi={currentRoute:S,listening:!0,addRoute:me,removeRoute:_e,hasRoute:Te,getRoutes:Ie,resolve:ve,options:t,push:qe,replace:fe,go:Mn,back:()=>Mn(-1),forward:()=>Mn(1),beforeEach:v.add,beforeResolve:T.add,afterEach:s.add,onError:At.add,isReady:Ft,install(Xe){const xt=this;Xe.component("RouterLink",ez),Xe.component("RouterView",rz),Xe.config.globalProperties.$router=xt,Object.defineProperty(Xe.config.globalProperties,"$route",{enumerable:!0,get:()=>fn(S)}),pu&&!Fn&&S.value===Ea&&(Fn=!0,qe(m.location).catch(gn=>{}));const pt={};for(const gn in Ea)pt[gn]=zi(()=>S.value[gn]);Xe.provide(nv,xt),Xe.provide(jm,Ga(pt)),Xe.provide(ay,S);const Bt=Xe.unmount;hi.add(Xe),Xe.unmount=function(){hi.delete(Xe),hi.size<1&&(z=Ea,Tn&&Tn(),Tn=null,S.value=Ea,Fn=!1,Cn=!1),Bt()}}};return fi}function lu(t){return t.reduce((r,l)=>r.then(()=>l()),Promise.resolve())}function sz(t,r){const l=[],h=[],m=[],v=Math.max(r.matched.length,t.matched.length);for(let T=0;T<v;T++){const s=r.matched[T];s&&(t.matched.find(z=>Iu(z,s))?h.push(s):l.push(s));const S=t.matched[T];S&&(r.matched.find(z=>Iu(z,S))||m.push(S))}return[l,h,m]}function az(){return $i(jm)}let w_;const lz=()=>{if(typeof window>"u")return new Map;if(!w_){const t=window;t.Ionicons=t.Ionicons||{},w_=t.Ionicons.map=t.Ionicons.map||new Map}return w_},cz=t=>{let r=T_(t.src);return r||(r=PT(t.name,t.icon,t.mode,t.ios,t.md),r?uz(r):t.icon&&(r=T_(t.icon),r||(r=T_(t.icon[t.mode]),r))?r:null)},uz=t=>{const r=lz().get(t);return r||Uw(`svg/${t}.svg`)},PT=(t,r,l,h,m)=>(l=(l&&Bf(l))==="ios"?"ios":"md",h&&l==="ios"?t=Bf(h):m&&l==="md"?t=Bf(m):(!t&&r&&!LT(r)&&(t=r),rm(t)&&(t=Bf(t))),!rm(t)||t.trim()===""||t.replace(/[a-z]|-|\d/gi,"")!==""?null:t),T_=t=>rm(t)&&(t=t.trim(),LT(t))?t:null,LT=t=>t.length>0&&/(\/|\.)/.test(t),rm=t=>typeof t=="string",Bf=t=>t.toLowerCase(),hz=(t,r=[])=>{const l={};return r.forEach(h=>{t.hasAttribute(h)&&(t.getAttribute(h)!==null&&(l[h]=t.getAttribute(h)),t.removeAttribute(h))}),l},dz=t=>t&&t.dir!==""?t.dir.toLowerCase()==="rtl":(document==null?void 0:document.dir.toLowerCase())==="rtl",pz=t=>{const r=document.createElement("div");r.innerHTML=t;for(let h=r.childNodes.length-1;h>=0;h--)r.childNodes[h].nodeName.toLowerCase()!=="svg"&&r.removeChild(r.childNodes[h]);const l=r.firstElementChild;if(l&&l.nodeName.toLowerCase()==="svg"){const h=l.getAttribute("class")||"";if(l.setAttribute("class",(h+" s-ion-icon").trim()),zT(l))return r.innerHTML}return""},zT=t=>{if(t.nodeType===1){if(t.nodeName.toLowerCase()==="script")return!1;for(let r=0;r<t.attributes.length;r++){const l=t.attributes[r].name;if(rm(l)&&l.toLowerCase().indexOf("on")===0)return!1}for(let r=0;r<t.childNodes.length;r++)if(!zT(t.childNodes[r]))return!1}return!0},fz=t=>t.startsWith("data:image/svg+xml"),mz=t=>t.indexOf(";utf8,")!==-1,Gl=new Map,a1=new Map;let E_;const gz=(t,r)=>{let l=a1.get(t);if(!l)if(typeof fetch<"u"&&typeof document<"u")if(fz(t)&&mz(t)){E_||(E_=new DOMParser);const m=E_.parseFromString(t,"text/html").querySelector("svg");return m&&Gl.set(t,m.outerHTML),Promise.resolve()}else l=fetch(t).then(h=>{if(h.ok)return h.text().then(m=>{m&&r!==!1&&(m=pz(m)),Gl.set(t,m||"")});Gl.set(t,"")}),a1.set(t,l);else return Gl.set(t,""),Promise.resolve();return l},_z=":host{display:inline-block;width:1em;height:1em;contain:strict;fill:currentColor;-webkit-box-sizing:content-box !important;box-sizing:content-box !important}:host .ionicon{stroke:currentColor}.ionicon-fill-none{fill:none}.ionicon-stroke-width{stroke-width:32px;stroke-width:var(--ionicon-stroke-width, 32px)}.icon-inner,.ionicon,svg{display:block;height:100%;width:100%}:host(.flip-rtl) .icon-inner{-webkit-transform:scaleX(-1);transform:scaleX(-1)}:host(.icon-small){font-size:18px !important}:host(.icon-large){font-size:32px !important}:host(.ion-color){color:var(--ion-color-base) !important}:host(.ion-color-primary){--ion-color-base:var(--ion-color-primary, #3880ff)}:host(.ion-color-secondary){--ion-color-base:var(--ion-color-secondary, #0cd1e8)}:host(.ion-color-tertiary){--ion-color-base:var(--ion-color-tertiary, #f4a942)}:host(.ion-color-success){--ion-color-base:var(--ion-color-success, #10dc60)}:host(.ion-color-warning){--ion-color-base:var(--ion-color-warning, #ffce00)}:host(.ion-color-danger){--ion-color-base:var(--ion-color-danger, #f14141)}:host(.ion-color-light){--ion-color-base:var(--ion-color-light, #f4f5f8)}:host(.ion-color-medium){--ion-color-base:var(--ion-color-medium, #989aa2)}:host(.ion-color-dark){--ion-color-base:var(--ion-color-dark, #222428)}",yz=Tr(class extends Er{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.iconName=null,this.inheritedAttributes={},this.isVisible=!1,this.mode=vz(),this.lazy=!1,this.sanitize=!0,this.hasAriaHidden=()=>{const{el:t}=this;return t.hasAttribute("aria-hidden")&&t.getAttribute("aria-hidden")==="true"}}componentWillLoad(){this.inheritedAttributes=hz(this.el,["aria-label"])}connectedCallback(){this.waitUntilVisible(this.el,"50px",()=>{this.isVisible=!0,this.loadIcon()})}disconnectedCallback(){this.io&&(this.io.disconnect(),this.io=void 0)}waitUntilVisible(t,r,l){if(this.lazy&&typeof window<"u"&&window.IntersectionObserver){const h=this.io=new window.IntersectionObserver(m=>{m[0].isIntersecting&&(h.disconnect(),this.io=void 0,l())},{rootMargin:r});h.observe(t)}else l()}loadIcon(){if(this.isVisible){const r=cz(this);r&&(Gl.has(r)?this.svgContent=Gl.get(r):gz(r,this.sanitize).then(()=>this.svgContent=Gl.get(r)))}const t=this.iconName=PT(this.name,this.icon,this.mode,this.ios,this.md);t&&(this.ariaLabel=t.replace(/\-/g," "))}render(){const{iconName:t,ariaLabel:r,el:l,inheritedAttributes:h}=this,m=this.mode||"md",v=this.flipRtl||t&&(t.indexOf("arrow")>-1||t.indexOf("chevron")>-1)&&this.flipRtl!==!1;return Gt(wr,Object.assign({"aria-label":r!==void 0&&!this.hasAriaHidden()?r:null,role:"img",class:Object.assign(Object.assign({[m]:!0},bz(this.color)),{[`icon-${this.size}`]:!!this.size,"flip-rtl":!!v&&dz(l)})},h),this.svgContent?Gt("div",{class:"icon-inner",innerHTML:this.svgContent}):Gt("div",{class:"icon-inner"}))}static get assetsDirs(){return["svg"]}get el(){return this}static get watchers(){return{name:["loadIcon"],src:["loadIcon"],icon:["loadIcon"],ios:["loadIcon"],md:["loadIcon"]}}static get style(){return _z}},[1,"ion-icon",{mode:[1025],color:[1],ios:[1],md:[1],flipRtl:[4,"flip-rtl"],name:[513],src:[1],icon:[8],size:[1],lazy:[4],sanitize:[4],svgContent:[32],isVisible:[32],ariaLabel:[32]}]),vz=()=>typeof document<"u"&&document.documentElement.getAttribute("mode")||"md",bz=t=>t?{"ion-color":!0,[`ion-color-${t}`]:!0}:null;function xz(){if(typeof customElements>"u")return;["ion-icon"].forEach(r=>{switch(r){case"ion-icon":customElements.get(r)||customElements.define(r,yz);break}})}const wz=xz,l1="update:modelValue",k_="modelValue",Tz="routerLink",c1="navManager",Ez="router",kz="aria",fu=Symbol(),S_={default:fu},u1=t=>(t==null?void 0:t.split(" "))||[],Sz=(t,r,l=[])=>{var h;return[...Array.from(((h=t.value)===null||h===void 0?void 0:h.classList)||[]),...l].filter((m,v,T)=>!r.has(m)&&T.indexOf(m)===v)},Vs=(t,r,l=[],h,m,v)=>{r!==void 0&&r();const T=Dr((s,{attrs:S,slots:z,emit:O})=>{var B;let Z=s[h];const me=Ni(),_e=new Set(u1(S.class)),Ie=qe=>{qe.el&&(Array.isArray(m)?m:[m]).forEach(et=>{qe.el.addEventListener(et.toLowerCase(),Pe=>{Z=(Pe==null?void 0:Pe.target)[h],O(l1,Z),v&&O(v,Pe)})})},Te=Nd(),$e=((B=Te==null?void 0:Te.appContext)===null||B===void 0?void 0:B.provides[c1])?$i(c1):void 0,Fe=qe=>{const{routerLink:fe}=s;if(fe!==fu)if($e!==void 0){let et={event:qe};for(const Pe in s){const Ge=s[Pe];s.hasOwnProperty(Pe)&&Pe.startsWith(Ez)&&Ge!==fu&&(et[Pe]=Ge)}$e.navigate(et)}else console.warn("Tried to navigate, but no router was found. Make sure you have mounted Vue Router.")};return()=>{Z=s[h],u1(S.class).forEach(Pe=>{_e.add(Pe)});const qe=s.onClick,fe=Pe=>{qe!==void 0&&qe(Pe),Pe.defaultPrevented||Fe(Pe)};let et={ref:me,class:Sz(me,_e),onClick:fe,onVnodeBeforeMount:m?Ie:void 0};for(const Pe in s){const Ge=s[Pe];(s.hasOwnProperty(Pe)&&Ge!==fu||Pe.startsWith(kz))&&(et[Pe]=Ge)}return h&&(s[k_]!==fu?et=Object.assign(Object.assign({},et),{[h]:s[k_]}):Z!==fu&&(et=Object.assign(Object.assign({},et),{[h]:Z}))),hs(t,et,z.default&&z.default())}});return T.displayName=t,T.props={[Tz]:S_},l.forEach(s=>{T.props[s]=S_}),h&&(T.props[k_]=S_,T.emits=[l1,v]),T},gd=Vs("ion-button",IM,["color","buttonType","disabled","expand","fill","routerDirection","routerAnimation","download","href","rel","shape","size","strong","target","type","form","ionFocus","ionBlur"]),Az=Vs("ion-buttons",zM,["collapse"]),RT=Vs("ion-content",$M,["color","fullscreen","forceOverscroll","scrollX","scrollY","scrollEvents","ionScrollStart","ionScroll","ionScrollEnd"]),Iz=Vs("ion-fab",rP,["horizontal","vertical","edge","activated"]),A_=Vs("ion-fab-button",cP,["color","activated","disabled","download","href","rel","routerDirection","routerAnimation","target","show","translucent","type","size","closeIcon","ionFocus","ionBlur"]),Cz=Vs("ion-fab-list",pP,["activated","side"]),DT=Vs("ion-header",kP,["collapse","translucent"]),Mz=Vs("ion-title",RP,["color","size","ionStyle"]),Pz=Vs("ion-toolbar",jP,["color"]);var cs;(function(t){t.WillEnter="onIonViewWillEnter",t.DidEnter="onIonViewDidEnter",t.WillLeave="onIonViewWillLeave",t.DidLeave="onIonViewDidLeave"})(cs||(cs={}));const Lz={[Xy]:cs.WillEnter,[Ky]:cs.DidEnter,[Yy]:cs.WillLeave,[Jy]:cs.DidLeave},h1={main:0},zz=(t="main")=>{var r;const l=((r=h1[t])!==null&&r!==void 0?r:0)+1;return h1[t]=l,l.toString()},Ff=(t,r,l)=>{t!=null&&t[l]&&t[l].bind(r==null?void 0:r.value)();const h=r==null?void 0:r.value;if(h!=null&&h[l]&&h[l](),h){const m=Lz[l],v=h[m];v&&v.forEach(T=>T())}},OT=()=>{if(typeof window<"u"){const t=window.Ionic;if(t&&t.config)return t.config}return null},Rz=(t,r,l)=>{if(l){const h=l,m=h.proxy[t]||(h.proxy[t]=[]);h.exposed&&(h.exposed[t]=m);const v=(...T)=>{if(!h.isUnmounted)return T?r(...T):r()};return m.push(v),v}else console.warn("[@ionic/vue]: Ionic Lifecycle Hooks can only be used during execution of setup().")},Nm=t=>(r,l=Nd())=>Rz(t,r,l);Nm(cs.WillEnter);Nm(cs.DidEnter);Nm(cs.WillLeave);Nm(cs.DidLeave);const I_=t=>t==="ionChange"?"v-ion-change":t.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase(),Dz=()=>({ael:(t,r,l,h)=>t.addEventListener(I_(r),l,h),rel:(t,r,l,h)=>t.removeEventListener(I_(r),l,h),ce:(t,r)=>new CustomEvent(I_(t),r)}),Oz={async install(t,r={}){typeof document<"u"&&document.documentElement.classList.add("ion-ce");const{ael:l,rel:h,ce:m}=Dz();QC(Object.assign(Object.assign({},r),{_ael:l,_rel:h,_ce:m}))}},Bz=Dr((t,{attrs:r,slots:l})=>{KP();const h=$i("navManager"),m=()=>{if(h===void 0)return;const v=r["default-href"]||r.defaultHref,T=r["router-animation"]||r.routerAnimation;h.handleNavigateBack(v,T)};return()=>hs("ion-back-button",Object.assign({onClick:m},r),l.default&&l.default())}),iv=Dr({name:"IonPage",props:{registerIonPage:{type:Function,default:()=>{}}},mounted(){this.$props.registerIonPage(this.$refs.ionPage)},setup(t,{attrs:r,slots:l}){return()=>hs("div",Object.assign(Object.assign({},r),{class:"ion-page",ref:"ionPage"}),l.default&&l.default())}}),d1=t=>!t.classList.contains("ion-page-hidden")&&!t.classList.contains("ion-page-invisible"),p1=Symbol(0),Fz=Dr({name:"IonRouterOutlet",setup(){eL();const t=$i(jm),r=az(),l=$i(p1,0),h=zi(()=>r.matched[l]);let m,v;ql(p1,l+1),ql(MT,h);const T=Ni(),s=zz("ion-router-outlet"),S=$i("navManager"),z=$i("viewStacks"),O=Sm([]);let B=!1,Z;vr(()=>[r,h.value],([qe,fe])=>{if(fe!==void 0){const et=fe!==m,Pe=qe.matched[qe.matched.length-1]===fe&&qe.path!==v;(et||Pe)&&$e(h)}m=fe,v=qe.path});const me=()=>{const qe=OT();if(!(qe&&qe.get("swipeBackEnabled",T.value.mode==="ios")))return!1;const et=z.getViewStack(s);if(!et||et.length<=1)return!1;const Pe=S.getLeavingRouteInfo();return!!z.findViewItemByRouteInfo({pathname:Pe.pushedByRoute||""},s)},_e=async()=>{const qe=S.getLeavingRouteInfo(),{routerAnimation:fe}=qe,et=z.findViewItemByRouteInfo({pathname:qe.pushedByRoute||""},s),Pe=z.findViewItemByRouteInfo(qe,s);if(Pe){let Ge=fe;const Ye=et.ionPageElement,dt=Pe.ionPageElement,wt=et.routerAnimation;Ge===void 0&&wt!==void 0&&(Ge=wt),Pe.routerAnimation=Ge,await Te(Ye,dt,"back",S.canGoBack(2),!0,Ge)}return Promise.resolve()},Ie=qe=>{if(qe)B=!0,S.handleNavigateBack();else{const fe=S.getCurrentRouteInfo(),et=z.findViewItemByRouteInfo({pathname:fe.pushedByRoute||""},s);et.ionPageElement.setAttribute("aria-hidden","true"),et.ionPageElement.classList.add("ion-page-hidden")}};vr(T,()=>{T.value.swipeHandler={canStart:me,onStart:_e,onEnd:Ie}});const Te=(qe,fe,et,Pe,Ge,Ye)=>new Promise(dt=>{if(B)return B=!1,dt(!1);if(qe===fe)return dt(!1);requestAnimationFrame(()=>{requestAnimationFrame(async()=>{qe.classList.add("ion-page-invisible");const wt=et===void 0||et==="root"||et==="none",Tn=await T.value.commit(qe,fe,{deepWait:!0,duration:wt&&Ye===void 0?0:void 0,direction:et,showGoBack:Pe,progressAnimation:Ge,animationBuilder:Ye});return dt(Tn)})})}),ve=async()=>{const qe=S.getCurrentRouteInfo(),{routerDirection:fe,routerAction:et,routerAnimation:Pe,prevRouteLastPathname:Ge,delta:Ye}=qe,dt=z.findViewItemByRouteInfo(qe,s);let wt=z.findLeavingViewItemByRouteInfo(qe,s);const Tn=dt.ionPageElement;if(Tn===void 0&&console.warn(`[@ionic/vue Warning]: The view you are trying to render for path ${qe.pathname} does not have the required <ion-page> component. Transitions and lifecycle methods may not work as expected.

See https://ionicframework.com/docs/vue/navigation#ionpage for more information.`),dt!==wt&&(!wt&&Ge&&(wt=z.findViewItemByPathname(Ge,s)),!(d1(Tn)&&(wt==null?void 0:wt.ionPageElement)!==void 0&&!d1(wt.ionPageElement)))){if(Ff(dt.vueComponent,dt.vueComponentRef,Xy),wt!=null&&wt.ionPageElement&&dt!==wt){let Zt=Pe;const si=wt.ionPageElement;Ff(wt.vueComponent,wt.vueComponentRef,Yy);const At=dt.routerAnimation;Zt===void 0&&fe==="back"&&At!==void 0&&(Zt=At),wt.routerAnimation=Zt,await Te(Tn,si,fe,!!qe.pushedByRoute,!1,Zt),si.classList.add("ion-page-hidden"),si.setAttribute("aria-hidden","true");const Cn=z.size()===1;et==="replace"?(wt.mount=!1,wt.ionPageElement=void 0,wt.ionRoute=!1):et==="push"&&fe==="forward"?Cn&&z.mountIntermediaryViews(s,wt,Ye):fe!=="none"&&wt&&dt!==wt&&(wt.mount=!1,wt.ionPageElement=void 0,wt.ionRoute=!1,Cn&&z.unmountLeavingViews(s,dt,Ye)),Ff(wt.vueComponent,wt.vueComponentRef,Jy)}else requestAnimationFrame(()=>Tn.classList.remove("ion-page-invisible"));Ff(dt.vueComponent,dt.vueComponentRef,Ky),O.value=z.getChildrenToRender(s)}},$e=qe=>{const fe=r.matched[0];if(Z||(Z=fe.path),!qe.value||qe.value!==fe&&fe.path!==Z)return;const et=S.getCurrentRouteInfo();let Pe=z.findViewItemByRouteInfo(et,s);Pe||(Pe=z.createViewItem(s,qe.value.components.default,qe.value,et),z.add(Pe)),Pe.mount?ve():(Pe.mount=!0,Pe.registerCallback=()=>{ve(),Pe.registerCallback=void 0}),O.value=z.getChildrenToRender(s)};return h.value&&$e(h),ec(()=>z.clear(s)),{id:s,components:O,injectedRoute:t,ionRouterOutlet:T,registerIonPage:(qe,fe)=>{const et=qe.ionPageElement;z.registerIonPage(qe,fe),qe.registerCallback?(fe.classList.add("ion-page-invisible"),qe.registerCallback()):et&&!et.classList.contains("ion-page-invisible")&&fe.classList.remove("ion-page-invisible")}}},render(){const{components:t,registerIonPage:r,injectedRoute:l}=this;return hs("ion-router-outlet",{ref:"ionRouterOutlet"},t&&t.map(h=>{var m,v;let T={ref:h.vueComponentRef,key:h.pathname,registerIonPage:O=>r(h,O)};const s=(v=(m=h.matchedRoute)===null||m===void 0?void 0:m.props)===null||v===void 0?void 0:v.default,z=s?s===!0?h.params:typeof s=="function"?(()=>{var O;const B=(O=h.vueComponentData)===null||O===void 0?void 0:O.propsFunctionResult;if(B)return B;{const Z=s(l);return h.vueComponentData=Object.assign(Object.assign({},h.vueComponentData),{propsFunctionResult:Z}),Z}})():s:null;return T=Object.assign(Object.assign({},T),z),hs(h.vueComponent,T)}))}}),BT=t=>{var r;return((r=t.type)===null||r===void 0?void 0:r.name)==="IonTabButton"},FT=t=>{let r=[];return t.forEach(l=>{if(BT(l))r.push(l);else if(Array.isArray(l.children)&&l.children.length>1){const h=FT(l.children);r=[...r,...h]}}),r};Dr({name:"IonTabBar",props:{_tabsWillChange:{type:Function,default:()=>{}},_tabsDidChange:{type:Function,default:()=>{}}},data(){return{tabState:{activeTab:void 0,tabs:{}},tabVnodes:[]}},updated(){this.setupTabState($i("navManager"))},methods:{setupTabState(t){const r=this.$data.tabState,l=Nd();(this.$data.tabVnodes=FT(l.subTree.children||[])).forEach(m=>{r.tabs[m.props.tab]={originalHref:m.props.href,currentHref:m.props.href,ref:m},m.component.props._getTabState=()=>r}),this.checkActiveTab(t)},checkActiveTab(t){const r=t.getCurrentRouteInfo(),l=this.$data.tabVnodes,{tabs:h,activeTab:m}=this.$data.tabState,v=this.$data.tabState,s=Object.keys(h).find(B=>{const Z=h[B].originalHref;return r.pathname.startsWith(Z)});if(l.forEach(B=>{const Z=h[B.props.tab];(!Z||Z.originalHref!==B.props.href)&&(h[B.props.tab]={originalHref:B.props.href,currentHref:B.props.href,ref:B})}),s&&m){const B=this.$data.tabState.tabs[m].currentHref;if(s!==m||B!==r.pathname){const Z=r.search?`?${r.search}`:"";h[s]=Object.assign(Object.assign({},h[s]),{currentHref:r.pathname+Z})}r.routerAction==="pop"&&s!==m&&(h[m]=Object.assign(Object.assign({},h[m]),{currentHref:h[m].originalHref}))}const S=l.find(B=>{var Z;return BT(B)&&((Z=B.props)===null||Z===void 0?void 0:Z.tab)===s}),z=this.$refs.ionTabBar,O=s!==m;z&&(S?(O&&this.$props._tabsWillChange(s),t.handleSetCurrentTab(s),z.selectedTab=v.activeTab=s,O&&this.$props._tabsDidChange(s)):z.selectedTab=v.activeTab="")}},mounted(){const t=$i("navManager");this.setupTabState(t),t.registerHistoryChangeListener(()=>this.checkActiveTab(t))},setup(t,{slots:r}){return oL(),()=>hs("ion-tab-bar",{ref:"ionTabBar"},r.default&&r.default())}});const jz=Sm([]),Nz=Dr((t,{attrs:r,slots:l})=>(ZP(),()=>hs("ion-app",Object.assign({},r),[l.default&&l.default(),...jz.value]))),C_=Dr({name:"IonIcon",props:{color:String,flipRtl:Boolean,icon:String,ios:String,lazy:String,md:String,mode:String,name:String,size:String,src:String},setup(t,{slots:r}){return wz(),()=>{var l,h;const{icon:m,ios:v,md:T,mode:s}=t;let S;const z=OT(),O=s||(z==null?void 0:z.get("mode"));return v||T?O==="ios"?S=(l=v??T)!==null&&l!==void 0?l:m:S=(h=T??v)!==null&&h!==void 0?h:m:S=m,hs("ion-icon",Object.assign(Object.assign({},t),{icon:S}),r)}}}),$z=Dr({__name:"App",setup(t){return(r,l)=>(Lr(),tc(fn(Nz),null,{default:$n(()=>[en(fn(Fz))]),_:1}))}}),Uz=()=>{const t=[],r={},l=Ie=>{switch(Ie.routerAction){case"pop":m(Ie);break;default:v(Ie);break}Ie.routerDirection==="root"&&(T(),v(Ie))},h=Ie=>{const Te=t.findIndex($e=>$e.id===Ie.id);Te>-1&&t.splice(Te,1,Ie);const ve=r[Ie.tab||""];if(ve){const $e=ve.findIndex(Fe=>Fe.id===Ie.id);$e>-1?ve.splice($e,1,Ie):ve.push(Ie)}else Ie.tab&&(r[Ie.tab]=[Ie])},m=Ie=>{const Te=s(Ie.tab);let ve;if(Te){for(ve=Te[Te.length-1];ve&&ve.id!==Ie.id;)Te.pop(),ve=Te[Te.length-1];Te.pop(),Te.push(Ie)}for(ve=t[t.length-1];ve&&ve.id!==Ie.id;)t.pop(),ve=t[t.length-1];t.pop(),t.push(Ie)},v=Ie=>{const Te=s(Ie.tab);Te&&(Te[Te.length-1]&&Te[Te.length-1].id===Ie.id&&Te.pop(),Te.push(Ie)),t.push(Ie)},T=Ie=>{if(Ie){const{position:Te,tab:ve}=Ie,$e=t.findIndex(fe=>fe.position===Te);if($e===-1)return;t.splice($e);const Fe=fe=>{const et=r[fe].findIndex(Pe=>Pe.position===Te);et!==-1&&r[fe].splice(et)},qe=r[ve];if(ve&&qe)Fe(ve);else for(const fe in r)Fe(fe)}else{for(const Te in r)r[Te]=[];t.length=0}},s=Ie=>{let Te;return Ie&&(Te=r[Ie],Te||(Te=r[Ie]=[])),Te},S=()=>t.length,z=(Ie,Te)=>{const ve=Te-Ie;return t[ve]||O()},O=()=>t[t.length-1];return{current:z,size:S,last:O,add:l,canGoBack:(Ie=1,Te,ve)=>ve-Ie>=Te,update:h,getFirstRouteInfoForTab:Ie=>{const Te=s(Ie);if(Te)return Te[0]},getCurrentRouteInfoForTab:Ie=>{const Te=s(Ie);if(Te)return Te[Te.length-1]},findLastLocation:(Ie,Te=-1)=>{const ve=s(Ie.tab);if(ve){if(Te<-1)return ve[ve.length-1+Te];for(let $e=ve.length-2;$e>=0;$e--){const Fe=ve[$e];if(Fe&&Fe.pathname===Ie.pushedByRoute)return Fe}}if(Te<-1)return t[t.length-1+Te];for(let $e=t.length-2;$e>=0;$e--){const Fe=t[$e];if(Fe&&Fe.pathname===Ie.pushedByRoute)return Fe}},clearHistory:T}},f1={main:0},jT=(t="main")=>{var r;const l=((r=f1[t])!==null&&r!==void 0?r:0)+1;return f1[t]=l,l.toString()},Vz=(t,r)=>{let l={direction:void 0,action:void 0,delta:void 0};r.afterEach((Pe,Ge,Ye)=>{if(Ye)return;const{direction:dt,action:wt,delta:Tn}=l;v=t.history.state.position;const Zt=t.history.state.replaced?"replace":void 0;B(Pe,wt||Zt,dt,Tn),l={direction:void 0,action:void 0,delta:void 0}});const h=Uz();let m=t.history.state.position,v=t.history.state.position,T,s;const S=[];typeof document<"u"&&document.addEventListener("ionBackButton",Pe=>{Pe.detail.register(0,Ge=>{t.history.go(-1),Ge()})}),t.history.listen((Pe,Ge,Ye)=>{l={delta:Ye.delta,action:Ye.type==="pop"&&Ye.delta>=1?"push":Ye.type,direction:Ye.direction===""?"forward":Ye.direction}});const z=(Pe,Ge)=>{const Ye=h.current(m,v);if(Ye&&Ye.pushedByRoute){const dt=h.findLastLocation(Ye);dt?(s=Object.assign(Object.assign({},dt),{routerAction:"pop",routerDirection:"back",routerAnimation:Ge||Ye.routerAnimation}),Ye.lastPathname===Ye.pushedByRoute||dt.pathname===Ye.pushedByRoute&&!Ye.tab&&!dt.tab?r.back():r.go(dt.position-Ye.position)):O(Pe,"pop","back")}else O(Pe,"pop","back")},O=(Pe,Ge,Ye,dt,wt)=>{Fe(Ge,Ye,dt,wt),Ge==="push"?r.push(Pe):r.replace(Pe)},B=(Pe,Ge,Ye,dt)=>{let wt;if(s)if(s.routerAction==="replace")wt=h.current(m,v);else if(s.routerAction==="pop")wt=h.current(m,v+1),Ge==="replace"&&h.clearHistory();else{const Zt=s.routerDirection==="root"?v:v-1;wt=h.current(m,Zt)}else wt=T;if(wt||(wt={pathname:"",search:""}),wt.pathname+wt.search!==Pe.fullPath){if(!s){if(Ge==="replace")s={routerAction:"replace",routerDirection:"none"};else if(Ge==="pop"){const rn=h.current(m,v-dt);if(rn&&rn.pushedByRoute){const Ft=h.findLastLocation(rn,dt);s=Object.assign(Object.assign({},Ft),{routerAction:"pop",routerDirection:"back"})}else s={routerAction:"pop",routerDirection:"none"}}s||(s={routerAction:"push",routerDirection:Ye||"forward"})}let Zt;if(s!=null&&s.id)Zt=Object.assign(Object.assign({},s),{lastPathname:wt.pathname});else{const rn=s.routerAction==="push"&&s.routerDirection==="forward";if(Zt=Object.assign(Object.assign({id:jT("routeInfo")},s),{lastPathname:wt.pathname,pathname:Pe.path,search:Pe.fullPath&&Pe.fullPath.split("?")[1]||"",params:Pe.params&&Pe.params,prevRouteLastPathname:wt.lastPathname}),rn)Zt.pushedByRoute=wt.pathname!==""?wt.pathname:void 0;else if(Zt.routerAction==="pop"){const Ft=h.findLastLocation(Zt);Zt.pushedByRoute=Ft==null?void 0:Ft.pushedByRoute}else if(Zt.routerAction==="push"&&Zt.tab!==wt.tab){const Ft=h.getCurrentRouteInfoForTab(Zt.tab);Zt.pushedByRoute=Ft==null?void 0:Ft.pushedByRoute}else if(Zt.routerAction==="replace"){const Ft=h.current(m,v),ni=Ft==null?void 0:Ft.pushedByRoute,Jt=ni!==void 0&&ni!==Zt.pathname?ni:Zt.pushedByRoute;Zt.lastPathname=(Ft==null?void 0:Ft.pathname)||Zt.lastPathname,Zt.pushedByRoute=Jt,Zt.routerDirection=(Ft==null?void 0:Ft.routerDirection)||Zt.routerDirection,Zt.routerAnimation=(Ft==null?void 0:Ft.routerAnimation)||Zt.routerAnimation,Zt.prevRouteLastPathname=Ft==null?void 0:Ft.lastPathname}}Zt.position=v,Zt.delta=dt;const si=h.size(),At=v-m,Cn=si===At&&si>0&&Ge==="replace";si>At||Cn?(Zt.routerAction==="push"||Zt.routerAction==="replace")&&dt===void 0&&(h.clearHistory(Zt),h.add(Zt)):h.add(Zt),h.size()===1&&(m=Zt.position),T=Zt}s=void 0,S.forEach(Zt=>Zt(T))},Z=()=>T,me=(Pe=1)=>h.canGoBack(Pe,m,v),_e=Pe=>{const{routerAnimation:Ge,routerDirection:Ye,routerLink:dt}=Pe;Fe("push",Ye,Ge),r.push(dt)},Ie=Pe=>{const Ge=h.getFirstRouteInfoForTab(Pe);Ge&&r.go(Ge.position-v)},Te=(Pe,Ge)=>{if(!Ge)return;const Ye=h.getCurrentRouteInfoForTab(Pe),[dt]=Ge.split("?");Ye?(s=Object.assign(Object.assign({},s),{routerAction:"push",routerDirection:"none",tab:Pe}),Ye.pathname===dt?r.push({path:Ye.pathname,query:sy(Ye.search)}):r.push({path:dt,query:sy(Ye.search)})):O(dt,"push","none",void 0,Pe)},ve=Pe=>{const Ge=Object.assign({},h.current(m,v));Ge.tab!==Pe&&(Ge.tab=Pe,h.update(Ge));const Ye=h.findLastLocation(Ge);Ge.pushedByRoute!==Ge.lastPathname&&(Ye==null?void 0:Ye.tab)!==Pe&&(Ge.pushedByRoute=void 0,h.update(Ge))},$e=Pe=>{S.push(Pe)},Fe=(Pe="push",Ge="forward",Ye,dt)=>{s={routerAction:Pe,routerDirection:Ge,routerAnimation:Ye,tab:dt}};return{handleNavigate:O,getLeavingRouteInfo:()=>h.current(m,v),handleNavigateBack:z,handleSetCurrentTab:ve,getCurrentRouteInfo:Z,canGoBack:me,navigate:_e,resetTab:Ie,changeTab:Te,registerHistoryChangeListener:$e,goBack:Pe=>{Fe("pop","back",Pe),r.back()},goForward:Pe=>{Fe("push","forward",Pe),r.forward()}}},Gz=t=>{const r={},l=()=>Object.keys(r).length,h=ve=>{delete r[ve]},m=ve=>r[ve],v=(ve,$e)=>{ve.ionPageElement=$e,ve.ionRoute=!0,ve.matchedRoute.instances={default:ve.vueComponentRef.value}},T=(ve,$e)=>O(ve.pathname,$e,!1),s=(ve,$e,Fe=!0)=>O(ve.lastPathname,$e,Fe),S=(ve,$e)=>O(ve,$e,!1),z=(ve,$e)=>$e.find(Fe=>{if(Fe.pathname===ve)return Fe}),O=(ve,$e,Fe=!1)=>{const qe=fe=>{if(Fe&&!fe.ionRoute||ve==="")return!1;const Pe=t.resolve(ve).matched.find(Ge=>Ge===fe.matchedRoute);if(Pe)return Pe.path.includes(":")&&ve!==fe.pathname?!1:fe};if($e){const fe=r[$e];if(!fe)return;const et=t?fe.find(qe):z(ve,fe);if(et)return et}else for(const fe in r){const et=r[fe],Pe=z(ve,et);if(Pe)return Pe}};return{unmountLeavingViews:(ve,$e,Fe=1)=>{const qe=r[ve];if(!qe)return;const fe=qe.findIndex(et=>et===$e);for(let et=fe+1;et<fe-Fe;et++){const Pe=qe[et];Pe.mount=!1,Pe.ionPageElement=void 0,Pe.ionRoute=!1,Pe.matchedRoute.instances={}}},mountIntermediaryViews:(ve,$e,Fe=1)=>{const qe=r[ve];if(!qe)return;const fe=qe.findIndex(et=>et===$e);for(let et=fe+1;et<fe+Fe;et++)qe[et].mount=!0},clear:h,findViewItemByRouteInfo:T,findLeavingViewItemByRouteInfo:s,findViewItemByPathname:S,createViewItem:(ve,$e,Fe,qe,fe)=>({id:jT("viewItem"),pathname:qe.pathname,outletId:ve,matchedRoute:Fe,ionPageElement:fe,vueComponent:$e,vueComponentRef:Sm(),ionRoute:!1,mount:!1,exact:qe.pathname===Fe.path,params:qe.params,vueComponentData:{}}),getChildrenToRender:ve=>r[ve]?r[ve].filter(qe=>qe.mount):[],add:ve=>{const{outletId:$e}=ve;r[$e]?r[$e].push(ve):r[$e]=[ve]},remove:(ve,$e)=>{if(!$e)throw Error("outletId required");const Fe=r[$e];Fe&&(r[$e]=Fe.filter(qe=>qe.id!==ve.id))},registerIonPage:v,getViewStack:m,size:l}},Zz=t=>{const r=Object.assign({},t);delete r.tabsPrefix;const l=oz(r),h=Vz(t,l),m=Gz(l),v=l.install.bind(l);l.install=s=>{s.provide("navManager",h),s.provide("viewStacks",m),v(s)};const T=l.isReady.bind(l);return l.isReady=()=>T(),l},qz=t=>TL(t),Wz={class:"flex flex-col items-center justify-center"},Hz=Gr("h1",null,"Journiz",-1),Xz={class:"text-red-600"},Kz=Dr({__name:"HelloJourniz",setup(t){const r=Ni(0),l=zi(()=>r.value*2),h=()=>r.value++;return console.log("👋 Welcome to app"),(m,v)=>(Lr(),Ra("div",Wz,[Hz,Gr("p",null,[to(" Count is: "),Gr("strong",null,N_(r.value),1),to(", doubleCount is "),Gr("strong",Xz,N_(fn(l)),1)]),en(fn(gd),{onClick:h},{default:$n(()=>[to("Increment")]),_:1}),en(fn(gd),{"router-link":"/geolocation"},{default:$n(()=>[to("Go to geolocation")]),_:1}),en(fn(gd),{"router-link":"/notif"},{default:$n(()=>[to("Go to notif")]),_:1})]))}}),Yz=Dr({__name:"HomeView",setup(t){return(r,l)=>{const h=gr("IonTitle"),m=gr("IonToolbar"),v=gr("IonHeader"),T=gr("IonContent");return Lr(),tc(fn(iv),null,{default:$n(()=>[en(v,{class:""},{default:$n(()=>[en(m,null,{default:$n(()=>[en(h,null,{default:$n(()=>[to("Jouuusssr")]),_:1})]),_:1})]),_:1}),en(T,{fullscreen:!0},{default:$n(()=>[en(Kz,{class:"h-full"})]),_:1})]),_:1})}}});/*! Capacitor: https://capacitorjs.com/ - MIT License */const Jz=t=>{const r=new Map;r.set("web",{name:"web"});const l=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:r},h=(v,T)=>{l.platforms.set(v,T)},m=v=>{l.platforms.has(v)&&(l.currentPlatform=l.platforms.get(v))};return l.addPlatform=h,l.setPlatform=m,l},Qz=t=>t.CapacitorPlatforms=Jz(t),NT=Qz(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});NT.addPlatform;NT.setPlatform;var Mu;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(Mu||(Mu={}));class M_ extends Error{constructor(r,l,h){super(r),this.message=r,this.code=l,this.data=h}}const eR=t=>{var r,l;return t!=null&&t.androidBridge?"android":!((l=(r=t==null?void 0:t.webkit)===null||r===void 0?void 0:r.messageHandlers)===null||l===void 0)&&l.bridge?"ios":"web"},tR=t=>{var r,l,h,m,v;const T=t.CapacitorCustomPlatform||null,s=t.Capacitor||{},S=s.Plugins=s.Plugins||{},z=t.CapacitorPlatforms,O=()=>T!==null?T.name:eR(t),B=((r=z==null?void 0:z.currentPlatform)===null||r===void 0?void 0:r.getPlatform)||O,Z=()=>B()!=="web",me=((l=z==null?void 0:z.currentPlatform)===null||l===void 0?void 0:l.isNativePlatform)||Z,_e=Pe=>{const Ge=qe.get(Pe);return!!(Ge!=null&&Ge.platforms.has(B())||ve(Pe))},Ie=((h=z==null?void 0:z.currentPlatform)===null||h===void 0?void 0:h.isPluginAvailable)||_e,Te=Pe=>{var Ge;return(Ge=s.PluginHeaders)===null||Ge===void 0?void 0:Ge.find(Ye=>Ye.name===Pe)},ve=((m=z==null?void 0:z.currentPlatform)===null||m===void 0?void 0:m.getPluginHeader)||Te,$e=Pe=>t.console.error(Pe),Fe=(Pe,Ge,Ye)=>Promise.reject(`${Ye} does not have an implementation of "${Ge}".`),qe=new Map,fe=(Pe,Ge={})=>{const Ye=qe.get(Pe);if(Ye)return console.warn(`Capacitor plugin "${Pe}" already registered. Cannot register plugins twice.`),Ye.proxy;const dt=B(),wt=ve(Pe);let Tn;const Zt=async()=>(!Tn&&dt in Ge?Tn=typeof Ge[dt]=="function"?Tn=await Ge[dt]():Tn=Ge[dt]:T!==null&&!Tn&&"web"in Ge&&(Tn=typeof Ge.web=="function"?Tn=await Ge.web():Tn=Ge.web),Tn),si=(Jt,Mn)=>{var Fn,hi;if(wt){const fi=wt==null?void 0:wt.methods.find(Xe=>Mn===Xe.name);if(fi)return fi.rtype==="promise"?Xe=>s.nativePromise(Pe,Mn.toString(),Xe):(Xe,xt)=>s.nativeCallback(Pe,Mn.toString(),Xe,xt);if(Jt)return(Fn=Jt[Mn])===null||Fn===void 0?void 0:Fn.bind(Jt)}else{if(Jt)return(hi=Jt[Mn])===null||hi===void 0?void 0:hi.bind(Jt);throw new M_(`"${Pe}" plugin is not implemented on ${dt}`,Mu.Unimplemented)}},At=Jt=>{let Mn;const Fn=(...hi)=>{const fi=Zt().then(Xe=>{const xt=si(Xe,Jt);if(xt){const pt=xt(...hi);return Mn=pt==null?void 0:pt.remove,pt}else throw new M_(`"${Pe}.${Jt}()" is not implemented on ${dt}`,Mu.Unimplemented)});return Jt==="addListener"&&(fi.remove=async()=>Mn()),fi};return Fn.toString=()=>`${Jt.toString()}() { [capacitor code] }`,Object.defineProperty(Fn,"name",{value:Jt,writable:!1,configurable:!1}),Fn},Cn=At("addListener"),rn=At("removeListener"),Ft=(Jt,Mn)=>{const Fn=Cn({eventName:Jt},Mn),hi=async()=>{const Xe=await Fn;rn({eventName:Jt,callbackId:Xe},Mn)},fi=new Promise(Xe=>Fn.then(()=>Xe({remove:hi})));return fi.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await hi()},fi},ni=new Proxy({},{get(Jt,Mn){switch(Mn){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return wt?Ft:Cn;case"removeListener":return rn;default:return At(Mn)}}});return S[Pe]=ni,qe.set(Pe,{name:Pe,proxy:ni,platforms:new Set([...Object.keys(Ge),...wt?[dt]:[]])}),ni},et=((v=z==null?void 0:z.currentPlatform)===null||v===void 0?void 0:v.registerPlugin)||fe;return s.convertFileSrc||(s.convertFileSrc=Pe=>Pe),s.getPlatform=B,s.handleError=$e,s.isNativePlatform=me,s.isPluginAvailable=Ie,s.pluginMethodNoop=Fe,s.registerPlugin=et,s.Exception=M_,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s.platform=s.getPlatform(),s.isNative=s.isNativePlatform(),s},nR=t=>t.Capacitor=tR(t),om=nR(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),rv=om.registerPlugin;om.Plugins;class $T{constructor(r){this.listeners={},this.windowListeners={},r&&(console.warn(`Capacitor WebPlugin "${r.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=r)}addListener(r,l){this.listeners[r]||(this.listeners[r]=[]),this.listeners[r].push(l);const m=this.windowListeners[r];m&&!m.registered&&this.addWindowListener(m);const v=async()=>this.removeListener(r,l),T=Promise.resolve({remove:v});return Object.defineProperty(T,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await v()}}),T}async removeAllListeners(){this.listeners={};for(const r in this.windowListeners)this.removeWindowListener(this.windowListeners[r]);this.windowListeners={}}notifyListeners(r,l){const h=this.listeners[r];h&&h.forEach(m=>m(l))}hasListeners(r){return!!this.listeners[r].length}registerWindowListener(r,l){this.windowListeners[l]={registered:!1,windowEventName:r,pluginEventName:l,handler:h=>{this.notifyListeners(l,h)}}}unimplemented(r="not implemented"){return new om.Exception(r,Mu.Unimplemented)}unavailable(r="not available"){return new om.Exception(r,Mu.Unavailable)}async removeListener(r,l){const h=this.listeners[r];if(!h)return;const m=h.indexOf(l);this.listeners[r].splice(m,1),this.listeners[r].length||this.removeWindowListener(this.windowListeners[r])}addWindowListener(r){window.addEventListener(r.windowEventName,r.handler),r.registered=!0}removeWindowListener(r){r&&(window.removeEventListener(r.windowEventName,r.handler),r.registered=!1)}}const m1=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),g1=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class iR extends $T{async getCookies(){const r=document.cookie,l={};return r.split(";").forEach(h=>{if(h.length<=0)return;let[m,v]=h.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");m=g1(m).trim(),v=g1(v).trim(),l[m]=v}),l}async setCookie(r){try{const l=m1(r.key),h=m1(r.value),m=`; expires=${(r.expires||"").replace("expires=","")}`,v=(r.path||"/").replace("path=",""),T=r.url!=null&&r.url.length>0?`domain=${r.url}`:"";document.cookie=`${l}=${h||""}${m}; path=${v}; ${T};`}catch(l){return Promise.reject(l)}}async deleteCookie(r){try{document.cookie=`${r.key}=; Max-Age=0`}catch(l){return Promise.reject(l)}}async clearCookies(){try{const r=document.cookie.split(";")||[];for(const l of r)document.cookie=l.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(r){return Promise.reject(r)}}async clearAllCookies(){try{await this.clearCookies()}catch(r){return Promise.reject(r)}}}rv("CapacitorCookies",{web:()=>new iR});const rR=async t=>new Promise((r,l)=>{const h=new FileReader;h.onload=()=>{const m=h.result;r(m.indexOf(",")>=0?m.split(",")[1]:m)},h.onerror=m=>l(m),h.readAsDataURL(t)}),oR=(t={})=>{const r=Object.keys(t);return Object.keys(t).map(m=>m.toLocaleLowerCase()).reduce((m,v,T)=>(m[v]=t[r[T]],m),{})},sR=(t,r=!0)=>t?Object.entries(t).reduce((h,m)=>{const[v,T]=m;let s,S;return Array.isArray(T)?(S="",T.forEach(z=>{s=r?encodeURIComponent(z):z,S+=`${v}=${s}&`}),S.slice(0,-1)):(s=r?encodeURIComponent(T):T,S=`${v}=${s}`),`${h}&${S}`},"").substr(1):null,aR=(t,r={})=>{const l=Object.assign({method:t.method||"GET",headers:t.headers},r),m=oR(t.headers)["content-type"]||"";if(typeof t.data=="string")l.body=t.data;else if(m.includes("application/x-www-form-urlencoded")){const v=new URLSearchParams;for(const[T,s]of Object.entries(t.data||{}))v.set(T,s);l.body=v.toString()}else if(m.includes("multipart/form-data")){const v=new FormData;if(t.data instanceof FormData)t.data.forEach((s,S)=>{v.append(S,s)});else for(const s of Object.keys(t.data))v.append(s,t.data[s]);l.body=v;const T=new Headers(l.headers);T.delete("content-type"),l.headers=T}else(m.includes("application/json")||typeof t.data=="object")&&(l.body=JSON.stringify(t.data));return l};class lR extends $T{async request(r){const l=aR(r,r.webFetchExtra),h=sR(r.params,r.shouldEncodeUrlParams),m=h?`${r.url}?${h}`:r.url,v=await fetch(m,l),T=v.headers.get("content-type")||"";let{responseType:s="text"}=v.ok?r:{};T.includes("application/json")&&(s="json");let S,z;switch(s){case"arraybuffer":case"blob":z=await v.blob(),S=await rR(z);break;case"json":S=await v.json();break;case"document":case"text":default:S=await v.text()}const O={};return v.headers.forEach((B,Z)=>{O[Z]=B}),{data:S,headers:O,status:v.status,url:v.url}}async get(r){return this.request(Object.assign(Object.assign({},r),{method:"GET"}))}async post(r){return this.request(Object.assign(Object.assign({},r),{method:"POST"}))}async put(r){return this.request(Object.assign(Object.assign({},r),{method:"PUT"}))}async patch(r){return this.request(Object.assign(Object.assign({},r),{method:"PATCH"}))}async delete(r){return this.request(Object.assign(Object.assign({},r),{method:"DELETE"}))}}rv("CapacitorHttp",{web:()=>new lR});const P_=rv("BackgroundGeolocation");var ly=function(t,r){return ly=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(l[m]=h[m])},ly(t,r)};function br(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function l(){this.constructor=t}ly(t,r),t.prototype=r===null?Object.create(r):(l.prototype=r.prototype,new l)}var cy=function(){return cy=Object.assign||function(r){for(var l,h=1,m=arguments.length;h<m;h++)for(var v in l=arguments[h])Object.prototype.hasOwnProperty.call(l,v)&&(r[v]=l[v]);return r},cy.apply(this,arguments)};function Cr(t,r,l,h){return new(l||(l=Promise))(function(m,v){function T(z){try{S(h.next(z))}catch(O){v(O)}}function s(z){try{S(h.throw(z))}catch(O){v(O)}}function S(z){z.done?m(z.value):function(B){return B instanceof l?B:new l(function(Z){Z(B)})}(z.value).then(T,s)}S((h=h.apply(t,r||[])).next())})}function Mr(t,r){var l,h,m,v,T={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return v={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function s(S){return function(z){return function(B){if(l)throw new TypeError("Generator is already executing.");for(;T;)try{if(l=1,h&&(m=2&B[0]?h.return:B[0]?h.throw||((m=h.return)&&m.call(h),0):h.next)&&!(m=m.call(h,B[1])).done)return m;switch(h=0,m&&(B=[2&B[0],m.value]),B[0]){case 0:case 1:m=B;break;case 4:return T.label++,{value:B[1],done:!1};case 5:T.label++,h=B[1],B=[0];continue;case 7:B=T.ops.pop(),T.trys.pop();continue;default:if(m=T.trys,!((m=m.length>0&&m[m.length-1])||B[0]!==6&&B[0]!==2)){T=0;continue}if(B[0]===3&&(!m||B[1]>m[0]&&B[1]<m[3])){T.label=B[1];break}if(B[0]===6&&T.label<m[1]){T.label=m[1],m=B;break}if(m&&T.label<m[2]){T.label=m[2],T.ops.push(B);break}m[2]&&T.ops.pop(),T.trys.pop();continue}B=r.call(t,T)}catch(Z){B=[6,Z],h=0}finally{l=m=0}if(5&B[0])throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}([S,z])}}}var UT,Id=function(t){function r(l){var h,m,v,T,s=this;return(s=t.call(this,"ClientResponseError")||this).url="",s.status=0,s.response={},s.isAbort=!1,s.originalError=null,Object.setPrototypeOf(s,r.prototype),l instanceof r||(s.originalError=l),l!==null&&typeof l=="object"&&(s.url=typeof l.url=="string"?l.url:"",s.status=typeof l.status=="number"?l.status:0,s.response=l.data!==null&&typeof l.data=="object"?l.data:{},s.isAbort=!!l.isAbort),typeof DOMException<"u"&&l instanceof DOMException&&(s.isAbort=!0),s.name="ClientResponseError "+s.status,s.message=(h=s.response)===null||h===void 0?void 0:h.message,s.message||(s.isAbort?s.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":!((T=(v=(m=s.originalError)===null||m===void 0?void 0:m.cause)===null||v===void 0?void 0:v.message)===null||T===void 0)&&T.includes("ECONNREFUSED ::1")?s.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":s.message="Something went wrong while processing your request."),s}return br(r,t),Object.defineProperty(r.prototype,"data",{get:function(){return this.response},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return cy({},this)},r}(Error),jf=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function _1(t,r,l){var h=Object.assign({},l||{}),m=h.encode||uR;if(!jf.test(t))throw new TypeError("argument name is invalid");var v=m(r);if(v&&!jf.test(v))throw new TypeError("argument val is invalid");var T=t+"="+v;if(h.maxAge!=null){var s=h.maxAge-0;if(isNaN(s)||!isFinite(s))throw new TypeError("option maxAge is invalid");T+="; Max-Age="+Math.floor(s)}if(h.domain){if(!jf.test(h.domain))throw new TypeError("option domain is invalid");T+="; Domain="+h.domain}if(h.path){if(!jf.test(h.path))throw new TypeError("option path is invalid");T+="; Path="+h.path}if(h.expires){if(!function(z){return Object.prototype.toString.call(z)==="[object Date]"||z instanceof Date}(h.expires)||isNaN(h.expires.valueOf()))throw new TypeError("option expires is invalid");T+="; Expires="+h.expires.toUTCString()}if(h.httpOnly&&(T+="; HttpOnly"),h.secure&&(T+="; Secure"),h.priority)switch(typeof h.priority=="string"?h.priority.toLowerCase():h.priority){case"low":T+="; Priority=Low";break;case"medium":T+="; Priority=Medium";break;case"high":T+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(h.sameSite)switch(typeof h.sameSite=="string"?h.sameSite.toLowerCase():h.sameSite){case!0:T+="; SameSite=Strict";break;case"lax":T+="; SameSite=Lax";break;case"strict":T+="; SameSite=Strict";break;case"none":T+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return T}function cR(t){return t.indexOf("%")!==-1?decodeURIComponent(t):t}function uR(t){return encodeURIComponent(t)}function y1(t){if(t)try{var r=decodeURIComponent(UT(t.split(".")[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)||{}}catch{}return{}}UT=typeof atob=="function"?atob:function(t){var r=String(t).replace(/=+$/,"");if(r.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var l,h,m=0,v=0,T="";h=r.charAt(v++);~h&&(l=m%4?64*l+h:h,m++%4)?T+=String.fromCharCode(255&l>>(-2*m&6)):0)h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h);return T};var Vd=function(){function t(r){r===void 0&&(r={}),this.load(r||{})}return t.prototype.load=function(r){for(var l=0,h=Object.entries(r);l<h.length;l++){var m=h[l],v=m[0],T=m[1];this[v]=T}this.id=r.id!==void 0?r.id:"",this.created=r.created!==void 0?r.created:"",this.updated=r.updated!==void 0?r.updated:""},Object.defineProperty(t.prototype,"isNew",{get:function(){return!this.id},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var r=typeof structuredClone=="function"?structuredClone(this):JSON.parse(JSON.stringify(this));return new this.constructor(r)},t.prototype.export=function(){return Object.assign({},this)},t}(),sm=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.load=function(l){t.prototype.load.call(this,l),this.collectionId=typeof l.collectionId=="string"?l.collectionId:"",this.collectionName=typeof l.collectionName=="string"?l.collectionName:"",this.loadExpand(l.expand)},r.prototype.loadExpand=function(l){for(var h in l=l||{},this.expand={},l)Array.isArray(l[h])?this.expand[h]=l[h].map(function(m){return new r(m||{})}):this.expand[h]=new r(l[h]||{})},r}(Vd),ov=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.load=function(l){t.prototype.load.call(this,l),this.avatar=typeof l.avatar=="number"?l.avatar:0,this.email=typeof l.email=="string"?l.email:""},r}(Vd),hR=function(){function t(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}return Object.defineProperty(t.prototype,"token",{get:function(){return this.baseToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"model",{get:function(){return this.baseModel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isValid",{get:function(){return!function(l,h){h===void 0&&(h=0);var m=y1(l);return!(Object.keys(m).length>0&&(!m.exp||m.exp-h>Date.now()/1e3))}(this.token)},enumerable:!1,configurable:!0}),t.prototype.save=function(r,l){this.baseToken=r||"",this.baseModel=l!==null&&typeof l=="object"?l.collectionId!==void 0?new sm(l):new ov(l):null,this.triggerChange()},t.prototype.clear=function(){this.baseToken="",this.baseModel=null,this.triggerChange()},t.prototype.loadFromCookie=function(r,l){l===void 0&&(l="pb_auth");var h=function(T,s){var S={};if(typeof T!="string")return S;for(var z=Object.assign({},s||{}).decode||cR,O=0;O<T.length;){var B=T.indexOf("=",O);if(B===-1)break;var Z=T.indexOf(";",O);if(Z===-1)Z=T.length;else if(Z<B){O=T.lastIndexOf(";",B-1)+1;continue}var me=T.slice(O,B).trim();if(S[me]===void 0){var _e=T.slice(B+1,Z).trim();_e.charCodeAt(0)===34&&(_e=_e.slice(1,-1));try{S[me]=z(_e)}catch{S[me]=_e}}O=Z+1}return S}(r||"")[l]||"",m={};try{(typeof(m=JSON.parse(h))===null||typeof m!="object"||Array.isArray(m))&&(m={})}catch{}this.save(m.token||"",m.model||null)},t.prototype.exportToCookie=function(r,l){var h,m,v;l===void 0&&(l="pb_auth");var T={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=y1(this.token);s!=null&&s.exp?T.expires=new Date(1e3*s.exp):T.expires=new Date("1970-01-01"),r=Object.assign({},T,r);var S={token:this.token,model:((h=this.model)===null||h===void 0?void 0:h.export())||null},z=_1(l,JSON.stringify(S),r),O=typeof Blob<"u"?new Blob([z]).size:z.length;return S.model&&O>4096&&(S.model={id:(m=S==null?void 0:S.model)===null||m===void 0?void 0:m.id,email:(v=S==null?void 0:S.model)===null||v===void 0?void 0:v.email},this.model instanceof sm&&(S.model.username=this.model.username,S.model.verified=this.model.verified,S.model.collectionId=this.model.collectionId),z=_1(l,JSON.stringify(S),r)),z},t.prototype.onChange=function(r,l){var h=this;return l===void 0&&(l=!1),this._onChangeCallbacks.push(r),l&&r(this.token,this.model),function(){for(var m=h._onChangeCallbacks.length-1;m>=0;m--)if(h._onChangeCallbacks[m]==r)return delete h._onChangeCallbacks[m],void h._onChangeCallbacks.splice(m,1)}},t.prototype.triggerChange=function(){for(var r=0,l=this._onChangeCallbacks;r<l.length;r++){var h=l[r];h&&h(this.token,this.model)}},t}(),dR=function(t){function r(l){l===void 0&&(l="pocketbase_auth");var h=t.call(this)||this;return h.storageFallback={},h.storageKey=l,h}return br(r,t),Object.defineProperty(r.prototype,"token",{get:function(){return(this._storageGet(this.storageKey)||{}).token||""},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"model",{get:function(){var l,h=this._storageGet(this.storageKey)||{};return h===null||typeof h!="object"||h.model===null||typeof h.model!="object"?null:((l=h.model)===null||l===void 0?void 0:l.collectionId)===void 0?new ov(h.model):new sm(h.model)},enumerable:!1,configurable:!0}),r.prototype.save=function(l,h){this._storageSet(this.storageKey,{token:l,model:h}),t.prototype.save.call(this,l,h)},r.prototype.clear=function(){this._storageRemove(this.storageKey),t.prototype.clear.call(this)},r.prototype._storageGet=function(l){if(typeof window<"u"&&(window!=null&&window.localStorage)){var h=window.localStorage.getItem(l)||"";try{return JSON.parse(h)}catch{return h}}return this.storageFallback[l]},r.prototype._storageSet=function(l,h){if(typeof window<"u"&&(window!=null&&window.localStorage)){var m=h;typeof h!="string"&&(m=JSON.stringify(h)),window.localStorage.setItem(l,m)}else this.storageFallback[l]=h},r.prototype._storageRemove=function(l){var h;typeof window<"u"&&(window!=null&&window.localStorage)&&((h=window.localStorage)===null||h===void 0||h.removeItem(l)),delete this.storageFallback[l]},r}(hR),Gd=function(r){this.client=r},pR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.getAll=function(l){return l===void 0&&(l={}),this.client.send("/api/settings",{method:"GET",params:l}).then(function(h){return h||{}})},r.prototype.update=function(l,h){return l===void 0&&(l={}),h===void 0&&(h={}),this.client.send("/api/settings",{method:"PATCH",params:h,body:l}).then(function(m){return m||{}})},r.prototype.testS3=function(l){return l===void 0&&(l={}),this.client.send("/api/settings/test/s3",{method:"POST",params:l}).then(function(){return!0})},r.prototype.testEmail=function(l,h,m){m===void 0&&(m={});var v={email:l,template:h};return this.client.send("/api/settings/test/email",{method:"POST",params:m,body:v}).then(function(){return!0})},r}(Gd),VT=function(r,l,h,m,v){this.page=r>0?r:1,this.perPage=l>=0?l:0,this.totalItems=h>=0?h:0,this.totalPages=m>=0?m:0,this.items=v||[]},sv=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.getFullList=function(l,h){if(typeof l=="number")return this._getFullList(this.baseCrudPath,l,h);var m=Object.assign({},l,h);return this._getFullList(this.baseCrudPath,m.batch||200,m)},r.prototype.getList=function(l,h,m){return l===void 0&&(l=1),h===void 0&&(h=30),m===void 0&&(m={}),this._getList(this.baseCrudPath,l,h,m)},r.prototype.getFirstListItem=function(l,h){return h===void 0&&(h={}),this._getFirstListItem(this.baseCrudPath,l,h)},r.prototype.getOne=function(l,h){return h===void 0&&(h={}),this._getOne(this.baseCrudPath,l,h)},r.prototype.create=function(l,h){return l===void 0&&(l={}),h===void 0&&(h={}),this._create(this.baseCrudPath,l,h)},r.prototype.update=function(l,h,m){return h===void 0&&(h={}),m===void 0&&(m={}),this._update(this.baseCrudPath,l,h,m)},r.prototype.delete=function(l,h){return h===void 0&&(h={}),this._delete(this.baseCrudPath,l,h)},r}(function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype._getFullList=function(l,h,m){var v=this;h===void 0&&(h=200),m===void 0&&(m={});var T=[],s=function(S){return Cr(v,void 0,void 0,function(){return Mr(this,function(z){return[2,this._getList(l,S,h||200,m).then(function(O){var B=O,Z=B.items,me=B.totalItems;return T=T.concat(Z),Z.length&&me>T.length?s(S+1):T})]})})};return s(1)},r.prototype._getList=function(l,h,m,v){var T=this;return h===void 0&&(h=1),m===void 0&&(m=30),v===void 0&&(v={}),v=Object.assign({page:h,perPage:m},v),this.client.send(l,{method:"GET",params:v}).then(function(s){var S=[];if(s!=null&&s.items){s.items=s.items||[];for(var z=0,O=s.items;z<O.length;z++){var B=O[z];S.push(T.decode(B))}}return new VT((s==null?void 0:s.page)||1,(s==null?void 0:s.perPage)||0,(s==null?void 0:s.totalItems)||0,(s==null?void 0:s.totalPages)||0,S)})},r.prototype._getOne=function(l,h,m){var v=this;return m===void 0&&(m={}),this.client.send(l+"/"+encodeURIComponent(h),{method:"GET",params:m}).then(function(T){return v.decode(T)})},r.prototype._getFirstListItem=function(l,h,m){return m===void 0&&(m={}),m=Object.assign({filter:h,$cancelKey:"one_by_filter_"+l+"_"+h},m),this._getList(l,1,1,m).then(function(v){var T;if(!(!((T=v==null?void 0:v.items)===null||T===void 0)&&T.length))throw new Id({status:404,data:{code:404,message:"The requested resource wasn't found.",data:{}}});return v.items[0]})},r.prototype._create=function(l,h,m){var v=this;return h===void 0&&(h={}),m===void 0&&(m={}),this.client.send(l,{method:"POST",params:m,body:h}).then(function(T){return v.decode(T)})},r.prototype._update=function(l,h,m,v){var T=this;return m===void 0&&(m={}),v===void 0&&(v={}),this.client.send(l+"/"+encodeURIComponent(h),{method:"PATCH",params:v,body:m}).then(function(s){return T.decode(s)})},r.prototype._delete=function(l,h,m){return m===void 0&&(m={}),this.client.send(l+"/"+encodeURIComponent(h),{method:"DELETE",params:m}).then(function(){return!0})},r}(Gd)),fR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.decode=function(l){return new ov(l)},Object.defineProperty(r.prototype,"baseCrudPath",{get:function(){return"/api/admins"},enumerable:!1,configurable:!0}),r.prototype.update=function(l,h,m){var v=this;return h===void 0&&(h={}),m===void 0&&(m={}),t.prototype.update.call(this,l,h,m).then(function(T){var s,S;return v.client.authStore.model&&((s=v.client.authStore.model)===null||s===void 0?void 0:s.collectionId)===void 0&&((S=v.client.authStore.model)===null||S===void 0?void 0:S.id)===(T==null?void 0:T.id)&&v.client.authStore.save(v.client.authStore.token,T),T})},r.prototype.delete=function(l,h){var m=this;return h===void 0&&(h={}),t.prototype.delete.call(this,l,h).then(function(v){var T,s;return v&&m.client.authStore.model&&((T=m.client.authStore.model)===null||T===void 0?void 0:T.collectionId)===void 0&&((s=m.client.authStore.model)===null||s===void 0?void 0:s.id)===l&&m.client.authStore.clear(),v})},r.prototype.authResponse=function(l){var h=this.decode((l==null?void 0:l.admin)||{});return l!=null&&l.token&&(l!=null&&l.admin)&&this.client.authStore.save(l.token,h),Object.assign({},l,{token:(l==null?void 0:l.token)||"",admin:h})},r.prototype.authWithPassword=function(l,h,m,v){return m===void 0&&(m={}),v===void 0&&(v={}),m=Object.assign({identity:l,password:h},m),this.client.send(this.baseCrudPath+"/auth-with-password",{method:"POST",params:v,body:m}).then(this.authResponse.bind(this))},r.prototype.authRefresh=function(l,h){return l===void 0&&(l={}),h===void 0&&(h={}),this.client.send(this.baseCrudPath+"/auth-refresh",{method:"POST",params:h,body:l}).then(this.authResponse.bind(this))},r.prototype.requestPasswordReset=function(l,h,m){return h===void 0&&(h={}),m===void 0&&(m={}),h=Object.assign({email:l},h),this.client.send(this.baseCrudPath+"/request-password-reset",{method:"POST",params:m,body:h}).then(function(){return!0})},r.prototype.confirmPasswordReset=function(l,h,m,v,T){return v===void 0&&(v={}),T===void 0&&(T={}),v=Object.assign({token:l,password:h,passwordConfirm:m},v),this.client.send(this.baseCrudPath+"/confirm-password-reset",{method:"POST",params:T,body:v}).then(function(){return!0})},r}(sv),mR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.load=function(l){t.prototype.load.call(this,l),this.recordId=typeof l.recordId=="string"?l.recordId:"",this.collectionId=typeof l.collectionId=="string"?l.collectionId:"",this.provider=typeof l.provider=="string"?l.provider:"",this.providerId=typeof l.providerId=="string"?l.providerId:""},r}(Vd),gR=function(t){function r(l,h){var m=t.call(this,l)||this;return m.collectionIdOrName=h,m}return br(r,t),r.prototype.decode=function(l){return new sm(l)},Object.defineProperty(r.prototype,"baseCrudPath",{get:function(){return this.baseCollectionPath+"/records"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"baseCollectionPath",{get:function(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)},enumerable:!1,configurable:!0}),r.prototype.subscribeOne=function(l,h){return Cr(this,void 0,void 0,function(){return Mr(this,function(m){return console.warn("PocketBase: subscribeOne(recordId, callback) is deprecated. Please replace it with subscribe(recordId, callback)."),[2,this.client.realtime.subscribe(this.collectionIdOrName+"/"+l,h)]})})},r.prototype.subscribe=function(l,h){return Cr(this,void 0,void 0,function(){var m;return Mr(this,function(v){if(typeof l=="function")return console.warn("PocketBase: subscribe(callback) is deprecated. Please replace it with subscribe('*', callback)."),[2,this.client.realtime.subscribe(this.collectionIdOrName,l)];if(!h)throw new Error("Missing subscription callback.");if(l==="")throw new Error("Missing topic.");return m=this.collectionIdOrName,l!=="*"&&(m+="/"+l),[2,this.client.realtime.subscribe(m,h)]})})},r.prototype.unsubscribe=function(l){return Cr(this,void 0,void 0,function(){return Mr(this,function(h){return l==="*"?[2,this.client.realtime.unsubscribe(this.collectionIdOrName)]:l?[2,this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+l)]:[2,this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)]})})},r.prototype.getFullList=function(l,h){if(typeof l=="number")return t.prototype.getFullList.call(this,l,h);var m=Object.assign({},l,h);return t.prototype.getFullList.call(this,m)},r.prototype.getList=function(l,h,m){return l===void 0&&(l=1),h===void 0&&(h=30),m===void 0&&(m={}),t.prototype.getList.call(this,l,h,m)},r.prototype.getFirstListItem=function(l,h){return h===void 0&&(h={}),t.prototype.getFirstListItem.call(this,l,h)},r.prototype.getOne=function(l,h){return h===void 0&&(h={}),t.prototype.getOne.call(this,l,h)},r.prototype.create=function(l,h){return l===void 0&&(l={}),h===void 0&&(h={}),t.prototype.create.call(this,l,h)},r.prototype.update=function(l,h,m){var v=this;return h===void 0&&(h={}),m===void 0&&(m={}),t.prototype.update.call(this,l,h,m).then(function(T){var s,S,z;return((s=v.client.authStore.model)===null||s===void 0?void 0:s.id)!==(T==null?void 0:T.id)||((S=v.client.authStore.model)===null||S===void 0?void 0:S.collectionId)!==v.collectionIdOrName&&((z=v.client.authStore.model)===null||z===void 0?void 0:z.collectionName)!==v.collectionIdOrName||v.client.authStore.save(v.client.authStore.token,T),T})},r.prototype.delete=function(l,h){var m=this;return h===void 0&&(h={}),t.prototype.delete.call(this,l,h).then(function(v){var T,s,S;return!v||((T=m.client.authStore.model)===null||T===void 0?void 0:T.id)!==l||((s=m.client.authStore.model)===null||s===void 0?void 0:s.collectionId)!==m.collectionIdOrName&&((S=m.client.authStore.model)===null||S===void 0?void 0:S.collectionName)!==m.collectionIdOrName||m.client.authStore.clear(),v})},r.prototype.authResponse=function(l){var h=this.decode((l==null?void 0:l.record)||{});return this.client.authStore.save(l==null?void 0:l.token,h),Object.assign({},l,{token:(l==null?void 0:l.token)||"",record:h})},r.prototype.listAuthMethods=function(l){return l===void 0&&(l={}),this.client.send(this.baseCollectionPath+"/auth-methods",{method:"GET",params:l}).then(function(h){return Object.assign({},h,{usernamePassword:!!(h!=null&&h.usernamePassword),emailPassword:!!(h!=null&&h.emailPassword),authProviders:Array.isArray(h==null?void 0:h.authProviders)?h==null?void 0:h.authProviders:[]})})},r.prototype.authWithPassword=function(l,h,m,v){var T=this;return m===void 0&&(m={}),v===void 0&&(v={}),m=Object.assign({identity:l,password:h},m),this.client.send(this.baseCollectionPath+"/auth-with-password",{method:"POST",params:v,body:m}).then(function(s){return T.authResponse(s)})},r.prototype.authWithOAuth2=function(l,h,m,v,T,s,S){var z=this;return T===void 0&&(T={}),s===void 0&&(s={}),S===void 0&&(S={}),s=Object.assign({provider:l,code:h,codeVerifier:m,redirectUrl:v,createData:T},s),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",{method:"POST",params:S,body:s}).then(function(O){return z.authResponse(O)})},r.prototype.authRefresh=function(l,h){var m=this;return l===void 0&&(l={}),h===void 0&&(h={}),this.client.send(this.baseCollectionPath+"/auth-refresh",{method:"POST",params:h,body:l}).then(function(v){return m.authResponse(v)})},r.prototype.requestPasswordReset=function(l,h,m){return h===void 0&&(h={}),m===void 0&&(m={}),h=Object.assign({email:l},h),this.client.send(this.baseCollectionPath+"/request-password-reset",{method:"POST",params:m,body:h}).then(function(){return!0})},r.prototype.confirmPasswordReset=function(l,h,m,v,T){return v===void 0&&(v={}),T===void 0&&(T={}),v=Object.assign({token:l,password:h,passwordConfirm:m},v),this.client.send(this.baseCollectionPath+"/confirm-password-reset",{method:"POST",params:T,body:v}).then(function(){return!0})},r.prototype.requestVerification=function(l,h,m){return h===void 0&&(h={}),m===void 0&&(m={}),h=Object.assign({email:l},h),this.client.send(this.baseCollectionPath+"/request-verification",{method:"POST",params:m,body:h}).then(function(){return!0})},r.prototype.confirmVerification=function(l,h,m){return h===void 0&&(h={}),m===void 0&&(m={}),h=Object.assign({token:l},h),this.client.send(this.baseCollectionPath+"/confirm-verification",{method:"POST",params:m,body:h}).then(function(){return!0})},r.prototype.requestEmailChange=function(l,h,m){return h===void 0&&(h={}),m===void 0&&(m={}),h=Object.assign({newEmail:l},h),this.client.send(this.baseCollectionPath+"/request-email-change",{method:"POST",params:m,body:h}).then(function(){return!0})},r.prototype.confirmEmailChange=function(l,h,m,v){return m===void 0&&(m={}),v===void 0&&(v={}),m=Object.assign({token:l,password:h},m),this.client.send(this.baseCollectionPath+"/confirm-email-change",{method:"POST",params:v,body:m}).then(function(){return!0})},r.prototype.listExternalAuths=function(l,h){return h===void 0&&(h={}),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(l)+"/external-auths",{method:"GET",params:h}).then(function(m){var v=[];if(Array.isArray(m))for(var T=0,s=m;T<s.length;T++){var S=s[T];v.push(new mR(S))}return v})},r.prototype.unlinkExternalAuth=function(l,h,m){return m===void 0&&(m={}),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(l)+"/external-auths/"+encodeURIComponent(h),{method:"DELETE",params:m}).then(function(){return!0})},r}(sv),_R=function(){function t(r){r===void 0&&(r={}),this.load(r||{})}return t.prototype.load=function(r){this.id=r.id!==void 0?r.id:"",this.name=r.name!==void 0?r.name:"",this.type=r.type!==void 0?r.type:"text",this.system=!!r.system,this.required=!!r.required,this.unique=!!r.unique,this.options=typeof r.options=="object"&&r.options!==null?r.options:{}},t}(),yR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.load=function(l){t.prototype.load.call(this,l),this.system=!!l.system,this.name=typeof l.name=="string"?l.name:"",this.type=typeof l.type=="string"?l.type:"base",this.options=l.options!==void 0?l.options:{},this.listRule=typeof l.listRule=="string"?l.listRule:null,this.viewRule=typeof l.viewRule=="string"?l.viewRule:null,this.createRule=typeof l.createRule=="string"?l.createRule:null,this.updateRule=typeof l.updateRule=="string"?l.updateRule:null,this.deleteRule=typeof l.deleteRule=="string"?l.deleteRule:null,l.schema=Array.isArray(l.schema)?l.schema:[],this.schema=[];for(var h=0,m=l.schema;h<m.length;h++){var v=m[h];this.schema.push(new _R(v))}},Object.defineProperty(r.prototype,"isBase",{get:function(){return this.type==="base"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isAuth",{get:function(){return this.type==="auth"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isView",{get:function(){return this.type==="view"},enumerable:!1,configurable:!0}),r}(Vd),vR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.decode=function(l){return new yR(l)},Object.defineProperty(r.prototype,"baseCrudPath",{get:function(){return"/api/collections"},enumerable:!1,configurable:!0}),r.prototype.import=function(l,h,m){return h===void 0&&(h=!1),m===void 0&&(m={}),Cr(this,void 0,void 0,function(){return Mr(this,function(v){return[2,this.client.send(this.baseCrudPath+"/import",{method:"PUT",params:m,body:{collections:l,deleteMissing:h}}).then(function(){return!0})]})})},r}(sv),v1=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.load=function(l){t.prototype.load.call(this,l),l.remoteIp=l.remoteIp||l.ip,this.url=typeof l.url=="string"?l.url:"",this.method=typeof l.method=="string"?l.method:"GET",this.status=typeof l.status=="number"?l.status:200,this.auth=typeof l.auth=="string"?l.auth:"guest",this.remoteIp=typeof l.remoteIp=="string"?l.remoteIp:"",this.userIp=typeof l.userIp=="string"?l.userIp:"",this.referer=typeof l.referer=="string"?l.referer:"",this.userAgent=typeof l.userAgent=="string"?l.userAgent:"",this.meta=typeof l.meta=="object"&&l.meta!==null?l.meta:{}},r}(Vd),bR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.getRequestsList=function(l,h,m){return l===void 0&&(l=1),h===void 0&&(h=30),m===void 0&&(m={}),m=Object.assign({page:l,perPage:h},m),this.client.send("/api/logs/requests",{method:"GET",params:m}).then(function(v){var T=[];if(v!=null&&v.items){v.items=(v==null?void 0:v.items)||[];for(var s=0,S=v.items;s<S.length;s++){var z=S[s];T.push(new v1(z))}}return new VT((v==null?void 0:v.page)||1,(v==null?void 0:v.perPage)||0,(v==null?void 0:v.totalItems)||0,(v==null?void 0:v.totalPages)||0,T)})},r.prototype.getRequest=function(l,h){return h===void 0&&(h={}),this.client.send("/api/logs/requests/"+encodeURIComponent(l),{method:"GET",params:h}).then(function(m){return new v1(m)})},r.prototype.getRequestsStats=function(l){return l===void 0&&(l={}),this.client.send("/api/logs/requests/stats",{method:"GET",params:l}).then(function(h){return h})},r}(Gd),xR=function(t){function r(){var l=t!==null&&t.apply(this,arguments)||this;return l.clientId="",l.eventSource=null,l.subscriptions={},l.lastSentTopics=[],l.maxConnectTimeout=15e3,l.reconnectAttempts=0,l.maxReconnectAttempts=1/0,l.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],l.pendingConnects=[],l}return br(r,t),Object.defineProperty(r.prototype,"isConnected",{get:function(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length},enumerable:!1,configurable:!0}),r.prototype.subscribe=function(l,h){var m;return Cr(this,void 0,void 0,function(){var v,T=this;return Mr(this,function(s){switch(s.label){case 0:if(!l)throw new Error("topic must be set.");return v=function(S){var z,O=S;try{z=JSON.parse(O==null?void 0:O.data)}catch{}h(z||{})},this.subscriptions[l]||(this.subscriptions[l]=[]),this.subscriptions[l].push(v),this.isConnected?[3,2]:[4,this.connect()];case 1:return s.sent(),[3,5];case 2:return this.subscriptions[l].length!==1?[3,4]:[4,this.submitSubscriptions()];case 3:return s.sent(),[3,5];case 4:(m=this.eventSource)===null||m===void 0||m.addEventListener(l,v),s.label=5;case 5:return[2,function(){return Cr(T,void 0,void 0,function(){return Mr(this,function(S){return[2,this.unsubscribeByTopicAndListener(l,v)]})})}]}})})},r.prototype.unsubscribe=function(l){var h;return Cr(this,void 0,void 0,function(){var m,v,T;return Mr(this,function(s){switch(s.label){case 0:if(!this.hasSubscriptionListeners(l))return[2];if(l){for(m=0,v=this.subscriptions[l];m<v.length;m++)T=v[m],(h=this.eventSource)===null||h===void 0||h.removeEventListener(l,T);delete this.subscriptions[l]}else this.subscriptions={};return this.hasSubscriptionListeners()?[3,1]:(this.disconnect(),[3,3]);case 1:return this.hasSubscriptionListeners(l)?[3,3]:[4,this.submitSubscriptions()];case 2:s.sent(),s.label=3;case 3:return[2]}})})},r.prototype.unsubscribeByPrefix=function(l){var h;return Cr(this,void 0,void 0,function(){var m,v,T,s,S;return Mr(this,function(z){switch(z.label){case 0:for(v in m=!1,this.subscriptions)if(v.startsWith(l)){for(m=!0,T=0,s=this.subscriptions[v];T<s.length;T++)S=s[T],(h=this.eventSource)===null||h===void 0||h.removeEventListener(v,S);delete this.subscriptions[v]}return m?this.hasSubscriptionListeners()?[4,this.submitSubscriptions()]:[3,2]:[2];case 1:return z.sent(),[3,3];case 2:this.disconnect(),z.label=3;case 3:return[2]}})})},r.prototype.unsubscribeByTopicAndListener=function(l,h){var m;return Cr(this,void 0,void 0,function(){var v,T;return Mr(this,function(s){switch(s.label){case 0:if(!Array.isArray(this.subscriptions[l])||!this.subscriptions[l].length)return[2];for(v=!1,T=this.subscriptions[l].length-1;T>=0;T--)this.subscriptions[l][T]===h&&(v=!0,delete this.subscriptions[l][T],this.subscriptions[l].splice(T,1),(m=this.eventSource)===null||m===void 0||m.removeEventListener(l,h));return v?(this.subscriptions[l].length||delete this.subscriptions[l],this.hasSubscriptionListeners()?[3,1]:(this.disconnect(),[3,3])):[2];case 1:return this.hasSubscriptionListeners(l)?[3,3]:[4,this.submitSubscriptions()];case 2:s.sent(),s.label=3;case 3:return[2]}})})},r.prototype.hasSubscriptionListeners=function(l){var h,m;if(this.subscriptions=this.subscriptions||{},l)return!!(!((h=this.subscriptions[l])===null||h===void 0)&&h.length);for(var v in this.subscriptions)if(!((m=this.subscriptions[v])===null||m===void 0)&&m.length)return!0;return!1},r.prototype.submitSubscriptions=function(){return Cr(this,void 0,void 0,function(){return Mr(this,function(l){return this.clientId?(this.addAllSubscriptionListeners(),this.lastSentTopics=this.getNonEmptySubscriptionTopics(),[2,this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentTopics},params:{$cancelKey:"realtime_"+this.clientId}}).catch(function(h){if(!(h!=null&&h.isAbort))throw h})]):[2]})})},r.prototype.getNonEmptySubscriptionTopics=function(){var l=[];for(var h in this.subscriptions)this.subscriptions[h].length&&l.push(h);return l},r.prototype.addAllSubscriptionListeners=function(){if(this.eventSource)for(var l in this.removeAllSubscriptionListeners(),this.subscriptions)for(var h=0,m=this.subscriptions[l];h<m.length;h++){var v=m[h];this.eventSource.addEventListener(l,v)}},r.prototype.removeAllSubscriptionListeners=function(){if(this.eventSource)for(var l in this.subscriptions)for(var h=0,m=this.subscriptions[l];h<m.length;h++){var v=m[h];this.eventSource.removeEventListener(l,v)}},r.prototype.connect=function(){return Cr(this,void 0,void 0,function(){var l=this;return Mr(this,function(h){return this.reconnectAttempts>0?[2]:[2,new Promise(function(m,v){l.pendingConnects.push({resolve:m,reject:v}),l.pendingConnects.length>1||l.initConnect()})]})})},r.prototype.initConnect=function(){var l=this;this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(function(){l.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=function(h){l.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",function(h){var m=h;l.clientId=m==null?void 0:m.lastEventId,l.submitSubscriptions().then(function(){return Cr(l,void 0,void 0,function(){var v;return Mr(this,function(T){switch(T.label){case 0:v=3,T.label=1;case 1:return this.hasUnsentSubscriptions()&&v>0?(v--,[4,this.submitSubscriptions()]):[3,3];case 2:return T.sent(),[3,1];case 3:return[2]}})})}).then(function(){for(var v=0,T=l.pendingConnects;v<T.length;v++)T[v].resolve();l.pendingConnects=[],l.reconnectAttempts=0,clearTimeout(l.reconnectTimeoutId),clearTimeout(l.connectTimeoutId)}).catch(function(v){l.clientId="",l.connectErrorHandler(v)})})},r.prototype.hasUnsentSubscriptions=function(){var l=this.getNonEmptySubscriptionTopics();if(l.length!=this.lastSentTopics.length)return!0;for(var h=0,m=l;h<m.length;h++){var v=m[h];if(!this.lastSentTopics.includes(v))return!0}return!1},r.prototype.connectErrorHandler=function(l){var h=this;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(var m=0,v=this.pendingConnects;m<v.length;m++)v[m].reject(new Id(l));this.disconnect()}else{this.disconnect(!0);var T=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(function(){h.initConnect()},T)}},r.prototype.disconnect=function(l){var h;if(l===void 0&&(l=!1),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),(h=this.eventSource)===null||h===void 0||h.close(),this.eventSource=null,this.clientId="",!l){this.reconnectAttempts=0;for(var m=new Id(new Error("Realtime disconnected.")),v=0,T=this.pendingConnects;v<T.length;v++)T[v].reject(m);this.pendingConnects=[]}},r}(Gd),wR=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return br(r,t),r.prototype.check=function(l){return l===void 0&&(l={}),this.client.send("/api/health",{method:"GET",params:l})},r}(Gd),TR=function(){function t(r,l,h){r===void 0&&(r="/"),h===void 0&&(h="en-US"),this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=r,this.lang=h,this.authStore=l||new dR,this.admins=new fR(this),this.collections=new vR(this),this.logs=new bR(this),this.settings=new pR(this),this.realtime=new xR(this),this.health=new wR(this)}return t.prototype.collection=function(r){return this.recordServices[r]||(this.recordServices[r]=new gR(this,r)),this.recordServices[r]},t.prototype.autoCancellation=function(r){return this.enableAutoCancellation=!!r,this},t.prototype.cancelRequest=function(r){return this.cancelControllers[r]&&(this.cancelControllers[r].abort(),delete this.cancelControllers[r]),this},t.prototype.cancelAllRequests=function(){for(var r in this.cancelControllers)this.cancelControllers[r].abort();return this.cancelControllers={},this},t.prototype.send=function(r,l){var h,m,v,T,s,S,z,O;return Cr(this,void 0,void 0,function(){var B,Z,me,_e,Ie,Te,ve=this;return Mr(this,function($e){return(B=Object.assign({method:"GET"},l)).body&&B.body.constructor.name!=="FormData"&&(typeof B.body!="string"&&(B.body=JSON.stringify(B.body)),((h=B==null?void 0:B.headers)===null||h===void 0?void 0:h["Content-Type"])===void 0&&(B.headers=Object.assign({},B.headers,{"Content-Type":"application/json"}))),((m=B==null?void 0:B.headers)===null||m===void 0?void 0:m["Accept-Language"])===void 0&&(B.headers=Object.assign({},B.headers,{"Accept-Language":this.lang})),!((v=this.authStore)===null||v===void 0)&&v.token&&((T=B==null?void 0:B.headers)===null||T===void 0?void 0:T.Authorization)===void 0&&(B.headers=Object.assign({},B.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&((s=B.params)===null||s===void 0?void 0:s.$autoCancel)!==!1&&(Z=((S=B.params)===null||S===void 0?void 0:S.$cancelKey)||(B.method||"GET")+r,this.cancelRequest(Z),me=new AbortController,this.cancelControllers[Z]=me,B.signal=me.signal),(z=B.params)===null||z===void 0||delete z.$autoCancel,(O=B.params)===null||O===void 0||delete O.$cancelKey,_e=this.buildUrl(r),B.params!==void 0&&((Ie=this.serializeQueryParams(B.params))&&(_e+=(_e.includes("?")?"&":"?")+Ie),delete B.params),this.beforeSend&&((Te=Object.assign({},this.beforeSend(_e,B))).url!==void 0||Te.options!==void 0?(_e=Te.url||_e,B=Te.options||B):Object.keys(Te).length&&(B=Te,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))),[2,fetch(_e,B).then(function(Fe){return Cr(ve,void 0,void 0,function(){var qe;return Mr(this,function(fe){switch(fe.label){case 0:qe={},fe.label=1;case 1:return fe.trys.push([1,3,,4]),[4,Fe.json()];case 2:return qe=fe.sent(),[3,4];case 3:return fe.sent(),[3,4];case 4:if(this.afterSend&&(qe=this.afterSend(Fe,qe)),Fe.status>=400)throw new Id({url:Fe.url,status:Fe.status,data:qe});return[2,qe]}})})}).catch(function(Fe){throw new Id(Fe)})]})})},t.prototype.getFileUrl=function(r,l,h){h===void 0&&(h={});var m=[];m.push("api"),m.push("files"),m.push(encodeURIComponent(r.collectionId||r.collectionName)),m.push(encodeURIComponent(r.id)),m.push(encodeURIComponent(l));var v=this.buildUrl(m.join("/"));if(Object.keys(h).length){var T=new URLSearchParams(h);v+=(v.includes("?")?"&":"?")+T}return v},t.prototype.buildUrl=function(r){var l=this.baseUrl+(this.baseUrl.endsWith("/")?"":"/");return r&&(l+=r.startsWith("/")?r.substring(1):r),l},t.prototype.serializeQueryParams=function(r){var l=[];for(var h in r)if(r[h]!==null){var m=r[h],v=encodeURIComponent(h);if(Array.isArray(m))for(var T=0,s=m;T<s.length;T++){var S=s[T];l.push(v+"="+encodeURIComponent(S))}else m instanceof Date?l.push(v+"="+encodeURIComponent(m.toISOString())):typeof m!==null&&typeof m=="object"?l.push(v+"="+encodeURIComponent(JSON.stringify(m))):l.push(v+"="+encodeURIComponent(m))}return l.join("&")},t}();const ER={}.VITE_API_URL&&{}.VITE_API_URL!==!0?{}.VITE_API_URL:"https://dev.journiz.leoboyer.dev",kR=new TR(ER),GT=()=>kR;var Yn;(function(t){t.assertEqual=m=>m;function r(m){}t.assertIs=r;function l(m){throw new Error}t.assertNever=l,t.arrayToEnum=m=>{const v={};for(const T of m)v[T]=T;return v},t.getValidEnumValues=m=>{const v=t.objectKeys(m).filter(s=>typeof m[m[s]]!="number"),T={};for(const s of v)T[s]=m[s];return t.objectValues(T)},t.objectValues=m=>t.objectKeys(m).map(function(v){return m[v]}),t.objectKeys=typeof Object.keys=="function"?m=>Object.keys(m):m=>{const v=[];for(const T in m)Object.prototype.hasOwnProperty.call(m,T)&&v.push(T);return v},t.find=(m,v)=>{for(const T of m)if(v(T))return T},t.isInteger=typeof Number.isInteger=="function"?m=>Number.isInteger(m):m=>typeof m=="number"&&isFinite(m)&&Math.floor(m)===m;function h(m,v=" | "){return m.map(T=>typeof T=="string"?`'${T}'`:T).join(v)}t.joinValues=h,t.jsonStringifyReplacer=(m,v)=>typeof v=="bigint"?v.toString():v})(Yn||(Yn={}));var uy;(function(t){t.mergeShapes=(r,l)=>({...r,...l})})(uy||(uy={}));const Pt=Yn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ca=t=>{switch(typeof t){case"undefined":return Pt.undefined;case"string":return Pt.string;case"number":return isNaN(t)?Pt.nan:Pt.number;case"boolean":return Pt.boolean;case"function":return Pt.function;case"bigint":return Pt.bigint;case"symbol":return Pt.symbol;case"object":return Array.isArray(t)?Pt.array:t===null?Pt.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?Pt.promise:typeof Map<"u"&&t instanceof Map?Pt.map:typeof Set<"u"&&t instanceof Set?Pt.set:typeof Date<"u"&&t instanceof Date?Pt.date:Pt.object;default:return Pt.unknown}},bt=Yn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),SR=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Oo extends Error{constructor(r){super(),this.issues=[],this.addIssue=h=>{this.issues=[...this.issues,h]},this.addIssues=(h=[])=>{this.issues=[...this.issues,...h]};const l=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,l):this.__proto__=l,this.name="ZodError",this.issues=r}get errors(){return this.issues}format(r){const l=r||function(v){return v.message},h={_errors:[]},m=v=>{for(const T of v.issues)if(T.code==="invalid_union")T.unionErrors.map(m);else if(T.code==="invalid_return_type")m(T.returnTypeError);else if(T.code==="invalid_arguments")m(T.argumentsError);else if(T.path.length===0)h._errors.push(l(T));else{let s=h,S=0;for(;S<T.path.length;){const z=T.path[S];S===T.path.length-1?(s[z]=s[z]||{_errors:[]},s[z]._errors.push(l(T))):s[z]=s[z]||{_errors:[]},s=s[z],S++}}};return m(this),h}toString(){return this.message}get message(){return JSON.stringify(this.issues,Yn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=l=>l.message){const l={},h=[];for(const m of this.issues)m.path.length>0?(l[m.path[0]]=l[m.path[0]]||[],l[m.path[0]].push(r(m))):h.push(r(m));return{formErrors:h,fieldErrors:l}}get formErrors(){return this.flatten()}}Oo.create=t=>new Oo(t);const Cd=(t,r)=>{let l;switch(t.code){case bt.invalid_type:t.received===Pt.undefined?l="Required":l=`Expected ${t.expected}, received ${t.received}`;break;case bt.invalid_literal:l=`Invalid literal value, expected ${JSON.stringify(t.expected,Yn.jsonStringifyReplacer)}`;break;case bt.unrecognized_keys:l=`Unrecognized key(s) in object: ${Yn.joinValues(t.keys,", ")}`;break;case bt.invalid_union:l="Invalid input";break;case bt.invalid_union_discriminator:l=`Invalid discriminator value. Expected ${Yn.joinValues(t.options)}`;break;case bt.invalid_enum_value:l=`Invalid enum value. Expected ${Yn.joinValues(t.options)}, received '${t.received}'`;break;case bt.invalid_arguments:l="Invalid function arguments";break;case bt.invalid_return_type:l="Invalid function return type";break;case bt.invalid_date:l="Invalid date";break;case bt.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(l=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(l=`${l} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?l=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?l=`Invalid input: must end with "${t.validation.endsWith}"`:Yn.assertNever(t.validation):t.validation!=="regex"?l=`Invalid ${t.validation}`:l="Invalid";break;case bt.too_small:t.type==="array"?l=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?l=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?l=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?l=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:l="Invalid input";break;case bt.too_big:t.type==="array"?l=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?l=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?l=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?l=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?l=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:l="Invalid input";break;case bt.custom:l="Invalid input";break;case bt.invalid_intersection_types:l="Intersection results could not be merged";break;case bt.not_multiple_of:l=`Number must be a multiple of ${t.multipleOf}`;break;case bt.not_finite:l="Number must be finite";break;default:l=r.defaultError,Yn.assertNever(t)}return{message:l}};let ZT=Cd;function AR(t){ZT=t}function am(){return ZT}const lm=t=>{const{data:r,path:l,errorMaps:h,issueData:m}=t,v=[...l,...m.path||[]],T={...m,path:v};let s="";const S=h.filter(z=>!!z).slice().reverse();for(const z of S)s=z(T,{data:r,defaultError:s}).message;return{...m,path:v,message:m.message||s}},IR=[];function Ot(t,r){const l=lm({issueData:r,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,am(),Cd].filter(h=>!!h)});t.common.issues.push(l)}class xr{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,l){const h=[];for(const m of l){if(m.status==="aborted")return mn;m.status==="dirty"&&r.dirty(),h.push(m.value)}return{status:r.value,value:h}}static async mergeObjectAsync(r,l){const h=[];for(const m of l)h.push({key:await m.key,value:await m.value});return xr.mergeObjectSync(r,h)}static mergeObjectSync(r,l){const h={};for(const m of l){const{key:v,value:T}=m;if(v.status==="aborted"||T.status==="aborted")return mn;v.status==="dirty"&&r.dirty(),T.status==="dirty"&&r.dirty(),(typeof T.value<"u"||m.alwaysSet)&&(h[v.value]=T.value)}return{status:r.value,value:h}}}const mn=Object.freeze({status:"aborted"}),qT=t=>({status:"dirty",value:t}),Rr=t=>({status:"valid",value:t}),hy=t=>t.status==="aborted",dy=t=>t.status==="dirty",cm=t=>t.status==="valid",um=t=>typeof Promise<"u"&&t instanceof Promise;var Yt;(function(t){t.errToObj=r=>typeof r=="string"?{message:r}:r||{},t.toString=r=>typeof r=="string"?r:r==null?void 0:r.message})(Yt||(Yt={}));class ds{constructor(r,l,h,m){this._cachedPath=[],this.parent=r,this.data=l,this._path=h,this._key=m}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const b1=(t,r)=>{if(cm(r))return{success:!0,data:r.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const l=new Oo(t.common.issues);return this._error=l,this._error}}};function bn(t){if(!t)return{};const{errorMap:r,invalid_type_error:l,required_error:h,description:m}=t;if(r&&(l||h))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:m}:{errorMap:(T,s)=>T.code!=="invalid_type"?{message:s.defaultError}:typeof s.data>"u"?{message:h??s.defaultError}:{message:l??s.defaultError},description:m}}class Sn{constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(r){return Ca(r.data)}_getOrReturnCtx(r,l){return l||{common:r.parent.common,data:r.data,parsedType:Ca(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new xr,ctx:{common:r.parent.common,data:r.data,parsedType:Ca(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){const l=this._parse(r);if(um(l))throw new Error("Synchronous parse encountered promise.");return l}_parseAsync(r){const l=this._parse(r);return Promise.resolve(l)}parse(r,l){const h=this.safeParse(r,l);if(h.success)return h.data;throw h.error}safeParse(r,l){var h;const m={common:{issues:[],async:(h=l==null?void 0:l.async)!==null&&h!==void 0?h:!1,contextualErrorMap:l==null?void 0:l.errorMap},path:(l==null?void 0:l.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:Ca(r)},v=this._parseSync({data:r,path:m.path,parent:m});return b1(m,v)}async parseAsync(r,l){const h=await this.safeParseAsync(r,l);if(h.success)return h.data;throw h.error}async safeParseAsync(r,l){const h={common:{issues:[],contextualErrorMap:l==null?void 0:l.errorMap,async:!0},path:(l==null?void 0:l.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:Ca(r)},m=this._parse({data:r,path:h.path,parent:h}),v=await(um(m)?m:Promise.resolve(m));return b1(h,v)}refine(r,l){const h=m=>typeof l=="string"||typeof l>"u"?{message:l}:typeof l=="function"?l(m):l;return this._refinement((m,v)=>{const T=r(m),s=()=>v.addIssue({code:bt.custom,...h(m)});return typeof Promise<"u"&&T instanceof Promise?T.then(S=>S?!0:(s(),!1)):T?!0:(s(),!1)})}refinement(r,l){return this._refinement((h,m)=>r(h)?!0:(m.addIssue(typeof l=="function"?l(h,m):l),!1))}_refinement(r){return new jo({schema:this,typeName:tn.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}optional(){return js.create(this,this._def)}nullable(){return Ql.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Bo.create(this,this._def)}promise(){return Lu.create(this,this._def)}or(r){return zd.create([this,r],this._def)}and(r){return Rd.create(this,r,this._def)}transform(r){return new jo({...bn(this._def),schema:this,typeName:tn.ZodEffects,effect:{type:"transform",transform:r}})}default(r){const l=typeof r=="function"?r:()=>r;return new jd({...bn(this._def),innerType:this,defaultValue:l,typeName:tn.ZodDefault})}brand(){return new HT({typeName:tn.ZodBranded,type:this,...bn(this._def)})}catch(r){const l=typeof r=="function"?r:()=>r;return new fm({...bn(this._def),innerType:this,catchValue:l,typeName:tn.ZodCatch})}describe(r){const l=this.constructor;return new l({...this._def,description:r})}pipe(r){return Zd.create(this,r)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const CR=/^c[^\s-]{8,}$/i,MR=/^[a-z][a-z0-9]*$/,PR=/[0-9A-HJKMNP-TV-Z]{26}/,LR=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,zR=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,RR=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,DR=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,OR=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,BR=t=>t.precision?t.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}Z$`):t.precision===0?t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function FR(t,r){return!!((r==="v4"||!r)&&DR.test(t)||(r==="v6"||!r)&&OR.test(t))}class Lo extends Sn{constructor(){super(...arguments),this._regex=(r,l,h)=>this.refinement(m=>r.test(m),{validation:l,code:bt.invalid_string,...Yt.errToObj(h)}),this.nonempty=r=>this.min(1,Yt.errToObj(r)),this.trim=()=>new Lo({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new Lo({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new Lo({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==Pt.string){const v=this._getOrReturnCtx(r);return Ot(v,{code:bt.invalid_type,expected:Pt.string,received:v.parsedType}),mn}const h=new xr;let m;for(const v of this._def.checks)if(v.kind==="min")r.data.length<v.value&&(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),h.dirty());else if(v.kind==="max")r.data.length>v.value&&(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),h.dirty());else if(v.kind==="length"){const T=r.data.length>v.value,s=r.data.length<v.value;(T||s)&&(m=this._getOrReturnCtx(r,m),T?Ot(m,{code:bt.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}):s&&Ot(m,{code:bt.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}),h.dirty())}else if(v.kind==="email")zR.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"email",code:bt.invalid_string,message:v.message}),h.dirty());else if(v.kind==="emoji")RR.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"emoji",code:bt.invalid_string,message:v.message}),h.dirty());else if(v.kind==="uuid")LR.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"uuid",code:bt.invalid_string,message:v.message}),h.dirty());else if(v.kind==="cuid")CR.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"cuid",code:bt.invalid_string,message:v.message}),h.dirty());else if(v.kind==="cuid2")MR.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"cuid2",code:bt.invalid_string,message:v.message}),h.dirty());else if(v.kind==="ulid")PR.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"ulid",code:bt.invalid_string,message:v.message}),h.dirty());else if(v.kind==="url")try{new URL(r.data)}catch{m=this._getOrReturnCtx(r,m),Ot(m,{validation:"url",code:bt.invalid_string,message:v.message}),h.dirty()}else v.kind==="regex"?(v.regex.lastIndex=0,v.regex.test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"regex",code:bt.invalid_string,message:v.message}),h.dirty())):v.kind==="trim"?r.data=r.data.trim():v.kind==="includes"?r.data.includes(v.value,v.position)||(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.invalid_string,validation:{includes:v.value,position:v.position},message:v.message}),h.dirty()):v.kind==="toLowerCase"?r.data=r.data.toLowerCase():v.kind==="toUpperCase"?r.data=r.data.toUpperCase():v.kind==="startsWith"?r.data.startsWith(v.value)||(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.invalid_string,validation:{startsWith:v.value},message:v.message}),h.dirty()):v.kind==="endsWith"?r.data.endsWith(v.value)||(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.invalid_string,validation:{endsWith:v.value},message:v.message}),h.dirty()):v.kind==="datetime"?BR(v).test(r.data)||(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.invalid_string,validation:"datetime",message:v.message}),h.dirty()):v.kind==="ip"?FR(r.data,v.version)||(m=this._getOrReturnCtx(r,m),Ot(m,{validation:"ip",code:bt.invalid_string,message:v.message}),h.dirty()):Yn.assertNever(v);return{status:h.value,value:r.data}}_addCheck(r){return new Lo({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...Yt.errToObj(r)})}url(r){return this._addCheck({kind:"url",...Yt.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...Yt.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...Yt.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...Yt.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...Yt.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...Yt.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...Yt.errToObj(r)})}datetime(r){var l;return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,offset:(l=r==null?void 0:r.offset)!==null&&l!==void 0?l:!1,...Yt.errToObj(r==null?void 0:r.message)})}regex(r,l){return this._addCheck({kind:"regex",regex:r,...Yt.errToObj(l)})}includes(r,l){return this._addCheck({kind:"includes",value:r,position:l==null?void 0:l.position,...Yt.errToObj(l==null?void 0:l.message)})}startsWith(r,l){return this._addCheck({kind:"startsWith",value:r,...Yt.errToObj(l)})}endsWith(r,l){return this._addCheck({kind:"endsWith",value:r,...Yt.errToObj(l)})}min(r,l){return this._addCheck({kind:"min",value:r,...Yt.errToObj(l)})}max(r,l){return this._addCheck({kind:"max",value:r,...Yt.errToObj(l)})}length(r,l){return this._addCheck({kind:"length",value:r,...Yt.errToObj(l)})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get minLength(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r}get maxLength(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r}}Lo.create=t=>{var r;return new Lo({checks:[],typeName:tn.ZodString,coerce:(r=t==null?void 0:t.coerce)!==null&&r!==void 0?r:!1,...bn(t)})};function jR(t,r){const l=(t.toString().split(".")[1]||"").length,h=(r.toString().split(".")[1]||"").length,m=l>h?l:h,v=parseInt(t.toFixed(m).replace(".","")),T=parseInt(r.toFixed(m).replace(".",""));return v%T/Math.pow(10,m)}class Fa extends Sn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==Pt.number){const v=this._getOrReturnCtx(r);return Ot(v,{code:bt.invalid_type,expected:Pt.number,received:v.parsedType}),mn}let h;const m=new xr;for(const v of this._def.checks)v.kind==="int"?Yn.isInteger(r.data)||(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.invalid_type,expected:"integer",received:"float",message:v.message}),m.dirty()):v.kind==="min"?(v.inclusive?r.data<v.value:r.data<=v.value)&&(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.too_small,minimum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),m.dirty()):v.kind==="max"?(v.inclusive?r.data>v.value:r.data>=v.value)&&(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.too_big,maximum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),m.dirty()):v.kind==="multipleOf"?jR(r.data,v.value)!==0&&(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.not_multiple_of,multipleOf:v.value,message:v.message}),m.dirty()):v.kind==="finite"?Number.isFinite(r.data)||(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.not_finite,message:v.message}),m.dirty()):Yn.assertNever(v);return{status:m.value,value:r.data}}gte(r,l){return this.setLimit("min",r,!0,Yt.toString(l))}gt(r,l){return this.setLimit("min",r,!1,Yt.toString(l))}lte(r,l){return this.setLimit("max",r,!0,Yt.toString(l))}lt(r,l){return this.setLimit("max",r,!1,Yt.toString(l))}setLimit(r,l,h,m){return new Fa({...this._def,checks:[...this._def.checks,{kind:r,value:l,inclusive:h,message:Yt.toString(m)}]})}_addCheck(r){return new Fa({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:Yt.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Yt.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Yt.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Yt.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Yt.toString(r)})}multipleOf(r,l){return this._addCheck({kind:"multipleOf",value:r,message:Yt.toString(l)})}finite(r){return this._addCheck({kind:"finite",message:Yt.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Yt.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Yt.toString(r)})}get minValue(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r}get maxValue(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&Yn.isInteger(r.value))}get isFinite(){let r=null,l=null;for(const h of this._def.checks){if(h.kind==="finite"||h.kind==="int"||h.kind==="multipleOf")return!0;h.kind==="min"?(l===null||h.value>l)&&(l=h.value):h.kind==="max"&&(r===null||h.value<r)&&(r=h.value)}return Number.isFinite(l)&&Number.isFinite(r)}}Fa.create=t=>new Fa({checks:[],typeName:tn.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...bn(t)});class ja extends Sn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce&&(r.data=BigInt(r.data)),this._getType(r)!==Pt.bigint){const v=this._getOrReturnCtx(r);return Ot(v,{code:bt.invalid_type,expected:Pt.bigint,received:v.parsedType}),mn}let h;const m=new xr;for(const v of this._def.checks)v.kind==="min"?(v.inclusive?r.data<v.value:r.data<=v.value)&&(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.too_small,type:"bigint",minimum:v.value,inclusive:v.inclusive,message:v.message}),m.dirty()):v.kind==="max"?(v.inclusive?r.data>v.value:r.data>=v.value)&&(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.too_big,type:"bigint",maximum:v.value,inclusive:v.inclusive,message:v.message}),m.dirty()):v.kind==="multipleOf"?r.data%v.value!==BigInt(0)&&(h=this._getOrReturnCtx(r,h),Ot(h,{code:bt.not_multiple_of,multipleOf:v.value,message:v.message}),m.dirty()):Yn.assertNever(v);return{status:m.value,value:r.data}}gte(r,l){return this.setLimit("min",r,!0,Yt.toString(l))}gt(r,l){return this.setLimit("min",r,!1,Yt.toString(l))}lte(r,l){return this.setLimit("max",r,!0,Yt.toString(l))}lt(r,l){return this.setLimit("max",r,!1,Yt.toString(l))}setLimit(r,l,h,m){return new ja({...this._def,checks:[...this._def.checks,{kind:r,value:l,inclusive:h,message:Yt.toString(m)}]})}_addCheck(r){return new ja({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Yt.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Yt.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Yt.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Yt.toString(r)})}multipleOf(r,l){return this._addCheck({kind:"multipleOf",value:r,message:Yt.toString(l)})}get minValue(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r}get maxValue(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r}}ja.create=t=>{var r;return new ja({checks:[],typeName:tn.ZodBigInt,coerce:(r=t==null?void 0:t.coerce)!==null&&r!==void 0?r:!1,...bn(t)})};class Md extends Sn{_parse(r){if(this._def.coerce&&(r.data=Boolean(r.data)),this._getType(r)!==Pt.boolean){const h=this._getOrReturnCtx(r);return Ot(h,{code:bt.invalid_type,expected:Pt.boolean,received:h.parsedType}),mn}return Rr(r.data)}}Md.create=t=>new Md({typeName:tn.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...bn(t)});class Yl extends Sn{_parse(r){if(this._def.coerce&&(r.data=new Date(r.data)),this._getType(r)!==Pt.date){const v=this._getOrReturnCtx(r);return Ot(v,{code:bt.invalid_type,expected:Pt.date,received:v.parsedType}),mn}if(isNaN(r.data.getTime())){const v=this._getOrReturnCtx(r);return Ot(v,{code:bt.invalid_date}),mn}const h=new xr;let m;for(const v of this._def.checks)v.kind==="min"?r.data.getTime()<v.value&&(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.too_small,message:v.message,inclusive:!0,exact:!1,minimum:v.value,type:"date"}),h.dirty()):v.kind==="max"?r.data.getTime()>v.value&&(m=this._getOrReturnCtx(r,m),Ot(m,{code:bt.too_big,message:v.message,inclusive:!0,exact:!1,maximum:v.value,type:"date"}),h.dirty()):Yn.assertNever(v);return{status:h.value,value:new Date(r.data.getTime())}}_addCheck(r){return new Yl({...this._def,checks:[...this._def.checks,r]})}min(r,l){return this._addCheck({kind:"min",value:r.getTime(),message:Yt.toString(l)})}max(r,l){return this._addCheck({kind:"max",value:r.getTime(),message:Yt.toString(l)})}get minDate(){let r=null;for(const l of this._def.checks)l.kind==="min"&&(r===null||l.value>r)&&(r=l.value);return r!=null?new Date(r):null}get maxDate(){let r=null;for(const l of this._def.checks)l.kind==="max"&&(r===null||l.value<r)&&(r=l.value);return r!=null?new Date(r):null}}Yl.create=t=>new Yl({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:tn.ZodDate,...bn(t)});class hm extends Sn{_parse(r){if(this._getType(r)!==Pt.symbol){const h=this._getOrReturnCtx(r);return Ot(h,{code:bt.invalid_type,expected:Pt.symbol,received:h.parsedType}),mn}return Rr(r.data)}}hm.create=t=>new hm({typeName:tn.ZodSymbol,...bn(t)});class Pd extends Sn{_parse(r){if(this._getType(r)!==Pt.undefined){const h=this._getOrReturnCtx(r);return Ot(h,{code:bt.invalid_type,expected:Pt.undefined,received:h.parsedType}),mn}return Rr(r.data)}}Pd.create=t=>new Pd({typeName:tn.ZodUndefined,...bn(t)});class Ld extends Sn{_parse(r){if(this._getType(r)!==Pt.null){const h=this._getOrReturnCtx(r);return Ot(h,{code:bt.invalid_type,expected:Pt.null,received:h.parsedType}),mn}return Rr(r.data)}}Ld.create=t=>new Ld({typeName:tn.ZodNull,...bn(t)});class Pu extends Sn{constructor(){super(...arguments),this._any=!0}_parse(r){return Rr(r.data)}}Pu.create=t=>new Pu({typeName:tn.ZodAny,...bn(t)});class Hl extends Sn{constructor(){super(...arguments),this._unknown=!0}_parse(r){return Rr(r.data)}}Hl.create=t=>new Hl({typeName:tn.ZodUnknown,...bn(t)});class $s extends Sn{_parse(r){const l=this._getOrReturnCtx(r);return Ot(l,{code:bt.invalid_type,expected:Pt.never,received:l.parsedType}),mn}}$s.create=t=>new $s({typeName:tn.ZodNever,...bn(t)});class dm extends Sn{_parse(r){if(this._getType(r)!==Pt.undefined){const h=this._getOrReturnCtx(r);return Ot(h,{code:bt.invalid_type,expected:Pt.void,received:h.parsedType}),mn}return Rr(r.data)}}dm.create=t=>new dm({typeName:tn.ZodVoid,...bn(t)});class Bo extends Sn{_parse(r){const{ctx:l,status:h}=this._processInputParams(r),m=this._def;if(l.parsedType!==Pt.array)return Ot(l,{code:bt.invalid_type,expected:Pt.array,received:l.parsedType}),mn;if(m.exactLength!==null){const T=l.data.length>m.exactLength.value,s=l.data.length<m.exactLength.value;(T||s)&&(Ot(l,{code:T?bt.too_big:bt.too_small,minimum:s?m.exactLength.value:void 0,maximum:T?m.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:m.exactLength.message}),h.dirty())}if(m.minLength!==null&&l.data.length<m.minLength.value&&(Ot(l,{code:bt.too_small,minimum:m.minLength.value,type:"array",inclusive:!0,exact:!1,message:m.minLength.message}),h.dirty()),m.maxLength!==null&&l.data.length>m.maxLength.value&&(Ot(l,{code:bt.too_big,maximum:m.maxLength.value,type:"array",inclusive:!0,exact:!1,message:m.maxLength.message}),h.dirty()),l.common.async)return Promise.all([...l.data].map((T,s)=>m.type._parseAsync(new ds(l,T,l.path,s)))).then(T=>xr.mergeArray(h,T));const v=[...l.data].map((T,s)=>m.type._parseSync(new ds(l,T,l.path,s)));return xr.mergeArray(h,v)}get element(){return this._def.type}min(r,l){return new Bo({...this._def,minLength:{value:r,message:Yt.toString(l)}})}max(r,l){return new Bo({...this._def,maxLength:{value:r,message:Yt.toString(l)}})}length(r,l){return new Bo({...this._def,exactLength:{value:r,message:Yt.toString(l)}})}nonempty(r){return this.min(1,r)}}Bo.create=(t,r)=>new Bo({type:t,minLength:null,maxLength:null,exactLength:null,typeName:tn.ZodArray,...bn(r)});function mu(t){if(t instanceof Ai){const r={};for(const l in t.shape){const h=t.shape[l];r[l]=js.create(mu(h))}return new Ai({...t._def,shape:()=>r})}else return t instanceof Bo?new Bo({...t._def,type:mu(t.element)}):t instanceof js?js.create(mu(t.unwrap())):t instanceof Ql?Ql.create(mu(t.unwrap())):t instanceof ps?ps.create(t.items.map(r=>mu(r))):t}class Ai extends Sn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const r=this._def.shape(),l=Yn.objectKeys(r);return this._cached={shape:r,keys:l}}_parse(r){if(this._getType(r)!==Pt.object){const z=this._getOrReturnCtx(r);return Ot(z,{code:bt.invalid_type,expected:Pt.object,received:z.parsedType}),mn}const{status:h,ctx:m}=this._processInputParams(r),{shape:v,keys:T}=this._getCached(),s=[];if(!(this._def.catchall instanceof $s&&this._def.unknownKeys==="strip"))for(const z in m.data)T.includes(z)||s.push(z);const S=[];for(const z of T){const O=v[z],B=m.data[z];S.push({key:{status:"valid",value:z},value:O._parse(new ds(m,B,m.path,z)),alwaysSet:z in m.data})}if(this._def.catchall instanceof $s){const z=this._def.unknownKeys;if(z==="passthrough")for(const O of s)S.push({key:{status:"valid",value:O},value:{status:"valid",value:m.data[O]}});else if(z==="strict")s.length>0&&(Ot(m,{code:bt.unrecognized_keys,keys:s}),h.dirty());else if(z!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const z=this._def.catchall;for(const O of s){const B=m.data[O];S.push({key:{status:"valid",value:O},value:z._parse(new ds(m,B,m.path,O)),alwaysSet:O in m.data})}}return m.common.async?Promise.resolve().then(async()=>{const z=[];for(const O of S){const B=await O.key;z.push({key:B,value:await O.value,alwaysSet:O.alwaysSet})}return z}).then(z=>xr.mergeObjectSync(h,z)):xr.mergeObjectSync(h,S)}get shape(){return this._def.shape()}strict(r){return Yt.errToObj,new Ai({...this._def,unknownKeys:"strict",...r!==void 0?{errorMap:(l,h)=>{var m,v,T,s;const S=(T=(v=(m=this._def).errorMap)===null||v===void 0?void 0:v.call(m,l,h).message)!==null&&T!==void 0?T:h.defaultError;return l.code==="unrecognized_keys"?{message:(s=Yt.errToObj(r).message)!==null&&s!==void 0?s:S}:{message:S}}}:{}})}strip(){return new Ai({...this._def,unknownKeys:"strip"})}passthrough(){return new Ai({...this._def,unknownKeys:"passthrough"})}extend(r){return new Ai({...this._def,shape:()=>({...this._def.shape(),...r})})}merge(r){return new Ai({unknownKeys:r._def.unknownKeys,catchall:r._def.catchall,shape:()=>({...this._def.shape(),...r._def.shape()}),typeName:tn.ZodObject})}setKey(r,l){return this.augment({[r]:l})}catchall(r){return new Ai({...this._def,catchall:r})}pick(r){const l={};return Yn.objectKeys(r).forEach(h=>{r[h]&&this.shape[h]&&(l[h]=this.shape[h])}),new Ai({...this._def,shape:()=>l})}omit(r){const l={};return Yn.objectKeys(this.shape).forEach(h=>{r[h]||(l[h]=this.shape[h])}),new Ai({...this._def,shape:()=>l})}deepPartial(){return mu(this)}partial(r){const l={};return Yn.objectKeys(this.shape).forEach(h=>{const m=this.shape[h];r&&!r[h]?l[h]=m:l[h]=m.optional()}),new Ai({...this._def,shape:()=>l})}required(r){const l={};return Yn.objectKeys(this.shape).forEach(h=>{if(r&&!r[h])l[h]=this.shape[h];else{let v=this.shape[h];for(;v instanceof js;)v=v._def.innerType;l[h]=v}}),new Ai({...this._def,shape:()=>l})}keyof(){return WT(Yn.objectKeys(this.shape))}}Ai.create=(t,r)=>new Ai({shape:()=>t,unknownKeys:"strip",catchall:$s.create(),typeName:tn.ZodObject,...bn(r)});Ai.strictCreate=(t,r)=>new Ai({shape:()=>t,unknownKeys:"strict",catchall:$s.create(),typeName:tn.ZodObject,...bn(r)});Ai.lazycreate=(t,r)=>new Ai({shape:t,unknownKeys:"strip",catchall:$s.create(),typeName:tn.ZodObject,...bn(r)});class zd extends Sn{_parse(r){const{ctx:l}=this._processInputParams(r),h=this._def.options;function m(v){for(const s of v)if(s.result.status==="valid")return s.result;for(const s of v)if(s.result.status==="dirty")return l.common.issues.push(...s.ctx.common.issues),s.result;const T=v.map(s=>new Oo(s.ctx.common.issues));return Ot(l,{code:bt.invalid_union,unionErrors:T}),mn}if(l.common.async)return Promise.all(h.map(async v=>{const T={...l,common:{...l.common,issues:[]},parent:null};return{result:await v._parseAsync({data:l.data,path:l.path,parent:T}),ctx:T}})).then(m);{let v;const T=[];for(const S of h){const z={...l,common:{...l.common,issues:[]},parent:null},O=S._parseSync({data:l.data,path:l.path,parent:z});if(O.status==="valid")return O;O.status==="dirty"&&!v&&(v={result:O,ctx:z}),z.common.issues.length&&T.push(z.common.issues)}if(v)return l.common.issues.push(...v.ctx.common.issues),v.result;const s=T.map(S=>new Oo(S));return Ot(l,{code:bt.invalid_union,unionErrors:s}),mn}}get options(){return this._def.options}}zd.create=(t,r)=>new zd({options:t,typeName:tn.ZodUnion,...bn(r)});const Vf=t=>t instanceof Od?Vf(t.schema):t instanceof jo?Vf(t.innerType()):t instanceof Bd?[t.value]:t instanceof Na?t.options:t instanceof Fd?Object.keys(t.enum):t instanceof jd?Vf(t._def.innerType):t instanceof Pd?[void 0]:t instanceof Ld?[null]:null;class $m extends Sn{_parse(r){const{ctx:l}=this._processInputParams(r);if(l.parsedType!==Pt.object)return Ot(l,{code:bt.invalid_type,expected:Pt.object,received:l.parsedType}),mn;const h=this.discriminator,m=l.data[h],v=this.optionsMap.get(m);return v?l.common.async?v._parseAsync({data:l.data,path:l.path,parent:l}):v._parseSync({data:l.data,path:l.path,parent:l}):(Ot(l,{code:bt.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[h]}),mn)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(r,l,h){const m=new Map;for(const v of l){const T=Vf(v.shape[r]);if(!T)throw new Error(`A discriminator value for key \`${r}\` could not be extracted from all schema options`);for(const s of T){if(m.has(s))throw new Error(`Discriminator property ${String(r)} has duplicate value ${String(s)}`);m.set(s,v)}}return new $m({typeName:tn.ZodDiscriminatedUnion,discriminator:r,options:l,optionsMap:m,...bn(h)})}}function py(t,r){const l=Ca(t),h=Ca(r);if(t===r)return{valid:!0,data:t};if(l===Pt.object&&h===Pt.object){const m=Yn.objectKeys(r),v=Yn.objectKeys(t).filter(s=>m.indexOf(s)!==-1),T={...t,...r};for(const s of v){const S=py(t[s],r[s]);if(!S.valid)return{valid:!1};T[s]=S.data}return{valid:!0,data:T}}else if(l===Pt.array&&h===Pt.array){if(t.length!==r.length)return{valid:!1};const m=[];for(let v=0;v<t.length;v++){const T=t[v],s=r[v],S=py(T,s);if(!S.valid)return{valid:!1};m.push(S.data)}return{valid:!0,data:m}}else return l===Pt.date&&h===Pt.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}class Rd extends Sn{_parse(r){const{status:l,ctx:h}=this._processInputParams(r),m=(v,T)=>{if(hy(v)||hy(T))return mn;const s=py(v.value,T.value);return s.valid?((dy(v)||dy(T))&&l.dirty(),{status:l.value,value:s.data}):(Ot(h,{code:bt.invalid_intersection_types}),mn)};return h.common.async?Promise.all([this._def.left._parseAsync({data:h.data,path:h.path,parent:h}),this._def.right._parseAsync({data:h.data,path:h.path,parent:h})]).then(([v,T])=>m(v,T)):m(this._def.left._parseSync({data:h.data,path:h.path,parent:h}),this._def.right._parseSync({data:h.data,path:h.path,parent:h}))}}Rd.create=(t,r,l)=>new Rd({left:t,right:r,typeName:tn.ZodIntersection,...bn(l)});class ps extends Sn{_parse(r){const{status:l,ctx:h}=this._processInputParams(r);if(h.parsedType!==Pt.array)return Ot(h,{code:bt.invalid_type,expected:Pt.array,received:h.parsedType}),mn;if(h.data.length<this._def.items.length)return Ot(h,{code:bt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),mn;!this._def.rest&&h.data.length>this._def.items.length&&(Ot(h,{code:bt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),l.dirty());const v=[...h.data].map((T,s)=>{const S=this._def.items[s]||this._def.rest;return S?S._parse(new ds(h,T,h.path,s)):null}).filter(T=>!!T);return h.common.async?Promise.all(v).then(T=>xr.mergeArray(l,T)):xr.mergeArray(l,v)}get items(){return this._def.items}rest(r){return new ps({...this._def,rest:r})}}ps.create=(t,r)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ps({items:t,typeName:tn.ZodTuple,rest:null,...bn(r)})};class Dd extends Sn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:l,ctx:h}=this._processInputParams(r);if(h.parsedType!==Pt.object)return Ot(h,{code:bt.invalid_type,expected:Pt.object,received:h.parsedType}),mn;const m=[],v=this._def.keyType,T=this._def.valueType;for(const s in h.data)m.push({key:v._parse(new ds(h,s,h.path,s)),value:T._parse(new ds(h,h.data[s],h.path,s))});return h.common.async?xr.mergeObjectAsync(l,m):xr.mergeObjectSync(l,m)}get element(){return this._def.valueType}static create(r,l,h){return l instanceof Sn?new Dd({keyType:r,valueType:l,typeName:tn.ZodRecord,...bn(h)}):new Dd({keyType:Lo.create(),valueType:r,typeName:tn.ZodRecord,...bn(l)})}}class pm extends Sn{_parse(r){const{status:l,ctx:h}=this._processInputParams(r);if(h.parsedType!==Pt.map)return Ot(h,{code:bt.invalid_type,expected:Pt.map,received:h.parsedType}),mn;const m=this._def.keyType,v=this._def.valueType,T=[...h.data.entries()].map(([s,S],z)=>({key:m._parse(new ds(h,s,h.path,[z,"key"])),value:v._parse(new ds(h,S,h.path,[z,"value"]))}));if(h.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const S of T){const z=await S.key,O=await S.value;if(z.status==="aborted"||O.status==="aborted")return mn;(z.status==="dirty"||O.status==="dirty")&&l.dirty(),s.set(z.value,O.value)}return{status:l.value,value:s}})}else{const s=new Map;for(const S of T){const z=S.key,O=S.value;if(z.status==="aborted"||O.status==="aborted")return mn;(z.status==="dirty"||O.status==="dirty")&&l.dirty(),s.set(z.value,O.value)}return{status:l.value,value:s}}}}pm.create=(t,r,l)=>new pm({valueType:r,keyType:t,typeName:tn.ZodMap,...bn(l)});class Jl extends Sn{_parse(r){const{status:l,ctx:h}=this._processInputParams(r);if(h.parsedType!==Pt.set)return Ot(h,{code:bt.invalid_type,expected:Pt.set,received:h.parsedType}),mn;const m=this._def;m.minSize!==null&&h.data.size<m.minSize.value&&(Ot(h,{code:bt.too_small,minimum:m.minSize.value,type:"set",inclusive:!0,exact:!1,message:m.minSize.message}),l.dirty()),m.maxSize!==null&&h.data.size>m.maxSize.value&&(Ot(h,{code:bt.too_big,maximum:m.maxSize.value,type:"set",inclusive:!0,exact:!1,message:m.maxSize.message}),l.dirty());const v=this._def.valueType;function T(S){const z=new Set;for(const O of S){if(O.status==="aborted")return mn;O.status==="dirty"&&l.dirty(),z.add(O.value)}return{status:l.value,value:z}}const s=[...h.data.values()].map((S,z)=>v._parse(new ds(h,S,h.path,z)));return h.common.async?Promise.all(s).then(S=>T(S)):T(s)}min(r,l){return new Jl({...this._def,minSize:{value:r,message:Yt.toString(l)}})}max(r,l){return new Jl({...this._def,maxSize:{value:r,message:Yt.toString(l)}})}size(r,l){return this.min(r,l).max(r,l)}nonempty(r){return this.min(1,r)}}Jl.create=(t,r)=>new Jl({valueType:t,minSize:null,maxSize:null,typeName:tn.ZodSet,...bn(r)});class xu extends Sn{constructor(){super(...arguments),this.validate=this.implement}_parse(r){const{ctx:l}=this._processInputParams(r);if(l.parsedType!==Pt.function)return Ot(l,{code:bt.invalid_type,expected:Pt.function,received:l.parsedType}),mn;function h(s,S){return lm({data:s,path:l.path,errorMaps:[l.common.contextualErrorMap,l.schemaErrorMap,am(),Cd].filter(z=>!!z),issueData:{code:bt.invalid_arguments,argumentsError:S}})}function m(s,S){return lm({data:s,path:l.path,errorMaps:[l.common.contextualErrorMap,l.schemaErrorMap,am(),Cd].filter(z=>!!z),issueData:{code:bt.invalid_return_type,returnTypeError:S}})}const v={errorMap:l.common.contextualErrorMap},T=l.data;return this._def.returns instanceof Lu?Rr(async(...s)=>{const S=new Oo([]),z=await this._def.args.parseAsync(s,v).catch(Z=>{throw S.addIssue(h(s,Z)),S}),O=await T(...z);return await this._def.returns._def.type.parseAsync(O,v).catch(Z=>{throw S.addIssue(m(O,Z)),S})}):Rr((...s)=>{const S=this._def.args.safeParse(s,v);if(!S.success)throw new Oo([h(s,S.error)]);const z=T(...S.data),O=this._def.returns.safeParse(z,v);if(!O.success)throw new Oo([m(z,O.error)]);return O.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...r){return new xu({...this._def,args:ps.create(r).rest(Hl.create())})}returns(r){return new xu({...this._def,returns:r})}implement(r){return this.parse(r)}strictImplement(r){return this.parse(r)}static create(r,l,h){return new xu({args:r||ps.create([]).rest(Hl.create()),returns:l||Hl.create(),typeName:tn.ZodFunction,...bn(h)})}}class Od extends Sn{get schema(){return this._def.getter()}_parse(r){const{ctx:l}=this._processInputParams(r);return this._def.getter()._parse({data:l.data,path:l.path,parent:l})}}Od.create=(t,r)=>new Od({getter:t,typeName:tn.ZodLazy,...bn(r)});class Bd extends Sn{_parse(r){if(r.data!==this._def.value){const l=this._getOrReturnCtx(r);return Ot(l,{received:l.data,code:bt.invalid_literal,expected:this._def.value}),mn}return{status:"valid",value:r.data}}get value(){return this._def.value}}Bd.create=(t,r)=>new Bd({value:t,typeName:tn.ZodLiteral,...bn(r)});function WT(t,r){return new Na({values:t,typeName:tn.ZodEnum,...bn(r)})}class Na extends Sn{_parse(r){if(typeof r.data!="string"){const l=this._getOrReturnCtx(r),h=this._def.values;return Ot(l,{expected:Yn.joinValues(h),received:l.parsedType,code:bt.invalid_type}),mn}if(this._def.values.indexOf(r.data)===-1){const l=this._getOrReturnCtx(r),h=this._def.values;return Ot(l,{received:l.data,code:bt.invalid_enum_value,options:h}),mn}return Rr(r.data)}get options(){return this._def.values}get enum(){const r={};for(const l of this._def.values)r[l]=l;return r}get Values(){const r={};for(const l of this._def.values)r[l]=l;return r}get Enum(){const r={};for(const l of this._def.values)r[l]=l;return r}extract(r){return Na.create(r)}exclude(r){return Na.create(this.options.filter(l=>!r.includes(l)))}}Na.create=WT;class Fd extends Sn{_parse(r){const l=Yn.getValidEnumValues(this._def.values),h=this._getOrReturnCtx(r);if(h.parsedType!==Pt.string&&h.parsedType!==Pt.number){const m=Yn.objectValues(l);return Ot(h,{expected:Yn.joinValues(m),received:h.parsedType,code:bt.invalid_type}),mn}if(l.indexOf(r.data)===-1){const m=Yn.objectValues(l);return Ot(h,{received:h.data,code:bt.invalid_enum_value,options:m}),mn}return Rr(r.data)}get enum(){return this._def.values}}Fd.create=(t,r)=>new Fd({values:t,typeName:tn.ZodNativeEnum,...bn(r)});class Lu extends Sn{unwrap(){return this._def.type}_parse(r){const{ctx:l}=this._processInputParams(r);if(l.parsedType!==Pt.promise&&l.common.async===!1)return Ot(l,{code:bt.invalid_type,expected:Pt.promise,received:l.parsedType}),mn;const h=l.parsedType===Pt.promise?l.data:Promise.resolve(l.data);return Rr(h.then(m=>this._def.type.parseAsync(m,{path:l.path,errorMap:l.common.contextualErrorMap})))}}Lu.create=(t,r)=>new Lu({type:t,typeName:tn.ZodPromise,...bn(r)});class jo extends Sn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===tn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){const{status:l,ctx:h}=this._processInputParams(r),m=this._def.effect||null;if(m.type==="preprocess"){const T=m.transform(h.data);return h.common.async?Promise.resolve(T).then(s=>this._def.schema._parseAsync({data:s,path:h.path,parent:h})):this._def.schema._parseSync({data:T,path:h.path,parent:h})}const v={addIssue:T=>{Ot(h,T),T.fatal?l.abort():l.dirty()},get path(){return h.path}};if(v.addIssue=v.addIssue.bind(v),m.type==="refinement"){const T=s=>{const S=m.refinement(s,v);if(h.common.async)return Promise.resolve(S);if(S instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(h.common.async===!1){const s=this._def.schema._parseSync({data:h.data,path:h.path,parent:h});return s.status==="aborted"?mn:(s.status==="dirty"&&l.dirty(),T(s.value),{status:l.value,value:s.value})}else return this._def.schema._parseAsync({data:h.data,path:h.path,parent:h}).then(s=>s.status==="aborted"?mn:(s.status==="dirty"&&l.dirty(),T(s.value).then(()=>({status:l.value,value:s.value}))))}if(m.type==="transform")if(h.common.async===!1){const T=this._def.schema._parseSync({data:h.data,path:h.path,parent:h});if(!cm(T))return T;const s=m.transform(T.value,v);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:l.value,value:s}}else return this._def.schema._parseAsync({data:h.data,path:h.path,parent:h}).then(T=>cm(T)?Promise.resolve(m.transform(T.value,v)).then(s=>({status:l.value,value:s})):T);Yn.assertNever(m)}}jo.create=(t,r,l)=>new jo({schema:t,typeName:tn.ZodEffects,effect:r,...bn(l)});jo.createWithPreprocess=(t,r,l)=>new jo({schema:r,effect:{type:"preprocess",transform:t},typeName:tn.ZodEffects,...bn(l)});class js extends Sn{_parse(r){return this._getType(r)===Pt.undefined?Rr(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}js.create=(t,r)=>new js({innerType:t,typeName:tn.ZodOptional,...bn(r)});class Ql extends Sn{_parse(r){return this._getType(r)===Pt.null?Rr(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}Ql.create=(t,r)=>new Ql({innerType:t,typeName:tn.ZodNullable,...bn(r)});class jd extends Sn{_parse(r){const{ctx:l}=this._processInputParams(r);let h=l.data;return l.parsedType===Pt.undefined&&(h=this._def.defaultValue()),this._def.innerType._parse({data:h,path:l.path,parent:l})}removeDefault(){return this._def.innerType}}jd.create=(t,r)=>new jd({innerType:t,typeName:tn.ZodDefault,defaultValue:typeof r.default=="function"?r.default:()=>r.default,...bn(r)});class fm extends Sn{_parse(r){const{ctx:l}=this._processInputParams(r),h={...l,common:{...l.common,issues:[]}},m=this._def.innerType._parse({data:h.data,path:h.path,parent:{...h}});return um(m)?m.then(v=>({status:"valid",value:v.status==="valid"?v.value:this._def.catchValue({get error(){return new Oo(h.common.issues)},input:h.data})})):{status:"valid",value:m.status==="valid"?m.value:this._def.catchValue({get error(){return new Oo(h.common.issues)},input:h.data})}}removeCatch(){return this._def.innerType}}fm.create=(t,r)=>new fm({innerType:t,typeName:tn.ZodCatch,catchValue:typeof r.catch=="function"?r.catch:()=>r.catch,...bn(r)});class mm extends Sn{_parse(r){if(this._getType(r)!==Pt.nan){const h=this._getOrReturnCtx(r);return Ot(h,{code:bt.invalid_type,expected:Pt.nan,received:h.parsedType}),mn}return{status:"valid",value:r.data}}}mm.create=t=>new mm({typeName:tn.ZodNaN,...bn(t)});const NR=Symbol("zod_brand");class HT extends Sn{_parse(r){const{ctx:l}=this._processInputParams(r),h=l.data;return this._def.type._parse({data:h,path:l.path,parent:l})}unwrap(){return this._def.type}}class Zd extends Sn{_parse(r){const{status:l,ctx:h}=this._processInputParams(r);if(h.common.async)return(async()=>{const v=await this._def.in._parseAsync({data:h.data,path:h.path,parent:h});return v.status==="aborted"?mn:v.status==="dirty"?(l.dirty(),qT(v.value)):this._def.out._parseAsync({data:v.value,path:h.path,parent:h})})();{const m=this._def.in._parseSync({data:h.data,path:h.path,parent:h});return m.status==="aborted"?mn:m.status==="dirty"?(l.dirty(),{status:"dirty",value:m.value}):this._def.out._parseSync({data:m.value,path:h.path,parent:h})}}static create(r,l){return new Zd({in:r,out:l,typeName:tn.ZodPipeline})}}const XT=(t,r={},l)=>t?Pu.create().superRefine((h,m)=>{var v,T;if(!t(h)){const s=typeof r=="function"?r(h):r,S=(T=(v=s.fatal)!==null&&v!==void 0?v:l)!==null&&T!==void 0?T:!0,z=typeof s=="string"?{message:s}:s;m.addIssue({code:"custom",...z,fatal:S})}}):Pu.create(),$R={object:Ai.lazycreate};var tn;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline"})(tn||(tn={}));const UR=(t,r={message:`Input not instance of ${t.name}`})=>XT(l=>l instanceof t,r),KT=Lo.create,YT=Fa.create,VR=mm.create,GR=ja.create,JT=Md.create,ZR=Yl.create,qR=hm.create,WR=Pd.create,HR=Ld.create,XR=Pu.create,KR=Hl.create,YR=$s.create,JR=dm.create,QR=Bo.create,eD=Ai.create,tD=Ai.strictCreate,nD=zd.create,iD=$m.create,rD=Rd.create,oD=ps.create,sD=Dd.create,aD=pm.create,lD=Jl.create,cD=xu.create,uD=Od.create,hD=Bd.create,dD=Na.create,pD=Fd.create,fD=Lu.create,x1=jo.create,mD=js.create,gD=Ql.create,_D=jo.createWithPreprocess,yD=Zd.create,vD=()=>KT().optional(),bD=()=>YT().optional(),xD=()=>JT().optional(),wD={string:t=>Lo.create({...t,coerce:!0}),number:t=>Fa.create({...t,coerce:!0}),boolean:t=>Md.create({...t,coerce:!0}),bigint:t=>ja.create({...t,coerce:!0}),date:t=>Yl.create({...t,coerce:!0})},TD=mn;var Bn=Object.freeze({__proto__:null,defaultErrorMap:Cd,setErrorMap:AR,getErrorMap:am,makeIssue:lm,EMPTY_PATH:IR,addIssueToContext:Ot,ParseStatus:xr,INVALID:mn,DIRTY:qT,OK:Rr,isAborted:hy,isDirty:dy,isValid:cm,isAsync:um,get util(){return Yn},get objectUtil(){return uy},ZodParsedType:Pt,getParsedType:Ca,ZodType:Sn,ZodString:Lo,ZodNumber:Fa,ZodBigInt:ja,ZodBoolean:Md,ZodDate:Yl,ZodSymbol:hm,ZodUndefined:Pd,ZodNull:Ld,ZodAny:Pu,ZodUnknown:Hl,ZodNever:$s,ZodVoid:dm,ZodArray:Bo,ZodObject:Ai,ZodUnion:zd,ZodDiscriminatedUnion:$m,ZodIntersection:Rd,ZodTuple:ps,ZodRecord:Dd,ZodMap:pm,ZodSet:Jl,ZodFunction:xu,ZodLazy:Od,ZodLiteral:Bd,ZodEnum:Na,ZodNativeEnum:Fd,ZodPromise:Lu,ZodEffects:jo,ZodTransformer:jo,ZodOptional:js,ZodNullable:Ql,ZodDefault:jd,ZodCatch:fm,ZodNaN:mm,BRAND:NR,ZodBranded:HT,ZodPipeline:Zd,custom:XT,Schema:Sn,ZodSchema:Sn,late:$R,get ZodFirstPartyTypeKind(){return tn},coerce:wD,any:XR,array:QR,bigint:GR,boolean:JT,date:ZR,discriminatedUnion:iD,effect:x1,enum:dD,function:cD,instanceof:UR,intersection:rD,lazy:uD,literal:hD,map:aD,nan:VR,nativeEnum:pD,never:YR,null:HR,nullable:gD,number:YT,object:eD,oboolean:xD,onumber:bD,optional:mD,ostring:vD,pipeline:yD,preprocess:_D,promise:fD,record:sD,set:lD,strictObject:tD,string:KT,symbol:qR,transformer:x1,tuple:oD,undefined:WR,union:nD,unknown:KR,void:JR,NEVER:TD,ZodIssueCode:bt,quotelessJson:SR,ZodError:Oo});const ED=Bn.object({basecampLatitude:Bn.number(),basecampLongitude:Bn.number(),basecampName:Bn.string(),created:Bn.string(),duration:Bn.number(),id:Bn.string(),indoor:Bn.boolean(),name:Bn.string(),points:Bn.array(Bn.unknown()),safeZone:Bn.null(),tags:Bn.array(Bn.string()),updated:Bn.string(),user:Bn.string()}),QT=Bn.object({created:Bn.string(),id:Bn.string(),latitude:Bn.number(),longitude:Bn.number(),members:Bn.array(Bn.string()),name:Bn.string(),score:Bn.number(),updated:Bn.string()});Bn.object({created:Bn.string(),date:Bn.string(),id:Bn.string(),journey:Bn.string(),updated:Bn.string(),name:Bn.string(),expand:Bn.object({teams:Bn.array(QT).optional(),journey:ED.optional()}).optional()});function kD(t){return JSON.parse(JSON.stringify(t))}function SD(t){if(!(t!=null&&t.expand))return t;t=kD(t);for(const[r,l]of Object.entries(t.expand))if(r.includes("(")){let h=r.split("(")[0];Array.isArray(l)&&(h+="s"),t.expand[h]=l,delete t.expand[r]}return t}var w1;const AD=typeof window<"u";AD&&((w1=window==null?void 0:window.navigator)!=null&&w1.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function gm(t){return typeof t=="function"?t():fn(t)}function ID(t,r,l="",h={},m=!1){const v=GT(),T=s=>{for(const[S,z]of Object.entries(h))s.expand[S]||(s.expand[S]=z())};return s=>{const S=Ni(!1),z=Ni(!1),O=Ni(null),B=Ni(null);vr(B,()=>{if(B.value){const Te=SD(B.value);O.value=r.parse(Te)}},{deep:!0});const me=()=>{const Te=gm(s);if(!Te)throw new Error(`Trying to use composable for collection ${t} without an id provided.`);return Te},_e=async()=>{const Te=me();S.value=!0;const ve=await v.collection(t).getOne(Te,{expand:l});ve||(B.value=null),T(ve),B.value=ve,S.value=!1},Ie=async()=>{const Te=me();O.value&&(z.value=!0,await v.collection(t).update(Te,O.value),z.value=!1)};return!m&&gm(s)&&_e().then(),!m&&Ii(s)&&vr(s,async Te=>{Te&&await _e()}),{data:O,rawData:B,refresh:_e,update:Ie,loading:S,updateLoading:z}}}function CD(t,r,l="",h={}){const m=ID(t,r,l,h,!0),v=GT();return T=>{const{data:s,loading:S,refresh:z,rawData:O,update:B,updateLoading:Z}=m(T),me=[],_e=async()=>{var $e;await z();const Te=await v.collection(t).subscribe(gm(T),Fe=>{var qe;Fe.action==="update"&&(Fe.record.expand=Object.assign({},Fe.record.expand,((qe=O.value)==null?void 0:qe.expand)??{}),O.value=Fe.record)}),ve=($e=O.value)==null?void 0:$e.expand;if(O.value&&ve)for(const[Fe,qe]of Object.entries(ve))if(Array.isArray(ve[Fe])){if(Fe.includes("(")){const[fe,et]=Fe.replace(")","").split("("),Pe=await v.collection(fe).subscribe("*",Ge=>{var dt;const Ye=ve[Fe].findIndex(wt=>wt.id===Ge.record.id);Ge.action==="delete"&&Ye>-1?O.value.expand[Fe].splice(Ye,1):Ge.record[et]===((dt=O.value)==null?void 0:dt.id)?Ye>-1?O.value.expand[Fe][Ye]=Ge.record:O.value.expand[Fe].push(Ge.record):Ye>-1&&O.value.expand[Fe].splice(Ye,1)});me.push(Pe)}}else{const fe=qe,et=await v.collection(fe.collectionName).subscribe(fe.id,Pe=>{O.value&&(O.value.expand[Fe]=Pe.record)});me.push(et)}me.push(Te)},Ie=()=>me.forEach(Te=>Te());return ec(Ie),gm(T)&&_e().then(),Ii(T)&&vr(T,async Te=>{Ie(),Te&&await _e()}),{data:s,loading:S,refresh:z,rawData:O,update:B,updateLoading:Z}}}const MD=CD("team",QT),eE=jw("team",()=>{const t=Ni(),r=s=>{t.value=s},{data:l,refresh:h,loading:m,update:v,updateLoading:T}=MD(t);return{setId:r,team:l,loading:m,updateLoading:T,update:v,refresh:h}}),tE=jw("geolocation",()=>{const t=Ga({lng:6.129384,lat:45.899247});let r=null;const l=()=>{r||P_.addWatcher({backgroundMessage:"Cancel to prevent battery drain.",backgroundTitle:"Tracking You.",requestPermissions:!0},function(z,O){return O?(O.code==="NOT_AUTHORIZED"&&window.confirm(`This app needs your location, but does not have permission.

Open settings now?`)&&P_.openSettings(),console.error(O)):(z?(t.lng=z.longitude,t.lat=z.latitude):console.error("Location object from OS was empty"),"")}).then(function(z){r=z})},h=()=>{r&&(s(),P_.removeWatcher({id:r}),r=null)},m=eE();let v=null;const T=()=>{if(v)return!1;v=vr(t,async()=>{m.team&&(m.team.longitude=t.lng,m.team.latitude=t.lat,await m.update(),console.log("💾Saved change on server : [lat: "+t.lat+", lng: "+t.lng+"]"))})},s=()=>{v==null||v(),v=null};return{startWatching:l,stopWatching:h,currentLocation:t,startReporting:T,stopReporting:s}});var Pr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function PD(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var l=function h(){if(this instanceof h){var m=[null];m.push.apply(m,arguments);var v=Function.bind.apply(r,m);return new v}return r.apply(this,arguments)};l.prototype=r.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(t).forEach(function(h){var m=Object.getOwnPropertyDescriptor(t,h);Object.defineProperty(l,h,m.get?m:{enumerable:!0,get:function(){return t[h]}})}),l}var fy={},LD={get exports(){return fy},set exports(t){fy=t}};(function(t,r){(function(l,h){t.exports=h()})(Pr,function(){var l,h,m;function v(s,S){if(!l)l=S;else if(!h)h=S;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",O={};l(O),m=S(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}v(["exports"],function(s){var S=typeof self<"u"?self:{},z="2.13.0";let O;const B={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(O==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{O={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):n}catch{O=n}}return O},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Z={supported:!1,testSupport:function(n){!Ie&&_e&&(Te?ve(n):me=n)}};let me,_e,Ie=!1,Te=!1;function ve(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,_e),n.isContextLost())return;Z.supported=!0}catch{}n.deleteTexture(e),Ie=!0}S.document&&(_e=S.document.createElement("img"),_e.onload=function(){me&&ve(me),me=null,Te=!0},_e.onerror=function(){Ie=!0,me=null},_e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $e="01";var Fe=qe;function qe(n,e,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=a}qe.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,a=0;a<8;a++){var u=this.sampleCurveX(i)-n;if(Math.abs(u)<e)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=u/p}var g=0,y=1;for(i=n,a=0;a<20&&(u=this.sampleCurveX(i),!(Math.abs(u-n)<e));a++)n>u?g=i:y=i,i=.5*(y-g)+g;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var fe=et;function et(n,e){this.x=n,this.y=e}et.prototype={clone:function(){return new et(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,e){var i=Math.cos(n),a=Math.sin(n),u=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},et.convert=function(n){return n instanceof et?n:Array.isArray(n)?new et(n[0],n[1]):n};const Pe=Math.PI/180,Ge=180/Math.PI;function Ye(n){return n*Pe}function dt(n){return n*Ge}const wt=[[0,0],[1,0],[1,1],[0,1]];function Tn(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Zt(n,e,i,a){const u=new Fe(n,e,i,a);return function(p){return u.solve(p)}}const si=Zt(.25,.1,.25,1);function At(n,e,i){return Math.min(i,Math.max(e,n))}function Cn(n,e,i){return(i=At((i-n)/(e-n),0,1))*i*(3-2*i)}function rn(n,e,i){const a=i-e,u=((n-e)%a+a)%a+e;return u===e?i:u}function Ft(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const u=new Array(n.length);let p=null;n.forEach((g,y)=>{e(g,(x,w)=>{x&&(p=x),u[y]=w,--a==0&&i(p,u)})})}function ni(n){const e=[];for(const i in n)e.push(n[i]);return e}function Jt(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}let Mn=1;function Fn(){return Mn++}function hi(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function fi(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Xe(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function xt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function pt(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Bt(n,e,i){const a={};for(const u in n)a[u]=e.call(i||this,n[u],u,n);return a}function gn(n,e,i){const a={};for(const u in n)e.call(i||this,n[u],u,n)&&(a[u]=n[u]);return a}function En(n){return Array.isArray(n)?n.map(En):typeof n=="object"&&n?Bt(n,En):n}const sn={};function ne(n){sn[n]||(typeof console<"u"&&console.warn(n),sn[n]=!0)}function ge(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ze(n){let e=0;for(let i,a,u=0,p=n.length,g=p-1;u<p;g=u++)i=n[u],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}function We(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ot(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,u,p)=>{const g=u||p;return e[a]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ft=null;function Tt(n){if(ft==null){const e=n.navigator?n.navigator.userAgent:null;ft=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ft}function ht(n){try{const e=S[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function yt(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const at="mapbox-tiles";let zt,It,$t=500,Kt=50;function cn(){try{return S.caches}catch{}}function Pn(){cn()&&!zt&&(zt=S.caches.open(at))}function Ln(n){const e=n.indexOf("?");if(e<0)return n;const i=function(u){const p=u.indexOf("?");return p>0?u.slice(p+1).split("&"):[]}(n),a=i.filter(u=>{const p=u.split("=");return p[0]==="language"||p[0]==="worldview"});return a.length?`${n.slice(0,e)}?${a.join("&")}`:n.slice(0,e)}let ai=1/0;const Fi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Fi);class Mi extends Error{constructor(e,i,a){i===401&&gs(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const No=We()?()=>self.worker&&self.worker.referrer:()=>(S.location.protocol==="blob:"?S.parent:S).location.href,ar=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(No())&&!/^\w+:/.test(i))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(a,u){const p=new S.AbortController,g=new S.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:No(),signal:p.signal});let y=!1,x=!1;const w=(A=g.url).indexOf("sku=")>0&&gs(A);var A;a.type==="json"&&g.headers.set("Accept","application/json");const C=(R,D,N)=>{if(x)return;if(R&&R.message!=="SecurityError"&&ne(R),D&&N)return M(D);const G=Date.now();S.fetch(g).then(ee=>{if(ee.ok){const se=w?ee.clone():null;return M(ee,se,G)}return u(new Mi(ee.statusText,ee.status,a.url))}).catch(ee=>{ee.name!=="AbortError"&&u(new Error(`${ee.message} ${a.url}`))})},M=(R,D,N)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(G=>{x||(D&&N&&function(ee,se,K){if(Pn(),!zt)return;const oe={status:se.status,statusText:se.statusText,headers:new S.Headers};se.headers.forEach((Me,Se)=>oe.headers.set(Se,Me));const ce=ot(se.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&oe.headers.set("Expires",new Date(K+1e3*ce["max-age"]).toUTCString());const ae=oe.headers.get("Expires");ae&&(new Date(ae).getTime()-K<42e4||function(Me,Se){if(It===void 0)try{new Response(new ReadableStream),It=!0}catch{It=!1}It?Se(Me.body):Me.blob().then(Se)}(se,Me=>{const Se=new S.Response(Me,oe);Pn(),zt&&zt.then(Ne=>Ne.put(Ln(ee.url),Se)).catch(Ne=>ne(Ne.message))}))}(g,D,N),y=!0,u(null,G,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(G=>{x||u(new Error(G.message))})};return w?function(R,D){if(Pn(),!zt)return D(null);const N=Ln(R.url);zt.then(G=>{G.match(N).then(ee=>{const se=function(K){if(!K)return!1;const oe=new Date(K.headers.get("Expires")||0),ce=ot(K.headers.get("Cache-Control")||"");return oe>Date.now()&&!ce["no-cache"]}(ee);G.delete(N),se&&G.put(N,ee.clone()),D(null,ee,se)}).catch(D)}).catch(D)}(g,C):C(null,null),{cancel:()=>{x=!0,y||p.abort()}}}(n,e);if(We()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,u){const p=new S.XMLHttpRequest;p.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in a.headers)p.setRequestHeader(g,a.headers[g]);return a.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=a.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(a.type==="json")try{g=JSON.parse(p.response)}catch(y){return u(y)}u(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new Mi(p.statusText,p.status,a.url))},p.send(a.body),{cancel:()=>p.abort()}}(n,e)},no=function(n,e){return ar(Jt(n,{type:"arrayBuffer"}),e)};function Ri(n){const e=S.document.createElement("a");return e.href=n,e.protocol===S.document.location.protocol&&e.host===S.document.location.host}const Ui="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let mo,fs;mo=[],fs=0;const Za=function(n,e){if(Z.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),fs>=B.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return mo.push(p),p}fs++;let i=!1;const a=()=>{if(!i)for(i=!0,fs--;mo.length&&fs<B.MAX_PARALLEL_IMAGE_REQUESTS;){const p=mo.shift(),{requestParameters:g,callback:y,cancelled:x}=p;x||(p.cancel=Za(g,y).cancel)}},u=no(n,(p,g,y,x)=>{a(),p?e(p):g&&(S.createImageBitmap?function(w,A){const C=new S.Blob([new Uint8Array(w)],{type:"image/png"});S.createImageBitmap(C).then(M=>{A(null,M)}).catch(M=>{A(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(w,A)=>e(w,A,y,x)):function(w,A){const C=new S.Image,M=S.URL;C.onload=()=>{A(null,C),M.revokeObjectURL(C.src),C.onload=null,S.requestAnimationFrame(()=>{C.src=Ui})},C.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new S.Blob([new Uint8Array(w)],{type:"image/png"});C.src=w.byteLength?M.createObjectURL(R):Ui}(g,(w,A)=>e(w,A,y,x)))});return{cancel:()=>{u.cancel(),a()}}},ms="NO_ACCESS_TOKEN";function Wr(n){return n.indexOf("mapbox:")===0}function gs(n){return B.API_URL_REGEX.test(n)}function ic(n){return B.API_CDN_URL_REGEX.test(n)}function rc(n){return B.API_STYLE_REGEX.test(n)&&!Gs(n)}function Gs(n){return B.API_SPRITE_REGEX.test(n)}const _s=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sr(n){const e=n.match(_s);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function $o(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function oc(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ys{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=oc(B.ACCESS_TOKEN);let a="";return a=i&&i.u?S.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(Number("0x"+p)))):B.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=ht("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=S.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const p=S.localStorage.getItem(a);p&&(this.anonId=p)}catch{ne("Unable to read from LocalStorage")}}saveEventData(){const e=ht("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{S.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ne("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,a,u){if(!B.EVENTS_URL)return;const p=Sr(B.EVENTS_URL);p.params.push(`access_token=${u||B.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},y=i?Jt(g,i):g,x={url:$o(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(w,A){return ar(Jt(w,{method:"POST"}),A)}(x,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const J=new class extends ys{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>Wr(i)||gs(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=oc(B.ACCESS_TOKEN),i=e?e.u:B.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;Xe(this.anonId)||(this.anonId=hi(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||p.getDate()!==g.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:$e,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n):this.processRequests()}},F=J.postTurnstileEvent.bind(J),$=new class extends ys{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,a){this.skuToken=e,this.errorCb=a,B.EVENTS_URL&&(i||B.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ms)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Xe(this.anonId)||(this.anonId=hi()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:$e,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},Y=$.postMapLoadEvent.bind($),re=new class extends ys{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){B.EVENTS_URL&&(n||B.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),a=function(u){const p=S.performance.getEntriesByType("resource"),g=S.performance.getEntriesByType("mark"),y=function(M){const R={};if(M){for(const D in M)if(D!=="other")for(const N of M[D]){const G=`${D}ResolveRangeMin`,ee=`${D}ResolveRangeMax`,se=`${D}RequestCount`,K=`${D}RequestCachedCount`;R[G]=Math.min(R[G]||1/0,N.startTime),R[ee]=Math.max(R[ee]||-1/0,N.responseEnd);const oe=ce=>{R[ce]===void 0&&(R[ce]=0),++R[ce]};N.transferSize!==void 0&&N.transferSize===0&&oe(K),oe(se)}}return R}(function(M,R){const D={};if(M)for(const N of M){const G=R(N);D[G]===void 0&&(D[G]=[]),D[G].push(N)}return D}(p,gt)),x=S.devicePixelRatio,w=S.navigator.connection||S.navigator.mozConnection||S.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},C=(M,R,D)=>{D!=null&&M.push({name:R,value:D.toString()})};for(const M in y)C(A.counters,M,y[M]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(C(A.counters,"interactionRangeMin",u.interactionRange[0]),C(A.counters,"interactionRangeMax",u.interactionRange[1])),g)for(const M of Object.keys(ke)){const R=ke[M],D=g.find(N=>N.name===R);D&&C(A.counters,R,D.startTime)}return C(A.counters,"visibilityHidden",u.visibilityHidden),C(A.attributes,"style",function(M){if(M)for(const R of M){const D=R.name.split("?")[0];if(rc(D)){const N=D.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(p)),C(A.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),C(A.attributes,"fogEnabled",u.fogEnabled?"true":"false"),C(A.attributes,"projection",u.projection),C(A.attributes,"zoom",u.zoom),C(A.metadata,"devicePixelRatio",x),C(A.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),C(A.metadata,"navigatorUserAgent",S.navigator.userAgent),C(A.metadata,"screenWidth",S.screen.width),C(A.metadata,"screenHeight",S.screen.height),C(A.metadata,"windowWidth",S.innerWidth),C(A.metadata,"windowHeight",S.innerHeight),C(A.metadata,"mapWidth",u.width/x),C(A.metadata,"mapHeight",u.height/x),C(A.metadata,"webglRenderer",u.renderer),C(A.metadata,"webglVendor",u.vendor),C(A.metadata,"sdkVersion",z),C(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(e,a,()=>{},n)}},he=re.postPerformanceEvent.bind(re),we=new class extends ys{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,a){if(!B.API_URL||!B.SESSION_PATH)return;const u=Sr(B.API_URL+B.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||B.ACCESS_TOKEN||""}`);const p={url:$o(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,y){return ar(Jt(g,{method:"GET"}),y)}(p,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(n,e,i,a){this.skuToken=e,this.errorCb=a,B.SESSION_PATH&&B.API_URL&&(i||B.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ms)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},be=we.getSessionAPI.bind(we),pe=new Set,ke={create:"create",load:"load",fullLoad:"fullLoad"},Ke={mark(n){S.performance.mark(n)},measure(n,e,i){S.performance.measure(n,e,i)}};function gt(n){const e=n.name.split("?")[0];return ic(e)&&e.includes("mapbox-gl.js")?"javascript":ic(e)&&e.includes("mapbox-gl.css")?"css":function(i){return B.API_FONTS_REGEX.test(i)}(e)?"fontRange":Gs(e)?"sprite":rc(e)?"style":function(i){return B.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const nt=S.performance;function jt(n){const e=n?n.url.toString():void 0;return nt.getEntriesByName(e)}let Rt,Lt,Wt,nn;const zn={now:()=>Wt!==void 0?Wt:S.performance.now(),setNow(n){Wt=n},restoreNow(){Wt=void 0},frame(n){const e=S.requestAnimationFrame(n);return{cancel:()=>S.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;nn||(nn=S.document.createElement("canvas"));const u=nn.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>nn.width||a>nn.height)&&(nn.width=i,nn.height=a),u.clearRect(-e,-e,i+2*e,a+2*e),u.drawImage(n,0,0,i,a),u.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(Rt||(Rt=S.document.createElement("a")),Rt.href=n,Rt.href),get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(Lt==null&&(Lt=S.matchMedia("(prefers-reduced-motion: reduce)")),Lt.matches)}};function Ut(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Un(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class Vn{constructor(e,i={}){Jt(this,i),this.type=e}}class Uo extends Vn{constructor(e,i={}){super("error",Jt({error:e},i))}}class go{on(e,i){return this._listeners=this._listeners||{},Ut(e,i,this._listeners),this}off(e,i){return Un(e,i,this._listeners),Un(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ut(e,i,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,i){typeof e=="string"&&(e=new Vn(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of p)Un(a,y,this._oneTimeListeners),y.call(this,e);const g=this._eventedParent;g&&(Jt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Uo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function _o(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}function wi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Vo(n){if(Array.isArray(n))return n.map(Vo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Vo(n[i]);return e}return wi(n)}class qd extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var io=qd;class Zs{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,u]of i)this.bindings[a]=u}concat(e){return new Zs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Wd=Zs;const qs={kind:"null"},lt={kind:"number"},_n={kind:"string"},un={kind:"boolean"},ro={kind:"color"},vs={kind:"object"},an={kind:"value"},qa={kind:"collator"},Ws={kind:"formatted"},Hs={kind:"resolvedImage"};function rr(n,e){return{kind:"array",itemType:n,N:e}}function Jn(n){if(n.kind==="array"){const e=Jn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Hd=[qs,lt,_n,un,ro,Ws,vs,rr(an),Hs];function lr(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!lr(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Hd)if(!lr(i,e))return null}}return`Expected ${Jn(n)} but found ${Jn(e)} instead.`}function ju(n,e){return e.some(i=>i.kind===n.kind)}function bs(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}var Nu,sc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Wa(n){return(n=Math.round(n))<0?0:n>255?255:n}function xs(n){return Wa(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function Xs(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function $u(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{Nu={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in sc)return sc[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=i.indexOf("("),u=i.indexOf(")");if(a!==-1&&u+1===i.length){var p=i.substr(0,a),g=i.substr(a+1,u-(a+1)).split(","),y=1;switch(p){case"rgba":if(g.length!==4)return null;y=Xs(g.pop());case"rgb":return g.length!==3?null:[xs(g[0]),xs(g[1]),xs(g[2]),y];case"hsla":if(g.length!==4)return null;y=Xs(g.pop());case"hsl":if(g.length!==3)return null;var x=(parseFloat(g[0])%360+360)%360/360,w=Xs(g[1]),A=Xs(g[2]),C=A<=.5?A*(w+1):A+w-A*w,M=2*A-C;return[Wa(255*$u(M,C,x+1/3)),Wa(255*$u(M,C,x)),Wa(255*$u(M,C,x-1/3)),y];default:return null}}return null}}catch{}class cr{constructor(e,i,a,u=1){this.r=e,this.g=i,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof cr)return e;if(typeof e!="string")return;const i=Nu(e);return i?new cr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${u})`}toArray(){const{r:e,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*i/u,255*a/u,u]}toArray01(){const{r:e,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,i/u,a/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:a,a:u}=this;return[e,i,a,u]}}cr.black=new cr(0,0,0,1),cr.white=new cr(1,1,1,1),cr.transparent=new cr(0,0,0,0),cr.red=new cr(1,0,0,1),cr.blue=new cr(0,0,1,1);var yi=cr;class ac{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ha{constructor(e,i,a,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=u,this.textColor=p}}class ur{constructor(e){this.sections=e}static fromString(e){return new ur([new Ha(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ur?e:ur.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(a)}return e}}class or{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new or({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Xd(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lc(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof yi||n instanceof ac||n instanceof ur||n instanceof or)return!0;if(Array.isArray(n)){for(const e of n)if(!lc(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!lc(n[e]))return!1;return!0}return!1}function Pi(n){if(n===null)return qs;if(typeof n=="string")return _n;if(typeof n=="boolean")return un;if(typeof n=="number")return lt;if(n instanceof yi)return ro;if(n instanceof ac)return qa;if(n instanceof ur)return Ws;if(n instanceof or)return Hs;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const u=Pi(a);if(i){if(i===u)continue;i=an;break}i=u}return rr(i||an,e)}return vs}function Xa(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof yi||n instanceof ur||n instanceof or?n.toString():JSON.stringify(n)}class Uu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!lc(e[1]))return i.error("invalid value");const a=e[1];let u=Pi(a);const p=i.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Uu(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof yi?["rgba"].concat(this.value.toArray()):this.value instanceof ur?this.value.serialize():this.value}}var Ka=Uu,Vi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const cc={string:_n,number:lt,boolean:un,object:vs};class Ks{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,u=1;const p=e[0];if(p==="array"){let y,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in cc)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=cc[w],u++}else y=an;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}a=rr(y,x)}else a=cc[p];const g=[];for(;u<e.length;u++){const y=i.parse(e[u],u,an);if(!y)return null;g.push(y)}return new Ks(a,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!lr(this.type,Pi(a)))return a;if(i===this.args.length-1)throw new Vi(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(Pi(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(a=>a.serialize()))}}var yo=Ks;class Ya{constructor(e){this.type=Ws,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let g=1;g<=e.length-1;++g){const y=e[g];if(p&&typeof y=="object"&&!Array.isArray(y)){p=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,lt),!x))return null;let w=null;if(y["text-font"]&&(w=i.parse(y["text-font"],1,rr(_n)),!w))return null;let A=null;if(y["text-color"]&&(A=i.parse(y["text-color"],1,ro),!A))return null;const C=u[u.length-1];C.scale=x,C.font=w,C.textColor=A}else{const x=i.parse(e[g],1,an);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new Ya(u)}evaluate(e){return new ur(this.sections.map(i=>{const a=i.content.evaluate(e);return Pi(a)===Hs?new Ha("",a,null,null,null):new Ha(Xa(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class uc{constructor(e){this.type=Hs,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const a=i.parse(e[1],1,_n);return a?new uc(a):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),a=or.fromString(i);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(i)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const qm={"to-boolean":un,"to-color":ro,"to-number":lt,"to-string":_n};class Vu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=qm[a],p=[];for(let g=1;g<e.length;g++){const y=i.parse(e[g],g,an);if(!y)return null;p.push(y)}return new Vu(u,p)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,a;for(const u of this.args){if(i=u.evaluate(e),a=null,i instanceof yi)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Xd(i[0],i[1],i[2],i[3]),!a))return new yi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Vi(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Vi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ur.fromString(Xa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?or.fromString(Xa(this.args[0].evaluate(e))):Xa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ya([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ys=Vu;const Kd=["Unknown","Point","LineString","Polygon"];var Ja=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Kd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(a*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=yi.parse(n)),e}};class Js{constructor(e,i,a,u){this.name=e,this.type=i,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],u=Js.definitions[a];if(!u)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=g.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let x=null;for(const[w,A]of y){x=new Xu(i.registry,i.path,null,i.scope);const C=[];let M=!1;for(let R=1;R<e.length;R++){const D=e[R],N=Array.isArray(w)?w[R-1]:w.type,G=x.parse(D,1+C.length,N);if(!G){M=!0;break}C.push(G)}if(!M)if(Array.isArray(w)&&w.length!==C.length)x.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const D=Array.isArray(w)?w[R]:w.type,N=C[R];x.concat(R+1).checkSubtype(D,N.type)}if(x.errors.length===0)return new Js(a,p,A,C)}}if(y.length===1)i.errors.push(...x.errors);else{const w=(y.length?y:g).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Jn).join(", ")})`:`(${Jn(M.type)}...)`;var M}).join(" | "),A=[];for(let C=1;C<e.length;C++){const M=i.parse(e[C],1+A.length);if(!M)return null;A.push(Jn(M.type))}i.error(`Expected arguments of type ${w}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Js.definitions=i;for(const a in i)e[a]=Js}}var Go=Js;class hc{constructor(e,i,a){this.type=qa,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const u=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,un);if(!u)return null;const p=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,un);if(!p)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,_n),!g)?null:new hc(u,p,g)}evaluate(e){return new ac(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Zo=8192;function Or(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Qa(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Yd(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Zo),Math.round(a*u*Zo)]}function Jd(n,e,i){const a=n[0]-e[0],u=n[1]-e[1],p=n[0]-i[0],g=n[1]-i[1];return a*g-p*u==0&&a*p<=0&&u*g<=0}function dc(n,e){let i=!1;for(let g=0,y=e.length;g<y;g++){const x=e[g];for(let w=0,A=x.length;w<A-1;w++){if(Jd(n,x[w],x[w+1]))return!1;(u=x[w])[1]>(a=n)[1]!=(p=x[w+1])[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]&&(i=!i)}}var a,u,p;return i}function Qd(n,e){for(let i=0;i<e.length;i++)if(dc(n,e[i]))return!0;return!1}function Gu(n,e,i,a){const u=a[0]-i[0],p=a[1]-i[1],g=(n[0]-i[0])*p-u*(n[1]-i[1]),y=(e[0]-i[0])*p-u*(e[1]-i[1]);return g>0&&y<0||g<0&&y>0}function Zu(n,e,i){for(const w of i)for(let A=0;A<w.length-1;++A)if((y=[(g=w[A+1])[0]-(p=w[A])[0],g[1]-p[1]])[0]*(x=[(u=e)[0]-(a=n)[0],u[1]-a[1]])[1]-y[1]*x[0]!=0&&Gu(a,u,p,g)&&Gu(p,g,a,u))return!0;var a,u,p,g,y,x;return!1}function Qs(n,e){for(let i=0;i<n.length;++i)if(!dc(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Zu(n[i],n[i+1],e))return!1;return!0}function ep(n,e){for(let i=0;i<e.length;i++)if(Qs(n,e[i]))return!0;return!1}function pc(n,e,i){const a=[];for(let u=0;u<n.length;u++){const p=[];for(let g=0;g<n[u].length;g++){const y=Yd(n[u][g],i);Or(e,y),p.push(y)}a.push(p)}return a}function fc(n,e,i){const a=[];for(let u=0;u<n.length;u++){const p=pc(n[u],e,i);a.push(p)}return a}function qu(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const u=.5*a;let p=n[0]-i[0]>u?-a:i[0]-n[0]>u?a:0;p===0&&(p=n[0]-i[2]>u?-a:i[2]-n[0]>u?a:0),n[0]+=p}Or(e,n)}function ws(n,e,i,a){const u=Math.pow(2,a.z)*Zo,p=[a.x*Zo,a.y*Zo],g=[];if(!n)return g;for(const y of n)for(const x of y){const w=[x.x+p[0],x.y+p[1]];qu(w,e,i,u),g.push(w)}return g}function Rn(n,e,i,a){const u=Math.pow(2,a.z)*Zo,p=[a.x*Zo,a.y*Zo],g=[];if(!n)return g;for(const x of n){const w=[];for(const A of x){const C=[A.x+p[0],A.y+p[1]];Or(e,C),w.push(C)}g.push(w)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of g)for(const w of x)qu(w,e,i,u)}var y;return g}class el{constructor(e,i){this.type=un,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(lc(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const p=a.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new el(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new el(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new el(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const y=pc(a.coordinates,p,g),x=ws(i.geometry(),u,p,g);if(!Qa(u,p))return!1;for(const w of x)if(!dc(w,y))return!1}if(a.type==="MultiPolygon"){const y=fc(a.coordinates,p,g),x=ws(i.geometry(),u,p,g);if(!Qa(u,p))return!1;for(const w of x)if(!Qd(w,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const y=pc(a.coordinates,p,g),x=Rn(i.geometry(),u,p,g);if(!Qa(u,p))return!1;for(const w of x)if(!Qs(w,y))return!1}if(a.type==="MultiPolygon"){const y=fc(a.coordinates,p,g),x=Rn(i.geometry(),u,p,g);if(!Qa(u,p))return!1;for(const w of x)if(!ep(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wu=el;function tl(n){if(n instanceof Go&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Wu)return!1;let e=!0;return n.eachChild(i=>{e&&!tl(i)&&(e=!1)}),e}function nl(n){if(n instanceof Go&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!nl(i)&&(e=!1)}),e}function mc(n,e){if(n instanceof Go&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!mc(a,e)&&(i=!1)}),i}class gc{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new gc(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Hu=gc;class _c{constructor(e,i=[],a,u=new Wd,p=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=p,this.expectedType=a}parse(e,i,a,u,p={}){return i?this.concat(i,a,u)._parse(e,p):this._parse(e,p)}_parse(e,i){function a(u,p,g){return g==="assert"?new yo(p,[u]):g==="coerce"?new Ys(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,x=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(y,x))return null}else g=a(g,y,i.typeAnnotation||"coerce");else g=a(g,y,i.typeAnnotation||"assert")}if(!(g instanceof Ka)&&g.type.kind!=="resolvedImage"&&qo(g)){const y=new Ja;try{g=new Ka(g.type,g.evaluate(y))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const u=typeof e=="number"?this.path.concat(e):this.path,p=a?this.scope.concat(a):this.scope;return new _c(this.registry,u,i||null,p,this.errors)}error(e,...i){const a=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new io(a,e))}checkSubtype(e,i){const a=lr(e,i);return a&&this.error(a),a}}var Xu=_c;function qo(n){if(n instanceof Hu)return qo(n.boundExpression);if(n instanceof Go&&n.name==="error"||n instanceof hc||n instanceof Wu)return!1;const e=n instanceof Ys||n instanceof yo;let i=!0;return n.eachChild(a=>{i=e?i&&qo(a):i&&a instanceof Ka}),!!i&&tl(n)&&mc(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ts(n,e){const i=n.length-1;let a,u,p=0,g=i,y=0;for(;p<=g;)if(y=Math.floor((p+g)/2),a=n[y],u=n[y+1],a<=e){if(y===i||e<u)return y;p=y+1}else{if(!(a>e))throw new Vi("Input is not a number.");g=y-1}return 0}class yc{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of a)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,lt);if(!a)return null;const u=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<e.length;g+=2){const y=g===1?-1/0:e[g],x=e[g+1],w=g,A=g+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=i.parse(x,A,p);if(!C)return null;p=p||C.type,u.push([y,C])}return new yc(p,a,u)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const p=i.length;return u>=i[p-1]?a[p-1].evaluate(e):a[Ts(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Ku=yc;function xn(n,e,i){return n*(1-i)+e*i}var il=Object.freeze({__proto__:null,number:xn,color:function(n,e,i){return new yi(xn(n.r,e.r,i),xn(n.g,e.g,i),xn(n.b,e.b,i),xn(n.a,e.a,i))},array:function(n,e,i){return n.map((a,u)=>xn(a,e[u],i))}});const tp=.95047,np=1.08883,Yu=4/29,Ju=6/29,Qu=3*Ju*Ju,ip=Math.PI/180,Wm=180/Math.PI;function vc(n){return n>.008856451679035631?Math.pow(n,1/3):n/Qu+Yu}function eh(n){return n>Ju?n*n*n:Qu*(n-Yu)}function bc(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function xc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function rp(n){const e=xc(n.r),i=xc(n.g),a=xc(n.b),u=vc((.4124564*e+.3575761*i+.1804375*a)/tp),p=vc((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-vc((.0193339*e+.119192*i+.9503041*a)/np)),alpha:n.a}}function op(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*eh(e),i=tp*eh(i),a=np*eh(a),new yi(bc(3.2404542*i-1.5371385*e-.4985314*a),bc(-.969266*i+1.8760108*e+.041556*a),bc(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function Hm(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const rl={forward:rp,reverse:op,interpolate:function(n,e,i){return{l:xn(n.l,e.l,i),a:xn(n.a,e.a,i),b:xn(n.b,e.b,i),alpha:xn(n.alpha,e.alpha,i)}}},ol={forward:function(n){const{l:e,a:i,b:a}=rp(n),u=Math.atan2(a,i)*Wm;return{h:u<0?u+360:u,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*ip,i=n.c;return op({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Hm(n.h,e.h,i),c:xn(n.c,e.c,i),l:xn(n.l,e.l,i),alpha:xn(n.alpha,e.alpha,i)}}};var sp=Object.freeze({__proto__:null,lab:rl,hcl:ol});class sl{constructor(e,i,a,u,p){this.type=e,this.operator=i,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[g,y]of p)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,i,a,u){let p=0;if(e.name==="exponential")p=th(i,e.base,a,u);else if(e.name==="linear")p=th(i,1,a,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new Fe(g[0],g[1],g[2],g[3]).solve(th(i,1,a,u))}return p}static parse(e,i){let[a,u,p,...g]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const w=u[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const w=u.slice(1);if(w.length!==4||w.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,lt),!p)return null;const y=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=ro:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let w=0;w<g.length;w+=2){const A=g[w],C=g[w+1],M=w+3,R=w+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(y.length&&y[y.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const D=i.parse(C,R,x);if(!D)return null;x=x||D.type,y.push([A,D])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new sl(x,a,u,p,y):i.error(`Type ${Jn(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const p=i.length;if(u>=i[p-1])return a[p-1].evaluate(e);const g=Ts(i,u),y=sl.interpolationFactor(this.interpolation,u,i[g],i[g+1]),x=a[g].evaluate(e),w=a[g+1].evaluate(e);return this.operator==="interpolate"?il[this.type.kind.toLowerCase()](x,w,y):this.operator==="interpolate-hcl"?ol.reverse(ol.interpolate(ol.forward(x),ol.forward(w),y)):rl.reverse(rl.interpolate(rl.forward(x),rl.forward(w),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function th(n,e,i,a){const u=a-i,p=n-i;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}var oo=sl;class nh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const u=i.expectedType;u&&u.kind!=="value"&&(a=u);const p=[];for(const y of e.slice(1)){const x=i.parse(y,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,p.push(x)}const g=u&&p.some(y=>lr(u,y.type));return new nh(g?an:a,p)}evaluate(e){let i,a=null,u=0;for(const p of this.args){if(u++,a=p.evaluate(e),a&&a instanceof or&&!a.available&&(i||(i=a),a=null,u===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ap=nh;class wc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const y=i.parse(e[p+1],p+1);if(!y)return null;a.push([g,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return u?new wc(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}var ih=wc;class Tc{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,lt),u=i.parse(e[2],2,rr(i.expectedType||an));return a&&u?new Tc(u.type.itemType,a,u):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Vi(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Vi(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Vi(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Xm=Tc;class rh{constructor(e,i){this.type=un,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,an),u=i.parse(e[2],2,an);return a&&u?ju(a.type,[un,_n,lt,qs,an])?new rh(a,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!bs(i,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(Pi(i))} instead.`);if(!bs(a,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${Jn(Pi(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var lp=rh;class al{constructor(e,i,a){this.type=lt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,an),u=i.parse(e[2],2,an);if(!a||!u)return null;if(!ju(a.type,[un,_n,lt,qs,an]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(a.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,lt);return p?new al(a,u,p):null}return new al(a,u)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!bs(i,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(Pi(i))} instead.`);if(!bs(a,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${Jn(Pi(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(i,u)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var cp=al;class oh{constructor(e,i,a,u,p,g){this.inputType=e,this.type=i,this.input=a,this.cases=u,this.outputs=p,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const p={},g=[];for(let w=2;w<e.length-1;w+=2){let A=e[w];const C=e[w+1];Array.isArray(A)||(A=[A]);const M=i.concat(w);if(A.length===0)return M.error("Expected at least one branch label.");for(const D of A){if(typeof D!="number"&&typeof D!="string")return M.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return M.error("Numeric branch labels must be integer values.");if(a){if(M.checkSubtype(a,Pi(D)))return null}else a=Pi(D);if(p[String(D)]!==void 0)return M.error("Branch labels must be unique.");p[String(D)]=g.length}const R=i.parse(C,w,u);if(!R)return null;u=u||R.type,g.push(R)}const y=i.parse(e[1],1,an);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new oh(a,u,y,p,g,x):null}evaluate(e){const i=this.input.evaluate(e);return(Pi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],u={};for(const g of i){const y=u[this.cases[g]];y===void 0?(u[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[y][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,y]of a)e.push(y.length===1?p(y[0]):y.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var Km=oh;class sh{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const y=i.parse(e[g],g,un);if(!y)return null;const x=i.parse(e[g+1],g+1,a);if(!x)return null;u.push([y,x]),a=a||x.type}const p=i.parse(e[e.length-1],e.length-1,a);return p?new sh(a,u,p):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ym=sh;class Es{constructor(e,i,a,u){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,an),u=i.parse(e[2],2,lt);if(!a||!u)return null;if(!ju(a.type,[rr(an),_n,an]))return i.error(`Expected first argument to be of type array or string, but found ${Jn(a.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,lt);return p?new Es(a.type,a,u,p):null}return new Es(a.type,a,u)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!bs(i,["string","array"]))throw new Vi(`Expected first argument to be of type array or string, but found ${Jn(Pi(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(a,u)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var up=Es;function ah(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function hp(n,e,i,a){return a.compare(e,i)===0}function ea(n,e,i){const a=n!=="=="&&n!=="!=";return class nE{constructor(p,g,y){this.type=un,this.lhs=p,this.rhs=g,this.collator=y,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const y=p[0];let x=g.parse(p[1],1,an);if(!x)return null;if(!ah(y,x.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${Jn(x.type)}'.`);let w=g.parse(p[2],2,an);if(!w)return null;if(!ah(y,w.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${Jn(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return g.error(`Cannot compare types '${Jn(x.type)}' and '${Jn(w.type)}'.`);a&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new yo(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new yo(x.type,[w])));let A=null;if(p.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(p[3],3,qa),!A)return null}return new nE(x,w,A)}evaluate(p){const g=this.lhs.evaluate(p),y=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const x=Pi(g),w=Pi(y);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Vi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=Pi(g),w=Pi(y);if(x.kind!=="string"||w.kind!=="string")return e(p,g,y)}return this.collator?i(p,g,y,this.collator.evaluate(p)):e(p,g,y)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const Jm=ea("==",function(n,e,i){return e===i},hp),dp=ea("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!hp(0,e,i,a)}),pp=ea("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),fp=ea(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),lh=ea("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),Qm=ea(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class ch{constructor(e,i,a,u,p,g){this.type=_n,this.number=e,this.locale=i,this.currency=a,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,lt);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parse(u.locale,1,_n),!p))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,_n),!g))return null;let y=null;if(u.unit&&(y=i.parse(u.unit,1,_n),!y))return null;let x=null;if(u["min-fraction-digits"]&&(x=i.parse(u["min-fraction-digits"],1,lt),!x))return null;let w=null;return u["max-fraction-digits"]&&(w=i.parse(u["max-fraction-digits"],1,lt),!w)?null:new ch(a,p,g,y,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class uh{constructor(e){this.type=lt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Jn(a.type)} instead.`):new uh(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Vi(`Expected value to be of type string or array, but found ${Jn(Pi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const mp={"==":Jm,"!=":dp,">":fp,"<":pp,">=":Qm,"<=":lh,array:yo,at:Xm,boolean:yo,case:Ym,coalesce:ap,collator:hc,format:Ya,image:uc,in:lp,"index-of":cp,interpolate:oo,"interpolate-hcl":oo,"interpolate-lab":oo,length:uh,let:ih,literal:Ka,match:Km,number:yo,"number-format":ch,object:yo,slice:up,step:Ku,string:yo,"to-boolean":Ys,"to-color":Ys,"to-number":Ys,"to-string":Ys,var:Hu,within:Wu};function gp(n,[e,i,a,u]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const p=u?u.evaluate(n):1,g=Xd(e,i,a,p);if(g)throw new Vi(g);return new yi(e/255*p,i/255*p,a/255*p,p)}function _p(n,e){return n in e}function hh(n,e){const i=e[n];return i===void 0?null:i}function Wo(n){return{type:n}}Go.register(mp,{error:[{kind:"error"},[_n],(n,[e])=>{throw new Vi(e.evaluate(n))}],typeof:[_n,[an],(n,[e])=>Jn(Pi(e.evaluate(n)))],"to-rgba":[rr(lt,4),[ro],(n,[e])=>e.evaluate(n).toArray()],rgb:[ro,[lt,lt,lt],gp],rgba:[ro,[lt,lt,lt,lt],gp],has:{type:un,overloads:[[[_n],(n,[e])=>_p(e.evaluate(n),n.properties())],[[_n,vs],(n,[e,i])=>_p(e.evaluate(n),i.evaluate(n))]]},get:{type:an,overloads:[[[_n],(n,[e])=>hh(e.evaluate(n),n.properties())],[[_n,vs],(n,[e,i])=>hh(e.evaluate(n),i.evaluate(n))]]},"feature-state":[an,[_n],(n,[e])=>hh(e.evaluate(n),n.featureState||{})],properties:[vs,[],n=>n.properties()],"geometry-type":[_n,[],n=>n.geometryType()],id:[an,[],n=>n.id()],zoom:[lt,[],n=>n.globals.zoom],pitch:[lt,[],n=>n.globals.pitch||0],"distance-from-center":[lt,[],n=>n.distanceFromCenter()],"heatmap-density":[lt,[],n=>n.globals.heatmapDensity||0],"line-progress":[lt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[lt,[],n=>n.globals.skyRadialProgress||0],accumulated:[an,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[lt,Wo(lt),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[lt,Wo(lt),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:lt,overloads:[[[lt,lt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[lt],(n,[e])=>-e.evaluate(n)]]},"/":[lt,[lt,lt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[lt,[lt,lt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[lt,[lt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[lt,[lt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[lt,[lt],(n,[e])=>Math.log(e.evaluate(n))],log2:[lt,[lt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[lt,[lt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[lt,[lt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[lt,[lt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[lt,[lt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[lt,[lt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[lt,[lt],(n,[e])=>Math.atan(e.evaluate(n))],min:[lt,Wo(lt),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[lt,Wo(lt),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[lt,[lt],(n,[e])=>Math.abs(e.evaluate(n))],round:[lt,[lt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[lt,[lt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[lt,[lt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[un,[_n,an],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[un,[an],(n,[e])=>n.id()===e.value],"filter-type-==":[un,[_n],(n,[e])=>n.geometryType()===e.value],"filter-<":[un,[_n,an],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a<u}],"filter-id-<":[un,[an],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[un,[_n,an],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a>u}],"filter-id->":[un,[an],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[un,[_n,an],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[un,[an],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[un,[_n,an],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[un,[an],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[un,[an],(n,[e])=>e.value in n.properties()],"filter-has-id":[un,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[un,[rr(_n)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[un,[rr(an)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[un,[_n,rr(an)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[un,[_n,rr(an)],(n,[e,i])=>function(a,u,p,g){for(;p<=g;){const y=p+g>>1;if(u[y]===a)return!0;u[y]>a?g=y-1:p=y+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:un,overloads:[[[un,un],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Wo(un),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:un,overloads:[[[un,un],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Wo(un),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[un,[un],(n,[e])=>!e.evaluate(n)],"is-supported-script":[un,[_n],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[_n,[_n],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[_n,[_n],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[_n,Wo(an),(n,e)=>e.map(i=>Xa(i.evaluate(n))).join("")],"resolved-locale":[_n,[qa],(n,[e])=>e.evaluate(n).resolvedLocale()]});var ta=mp;function ll(n){return{result:"success",value:n}}function na(n){return{result:"error",value:n}}function ia(n){return n["property-type"]==="data-driven"}function vo(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ec(n){return!!n.expression&&n.expression.interpolated}function vn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function kc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function eg(n){return n}function dh(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",u=a||!(a||n.property!==void 0),p=n.type||(Ec(e)?"exponential":"interval");if(i&&((n=_o({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],yi.parse(w[1])])),n.default=yi.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!sp[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,y,x;if(p==="exponential")g=Sc;else if(p==="interval")g=yp;else if(p==="categorical"){g=ph,y=Object.create(null);for(const w of n.stops)y[w[0]]=w[1];x=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=vp}if(a){const w={},A=[];for(let R=0;R<n.stops.length;R++){const D=n.stops[R],N=D[0].zoom;w[N]===void 0&&(w[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},A.push(N)),w[N].stops.push([D[0].value,D[1]])}const C=[];for(const R of A)C.push([w[R].zoom,dh(w[R],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:oo.interpolationFactor.bind(void 0,M),zoomStops:C.map(R=>R[0]),evaluate:({zoom:R},D)=>Sc({stops:C,base:n.base},e,R).evaluate(R,D)}}if(u){const w=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:oo.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(n,e,A,y,x)}}return{kind:"source",evaluate(w,A){const C=A&&A.properties?A.properties[n.property]:void 0;return C===void 0?cl(n.default,e.default):g(n,e,C,y,x)}}}function cl(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function ph(n,e,i,a,u){return cl(typeof i===u?a[i]:void 0,n.default,e.default)}function yp(n,e,i){if(vn(i)!=="number")return cl(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const u=Ts(n.stops.map(p=>p[0]),i);return n.stops[u][1]}function Sc(n,e,i){const a=n.base!==void 0?n.base:1;if(vn(i)!=="number")return cl(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const p=Ts(n.stops.map(A=>A[0]),i),g=function(A,C,M,R){const D=R-M,N=A-M;return D===0?0:C===1?N/D:(Math.pow(C,N)-1)/(Math.pow(C,D)-1)}(i,a,n.stops[p][0],n.stops[p+1][0]),y=n.stops[p][1],x=n.stops[p+1][1];let w=il[e.type]||eg;if(n.colorSpace&&n.colorSpace!=="rgb"){const A=sp[n.colorSpace];w=(C,M)=>A.reverse(A.interpolate(A.forward(C),A.forward(M),g))}return typeof y.evaluate=="function"?{evaluate(...A){const C=y.evaluate.apply(void 0,A),M=x.evaluate.apply(void 0,A);if(C!==void 0&&M!==void 0)return w(C,M,g)}}:w(y,x,g)}function vp(n,e,i){return e.type==="color"?i=yi.parse(i):e.type==="formatted"?i=ur.fromString(i.toString()):e.type==="resolvedImage"?i=or.fromString(i.toString()):vn(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),cl(i,n.default,e.default)}class Ac{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Ja,this._defaultValue=i?function(a){return a.type==="color"&&(kc(a.default)||Array.isArray(a.default))?new yi(0,0,0,0):a.type==="color"?yi.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,a,u,p,g,y,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,u,p,g,y,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Vi(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function ra(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ta}function oa(n,e){const i=new Xu(ta,[],e?function(u){const p={color:ro,string:_n,number:lt,enum:_n,boolean:un,formatted:Ws,resolvedImage:Hs};return u.type==="array"?rr(p[u.value]||an,u.length):p[u.type]}(e):void 0),a=i.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ll(new Ac(a,e)):na(i.errors)}class Ic{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!nl(i.expression)}evaluateWithoutErrorHandling(e,i,a,u,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,p,g)}evaluate(e,i,a,u,p,g){return this._styleExpression.evaluate(e,i,a,u,p,g)}}class ks{constructor(e,i,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!nl(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,a,u,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,p,g)}evaluate(e,i,a,u,p,g){return this._styleExpression.evaluate(e,i,a,u,p,g)}interpolationFactor(e,i,a){return this.interpolationType?oo.interpolationFactor(this.interpolationType,e,i,a):0}}function Ss(n,e){if((n=oa(n,e)).result==="error")return n;const i=n.value.expression,a=tl(i);if(!a&&!ia(e))return na([new io("","data expressions not supported")]);const u=mc(i,["zoom","pitch","distance-from-center"]);if(!u&&!vo(e))return na([new io("","zoom expressions not supported")]);const p=hl(i);return p||u?p instanceof io?na([p]):p instanceof oo&&!Ec(e)?na([new io("",'"interpolate" expressions cannot be used with this property')]):ll(p?new ks(a?"camera":"composite",n.value,p.labels,p instanceof oo?p.interpolation:void 0):new Ic(a?"constant":"source",n.value)):na([new io("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ul{constructor(e,i){this._parameters=e,this._specification=i,_o(this,dh(this._parameters,this._specification))}static deserialize(e){return new ul(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function hl(n){let e=null;if(n instanceof ih)e=hl(n.result);else if(n instanceof ap){for(const i of n.args)if(e=hl(i),e)break}else(n instanceof Ku||n instanceof oo)&&n.input instanceof Go&&n.input.name==="zoom"&&(e=n);return e instanceof io||n.eachChild(i=>{const a=hl(i);a instanceof io?e=a:!e&&a?e=new io("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new io("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class _t{constructor(e,i,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function Br(n){const e=n.key,i=n.value,a=n.valueSpec||{},u=n.objectElementValidators||{},p=n.style,g=n.styleSpec;let y=[];const x=vn(i);if(x!=="object")return[new _t(e,i,`object expected, ${x} found`)];for(const w in i){const A=w.split(".")[0],C=a[A]||a["*"];let M;u[A]?M=u[A]:a[A]?M=Hi:u["*"]?M=u["*"]:a["*"]&&(M=Hi),M?y=y.concat(M({key:(e&&`${e}.`)+w,value:i[w],valueSpec:C,style:p,styleSpec:g,object:i,objectKey:w},i)):y.push(new _t(e,i[w],`unknown property "${w}"`))}for(const w in a)u[w]||a[w].required&&a[w].default===void 0&&i[w]===void 0&&y.push(new _t(e,i,`missing required property "${w}"`));return y}function bp(n){const e=n.value,i=n.valueSpec,a=n.style,u=n.styleSpec,p=n.key,g=n.arrayElementValidator||Hi;if(vn(e)!=="array")return[new _t(p,e,`array expected, ${vn(e)} found`)];if(i.length&&e.length!==i.length)return[new _t(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new _t(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(y.function=i.function),vn(i.value)==="object"&&(y=i.value);let x=[];for(let w=0;w<e.length;w++)x=x.concat(g({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:a,styleSpec:u,key:`${p}[${w}]`}));return x}function fh(n){const e=n.key,i=n.value,a=n.valueSpec;let u=vn(i);if(u==="number"&&i!=i&&(u="NaN"),u!=="number")return[new _t(e,i,`number expected, ${u} found`)];if("minimum"in a){let p=a.minimum;if(vn(a.minimum)==="array"&&(p=a.minimum[n.arrayIndex]),i<p)return[new _t(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in a){let p=a.maximum;if(vn(a.maximum)==="array"&&(p=a.maximum[n.arrayIndex]),i>p)return[new _t(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function dl(n){const e=n.valueSpec,i=wi(n.value.type);let a,u,p,g={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,w=vn(n.value.stops)==="array"&&vn(n.value.stops[0])==="array"&&vn(n.value.stops[0][0])==="object",A=Br({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if(i==="identity")return[new _t(R.key,R.value,'identity function may not have a "stops" property')];let D=[];const N=R.value;return D=D.concat(bp({key:R.key,value:N,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),vn(N)==="array"&&N.length===0&&D.push(new _t(R.key,N,"array must have at least one stop")),D},default:function(R){return Hi({key:R.key,value:R.value,valueSpec:e,style:R.style,styleSpec:R.styleSpec})}}});return i==="identity"&&y&&A.push(new _t(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||A.push(new _t(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Ec(n.valueSpec)&&A.push(new _t(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!ia(n.valueSpec)?A.push(new _t(n.key,n.value,"property functions not supported")):y&&!vo(n.valueSpec)&&A.push(new _t(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!w||n.value.property!==void 0||A.push(new _t(n.key,n.value,'"property" property is required')),A;function C(R){let D=[];const N=R.value,G=R.key;if(vn(N)!=="array")return[new _t(G,N,`array expected, ${vn(N)} found`)];if(N.length!==2)return[new _t(G,N,`array length 2 expected, length ${N.length} found`)];if(w){if(vn(N[0])!=="object")return[new _t(G,N,`object expected, ${vn(N[0])} found`)];if(N[0].zoom===void 0)return[new _t(G,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new _t(G,N,"object stop key must have value")];const ee=wi(N[0].zoom);if(typeof ee!="number")return[new _t(G,N[0].zoom,"stop zoom values must be numbers")];if(p&&p>ee)return[new _t(G,N[0].zoom,"stop zoom values must appear in ascending order")];ee!==p&&(p=ee,u=void 0,g={}),D=D.concat(Br({key:`${G}[0]`,value:N[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:fh,value:M}}))}else D=D.concat(M({key:`${G}[0]`,value:N[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},N));return ra(Vo(N[1]))?D.concat([new _t(`${G}[1]`,N[1],"expressions are not allowed in function stops.")]):D.concat(Hi({key:`${G}[1]`,value:N[1],valueSpec:e,style:R.style,styleSpec:R.styleSpec}))}function M(R,D){const N=vn(R.value),G=wi(R.value),ee=R.value!==null?R.value:D;if(a){if(N!==a)return[new _t(R.key,ee,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new _t(R.key,ee,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&i!=="categorical"){let se=`number expected, ${N} found`;return ia(e)&&i===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(R.key,ee,se)]}return i!=="categorical"||N!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?i!=="categorical"&&N==="number"&&typeof G=="number"&&typeof u=="number"&&u!==void 0&&G<u?[new _t(R.key,ee,"stop domain values must appear in ascending order")]:(u=G,i==="categorical"&&G in g?[new _t(R.key,ee,"stop domain values must be unique")]:(g[G]=!0,[])):[new _t(R.key,ee,`integer expected, found ${String(G)}`)]}}function sa(n){const e=(n.expressionContext==="property"?Ss:oa)(Vo(n.value),n.valueSpec);if(e.result==="error")return e.value.map(a=>new _t(`${n.key}${a.key}`,n.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new _t(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!nl(i))return[new _t(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return xp(i,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!mc(i,["zoom","feature-state"]))return[new _t(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!tl(i))return[new _t(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xp(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(i.size===0)return[];const a=[];return n instanceof Go&&i.has(n.name)?[new _t(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{a.push(...xp(u,e))}),a)}function Cc(n){const e=n.key,i=n.value,a=n.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(wi(i))===-1&&u.push(new _t(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(wi(i))===-1&&u.push(new _t(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function mh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!mh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Mc(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};mh(n)||(n=Lc(n));const i=n;let a=!0;try{a=function(w){if(!ji(w))return w;let A=Vo(w);return fl(A),A=pl(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const u=je[`filter_${e}`],p=oa(a,u);let g=null;if(p.result==="error")throw new Error(p.value.map(w=>`${w.key}: ${w.message}`).join(", "));g=(w,A,C)=>p.value.evaluate(w,A,{},C);let y=null,x=null;if(a!==i){const w=oa(i,u);if(w.result==="error")throw new Error(w.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,C,M,R,D)=>w.value.evaluate(A,C,{},M,void 0,void 0,R,D),x=!tl(w.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:wp(a),needFeature:!!x}}function pl(n){if(!Array.isArray(n))return n;const e=function(i){if(Pc.has(i[0])){for(let a=1;a<i.length;a++)if(ji(i[a]))return!0}return i}(n);return e===!0?e:e.map(i=>pl(i))}function fl(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||ji(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||ji(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||ji(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)fl(n[a])}function ji(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(ji(n[i]))return!0;return!1}const Pc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function tg(n,e){return n<e?-1:n>e?1:0}function wp(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(wp(n[e]))return!0;return!1}function Lc(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?gh(n[1],n[2],"=="):e==="!="?aa(gh(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gh(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Lc))):e==="all"?["all"].concat(n.slice(1).map(Lc)):e==="none"?["all"].concat(n.slice(1).map(Lc).map(aa)):e==="in"?zc(n[1],n.slice(2)):e==="!in"?aa(zc(n[1],n.slice(2))):e==="has"?Tp(n[1]):e==="!has"?aa(Tp(n[1])):e!=="within"||n;var i}function gh(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function zc(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(tg)]]:["filter-in-small",n,["literal",e]]}}function Tp(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function aa(n){return["!",n]}function _h(n){return mh(Vo(n.value))?sa(_o({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Ep(n)}function Ep(n){const e=n.value,i=n.key;if(vn(e)!=="array")return[new _t(i,e,`array expected, ${vn(e)} found`)];const a=n.styleSpec;let u,p=[];if(e.length<1)return[new _t(i,e,"filter array must have at least 1 element")];switch(p=p.concat(Cc({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),wi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&wi(e[1])==="$type"&&p.push(new _t(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new _t(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=vn(e[1]),u!=="string"&&p.push(new _t(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=vn(e[g]),wi(e[1])==="$type"?p=p.concat(Cc({key:`${i}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new _t(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Ep({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=vn(e[1]),e.length!==2?p.push(new _t(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new _t(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=vn(e[1]),e.length!==2?p.push(new _t(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&p.push(new _t(`${i}[1]`,e[1],`object expected, ${u} found`))}return p}function Rc(n,e){const i=n.key,a=n.style,u=n.styleSpec,p=n.value,g=n.objectKey,y=u[`${e}_${n.layerType}`];if(!y)return[];const x=g.match(/^(.*)-transition$/);if(e==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return Hi({key:i,value:p,valueSpec:u.transition,style:a,styleSpec:u});const w=n.valueSpec||y[g];if(!w)return[new _t(i,p,`unknown property "${g}"`)];let A;if(vn(p)==="string"&&ia(w)&&!w.tokens&&(A=/^{([^}]+)}$/.exec(p)))return[new _t(i,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const C=[];return n.layerType==="symbol"&&(g==="text-field"&&a&&!a.glyphs&&C.push(new _t(i,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&kc(Vo(p))&&wi(p.type)==="identity"&&C.push(new _t(i,p,'"text-font" does not support identity functions'))),C.concat(Hi({key:n.key,value:p,valueSpec:w,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function kp(n){return Rc(n,"paint")}function yh(n){return Rc(n,"layout")}function vh(n){let e=[];const i=n.value,a=n.key,u=n.style,p=n.styleSpec;i.type||i.ref||e.push(new _t(a,i,'either "type" or "ref" is required'));let g=wi(i.type);const y=wi(i.ref);if(i.id){const x=wi(i.id);for(let w=0;w<n.arrayIndex;w++){const A=u.layers[w];wi(A.id)===x&&e.push(new _t(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&e.push(new _t(a,i[w],`"${w}" is prohibited for ref layers`))}),u.layers.forEach(w=>{wi(w.id)===y&&(x=w)}),x?x.ref?e.push(new _t(a,i.ref,"ref cannot reference another ref layer")):g=wi(x.type):typeof y=="string"&&e.push(new _t(a,i.ref,`ref layer "${y}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const x=u.sources&&u.sources[i.source],w=x&&wi(x.type);x?w==="vector"&&g==="raster"?e.push(new _t(a,i.source,`layer "${i.id}" requires a raster source`)):w==="raster"&&g!=="raster"?e.push(new _t(a,i.source,`layer "${i.id}" requires a vector source`)):w!=="vector"||i["source-layer"]?w==="raster-dem"&&g!=="hillshade"?e.push(new _t(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||w==="geojson"&&x.lineMetrics||e.push(new _t(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new _t(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new _t(a,i.source,`source "${i.source}" not found`))}else e.push(new _t(a,i,'missing required property "source"'));return e=e.concat(Br({key:a,value:i,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hi({key:`${a}.type`,value:i.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:x=>_h(_o({layerType:g},x)),layout:x=>Br({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>yh(_o({layerType:g},w))}}),paint:x=>Br({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>kp(_o({layerType:g},w))}})}})),e}function la(n){const e=n.value,i=n.key,a=vn(e);return a!=="string"?[new _t(i,e,`string expected, ${a} found`)]:[]}const Dc={promoteId:function({key:n,value:e}){if(vn(e)==="string")return la({key:n,value:e});{const i=[];for(const a in e)i.push(...la({key:`${n}.${a}`,value:e[a]}));return i}}};function ml(n){const e=n.value,i=n.key,a=n.styleSpec,u=n.style;if(!e.type)return[new _t(i,e,'"type" is required')];const p=wi(e.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=Br({key:i,value:e,valueSpec:a[`source_${p.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:Dc}),g;case"geojson":if(g=Br({key:i,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:Dc}),e.cluster)for(const y in e.clusterProperties){const[x,w]=e.clusterProperties[y],A=typeof x=="string"?[x,["accumulated"],["get",y]]:x;g.push(...sa({key:`${i}.${y}.map`,value:w,expressionContext:"cluster-map"})),g.push(...sa({key:`${i}.${y}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return Br({key:i,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return Br({key:i,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new _t(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cc({key:`${i}.type`,value:e.type,valueSpec:{values:Sp(a)},style:u,styleSpec:a})}}function Sp(n){return n.source.reduce((e,i)=>{const a=n[i];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Ap(n){const e=n.value,i=n.styleSpec,a=i.light,u=n.style;let p=[];const g=vn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new _t("light",e,`object expected, ${g} found`)]),p;for(const y in e){const x=y.match(/^(.*)-transition$/);p=p.concat(x&&a[x[1]]&&a[x[1]].transition?Hi({key:y,value:e[y],valueSpec:i.transition,style:u,styleSpec:i}):a[y]?Hi({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:i}):[new _t(y,e[y],`unknown property "${y}"`)])}return p}function bh(n){const e=n.value,i=n.key,a=n.style,u=n.styleSpec,p=u.terrain;let g=[];const y=vn(e);if(e===void 0)return g;if(y!=="object")return g=g.concat([new _t("terrain",e,`object expected, ${y} found`)]),g;for(const x in e){const w=x.match(/^(.*)-transition$/);g=g.concat(w&&p[w[1]]&&p[w[1]].transition?Hi({key:x,value:e[x],valueSpec:u.transition,style:a,styleSpec:u}):p[x]?Hi({key:x,value:e[x],valueSpec:p[x],style:a,styleSpec:u}):[new _t(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=a.sources&&a.sources[e.source],w=x&&wi(x.type);x?w!=="raster-dem"&&g.push(new _t(i,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):g.push(new _t(i,e.source,`source "${e.source}" not found`))}else g.push(new _t(i,e,'terrain is missing required property "source"'));return g}function Ip(n){const e=n.value,i=n.style,a=n.styleSpec,u=a.fog;let p=[];const g=vn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new _t("fog",e,`object expected, ${g} found`)]),p;for(const y in e){const x=y.match(/^(.*)-transition$/);p=p.concat(x&&u[x[1]]&&u[x[1]].transition?Hi({key:y,value:e[y],valueSpec:a.transition,style:i,styleSpec:a}):u[y]?Hi({key:y,value:e[y],valueSpec:u[y],style:i,styleSpec:a}):[new _t(y,e[y],`unknown property "${y}"`)])}return p}const Oc={"*":()=>[],array:bp,boolean:function(n){const e=n.value,i=n.key,a=vn(e);return a!=="boolean"?[new _t(i,e,`boolean expected, ${a} found`)]:[]},number:fh,color:function(n){const e=n.key,i=n.value,a=vn(i);return a!=="string"?[new _t(e,i,`color expected, ${a} found`)]:Nu(i)===null?[new _t(e,i,`color expected, "${i}" found`)]:[]},enum:Cc,filter:_h,function:dl,layer:vh,object:Br,source:ml,light:Ap,terrain:bh,fog:Ip,string:la,formatted:function(n){return la(n).length===0?[]:sa(n)},resolvedImage:function(n){return la(n).length===0?[]:sa(n)},projection:function(n){const e=n.value,i=n.styleSpec,a=i.projection,u=n.style;let p=[];const g=vn(e);if(g==="object")for(const y in e)p=p.concat(Hi({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:i}));else g!=="string"&&(p=p.concat([new _t("projection",e,`object or string expected, ${g} found`)]));return p}};function Hi(n){const e=n.value,i=n.valueSpec,a=n.styleSpec;return i.expression&&kc(wi(e))?dl(n):i.expression&&ra(Vo(e))?sa(n):i.type&&Oc[i.type]?Oc[i.type](n):Br(_o({},n,{valueSpec:i.type?a[i.type]:i}))}function ng(n){const e=n.value,i=n.key,a=la(n);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new _t(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new _t(i,e,'"glyphs" url must include a "{range}" token'))),a}function Cp(n,e=je){return bo(Hi({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:ng,"*":()=>[]}}))}const ig=n=>bo(kp(n)),Mp=n=>bo(yh(n));function bo(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Pp(n,e){let i=!1;if(e&&e.length)for(const a of e)n.fire(new Uo(new Error(a.message))),i=!0;return i}var ca=so;function so(n,e,i){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var p=0;p<this.d*this.d;p++){var g=u[3+p],y=u[3+p+1];a.push(g===y?null:u.subarray(g,y))}var x=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var A=i/e*n;this.min=-A,this.max=n+A}so.prototype.insert=function(n,e,i,a,u){this._forEachCell(e,i,a,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)},so.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},so.prototype._insertCell=function(n,e,i,a,u,p){this.cells[u].push(p)},so.prototype.query=function(n,e,i,a,u){var p=this.min,g=this.max;if(n<=p&&e<=p&&g<=i&&g<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,i,a,this._queryCell,y,{},u),y},so.prototype._queryCell=function(n,e,i,a,u,p,g,y){var x=this.cells[u];if(x!==null)for(var w=this.keys,A=this.bboxes,C=0;C<x.length;C++){var M=x[C];if(g[M]===void 0){var R=4*M;(y?y(A[R+0],A[R+1],A[R+2],A[R+3]):n<=A[R+2]&&e<=A[R+3]&&i>=A[R+0]&&a>=A[R+1])?(g[M]=!0,p.push(w[M])):g[M]=!1}}},so.prototype._forEachCell=function(n,e,i,a,u,p,g,y){for(var x=this._convertToCellCoord(n),w=this._convertToCellCoord(e),A=this._convertToCellCoord(i),C=this._convertToCellCoord(a),M=x;M<=A;M++)for(var R=w;R<=C;R++){var D=this.d*R+M;if((!y||y(this._convertFromCellCoord(M),this._convertFromCellCoord(R),this._convertFromCellCoord(M+1),this._convertFromCellCoord(R+1)))&&u.call(this,n,e,i,a,D,p,g,y))return}},so.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},so.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},so.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,g=0;g<n.length;g++){var y=n[g];u[3+g]=p,u.set(y,p),p+=y.length}return u[3+n.length]=p,u.set(this.keys,p),u[3+n.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};const Bc={};function Et(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Bc[e]={klass:n,omit:i.omit||[]}}Et(Object,"Object"),ca.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},ca.deserialize=function(n){return new ca(n.buffer)},Object.defineProperty(ca,"name",{value:"Grid"}),Et(ca,"Grid"),Et(yi,"Color"),Et(Error,"Error"),Et(Mi,"AJAXError"),Et(or,"ResolvedImage"),Et(ul,"StylePropertyFunction"),Et(Ac,"StyleExpression",{omit:["_evaluator"]}),Et(ks,"ZoomDependentExpression"),Et(Ic,"ZoomConstantExpression"),Et(Go,"CompoundExpression",{omit:["_evaluate"]});for(const n in ta)Bc[ta[n]._classRegistryKey]||Et(ta[n],`Expression${n}`);function Lp(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function gl(n){return S.ImageBitmap&&n instanceof S.ImageBitmap}function _l(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Lp(n)||gl(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof S.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(_l(a,e));return i}if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const p in n)n.hasOwnProperty(p)&&(Bc[a].omit.indexOf(p)>=0||(u[p]=_l(n[p],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof n)}function yl(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Lp(n)||gl(n)||ArrayBuffer.isView(n)||n instanceof S.ImageData)return n;if(Array.isArray(n))return n.map(yl);if(typeof n=="object"){const e=n.$name||"Object",{klass:i}=Bc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const u of Object.keys(n))u!=="$name"&&(a[u]=yl(n[u]));return a}throw new Error("can't deserialize object of type "+typeof n)}const vl=n=>n>=1536&&n<=1791,zp=n=>n>=1872&&n<=1919,xh=n=>n>=2208&&n<=2303,Rp=n=>n>=11904&&n<=12031,wh=n=>n>=12032&&n<=12255,Th=n=>n>=12272&&n<=12287,bl=n=>n>=12288&&n<=12351,Fc=n=>n>=12352&&n<=12447,ua=n=>n>=12448&&n<=12543,jc=n=>n>=12544&&n<=12591,Dp=n=>n>=12704&&n<=12735,Op=n=>n>=12736&&n<=12783,Eh=n=>n>=12784&&n<=12799,Bp=n=>n>=12800&&n<=13055,Fp=n=>n>=13056&&n<=13311,jp=n=>n>=13312&&n<=19903,kh=n=>n>=19968&&n<=40959,Np=n=>n>=40960&&n<=42127,$p=n=>n>=42128&&n<=42191,Up=n=>n>=44032&&n<=55215,Vp=n=>n>=63744&&n<=64255,Nc=n=>n>=64336&&n<=65023,xl=n=>n>=65040&&n<=65055,d=n=>n>=65072&&n<=65103,o=n=>n>=65104&&n<=65135,c=n=>n>=65136&&n<=65279,f=n=>n>=65280&&n<=65519;function _(n){for(const e of n)if(k(e.charCodeAt(0)))return!0;return!1}function b(n){for(const e of n)if(!E(e.charCodeAt(0)))return!1;return!0}function E(n){return!(vl(n)||zp(n)||xh(n)||Nc(n)||c(n))}function k(n){return!(n!==746&&n!==747&&(n<4352||!(Dp(n)||jc(n)||d(n)&&!(n>=65097&&n<=65103)||Vp(n)||Fp(n)||Rp(n)||Op(n)||!(!bl(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||jp(n)||kh(n)||Bp(n)||(e=>e>=12592&&e<=12687)(n)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||Up(n)||Fc(n)||Th(n)||(e=>e>=12688&&e<=12703)(n)||wh(n)||Eh(n)||ua(n)&&n!==12540||!(!f(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!o(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||xl(n)||(e=>e>=19904&&e<=19967)(n)||Np(n)||$p(n))))}function I(n){return!(k(n)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||bl(e)||ua(e)||(i=>i>=57344&&i<=63743)(e)||d(e)||o(e)||f(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function P(n){return n>=1424&&n<=2303||Nc(n)||c(n)}function L(n,e){return!(!e&&P(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=>i>=6016&&i<=6143)(n))}function j(n){for(const e of n)if(P(e.charCodeAt(0)))return!0;return!1}const V="deferred",W="loading",q="loaded";let H=null,X="unavailable",U=null;const te=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(X="error"),H&&H(n)};function Q(){ie.fire(new Vn("pluginStateChange",{pluginStatus:X,pluginURL:U}))}const ie=new go,ue=function(){return X},le=function(){if(X!==V||!U)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");X=W,Q(),U&&no({url:U},n=>{n?te(n):(X=q,Q())})},de={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>X===q||de.applyArabicShaping!=null,isLoading:()=>X===W,setState(n){X=n.pluginStatus,U=n.pluginURL},isParsed:()=>de.applyArabicShaping!=null&&de.processBidirectionalText!=null&&de.processStyledBidirectionalText!=null,getPluginURL:()=>U};class xe{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,a){for(const u of i)if(!L(u.charCodeAt(0),a))return!1;return!0}(e,de.isLoaded())}}class Ae{constructor(e,i){this.property=e,this.value=i,this.expression=function(a,u){if(kc(a))return new ul(a,u);if(ra(a)){const p=Ss(a,u);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=a;return typeof a=="string"&&u.type==="color"&&(p=yi.parse(a)),{kind:"constant",evaluate:()=>p}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Le{constructor(e){this.property=e,this.value=new Ae(e,void 0)}transitioned(e,i){return new Ee(this.property,this.value,i,Jt({},e.transition,this.transition),e.now)}untransitioned(){return new Ee(this.property,this.value,null,{},0)}}class st{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return En(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Le(this._values[e].property)),this._values[e].value=new Ae(this._values[e].property,i===null?void 0:En(i))}getTransition(e){return En(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Le(this._values[e].property)),this._values[e].transition=En(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const a=new Ve(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,i._values[u]);return a}untransitioned(){const e=new Ve(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ee{constructor(e,i,a,u,p){const g=u.delay||0,y=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+g,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,a),g=this.prior;if(g){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return g.possiblyEvaluate(e,i,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,a),p,Tn(y))}}return p}}class Ve{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const u=new Ce(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Oe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return En(this._values[e].value)}setValue(e,i){this._values[e]=new Ae(this._values[e].property,i===null?void 0:En(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const u=new Ce(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,a);return u}}class Je{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,u){return this.property.evaluate(this.value,this.parameters,e,i,a,u)}}class Ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ye{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const u=il[this.specification.type];return u?u(e,i,a):e}}class Re{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,u){return new Je(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,u)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Je(this,{kind:"constant",value:void 0},e.parameters);const u=il[this.specification.type];return u?new Je(this,{kind:"constant",value:u(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,u,p,g){return e.kind==="constant"?e.value:e.evaluate(i,a,u,p,g)}}class He{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){return!!e.expression.evaluate(i,null,{},a,u)}interpolate(){return!1}}class tt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new xe(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const p=this.defaultPropertyValues[a]=new Ae(u,void 0),g=this.defaultTransitionablePropertyValues[a]=new Le(u);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate(i)}}}function Ct(n,e){return 256*(n=At(Math.floor(n),0,255))+At(Math.floor(e),0,255)}Et(Re,"DataDrivenProperty"),Et(ye,"DataConstantProperty"),Et(He,"ColorRampProperty");const Qt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kt{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Mt(n,e=1){let i=0,a=0;return{members:n.map(u=>{const p=Qt[u.type].BYTES_PER_ELEMENT,g=i=hn(i,Math.max(e,p)),y=u.components||1;return a=Math.max(a,p),i+=p*y,{name:u.name,type:u.type,components:y,offset:g}}),size:hn(i,Math.max(a,e)),alignment:e}}function hn(n,e){return Math.ceil(n/e)*e}class Dt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=a,e}}Dt.prototype.bytesPerElement=4,Et(Dt,"StructArrayLayout2i4");class Dn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=u,e}}Dn.prototype.bytesPerElement=6,Et(Dn,"StructArrayLayout3i6");class Gn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u)}emplace(e,i,a,u,p){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=u,this.int16[g+3]=p,e}}Gn.prototype.bytesPerElement=8,Et(Gn,"StructArrayLayout4i8");class Qn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,u,p,g,y)}emplace(e,i,a,u,p,g,y,x){const w=6*e,A=12*e,C=3*e;return this.int16[w+0]=i,this.int16[w+1]=a,this.uint8[A+4]=u,this.uint8[A+5]=p,this.uint8[A+6]=g,this.uint8[A+7]=y,this.float32[C+2]=x,e}}Qn.prototype.bytesPerElement=12,Et(Qn,"StructArrayLayout2i4ub1f12");class Xn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u)}emplace(e,i,a,u,p){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=u,this.float32[g+3]=p,e}}Xn.prototype.bytesPerElement=16,Et(Xn,"StructArrayLayout4f16");class Ti extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,u,p)}emplace(e,i,a,u,p,g){const y=6*e,x=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=p,this.float32[x+2]=g,e}}Ti.prototype.bytesPerElement=12,Et(Ti,"StructArrayLayout4ui1f12");class hr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u)}emplace(e,i,a,u,p){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=u,this.uint16[g+3]=p,e}}hr.prototype.bytesPerElement=8,Et(hr,"StructArrayLayout4ui8");class Hr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,u,p,g)}emplace(e,i,a,u,p,g,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=g,this.int16[x+5]=y,e}}Hr.prototype.bytesPerElement=12,Et(Hr,"StructArrayLayout6i12");class xo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g,y,x,w,A,C,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,a,u,p,g,y,x,w,A,C,M)}emplace(e,i,a,u,p,g,y,x,w,A,C,M,R){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=a,this.int16[D+2]=u,this.int16[D+3]=p,this.uint16[D+4]=g,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=w,this.int16[D+8]=A,this.int16[D+9]=C,this.int16[D+10]=M,this.int16[D+11]=R,e}}xo.prototype.bytesPerElement=24,Et(xo,"StructArrayLayout4i4ui4i24");class li extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,u,p,g)}emplace(e,i,a,u,p,g,y){const x=10*e,w=5*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=u,this.float32[w+2]=p,this.float32[w+3]=g,this.float32[w+4]=y,e}}li.prototype.bytesPerElement=20,Et(li,"StructArrayLayout3i3f20");class Kn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Kn.prototype.bytesPerElement=4,Et(Kn,"StructArrayLayout1ul4");class An extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g,y,x,w,A,C,M,R){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,a,u,p,g,y,x,w,A,C,M,R)}emplace(e,i,a,u,p,g,y,x,w,A,C,M,R,D){const N=20*e,G=10*e;return this.int16[N+0]=i,this.int16[N+1]=a,this.int16[N+2]=u,this.int16[N+3]=p,this.int16[N+4]=g,this.float32[G+3]=y,this.float32[G+4]=x,this.float32[G+5]=w,this.float32[G+6]=A,this.int16[N+14]=C,this.uint32[G+8]=M,this.uint16[N+18]=R,this.uint16[N+19]=D,e}}An.prototype.bytesPerElement=40,Et(An,"StructArrayLayout5i4f1i1ul2ui40");class gi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,u,p,g,y)}emplace(e,i,a,u,p,g,y,x){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+4]=p,this.int16[w+5]=g,this.int16[w+6]=y,this.int16[w+7]=x,e}}gi.prototype.bytesPerElement=16,Et(gi,"StructArrayLayout3i2i2i16");class Xi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,u,p)}emplace(e,i,a,u,p,g){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[x+6]=p,this.int16[x+7]=g,e}}Xi.prototype.bytesPerElement=16,Et(Xi,"StructArrayLayout2f1f2i16");class ii extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u)}emplace(e,i,a,u,p){const g=12*e,y=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=a,this.float32[y+1]=u,this.float32[y+2]=p,e}}ii.prototype.bytesPerElement=12,Et(ii,"StructArrayLayout2ub2f12");class Ki extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=u,e}}Ki.prototype.bytesPerElement=12,Et(Ki,"StructArrayLayout3f12");class Yi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=u,e}}Yi.prototype.bytesPerElement=6,Et(Yi,"StructArrayLayout3ui6");class Ho extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G,ee,se,K,oe,ce){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G,ee,se,K,oe,ce)}emplace(e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G,ee,se,K,oe,ce,ae){const Me=30*e,Se=15*e,Ne=60*e;return this.int16[Me+0]=i,this.int16[Me+1]=a,this.int16[Me+2]=u,this.float32[Se+2]=p,this.float32[Se+3]=g,this.uint16[Me+8]=y,this.uint16[Me+9]=x,this.uint32[Se+5]=w,this.uint32[Se+6]=A,this.uint32[Se+7]=C,this.uint16[Me+16]=M,this.uint16[Me+17]=R,this.uint16[Me+18]=D,this.float32[Se+10]=N,this.float32[Se+11]=G,this.uint8[Ne+48]=ee,this.uint8[Ne+49]=se,this.uint8[Ne+50]=K,this.uint32[Se+13]=oe,this.int16[Me+28]=ce,this.uint8[Ne+58]=ae,e}}Ho.prototype.bytesPerElement=60,Et(Ho,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ha extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G,ee,se,K,oe,ce,ae,Me,Se,Ne,it,De,Ue,Ze,Qe){const rt=this.length;return this.resize(rt+1),this.emplace(rt,e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G,ee,se,K,oe,ce,ae,Me,Se,Ne,it,De,Ue,Ze,Qe)}emplace(e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G,ee,se,K,oe,ce,ae,Me,Se,Ne,it,De,Ue,Ze,Qe,rt){const Be=38*e,ct=19*e;return this.int16[Be+0]=i,this.int16[Be+1]=a,this.int16[Be+2]=u,this.float32[ct+2]=p,this.float32[ct+3]=g,this.int16[Be+8]=y,this.int16[Be+9]=x,this.int16[Be+10]=w,this.int16[Be+11]=A,this.int16[Be+12]=C,this.int16[Be+13]=M,this.uint16[Be+14]=R,this.uint16[Be+15]=D,this.uint16[Be+16]=N,this.uint16[Be+17]=G,this.uint16[Be+18]=ee,this.uint16[Be+19]=se,this.uint16[Be+20]=K,this.uint16[Be+21]=oe,this.uint16[Be+22]=ce,this.uint16[Be+23]=ae,this.uint16[Be+24]=Me,this.uint16[Be+25]=Se,this.uint16[Be+26]=Ne,this.uint16[Be+27]=it,this.uint16[Be+28]=De,this.uint32[ct+15]=Ue,this.float32[ct+16]=Ze,this.float32[ct+17]=Qe,this.float32[ct+18]=rt,e}}ha.prototype.bytesPerElement=76,Et(ha,"StructArrayLayout3i2f6i15ui1ul3f76");class Ar extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ar.prototype.bytesPerElement=4,Et(Ar,"StructArrayLayout1f4");class Fr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,u,p)}emplace(e,i,a,u,p,g){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=p,this.float32[y+4]=g,e}}Fr.prototype.bytesPerElement=20,Et(Fr,"StructArrayLayout5f20");class wo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u)}emplace(e,i,a,u,p){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=u,this.uint16[g+4]=p,e}}wo.prototype.bytesPerElement=12,Et(wo,"StructArrayLayout1ul3ui12");class Xo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=a,e}}Xo.prototype.bytesPerElement=4,Et(Xo,"StructArrayLayout2ui4");class Ko extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ko.prototype.bytesPerElement=2,Et(Ko,"StructArrayLayout1ui2");class da extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=a,e}}da.prototype.bytesPerElement=8,Et(da,"StructArrayLayout2f8");class gv extends kt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gv.prototype.size=40;class rg extends An{get(e){return new gv(this,e)}}Et(rg,"CollisionBoxArray");class _v extends kt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}_v.prototype.size=60;class yv extends Ho{get(e){return new _v(this,e)}}Et(yv,"PlacedSymbolArray");class vv extends kt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vv.prototype.size=76;class bv extends ha{get(e){return new vv(this,e)}}Et(bv,"SymbolInstanceArray");class xv extends Ar{getoffsetX(e){return this.float32[1*e+0]}}Et(xv,"GlyphOffsetArray");class wv extends Dt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Et(wv,"SymbolLineVertexArray");class Tv extends kt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Tv.prototype.size=12;class Ev extends wo{get(e){return new Tv(this,e)}}Et(Ev,"FeatureIndexArray");class kv extends Xo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Et(kv,"FillExtrusionCentroidArray");const FE=Mt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),jE=Mt([{name:"a_dash",components:4,type:"Uint16"}]);var wl={},NE={get exports(){return wl},set exports(n){wl=n}},og={};({get exports(){return og},set exports(n){og=n}}).exports=function(n,e){var i,a,u,p,g,y,x,w;for(a=n.length-(i=3&n.length),u=e,g=3432918353,y=461845907,w=0;w<a;)x=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24,++w,u=27492+(65535&(p=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&n.charCodeAt(w+2))<<16;case 2:x^=(255&n.charCodeAt(w+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&n.charCodeAt(w)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=n.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var sg={};({get exports(){return sg},set exports(n){sg=n}}).exports=function(n,e){for(var i,a=n.length,u=e^a,p=0;a>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(p)|(255&n.charCodeAt(++p))<<8|(255&n.charCodeAt(++p))<<16|(255&n.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++p;switch(a){case 3:u^=(255&n.charCodeAt(p+2))<<16;case 2:u^=(255&n.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&n.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Sv=og,$E=sg;NE.exports=Sv,wl.murmur3=Sv,wl.murmur2=$E;class Gp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,a,u){this.ids.push(Av(e)),this.positions.push(i,a,u)}getPositions(e){const i=Av(e);let a=0,u=this.ids.length-1;for(;a<u;){const g=a+u>>1;this.ids[g]>=i?u=g:a=g+1}const p=[];for(;this.ids[a]===i;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(e,i){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return ag(a,u,0,a.length-1),i&&i.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const i=new Gp;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Av(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:wl(String(n))}function ag(n,e,i,a){for(;i<a;){const u=n[i+a>>1];let p=i-1,g=a+1;for(;;){do p++;while(n[p]<u);do g--;while(n[g]>u);if(p>=g)break;Zp(n,p,g),Zp(e,3*p,3*g),Zp(e,3*p+1,3*g+1),Zp(e,3*p+2,3*g+2)}g-i<a-g?(ag(n,e,i,g),i=g+1):(ag(n,e,g+1,a),a=g)}}function Zp(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}Et(Gp,"FeaturePositionMap");class As{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class qp extends As{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Iv extends As{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Cv extends As{constructor(e){super(e),this.current=yi.transparent}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const UE=new Float32Array(16),VE=new Float32Array(9),GE=new Float32Array(4);function lg(n){return[Ct(255*n.r,255*n.g),Ct(255*n.b,255*n.a)]}class Sh{constructor(e,i,a){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=a}setUniform(e,i,a,u,p){i.set(e,p,u.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new Cv(e):new qp(e)}}class $c{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,a,u,p){const g=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(e,p,g)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Iv(e):new qp(e)}}class Is{constructor(e,i,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,a,u,p,g){const y=this.paintVertexArray.length,x=this.expression.evaluate(new xe(0),i,{},p,u,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,i,a,u,p){const g=this.expression.evaluate({zoom:0},a,u,void 0,p);this._setPaintValue(e,i,g)}_setPaintValue(e,i,a){if(this.type==="color"){const u=lg(a);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class To{constructor(e,i,a,u,p,g){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,a,u,p,g){const y=this.expression.evaluate(new xe(this.zoom),i,{},p,u,g),x=this.expression.evaluate(new xe(this.zoom+1),i,{},p,u,g),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,x)}updatePaintArray(e,i,a,u,p){const g=this.expression.evaluate({zoom:this.zoom},a,u,void 0,p),y=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,p);this._setPaintValue(e,i,g,y)}_setPaintValue(e,i,a,u){if(this.type==="color"){const p=lg(a),g=lg(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,p[0],p[1],g[0],g[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,u,p){const g=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=At(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,p,y)}getBinding(e,i){return new qp(e)}}class pa{constructor(e,i,a,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(a==="array"?jE:FE).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new u}populatePaintArray(e,i,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,u,p,g){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,i,a,u){if(!u||!a)return;const p=u[a];if(!p)return;const{tl:g,br:y,pixelRatio:x}=p;for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,g[0],g[1],y[0],y[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fa{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!a(p))continue;const g=e.paint.get(p);if(!(g instanceof Je&&ia(g.property.specification)))continue;const y=qE(p,e.type),x=g.value,w=g.property.specification.type,A=g.property.useIntegerZoom,C=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||M)if(x.kind==="source"||M||C){const R=Mv(p,w,"source");this.binders[p]=C?new pa(x,y,w,R,e.id):new Is(x,y,w,R),u.push(`/a_${p}`)}else{const R=Mv(p,w,"composite");this.binders[p]=new To(x,y,w,A,i,R),u.push(`/z_${p}`)}else this.binders[p]=C?new $c(x.value,y):new Sh(x.value,y,w),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Is||i instanceof To?i.maxValue:0}populatePaintArrays(e,i,a,u,p,g){for(const y in this.binders){const x=this.binders[y];(x instanceof Is||x instanceof To||x instanceof pa)&&x.populatePaintArray(e,i,a,u,p,g)}}setConstantPatternPositions(e){for(const i in this.binders){const a=this.binders[i];a instanceof $c&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,i,a,u,p,g){let y=!1;for(const x in e){const w=i.getPositions(x);for(const A of w){const C=a.feature(A.index);for(const M in this.binders){const R=this.binders[M];if((R instanceof Is||R instanceof To||R instanceof pa)&&R.expression.isStateDependent===!0){const D=u.paint.get(M);R.expression=D.value,R.updatePaintArray(A.start,A.end,C,e[x],p,g),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Sh||a instanceof $c)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Is||a instanceof To||a instanceof pa)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Sh||a instanceof $c||a instanceof To)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Sh||u instanceof $c||u instanceof To)for(const p of u.uniformNames)i.push({name:p,property:a,binding:u.getBinding(e,p)})}return i}setUniforms(e,i,a,u,p){for(const{name:g,property:y,binding:x}of a)this.binders[y].setUniform(e,x,p,u.get(y),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Is||i instanceof To||i instanceof pa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof Is||a instanceof To||a instanceof pa)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Is||i instanceof To||i instanceof pa)&&i.destroy()}}}class Tl{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new fa(u,i,a);this.needsUpload=!1,this._featureMap=new Gp,this._bufferOffset=0}populatePaintArrays(e,i,a,u,p,g,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,i,u,p,g,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,u,p){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ZE={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function qE(n,e){return ZE[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const WE={"line-pattern":{source:Ti,composite:Ti},"fill-pattern":{source:Ti,composite:Ti},"fill-extrusion-pattern":{source:Ti,composite:Ti},"line-dasharray":{source:hr,composite:hr}},HE={color:{source:da,composite:Xn},number:{source:Ar,composite:da}};function Mv(n,e,i){const a=WE[n];return a&&a[i]||HE[e][i]}Et(Sh,"ConstantBinder"),Et($c,"PatternConstantBinder"),Et(Is,"SourceExpressionBinder"),Et(pa,"PatternCompositeBinder"),Et(To,"CompositeExpressionBinder"),Et(fa,"ProgramConfiguration",{omit:["_buffers"]}),Et(Tl,"ProgramConfigurationSet");const Wp="-transition";class Eo extends go{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Oe(i.layout)),i.paint)){this._transitionablePaint=new st(i.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ce(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){i!=null&&this._validate(Mp,`layers.${this.id}.layout.${e}`,e,i,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return pt(e,Wp)?this._transitionablePaint.getTransition(e.slice(0,-Wp.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(i!=null&&this._validate(ig,`layers.${this.id}.paint.${e}`,e,i,a))return!1;if(pt(e,Wp))return this._transitionablePaint.setTransition(e.slice(0,-Wp.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.value.isDataDriven(),g=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,x=y.isDataDriven(),w=pt(e,"pattern")||e==="line-dasharray";return x||p||w||this._handleOverridablePaintPropertyUpdate(e,g,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),gn(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(e,i,a,u,p={}){return(!p||p.validate!==!1)&&Pp(this,e.call(Cp,{key:i,layerType:this.type,objectKey:a,value:u,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Je&&ia(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Mc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const XE=Mt([{name:"a_pos",components:2,type:"Int16"}],4),KE=Mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ei{constructor(e=[]){this.segments=e}prepareSegment(e,i,a,u){let p=this.segments[this.segments.length-1];return e>Ei.MAX_VERTEX_ARRAY_LENGTH&&ne(`Max vertices per segment is ${Ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Ei.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,u){return new Ei([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}Ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(Ei,"SegmentVector");var Ht=8192;class ma{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof kn?new kn(e.lng,e.lat):kn.convert(e),this}setSouthWest(e){return this._sw=e instanceof kn?new kn(e.lng,e.lat):kn.convert(e),this}extend(e){const i=this._sw,a=this._ne;let u,p;if(e instanceof kn)u=e,p=e;else{if(!(e instanceof ma))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ma.convert(e)):this.extend(kn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(kn.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||a?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new kn(u.lng,u.lat),this._ne=new kn(p.lng,p.lat)),this}getCenter(){return new kn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new kn(this.getWest(),this.getNorth())}getSouthEast(){return new kn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=kn.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof ma?e:new ma(e)}}var Hp=1e-6,jr=typeof Float32Array<"u"?Float32Array:Array;function Pv(){var n=new jr(9);return jr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Lv(n,e,i){var a=e[0],u=e[1],p=e[2],g=e[3],y=e[4],x=e[5],w=e[6],A=e[7],C=e[8],M=i[0],R=i[1],D=i[2],N=i[3],G=i[4],ee=i[5],se=i[6],K=i[7],oe=i[8];return n[0]=M*a+R*g+D*w,n[1]=M*u+R*y+D*A,n[2]=M*p+R*x+D*C,n[3]=N*a+G*g+ee*w,n[4]=N*u+G*y+ee*A,n[5]=N*p+G*x+ee*C,n[6]=se*a+K*g+oe*w,n[7]=se*u+K*y+oe*A,n[8]=se*p+K*x+oe*C,n}function ko(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function cg(n,e){var i=e[0],a=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],w=e[7],A=e[8],C=e[9],M=e[10],R=e[11],D=e[12],N=e[13],G=e[14],ee=e[15],se=i*y-a*g,K=i*x-u*g,oe=i*w-p*g,ce=a*x-u*y,ae=a*w-p*y,Me=u*w-p*x,Se=A*N-C*D,Ne=A*G-M*D,it=A*ee-R*D,De=C*G-M*N,Ue=C*ee-R*N,Ze=M*ee-R*G,Qe=se*Ze-K*Ue+oe*De+ce*it-ae*Ne+Me*Se;return Qe?(n[0]=(y*Ze-x*Ue+w*De)*(Qe=1/Qe),n[1]=(u*Ue-a*Ze-p*De)*Qe,n[2]=(N*Me-G*ae+ee*ce)*Qe,n[3]=(M*ae-C*Me-R*ce)*Qe,n[4]=(x*it-g*Ze-w*Ne)*Qe,n[5]=(i*Ze-u*it+p*Ne)*Qe,n[6]=(G*oe-D*Me-ee*K)*Qe,n[7]=(A*Me-M*oe+R*K)*Qe,n[8]=(g*Ue-y*it+w*Se)*Qe,n[9]=(a*it-i*Ue-p*Se)*Qe,n[10]=(D*ae-N*oe+ee*se)*Qe,n[11]=(C*oe-A*ae-R*se)*Qe,n[12]=(y*Ne-g*De-x*Se)*Qe,n[13]=(i*De-a*Ne+u*Se)*Qe,n[14]=(N*K-D*ce-G*se)*Qe,n[15]=(A*ce-C*K+M*se)*Qe,n):null}function El(n,e,i){var a=e[0],u=e[1],p=e[2],g=e[3],y=e[4],x=e[5],w=e[6],A=e[7],C=e[8],M=e[9],R=e[10],D=e[11],N=e[12],G=e[13],ee=e[14],se=e[15],K=i[0],oe=i[1],ce=i[2],ae=i[3];return n[0]=K*a+oe*y+ce*C+ae*N,n[1]=K*u+oe*x+ce*M+ae*G,n[2]=K*p+oe*w+ce*R+ae*ee,n[3]=K*g+oe*A+ce*D+ae*se,n[4]=(K=i[4])*a+(oe=i[5])*y+(ce=i[6])*C+(ae=i[7])*N,n[5]=K*u+oe*x+ce*M+ae*G,n[6]=K*p+oe*w+ce*R+ae*ee,n[7]=K*g+oe*A+ce*D+ae*se,n[8]=(K=i[8])*a+(oe=i[9])*y+(ce=i[10])*C+(ae=i[11])*N,n[9]=K*u+oe*x+ce*M+ae*G,n[10]=K*p+oe*w+ce*R+ae*ee,n[11]=K*g+oe*A+ce*D+ae*se,n[12]=(K=i[12])*a+(oe=i[13])*y+(ce=i[14])*C+(ae=i[15])*N,n[13]=K*u+oe*x+ce*M+ae*G,n[14]=K*p+oe*w+ce*R+ae*ee,n[15]=K*g+oe*A+ce*D+ae*se,n}function Ah(n,e,i){var a,u,p,g,y,x,w,A,C,M,R,D,N=i[0],G=i[1],ee=i[2];return e===n?(n[12]=e[0]*N+e[4]*G+e[8]*ee+e[12],n[13]=e[1]*N+e[5]*G+e[9]*ee+e[13],n[14]=e[2]*N+e[6]*G+e[10]*ee+e[14],n[15]=e[3]*N+e[7]*G+e[11]*ee+e[15]):(u=e[1],p=e[2],g=e[3],y=e[4],x=e[5],w=e[6],A=e[7],C=e[8],M=e[9],R=e[10],D=e[11],n[0]=a=e[0],n[1]=u,n[2]=p,n[3]=g,n[4]=y,n[5]=x,n[6]=w,n[7]=A,n[8]=C,n[9]=M,n[10]=R,n[11]=D,n[12]=a*N+y*G+C*ee+e[12],n[13]=u*N+x*G+M*ee+e[13],n[14]=p*N+w*G+R*ee+e[14],n[15]=g*N+A*G+D*ee+e[15]),n}function kl(n,e,i){var a=i[0],u=i[1],p=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function ug(n,e,i){var a=Math.sin(i),u=Math.cos(i),p=e[4],g=e[5],y=e[6],x=e[7],w=e[8],A=e[9],C=e[10],M=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*u+w*a,n[5]=g*u+A*a,n[6]=y*u+C*a,n[7]=x*u+M*a,n[8]=w*u-p*a,n[9]=A*u-g*a,n[10]=C*u-y*a,n[11]=M*u-x*a,n}function Xp(n,e,i){var a=Math.sin(i),u=Math.cos(i),p=e[0],g=e[1],y=e[2],x=e[3],w=e[8],A=e[9],C=e[10],M=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*u-w*a,n[1]=g*u-A*a,n[2]=y*u-C*a,n[3]=x*u-M*a,n[8]=p*a+w*u,n[9]=g*a+A*u,n[10]=y*a+C*u,n[11]=x*a+M*u,n}function zv(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Rv(n,e,i){var a,u,p,g=i[0],y=i[1],x=i[2],w=Math.hypot(g,y,x);return w<Hp?null:(g*=w=1/w,y*=w,x*=w,a=Math.sin(e),u=Math.cos(e),n[0]=g*g*(p=1-u)+u,n[1]=y*g*p+x*a,n[2]=x*g*p-y*a,n[3]=0,n[4]=g*y*p-x*a,n[5]=y*y*p+u,n[6]=x*y*p+g*a,n[7]=0,n[8]=g*x*p+y*a,n[9]=y*x*p-g*a,n[10]=x*x*p+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var YE=El;function hg(){var n=new jr(3);return jr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Dv(n){var e=new jr(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Ih(n){return Math.hypot(n[0],n[1],n[2])}function Uc(n,e,i){var a=new jr(3);return a[0]=n,a[1]=e,a[2]=i,a}function Cs(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function dg(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Ov(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Ch(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Mh(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Xr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Ph(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function dr(n,e){var i=e[0],a=e[1],u=e[2],p=i*i+a*a+u*u;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function ao(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function pg(n,e,i){var a=e[0],u=e[1],p=e[2],g=i[0],y=i[1],x=i[2];return n[0]=u*x-p*y,n[1]=p*g-a*x,n[2]=a*y-u*g,n}function vi(n,e,i){var a=e[0],u=e[1],p=e[2],g=i[3]*a+i[7]*u+i[11]*p+i[15];return n[0]=(i[0]*a+i[4]*u+i[8]*p+i[12])/(g=g||1),n[1]=(i[1]*a+i[5]*u+i[9]*p+i[13])/g,n[2]=(i[2]*a+i[6]*u+i[10]*p+i[14])/g,n}function Bv(n,e,i){var a=i[0],u=i[1],p=i[2],g=e[0],y=e[1],x=e[2],w=u*x-p*y,A=p*g-a*x,C=a*y-u*g,M=u*C-p*A,R=p*w-a*C,D=a*A-u*w,N=2*i[3];return A*=N,C*=N,R*=2,D*=2,n[0]=g+(w*=N)+(M*=2),n[1]=y+A+R,n[2]=x+C+D,n}var Lh,So=dg,JE=Ov,QE=Ih;function Fv(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function jv(n,e){var i=e[0],a=e[1],u=e[2],p=e[3],g=i*i+a*a+u*u+p*p;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=a*g,n[2]=u*g,n[3]=p*g,n}function Sl(n,e,i){var a=e[0],u=e[1],p=e[2],g=e[3];return n[0]=i[0]*a+i[4]*u+i[8]*p+i[12]*g,n[1]=i[1]*a+i[5]*u+i[9]*p+i[13]*g,n[2]=i[2]*a+i[6]*u+i[10]*p+i[14]*g,n[3]=i[3]*a+i[7]*u+i[11]*p+i[15]*g,n}function Nv(){var n=new jr(4);return jr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function $v(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Uv(n,e,i){i*=.5;var a=e[0],u=e[1],p=e[2],g=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=a*x+g*y,n[1]=u*x+p*y,n[2]=p*x-u*y,n[3]=g*x-a*y,n}function Vv(n,e,i){i*=.5;var a=e[0],u=e[1],p=e[2],g=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=a*x-p*y,n[1]=u*x+g*y,n[2]=p*x+a*y,n[3]=g*x-u*y,n}hg(),Lh=new jr(4),jr!=Float32Array&&(Lh[0]=0,Lh[1]=0,Lh[2]=0,Lh[3]=0);var e2=jv;hg(),Uc(1,0,0),Uc(0,1,0),Nv(),Nv(),Pv();const t2=Mt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Gv}=t2,Zv=Mt([{name:"a_pos_3",components:3,type:"Int16"}]);var zh=Mt([{name:"a_pos",type:"Int16",components:2}]);class fg{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const u=ao(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return a[0]=this.pos[0]+this.dir[0]*p,a[1]=this.pos[1]+this.dir[1]*p,a[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,a){if(function(R,D){var N=R[0],G=R[1],ee=R[2],se=D[0],K=D[1],oe=D[2];return Math.abs(N-se)<=Hp*Math.max(1,Math.abs(N),Math.abs(se))&&Math.abs(G-K)<=Hp*Math.max(1,Math.abs(G),Math.abs(K))&&Math.abs(ee-oe)<=Hp*Math.max(1,Math.abs(ee),Math.abs(oe))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[u,p,g]=this.dir,y=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],A=u*u+p*p+g*g,C=2*(y*u+x*p+w*g),M=C*C-4*A*(y*y+x*x+w*w-i*i);if(M<0){const R=Math.max(-C/2,0),D=y+u*R,N=x+p*R,G=w+g*R,ee=Math.hypot(D,N,G);return a[0]=D*i/ee,a[1]=N*i/ee,a[2]=G*i/ee,!1}{const R=(-C-Math.sqrt(M))/(2*A);if(R<0){const D=Math.hypot(y,x,w);return a[0]=y*i/D,a[1]=x*i/D,a[2]=w*i/D,!1}return a[0]=y+u*R,a[1]=x+p*R,a[2]=w+g*R,!0}}}class mg{constructor(e,i,a,u,p){this.TL=e,this.TR=i,this.BR=a,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,i,a){const u=[-1,1,1],p=[1,1,1],g=[1,-1,1],y=[-1,-1,1],x=vi(u,u,e),w=vi(p,p,e),A=vi(g,g,e),C=vi(y,y,e);return new mg(x,w,A,C,i/a)}}class gg{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,a,u){const p=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const w=Sl([],x,e),A=1/w[3]/i*p;return function(C,M,R){return C[0]=M[0]*R[0],C[1]=M[1]*R[1],C[2]=M[2]*R[2],C[3]=M[3]*R[3],C}(w,w,[A,A,u?1/w[3]:A,A])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const w=dr([],pg([],So([],g[x[0]],g[x[1]]),So([],g[x[2]],g[x[1]]))),A=-ao(w,g[x[1]]);return w.concat(A)});return new gg(g,y)}}class pr{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)Ch(i,i,u),Mh(a,a,u);return new pr(i,a)}static applyTransform(e,i){const a=e.getCorners();for(let u=0;u<a.length;++u)vi(a[u],a[u],i);return pr.fromPoints(a)}constructor(e,i){this.min=e,this.max=i,this.center=Xr([],Cs([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=Dv(this.min),u=Dv(this.max);for(let p=0;p<i.length;p++)a[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new pr(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let a=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let g=0;for(let y=0;y<i.length;y++)g+=ao(p,i[y])+p[3]>=0;if(g===0)return 0;g!==i.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const x=e.points[y][u]-this.min[u];p=Math.min(p,x),g=Math.max(g,x)}if(g<0||p>this.max[u]-this.min[u])return 0}return 1}}const Yo=Ht/Math.PI/2,Al=64,Rh=[Al,32,16],lo=-Yo,co=Yo,n2=[new pr([lo,lo,lo],[co,co,co]),new pr([lo,lo,lo],[0,0,co]),new pr([0,lo,lo],[co,0,co]),new pr([lo,0,lo],[0,co,co]),new pr([0,0,lo],[co,co,co])];function Kp(n){return n*Yo/Bh}function qv(n,e,i,a=!0){const u=Xr([],n._camera.position,n.worldSize),p=[e,i,1,1];Sl(p,p,n.pixelMatrixInverse),Fv(p,p,1/p[3]);const g=dr([],So([],p,u)),y=n.globeMatrix,x=[y[12],y[13],y[14]],w=So([],x,u),A=Ih(w),C=dr([],w),M=n.worldSize/(2*Math.PI),R=ao(C,g),D=Math.asin(M/A);if(D<Math.acos(R)){if(!a)return null;const it=[],De=[];Xr(it,g,A/R),dr(De,So(De,it,w)),dr(g,Cs(g,w,Xr(g,De,Math.tan(D)*A)))}const N=[];new fg(u,g).closestPointOnSphere(x,M,N);const G=dr([],yt(y,0)),ee=dr([],yt(y,1)),se=dr([],yt(y,2)),K=ao(G,N),oe=ao(ee,N),ce=ao(se,N),ae=dt(Math.asin(-oe/M));let Me=dt(Math.atan2(K,ce));Me=n.center.lng+function(it,De){const Ue=(De-it+180)%360-180;return Ue<-180?Ue+360:Ue}(n.center.lng,Me);const Se=Qo(Me),Ne=At(es(ae),0,1);return new qc(Se,Ne)}class i2{constructor(e,i,a){this.a=So([],e,a),this.b=So([],i,a),this.center=a;const u=dr([],this.a),p=dr([],this.b);this.angle=Math.acos(ao(u,p))}}function _g(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,u,p,g){const y=Math.sin(p);return a*(Math.sin((1-g)*p)/y)+u*(Math.sin(g*p)/y)}(n.a[e],n.b[e],n.angle,At(i,0,1))+n.center[e]}function Jo(n){if(n.z<=1)return n2[n.z+2*n.y+n.x];const e=yg(Yp(n));return pr.fromPoints(e)}function Il(n,e,i){return Xr(n,n,1-i),Ph(n,n,e,i)}function Wv(n,e){const i=Zc(e.zoom);if(i===0)return Jo(n);const a=Yp(n),u=yg(a),p=Qo(a.getWest())*e.worldSize,g=Qo(a.getEast())*e.worldSize,y=es(a.getNorth())*e.worldSize,x=es(a.getSouth())*e.worldSize,w=[p,y,0],A=[g,y,0],C=[p,x,0],M=[g,x,0],R=cg([],e.globeMatrix);return vi(w,w,R),vi(A,A,R),vi(C,C,R),vi(M,M,R),u[0]=Il(u[0],C,i),u[1]=Il(u[1],M,i),u[2]=Il(u[2],A,i),u[3]=Il(u[3],w,i),pr.fromPoints(u)}function Hv(n,e,i){for(const a of n)vi(a,a,e),Xr(a,a,i)}function r2(n,e,i){const a=e/n.worldSize,u=n.globeMatrix;if(i.z<=1){const Se=Jo(i).getCorners();return Hv(Se,u,a),pr.fromPoints(Se)}const p=Yp(i),g=yg(p);Hv(g,u,a);const y=Number.MAX_VALUE,x=[-y,-y,-y],w=[y,y,y];if(p.contains(n.center)){for(const it of g)Ch(w,w,it),Mh(x,x,it);x[2]=0;const Se=n.point,Ne=[Se.x*a,Se.y*a,0];return Ch(w,w,Ne),Mh(x,x,Ne),new pr(w,x)}const A=[u[12]*a,u[13]*a,u[14]*a],C=p.getCenter(),M=At(n.center.lat,-Qi,Qi),R=At(C.lat,-Qi,Qi),D=Qo(n.center.lng),N=es(M);let G=D-Qo(C.lng);const ee=N-es(R);G>.5?G-=1:G<-.5&&(G+=1);let se=0;Math.abs(G)>Math.abs(ee)?se=G>=0?1:3:(se=ee>=0?0:2,Ph(A,A,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(Ye(ee>=0?p.getSouth():p.getNorth()))*Yo));const K=g[se],oe=g[(se+1)%4],ce=new i2(K,oe,A),ae=[_g(ce,0)||K[0],_g(ce,1)||K[1],_g(ce,2)||K[2]],Me=Zc(n.zoom);if(Me>0){const Se=function({x:it,y:De,z:Ue},Ze,Qe,rt,Be){const ct=1/(1<<Ue);let Nt=it*ct,mt=Nt+ct,St=De*ct,ut=St+ct,Vt=0;const dn=(Nt+mt)/2-rt;return dn>.5?Vt=-1:dn<-.5&&(Vt=1),Nt=((Nt+Vt)*Ze-(rt*=Ze))*Qe+rt,mt=((mt+Vt)*Ze-rt)*Qe+rt,St=(St*Ze-(Be*=Ze))*Qe+Be,ut=(ut*Ze-Be)*Qe+Be,[[Nt,ut,0],[mt,ut,0],[mt,St,0],[Nt,St,0]]}(i,e,n._pixelsPerMercatorPixel,D,N);for(let it=0;it<g.length;it++)Il(g[it],Se[it],Me);const Ne=Cs([],Se[se],Se[(se+1)%4]);Xr(Ne,Ne,.5),Il(ae,Ne,Me)}for(const Se of g)Ch(w,w,Se),Mh(x,x,Se);return w[2]=Math.min(K[2],oe[2]),Ch(w,w,ae),Mh(x,x,ae),new pr(w,x)}function Yp({x:n,y:e,z:i}){const a=1/(1<<i),u=new kn(Kr(n*a),Ji((e+1)*a)),p=new kn(Kr((n+1)*a),Ji(e*a));return new ma(u,p)}function yg(n){const e=Ye(n.getNorth()),i=Ye(n.getSouth()),a=Math.cos(e),u=Math.cos(i),p=Math.sin(e),g=Math.sin(i),y=n.getWest(),x=n.getEast();return[Vc(u,g,y),Vc(u,g,x),Vc(a,p,x),Vc(a,p,y)]}function Vc(n,e,i,a=Yo){return i=Ye(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function Gc(n,e,i){return Vc(Math.cos(Ye(n)),Math.sin(Ye(n)),e,i)}function Dh(n,e,i,a){const u=1<<i.z,p=(n/Ht+i.x)/u;return Gc(Ji((e/Ht+i.y)/u),Kr(p),a)}function Jp({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Xv=new Float64Array(16);function Oh(n){const e=Jp(n),i=zv(Xv,[e,e,e]);return Ah(i,i,((a=[])[0]=-(u=n.min)[0],a[1]=-u[1],a[2]=-u[2],a));var a,u}function vg(n){const e=(a=n.min,(i=Xv)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const u=1/Jp(n);return kl(e,e,[u,u,u])}function Kv(n,e,i,a,u){const p=function(x){const w=Ht/(2*Math.PI);return x/(2*Math.PI)/w}(i),g=[n,e,-i/(2*Math.PI)],y=ko(new Float64Array(16));return Ah(y,y,g),kl(y,y,[p,p,p]),ug(y,y,Ye(-u)),Xp(y,y,Ye(-a)),y}function Zc(n){return Cn(5,6,n)}function Yv(n,e){const i=Gc(e.lat,e.lng),a=function(D){const N=Gc(D._center.lat,D._center.lng);let G=pg([],Uc(0,1,0),N);const ee=Rv([],-D.angle,N);G=vi(G,G,ee),Rv(ee,-D._pitch,G);const se=dr([],N);return Xr(se,se,Kp(D.cameraToCenterDistance/D.pixelsPerMeter)),vi(se,se,ee),Cs([],N,se)}(n);return g=(u=dg([],a,i))[0],y=u[1],x=u[2],w=(p=i)[0],A=p[1],C=p[2],R=(M=Math.sqrt(g*g+y*y+x*x)*Math.sqrt(w*w+A*A+C*C))&&ao(u,p)/M,Math.acos(Math.min(Math.max(R,-1),1));var u,p,g,y,x,w,A,C,M,R}function bg(n,e){return Yv(n,e)>Math.PI/2*1.01}const Jv=Ye(85),o2=Math.cos(Jv),s2=Math.sin(Jv),Bh=63710088e-1,Qv=2*Math.PI*Bh;class kn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kn(rn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,u=e.lat*i,p=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return Bh*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new ma(new kn(this.lng-a,this.lat-i),new kn(this.lng+a,this.lat+i))}toEcef(e){const i=Kp(e);return Gc(this.lat,this.lng,Yo+i)}static convert(e){if(e instanceof kn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new kn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new kn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function xg(n){return Qv*Math.cos(n*Math.PI/180)}function Qo(n){return(180+n)/360}function es(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ao(n,e){return n/xg(e)}function Kr(n){return 360*n-180}function Ji(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function e0(n,e){return n*xg(Ji(e))}const Qi=85.051129;function t0(n){return 1/Math.cos(n*Math.PI/180)}class qc{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=kn.convert(e);return new qc(Qo(a.lng),es(a.lat),Ao(i,a.lat))}toLngLat(){return new kn(Kr(this.x),Ji(this.y))}toAltitude(){return e0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qv*t0(Ji(this.y))}}function wg(n,e,i,a,u,p,g,y,x){const w=(e+a)/2,A=(i+u)/2,C=new fe(w,A);y(C),function(M,R,D,N,G,ee){const se=D-G,K=N-ee;return Math.abs((N-R)*se-(D-M)*K)/Math.hypot(se,K)}(C.x,C.y,p.x,p.y,g.x,g.y)>=x?(wg(n,e,i,w,A,p,C,y,x),wg(n,w,A,a,u,C,g,y,x)):n.push(g)}function n0(n,e,i){let a=n[0],u=a.x,p=a.y;e(a);const g=[a];for(let y=1;y<n.length;y++){const x=n[y],{x:w,y:A}=x;e(x),wg(g,u,p,w,A,a,x,e,i),u=w,p=A,a=x}return g}function Tg(n,e,i,a){if(a(e,i)){const u=e.add(i)._mult(.5);Tg(n,e,u,a),Tg(n,u,i,a)}else n.push(i)}function a2(n,e){let i=n[0];const a=[i];for(let u=1;u<n.length;u++){const p=n[u];Tg(a,i,p,e),i=p}return a}const Eg=Math.pow(2,14)-1,i0=-Eg-1;function l2(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=At(i,i0,Eg),n.y=At(a,i0,Eg),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&ne("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ms(n,e,i){const a=n.loadGeometry(),u=n.extent,p=Ht/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:y,x,y:w,projection:A}=i,C=M=>{const R=Kr((e.x+M.x/u)/g),D=Ji((e.y+M.y/u)/g),N=A.project(R,D);M.x=(N.x*y-x)*u,M.y=(N.y*y-w)*u};for(let M=0;M<a.length;M++)if(n.type!==1)a[M]=n0(a[M],C,1);else{const R=[];for(const D of a[M])D.x<0||D.x>=u||D.y<0||D.y>=u||(C(D),R.push(D));a[M]=R}}for(const g of a)for(const y of g)l2(y,p);return a}function Cl(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ms(n):[]}}function Qp(n,e,i,a,u){n.emplaceBack(2*e+(a+1)/2,2*i+(u+1)/2)}function ef(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class kg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Dt,this.indexArray=new Yi,this.segments=new Ei,this.programConfigurations=new Tl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){const p=this.layers[0],g=[];let y=null;p.type==="circle"&&(y=p.layout.get("circle-sort-key"));for(const{feature:w,id:A,index:C,sourceLayerIndex:M}of e){const R=this.layers[0]._featureFilter.needGeometry,D=Cl(w,R);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),D,a))continue;const N=y?y.evaluate(D,{},a):void 0,G={id:A,properties:w.properties,type:w.type,sourceLayerIndex:M,index:C,geometry:R?D.geometry:Ms(w,a,u),patterns:{},sortKey:N};g.push(G)}y&&g.sort((w,A)=>w.sortKey-A.sortKey);let x=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Hr,x=u.projection);for(const w of g){const{geometry:A,index:C,sourceLayerIndex:M}=w,R=e[C].feature;this.addFeature(w,A,C,i.availableImages,a,x),i.featureIndex.insert(R,A,C,M,this.index)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KE.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,a,u,p,g){for(const y of i)for(const x of y){const w=x.x,A=x.y;if(w<0||w>=Ht||A<0||A>=Ht)continue;if(g){const R=g.projectTilePoint(w,A,p),D=g.upVector(p,w,A),N=this.globeExtVertexArray;ef(N,R,D),ef(N,R,D),ef(N,R,D),ef(N,R,D)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=C.vertexLength;Qp(this.layoutVertexArray,w,A,-1,-1),Qp(this.layoutVertexArray,w,A,1,-1),Qp(this.layoutVertexArray,w,A,1,1),Qp(this.layoutVertexArray,w,A,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,p)}}function r0(n,e){for(let i=0;i<n.length;i++)if(Ml(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ml(n,e[i]))return!0;return!!Sg(n,e)}function c2(n,e,i){return!!Ml(n,e)||!!Ag(e,n,i)}function o0(n,e){if(n.length===1)return a0(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let u=0;u<a.length;u++)if(Ml(n,a[u]))return!0}for(let i=0;i<n.length;i++)if(a0(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Sg(n,e[i]))return!0;return!1}function u2(n,e,i){if(n.length>1){if(Sg(n,e))return!0;for(let a=0;a<e.length;a++)if(Ag(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Ag(n[a],e,i))return!0;return!1}function Sg(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],u=n[i+1];for(let p=0;p<e.length-1;p++)if(h2(a,u,e[p],e[p+1]))return!0}return!1}function h2(n,e,i,a){return ge(n,i,a)!==ge(e,i,a)&&ge(n,e,i)!==ge(n,e,a)}function Ag(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(s0(n,e[u-1],e[u])<a)return!0;return!1}function s0(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function a0(n,e){let i,a,u,p=!1;for(let g=0;g<n.length;g++){i=n[g];for(let y=0,x=i.length-1;y<i.length;x=y++)a=i[y],u=i[x],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(p=!p)}return p}function Ml(n,e){let i=!1;for(let a=0,u=n.length-1;a<n.length;u=a++){const p=n[a],g=n[u];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function l0(n,e,i,a,u){for(const g of n)if(e<=g.x&&i<=g.y&&a>=g.x&&u>=g.y)return!0;const p=[new fe(e,i),new fe(e,u),new fe(a,u),new fe(a,i)];if(n.length>2){for(const g of p)if(Ml(n,g))return!0}for(let g=0;g<n.length-1;g++)if(d2(n[g],n[g+1],p))return!0;return!1}function d2(n,e,i){const a=i[0],u=i[2];if(n.x<a.x&&e.x<a.x||n.x>u.x&&e.x>u.x||n.y<a.y&&e.y<a.y||n.y>u.y&&e.y>u.y)return!1;const p=ge(n,e,i[0]);return p!==ge(n,e,i[1])||p!==ge(n,e,i[2])||p!==ge(n,e,i[3])}function Wc(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function tf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function c0(n,e,i,a,u){if(!e[0]&&!e[1])return n;const p=fe.convert(e)._mult(u);i==="viewport"&&p._rotate(-a);const g=[];for(let y=0;y<n.length;y++)g.push(n[y].sub(p));return g}function u0(n,e,i,a){const u=fe.convert(n)._mult(a);return e==="viewport"&&u._rotate(-i),u}Et(kg,"CircleBucket",{omit:["layers"]});const p2=new tt({"circle-sort-key":new Re(je.layout_circle["circle-sort-key"])});var f2={paint:new tt({"circle-radius":new Re(je.paint_circle["circle-radius"]),"circle-color":new Re(je.paint_circle["circle-color"]),"circle-blur":new Re(je.paint_circle["circle-blur"]),"circle-opacity":new Re(je.paint_circle["circle-opacity"]),"circle-translate":new ye(je.paint_circle["circle-translate"]),"circle-translate-anchor":new ye(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ye(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ye(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Re(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Re(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Re(je.paint_circle["circle-stroke-opacity"])}),layout:p2};function h0(n,e,i,a,u,p,g,y,x){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(x*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,A=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const C of e)for(const M of C){const R=M.add(y),D=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(R.x,R.y,!0):0,N=i.projection.projectTilePoint(R.x,R.y,w);if(D>0){const K=i.projection.upVector(w,R.x,R.y);N.x+=K[0]*A*D,N.y+=K[1]*A*D,N.z+=K[2]*A*D}const G=p?R:m2(N.x,N.y,N.z,a),ee=p?n.tilespaceRays.map(K=>_2(K,D)):n.queryGeometry.screenGeometry,se=Sl([],[N.x,N.y,N.z,1],a);if(!g&&p?x*=se[3]/i.cameraToCenterDistance:g&&!p&&(x*=i.cameraToCenterDistance/se[3]),p){const K=Ji((M.y/Ht+w.y)/(1<<w.z));x/=i.projection.pixelsPerMeter(K,1)/Ao(1,K)}if(c2(ee,G,x))return!0}return!1}function m2(n,e,i,a){const u=Sl([],[n,e,i,1],a);return new fe(u[0]/u[3],u[1]/u[3])}const d0=Uc(0,0,0),g2=Uc(0,0,1);function _2(n,e){const i=hg();return d0[2]=e,n.intersectsPlane(d0,g2,i),new fe(i[0],i[1])}class p0 extends kg{}function f0(n,{width:e,height:i},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=u,n}function m0(n,e,i){const{width:a,height:u}=e;a===n.width&&u===n.height||(Ig(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,u)},i),n.width=a,n.height=u,n.data=e.data)}function Ig(n,e,i,a,u,p){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=e.data;for(let x=0;x<u.height;x++){const w=((i.y+x)*n.width+i.x)*p,A=((a.y+x)*e.width+a.x)*p;for(let C=0;C<u.width*p;C++)y[A+C]=g[w+C]}return e}Et(p0,"HeatmapBucket",{omit:["layers"]});class Ps{constructor(e,i){f0(this,e,1,i)}resize(e){m0(this,new Ps(e),1)}clone(){return new Ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,p){Ig(e,i,a,u,p,1)}}class Nr{constructor(e,i){f0(this,e,4,i)}resize(e){m0(this,new Nr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Nr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,p){Ig(e,i,a,u,p,4)}}Et(Ps,"AlphaImage"),Et(Nr,"RGBAImage");var y2={paint:new tt({"heatmap-radius":new Re(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Re(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ye(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new He(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ye(je.paint_heatmap["heatmap-opacity"])})};function Cg(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,u=n.image||new Nr({width:i,height:a}),p=(g,y,x)=>{e[n.evaluationKey]=x;const w=n.expression.evaluate(e);u.data[g+y+0]=Math.floor(255*w.r/w.a),u.data[g+y+1]=Math.floor(255*w.g/w.a),u.data[g+y+2]=Math.floor(255*w.b/w.a),u.data[g+y+3]=Math.floor(255*w.a)};if(n.clips)for(let g=0,y=0;g<a;++g,y+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const A=x/(i-1),{start:C,end:M}=n.clips[g];p(y,w,C*(1-A)+M*A)}else for(let g=0,y=0;g<i;g++,y+=4)p(0,y,g/(i-1));return u}var v2={paint:new tt({"hillshade-illumination-direction":new ye(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ye(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ye(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ye(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ye(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ye(je.paint_hillshade["hillshade-accent-color"])})};const b2=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:x2}=b2;var Hc={};function nf(n,e,i){i=i||2;var a,u,p,g,y,x,w,A=e&&e.length,C=A?e[0]*i:n.length,M=g0(n,0,C,i,!0),R=[];if(!M||M.next===M.prev)return R;if(A&&(M=function(N,G,ee,se){var K,oe,ce,ae=[];for(K=0,oe=G.length;K<oe;K++)(ce=g0(N,G[K]*se,K<oe-1?G[K+1]*se:N.length,se,!1))===ce.next&&(ce.steiner=!0),ae.push(C2(ce));for(ae.sort(S2),K=0;K<ae.length;K++)ee=A2(ae[K],ee);return ee}(n,e,M,i)),n.length>80*i){a=p=n[0],u=g=n[1];for(var D=i;D<C;D+=i)(y=n[D])<a&&(a=y),(x=n[D+1])<u&&(u=x),y>p&&(p=y),x>g&&(g=x);w=(w=Math.max(p-a,g-u))!==0?32767/w:0}return Fh(M,R,i,a,u,w,0),R}function g0(n,e,i,a,u){var p,g;if(u===Lg(n,e,i,a)>0)for(p=e;p<i;p+=a)g=v0(p,n[p],n[p+1],g);else for(p=i-a;p>=e;p-=a)g=v0(p,n[p],n[p+1],g);return g&&rf(g,g.next)&&(Nh(g),g=g.next),g}function Pl(n,e){if(!n)return n;e||(e=n);var i,a=n;do if(i=!1,a.steiner||!rf(a,a.next)&&ki(a.prev,a,a.next)!==0)a=a.next;else{if(Nh(a),(a=e=a.prev)===a.next)break;i=!0}while(i||a!==e);return e}function Fh(n,e,i,a,u,p,g){if(n){!g&&p&&function(A,C,M,R){var D=A;do D.z===0&&(D.z=Mg(D.x,D.y,C,M,R)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==A);D.prevZ.nextZ=null,D.prevZ=null,function(N){var G,ee,se,K,oe,ce,ae,Me,Se=1;do{for(ee=N,N=null,oe=null,ce=0;ee;){for(ce++,se=ee,ae=0,G=0;G<Se&&(ae++,se=se.nextZ);G++);for(Me=Se;ae>0||Me>0&&se;)ae!==0&&(Me===0||!se||ee.z<=se.z)?(K=ee,ee=ee.nextZ,ae--):(K=se,se=se.nextZ,Me--),oe?oe.nextZ=K:N=K,K.prevZ=oe,oe=K;ee=se}oe.nextZ=null,Se*=2}while(ce>1)}(D)}(n,a,u,p);for(var y,x,w=n;n.prev!==n.next;)if(y=n.prev,x=n.next,p?T2(n,a,u,p):w2(n))e.push(y.i/i|0),e.push(n.i/i|0),e.push(x.i/i|0),Nh(n),n=x.next,w=x.next;else if((n=x)===w){g?g===1?Fh(n=E2(Pl(n),e,i),e,i,a,u,p,2):g===2&&k2(n,e,i,a,u,p):Fh(Pl(n),e,i,a,u,p,1);break}}}function w2(n){var e=n.prev,i=n,a=n.next;if(ki(e,i,a)>=0)return!1;for(var u=e.x,p=i.x,g=a.x,y=e.y,x=i.y,w=a.y,A=u<p?u<g?u:g:p<g?p:g,C=y<x?y<w?y:w:x<w?x:w,M=u>p?u>g?u:g:p>g?p:g,R=y>x?y>w?y:w:x>w?x:w,D=a.next;D!==e;){if(D.x>=A&&D.x<=M&&D.y>=C&&D.y<=R&&Xc(u,y,p,x,g,w,D.x,D.y)&&ki(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function T2(n,e,i,a){var u=n.prev,p=n,g=n.next;if(ki(u,p,g)>=0)return!1;for(var y=u.x,x=p.x,w=g.x,A=u.y,C=p.y,M=g.y,R=y<x?y<w?y:w:x<w?x:w,D=A<C?A<M?A:M:C<M?C:M,N=y>x?y>w?y:w:x>w?x:w,G=A>C?A>M?A:M:C>M?C:M,ee=Mg(R,D,e,i,a),se=Mg(N,G,e,i,a),K=n.prevZ,oe=n.nextZ;K&&K.z>=ee&&oe&&oe.z<=se;){if(K.x>=R&&K.x<=N&&K.y>=D&&K.y<=G&&K!==u&&K!==g&&Xc(y,A,x,C,w,M,K.x,K.y)&&ki(K.prev,K,K.next)>=0||(K=K.prevZ,oe.x>=R&&oe.x<=N&&oe.y>=D&&oe.y<=G&&oe!==u&&oe!==g&&Xc(y,A,x,C,w,M,oe.x,oe.y)&&ki(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;K&&K.z>=ee;){if(K.x>=R&&K.x<=N&&K.y>=D&&K.y<=G&&K!==u&&K!==g&&Xc(y,A,x,C,w,M,K.x,K.y)&&ki(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;oe&&oe.z<=se;){if(oe.x>=R&&oe.x<=N&&oe.y>=D&&oe.y<=G&&oe!==u&&oe!==g&&Xc(y,A,x,C,w,M,oe.x,oe.y)&&ki(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function E2(n,e,i){var a=n;do{var u=a.prev,p=a.next.next;!rf(u,p)&&_0(u,a,a.next,p)&&jh(u,p)&&jh(p,u)&&(e.push(u.i/i|0),e.push(a.i/i|0),e.push(p.i/i|0),Nh(a),Nh(a.next),a=n=p),a=a.next}while(a!==n);return Pl(a)}function k2(n,e,i,a,u,p){var g=n;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&M2(g,y)){var x=y0(g,y);return g=Pl(g,g.next),x=Pl(x,x.next),Fh(g,e,i,a,u,p,0),void Fh(x,e,i,a,u,p,0)}y=y.next}g=g.next}while(g!==n)}function S2(n,e){return n.x-e.x}function A2(n,e){var i=function(u,p){var g,y=p,x=u.x,w=u.y,A=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var C=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(C<=x&&C>A&&(A=C,g=y.x<y.next.x?y:y.next,C===x))return g}y=y.next}while(y!==p);if(!g)return null;var M,R=g,D=g.x,N=g.y,G=1/0;y=g;do x>=y.x&&y.x>=D&&x!==y.x&&Xc(w<N?x:A,w,D,N,w<N?A:x,w,y.x,y.y)&&(M=Math.abs(w-y.y)/(x-y.x),jh(y,u)&&(M<G||M===G&&(y.x>g.x||y.x===g.x&&I2(g,y)))&&(g=y,G=M)),y=y.next;while(y!==R);return g}(n,e);if(!i)return e;var a=y0(i,n);return Pl(a,a.next),Pl(i,i.next)}function I2(n,e){return ki(n.prev,n,e.prev)<0&&ki(e.next,n,n.next)<0}function Mg(n,e,i,a,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function C2(n){var e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Xc(n,e,i,a,u,p,g,y){return(u-g)*(e-y)>=(n-g)*(p-y)&&(n-g)*(a-y)>=(i-g)*(e-y)&&(i-g)*(p-y)>=(u-g)*(a-y)}function M2(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==a.i&&u.next.i!==a.i&&_0(u,u.next,i,a))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(jh(n,e)&&jh(e,n)&&function(i,a){var u=i,p=!1,g=(i.x+a.x)/2,y=(i.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&g<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==i);return p}(n,e)&&(ki(n.prev,n,e.prev)||ki(n,e.prev,e))||rf(n,e)&&ki(n.prev,n,n.next)>0&&ki(e.prev,e,e.next)>0)}function ki(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function rf(n,e){return n.x===e.x&&n.y===e.y}function _0(n,e,i,a){var u=sf(ki(n,e,i)),p=sf(ki(n,e,a)),g=sf(ki(i,a,n)),y=sf(ki(i,a,e));return u!==p&&g!==y||!(u!==0||!of(n,i,e))||!(p!==0||!of(n,a,e))||!(g!==0||!of(i,n,a))||!(y!==0||!of(i,e,a))}function of(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function sf(n){return n>0?1:n<0?-1:0}function jh(n,e){return ki(n.prev,n,n.next)<0?ki(n,e,n.next)>=0&&ki(n,n.prev,e)>=0:ki(n,e,n.prev)<0||ki(n,n.next,e)<0}function y0(n,e){var i=new Pg(n.i,n.x,n.y),a=new Pg(e.i,e.x,e.y),u=n.next,p=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,a.next=i,i.prev=a,p.next=a,a.prev=p,a}function v0(n,e,i,a){var u=new Pg(n,e,i);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Nh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Pg(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lg(n,e,i,a){for(var u=0,p=e,g=i-a;p<i;p+=a)u+=(n[g]-n[p])*(n[p+1]+n[g+1]),g=p;return u}function P2(n,e,i,a,u){b0(n,e,i||0,a||n.length-1,u||L2)}function b0(n,e,i,a,u){for(;a>i;){if(a-i>600){var p=a-i+1,g=e-i+1,y=Math.log(p),x=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*x*(p-x)/p)*(g-p/2<0?-1:1);b0(n,e,Math.max(i,Math.floor(e-g*x/p+w)),Math.min(a,Math.floor(e+(p-g)*x/p+w)),u)}var A=n[e],C=i,M=a;for($h(n,i,e),u(n[a],A)>0&&$h(n,i,a);C<M;){for($h(n,C,M),C++,M--;u(n[C],A)<0;)C++;for(;u(n[M],A)>0;)M--}u(n[i],A)===0?$h(n,i,M):$h(n,++M,a),M<=e&&(i=M+1),e<=M&&(a=M-1)}}function $h(n,e,i){var a=n[e];n[e]=n[i],n[i]=a}function L2(n,e){return n<e?-1:n>e?1:0}function zg(n,e){const i=n.length;if(i<=1)return[n];const a=[];let u,p;for(let g=0;g<i;g++){const y=ze(n[g]);y!==0&&(n[g].area=Math.abs(y),p===void 0&&(p=y<0),p===y<0?(u&&a.push(u),u=[n[g]]):u.push(n[g]))}if(u&&a.push(u),e>1)for(let g=0;g<a.length;g++)a[g].length<=e||(P2(a[g],e,1,a[g].length-1,z2),a[g]=a[g].slice(0,e));return a}function z2(n,e){return e.area-n.area}function Rg(n,e,i){const a=i.patternDependencies;let u=!1;for(const p of e){const g=p.paint.get(`${n}-pattern`);g.isConstant()||(u=!0);const y=g.constantOr(null);y&&(u=!0,a[y]=!0)}return u}function Dg(n,e,i,a,u){const p=u.patternDependencies;for(const g of e){const y=g.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a},i,{},u.availableImages);x=x&&x.name?x.name:x,p[x]=!0,i.patterns[g.id]=x}}return i}({get exports(){return Hc},set exports(n){Hc=n}}).exports=nf,Hc.default=nf,nf.deviation=function(n,e,i,a){var u=e&&e.length,p=Math.abs(Lg(n,0,u?e[0]*i:n.length,i));if(u)for(var g=0,y=e.length;g<y;g++)p-=Math.abs(Lg(n,e[g]*i,g<y-1?e[g+1]*i:n.length,i));var x=0;for(g=0;g<a.length;g+=3){var w=a[g]*i,A=a[g+1]*i,C=a[g+2]*i;x+=Math.abs((n[w]-n[C])*(n[A+1]-n[w+1])-(n[w]-n[A])*(n[C+1]-n[w+1]))}return p===0&&x===0?0:Math.abs((x-p)/p)},nf.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,u=0;u<n.length;u++){for(var p=0;p<n[u].length;p++)for(var g=0;g<e;g++)i.vertices.push(n[u][p][g]);u>0&&i.holes.push(a+=n[u-1].length)}return i};class af{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dt,this.indexArray=new Yi,this.indexArray2=new Xo,this.programConfigurations=new Tl(e.layers,e.zoom),this.segments=new Ei,this.segments2=new Ei,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,a,u){this.hasPattern=Rg("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:x,index:w,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Cl(y,C);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),M,a))continue;const R=p?p.evaluate(M,{},a,i.availableImages):void 0,D={id:x,properties:y.properties,type:y.type,sourceLayerIndex:A,index:w,geometry:C?M.geometry:Ms(y,a,u),patterns:{},sortKey:R};g.push(D)}p&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:w,sourceLayerIndex:A}=y;if(this.hasPattern){const C=Dg("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(y,x,w,a,{},i.availableImages);i.featureIndex.insert(e[w].feature,x,w,A,this.index)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}addFeatures(e,i,a,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,x2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,u,p,g=[]){for(const y of zg(i,500)){let x=0;for(const D of y)x+=D.length;const w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),A=w.vertexLength,C=[],M=[];for(const D of y){if(D.length===0)continue;D!==y[0]&&M.push(C.length/2);const N=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),G=N.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(G+D.length-1,G),C.push(D[0].x),C.push(D[0].y);for(let ee=1;ee<D.length;ee++)this.layoutVertexArray.emplaceBack(D[ee].x,D[ee].y),this.indexArray2.emplaceBack(G+ee-1,G+ee),C.push(D[ee].x),C.push(D[ee].y);N.vertexLength+=D.length,N.primitiveLength+=D.length}const R=Hc(C,M);for(let D=0;D<R.length;D+=3)this.indexArray.emplaceBack(A+R[D],A+R[D+1],A+R[D+2]);w.vertexLength+=x,w.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,g,u)}}Et(af,"FillBucket",{omit:["layers","patternFeatures"]});const R2=new tt({"fill-sort-key":new Re(je.layout_fill["fill-sort-key"])});var D2={paint:new tt({"fill-antialias":new ye(je.paint_fill["fill-antialias"]),"fill-opacity":new Re(je.paint_fill["fill-opacity"]),"fill-color":new Re(je.paint_fill["fill-color"]),"fill-outline-color":new Re(je.paint_fill["fill-outline-color"]),"fill-translate":new ye(je.paint_fill["fill-translate"]),"fill-translate-anchor":new ye(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Re(je.paint_fill["fill-pattern"])}),layout:R2};const O2=Mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),B2=Mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),F2=Mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:j2}=O2;var lf={},N2=fe,x0=Kc;function Kc(n,e,i,a,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=u,n.readFields($2,this,e)}function $2(n,e,i){n==1?e.id=i.readVarint():n==2?function(a,u){for(var p=a.readVarint()+a.pos;a.pos<p;){var g=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[g]=y}}(i,e):n==3?e.type=i.readVarint():n==4&&(e._geometry=i.pos)}function U2(n){for(var e,i,a=0,u=0,p=n.length,g=p-1;u<p;g=u++)a+=((i=n[g]).x-(e=n[u]).x)*(e.y+i.y);return a}Kc.types=["Unknown","Point","LineString","Polygon"],Kc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,a=1,u=0,p=0,g=0,y=[];n.pos<i;){if(u<=0){var x=n.readVarint();a=7&x,u=x>>3}if(u--,a===1||a===2)p+=n.readSVarint(),g+=n.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new N2(p,g));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Kc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,a=0,u=0,p=0,g=1/0,y=-1/0,x=1/0,w=-1/0;n.pos<e;){if(a<=0){var A=n.readVarint();i=7&A,a=A>>3}if(a--,i===1||i===2)(u+=n.readSVarint())<g&&(g=u),u>y&&(y=u),(p+=n.readSVarint())<x&&(x=p),p>w&&(w=p);else if(i!==7)throw new Error("unknown command "+i)}return[g,x,y,w]},Kc.prototype.toGeoJSON=function(n,e,i){var a,u,p=this.extent*Math.pow(2,i),g=this.extent*n,y=this.extent*e,x=this.loadGeometry(),w=Kc.types[this.type];function A(R){for(var D=0;D<R.length;D++){var N=R[D];R[D]=[360*(N.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+y)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<x.length;a++)C[a]=x[a][0];A(x=C);break;case 2:for(a=0;a<x.length;a++)A(x[a]);break;case 3:for(x=function(R){var D=R.length;if(D<=1)return[R];for(var N,G,ee=[],se=0;se<D;se++){var K=U2(R[se]);K!==0&&(G===void 0&&(G=K<0),G===K<0?(N&&ee.push(N),N=[R[se]]):N.push(R[se]))}return N&&ee.push(N),ee}(x),a=0;a<x.length;a++)for(u=0;u<x[a].length;u++)A(x[a][u])}x.length===1?x=x[0]:w="Multi"+w;var M={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(M.id=this.id),M};var V2=x0,w0=T0;function T0(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(G2,this,e),this.length=this._features.length}function G2(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(a){for(var u=null,p=a.readVarint()+a.pos;a.pos<p;){var g=a.readVarint()>>3;u=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return u}(i))}T0.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new V2(this._pbf,e,this.extent,this._keys,this._values)};var Z2=w0;function q2(n,e,i){if(n===3){var a=new Z2(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}var Og=lf.VectorTile=function(n,e){this.layers=n.readFields(q2,{},e)},cf=lf.VectorTileFeature=x0;function uf(n,e,i,a){const u=[],p=a===0?(g,y,x,w,A,C)=>{g.push(new fe(C,x+(C-y)/(w-y)*(A-x)))}:(g,y,x,w,A,C)=>{g.push(new fe(y+(C-x)/(A-x)*(w-y),C))};for(const g of n){const y=[];for(const x of g){if(x.length<=2)continue;const w=[];for(let M=0;M<x.length-1;M++){const R=x[M].x,D=x[M].y,N=x[M+1].x,G=x[M+1].y,ee=a===0?R:D,se=a===0?N:G;ee<e?se>e&&p(w,R,D,N,G,e):ee>i?se<i&&p(w,R,D,N,G,i):w.push(x[M]),se<e&&ee>=e&&p(w,R,D,N,G,e),se>i&&ee<=i&&p(w,R,D,N,G,i)}let A=x[x.length-1];const C=a===0?A.x:A.y;C>=e&&C<=i&&w.push(A),w.length&&(A=w[w.length-1],w[0].x===A.x&&w[0].y===A.y||w.push(w[0]),y.push(w))}y.length&&u.push(y)}return u}lf.VectorTileLayer=w0;const W2=cf.types,H2=Math.pow(2,13);function Uh(n,e,i,a,u,p,g,y){n.emplaceBack((e<<1)+g,(i<<1)+p,(Math.floor(a*H2)<<1)+u,Math.round(y))}function Vh(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class E0{constructor(){this.acc=new fe(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new fe(e.x,e.y),this.max=new fe(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,u=this.max;e.x<a.x?a.x=e.x:e.x>u.x&&(u.x=e.x),e.y<a.y?a.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===Ht)&&e.x===i.x)!=((e.y===0||e.y===Ht)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,xn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Ht!=e.x>Ht&&this.addBorderIntersection(1,xn(i.y,e.y,(Ht-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,xn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Ht!=e.y>Ht&&this.addBorderIntersection(3,xn(i.x,e.x,(Ht-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((i,a)=>i+a.edges,0);return e!==0?this.acc.div(e)._round():new fe(0,0)}span(){return new fe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Gh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Gn,this.centroidVertexArray=new kv,this.indexArray=new Yi,this.programConfigurations=new Tl(e.layers,e.zoom),this.segments=new Ei,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,a,u){this.features=[],this.hasPattern=Rg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/Ht/(1<<p.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:y,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,A=Cl(p,w);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),A,a))continue;const C={id:g,sourceLayerIndex:x,index:y,geometry:w?A.geometry:Ms(p,a,u),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(Dg("fill-extrusion",this.layers,C,this.zoom,i)):this.addFeature(C,C.geometry,y,a,{},i.availableImages,u),i.featureIndex.insert(p,C.geometry,y,x,this.index,M)}this.sortBorders()}addFeatures(e,i,a,u,p){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,i,a,u,p)}this.sortBorders()}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,j2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,F2.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,B2.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,p,g,y){const x=[new fe(0,0),new fe(Ht,Ht)],w=y.projection,A=w.name==="globe",C=this.enableTerrain&&!A?new E0:null,M=W2[e.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Hr);const R=zg(i,500);for(let ee=R.length-1;ee>=0;ee--){const se=R[ee];(se.length===0||(D=se[0]).every(K=>K.x<=0)||D.every(K=>K.x>=Ht)||D.every(K=>K.y<=0)||D.every(K=>K.y>=Ht))&&R.splice(ee,1)}var D;let N;if(A)N=P0(R,x,u);else{N=[];for(const ee of R)N.push({polygon:ee,bounds:x})}const G=M?this.edgeRadius:0;for(const{polygon:ee,bounds:se}of N){let K=0,oe=0;for(const ae of ee)M&&!ae[0].equals(ae[ae.length-1])&&ae.push(ae[0]),oe+=M?ae.length-1:ae.length;const ce=this.segments.prepareSegment((M?5:4)*oe,this.layoutVertexArray,this.indexArray);if(M){const ae=[],Me=[];K=ce.vertexLength;for(const Ne of ee){let it,De;Ne.length&&Ne!==ee[0]&&Me.push(ae.length/2),it=Ne[1].sub(Ne[0])._perp()._unit();for(let Ue=1;Ue<Ne.length;Ue++){const Ze=Ne[Ue],Qe=Ne[Ue===Ne.length-1?1:Ue+1];let{x:rt,y:Be}=Ze;if(G){De=Qe.sub(Ze)._perp()._unit();const ct=it.add(De)._unit(),Nt=G*Math.min(4,1/(it.x*ct.x+it.y*ct.y));rt+=Nt*ct.x,Be+=Nt*ct.y,it=De}Uh(this.layoutVertexArray,rt,Be,0,0,1,1,0),ce.vertexLength++,ae.push(Ze.x,Ze.y),A&&Vh(this.layoutVertexExtArray,w.projectTilePoint(rt,Be,u),w.upVector(u,rt,Be))}}const Se=Hc(ae,Me);for(let Ne=0;Ne<Se.length;Ne+=3)this.indexArray.emplaceBack(K+Se[Ne],K+Se[Ne+2],K+Se[Ne+1]),ce.primitiveLength++}for(const ae of ee){C&&ae.length&&C.startRing(ae[0]);let Me,Se,Ne,it=ae.length>4&&I0(ae[ae.length-2],ae[0],ae[1]),De=G?X2(ae[ae.length-2],ae[0],ae[1],G):0;Se=ae[1].sub(ae[0])._perp()._unit();let Ue=!0;for(let Ze=1,Qe=0;Ze<ae.length;Ze++){let rt=ae[Ze-1],Be=ae[Ze];const ct=ae[Ze===ae.length-1?1:Ze+1];if(C&&M&&C.currentPolyCount.top++,A0(Be,rt,se)){G&&(Se=ct.sub(Be)._perp()._unit(),Ue=!Ue);continue}C&&C.append(Be,rt);const Nt=Be.sub(rt)._perp(),mt=Nt.x/(Math.abs(Nt.x)+Math.abs(Nt.y)),St=Nt.y>0?1:0,ut=rt.dist(Be);if(Qe+ut>32768&&(Qe=0),G){Ne=ct.sub(Be)._perp()._unit();let on=S0(rt,Be,ct,k0(Se,Ne),G);isNaN(on)&&(on=0);const qt=Be.sub(rt)._unit();rt=rt.add(qt.mult(De))._round(),Be=Be.add(qt.mult(-on))._round(),De=on,Se=Ne}const Vt=ce.vertexLength,dn=ae.length>4&&I0(rt,Be,ct);let ln=C0(Qe,it,Ue);if(Uh(this.layoutVertexArray,rt.x,rt.y,mt,St,0,0,ln),Uh(this.layoutVertexArray,rt.x,rt.y,mt,St,0,1,ln),Qe+=ut,ln=C0(Qe,dn,!Ue),it=dn,Uh(this.layoutVertexArray,Be.x,Be.y,mt,St,0,0,ln),Uh(this.layoutVertexArray,Be.x,Be.y,mt,St,0,1,ln),ce.vertexLength+=4,this.indexArray.emplaceBack(Vt+0,Vt+1,Vt+2),this.indexArray.emplaceBack(Vt+1,Vt+3,Vt+2),ce.primitiveLength+=2,G){const on=K+(Ze===1?ae.length-2:Ze-2),qt=Ze===1?K:on+1;if(this.indexArray.emplaceBack(Vt+1,on,Vt+3),this.indexArray.emplaceBack(on,qt,Vt+3),ce.primitiveLength+=2,Me===void 0&&(Me=Vt),!A0(ct,ae[Ze],se)){const jn=Ze===ae.length-1?Me:ce.vertexLength;this.indexArray.emplaceBack(Vt+2,Vt+3,jn),this.indexArray.emplaceBack(Vt+3,jn+1,jn),this.indexArray.emplaceBack(Vt+3,qt,jn+1),ce.primitiveLength+=3}Ue=!Ue}if(A){const on=this.layoutVertexExtArray,qt=w.projectTilePoint(rt.x,rt.y,u),jn=w.projectTilePoint(Be.x,Be.y,u),Xt=w.upVector(u,rt.x,rt.y),pn=w.upVector(u,Be.x,Be.y);Vh(on,qt,Xt),Vh(on,qt,Xt),Vh(on,jn,pn),Vh(on,jn,pn)}}M&&(K+=ae.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const ee=C.borders,se=this.featuresOnBorder.push(C)-1;for(let K=0;K<4;K++)ee[K][0]!==Number.MAX_VALUE&&this.borders[K].push(se)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,i,a=!0){let u,p;if(e)if(e.y!==0){const y=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+a;let g=a?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let x=0;x<y.top;x++)this.centroidVertexArray.emplace(g++,u,p);for(let x=0;x<2*y.edges;x++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,u,p)}}}function k0(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function X2(n,e,i,a){const u=e.sub(n)._perp()._unit(),p=i.sub(e)._perp()._unit();return S0(n,e,i,k0(u,p),a)}function S0(n,e,i,a,u){const p=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,u*p/a)}function A0(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function I0(n,e,i){if(n.x<0||n.x>=Ht||e.x<0||e.x>=Ht||i.x<0||i.x>=Ht)return!1;const a=i.sub(e),u=a.perp(),p=n.sub(e);return(a.x*p.x+a.y*p.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function C0(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function M0(){const n=Math.PI/32,e=Math.tan(n),i=Bh;return i*Math.sqrt(1+2*e*e)-i}function P0(n,e,i){const a=1<<i.z,u=Kr(i.x/a),p=Kr((i.x+1)/a),g=Ji(i.y/a),y=Ji((i.y+1)/a);return function(x,w,A,C,M=0,R){const D=[];if(!x.length||!A||!C)return D;const N=(ae,Me)=>{for(const Se of ae)D.push({polygon:Se,bounds:Me})},G=Math.ceil(Math.log2(A)),ee=Math.ceil(Math.log2(C)),se=G-ee,K=[];for(let ae=0;ae<Math.abs(se);ae++)K.push(se>0?0:1);for(let ae=0;ae<Math.min(G,ee);ae++)K.push(0),K.push(1);let oe=x;if(oe=uf(oe,w[0].y-M,w[1].y+M,1),oe=uf(oe,w[0].x-M,w[1].x+M,0),!oe.length)return D;const ce=[];for(K.length?ce.push({polygons:oe,bounds:w,depth:0}):N(oe,w);ce.length;){const ae=ce.pop(),Me=ae.depth,Se=K[Me],Ne=ae.bounds[0],it=ae.bounds[1],De=Se===0?Ne.x:Ne.y,Ue=Se===0?it.x:it.y,Ze=R?R(Se,De,Ue):.5*(De+Ue),Qe=uf(ae.polygons,De-M,Ze+M,Se),rt=uf(ae.polygons,Ze-M,Ue+M,Se);if(Qe.length){const Be=[Ne,new fe(Se===0?Ze:it.x,Se===1?Ze:it.y)];K.length>Me+1?ce.push({polygons:Qe,bounds:Be,depth:Me+1}):N(Qe,Be)}if(rt.length){const Be=[new fe(Se===0?Ze:Ne.x,Se===1?Ze:Ne.y),it];K.length>Me+1?ce.push({polygons:rt,bounds:Be,depth:Me+1}):N(rt,Be)}}return D}(n,e,Math.ceil((p-u)/11.25),Math.ceil((g-y)/11.25),1,(x,w,A)=>{if(x===0)return .5*(w+A);{const C=Ji((i.y+w/Ht)/a);return(es(.5*(Ji((i.y+A/Ht)/a)+C))*a-i.y)*Ht}})}Et(Gh,"FillExtrusionBucket",{omit:["layers","features"]}),Et(E0,"PartMetadata");const K2=new tt({"fill-extrusion-edge-radius":new ye(je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Y2={paint:new tt({"fill-extrusion-opacity":new ye(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Re(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ye(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ye(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Re(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Re(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Re(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ye(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ye(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ye(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:K2};function L0(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class hf{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Zh(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=function(p,g,y){var x=L0(256*p,256*(g=Math.pow(2,y)-g-1),y),w=L0(256*(p+1),256*(g+1),y);return x[0]+","+x[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),u=function(p,g,y){let x,w="";for(let A=p;A>0;A--)x=1<<A-1,w+=(g&x?1:0)+(y&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class z0{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Zh(e,i.z,i.z,i.x,i.y)}}class fr{constructor(e,i,a,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new hf(a,+u,+p),this.key=i===0&&e===a?this.canonical.key:Zh(i,e,a,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new fr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Zh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Zh(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new fr(i,this.wrap,i,a,u),new fr(i,this.wrap,i,a+1,u),new fr(i,this.wrap,i,a,u+1),new fr(i,this.wrap,i,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new fr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new z0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Zh(n,e,i,a,u){const p=1<<Math.min(i,22);let g=p*(u%p)+a%p;return n&&i<22&&(g+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}Et(hf,"CanonicalTileID"),Et(fr,"OverscaledTileID",{omit:["projMatrix"]});class Yc extends fe{constructor(e,i,a){super(e,i),this.z=a}}function qh(n,e){return n.x*e.x+n.y*e.y}function R0(n,e){if(n.length===1){let i=0;const a=e[i++];let u;for(;!u||a.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],g=n[0],y=u.sub(a),x=p.sub(a),w=g.sub(a),A=qh(y,y),C=qh(y,x),M=qh(x,x),R=qh(w,y),D=qh(w,x),N=A*M-C*C,G=(M*R-C*D)/N,ee=(A*D-C*R)/N,se=a.z*(1-G-ee)+u.z*G+p.z*ee;if(isFinite(se))return se}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function D0(n,e,i,a,u,p,g,y){const x=g*u.getElevationAt(n,e,!0,!0),w=p[0]!==0,A=w?p[1]===0?g*(p[0]/7-450):g*function(C,M,R){const D=Math.floor(M[0]/8),N=Math.floor(M[1]/8),G=10*(M[0]-8*D),ee=10*(M[1]-8*N),se=C.getElevationAt(D,N,!0,!0),K=C.getMeterToDEM(R),oe=Math.floor(.5*(G*K-1)),ce=Math.floor(.5*(ee*K-1)),ae=C.tileCoordToPixel(D,N),Me=2*oe+1,Se=2*ce+1,Ne=function(rt,Be,ct,Nt,mt){return[rt.getElevationAtPixel(Be,ct,!0),rt.getElevationAtPixel(Be+mt,ct,!0),rt.getElevationAtPixel(Be,ct+mt,!0),rt.getElevationAtPixel(Be+Nt,ct+mt,!0)]}(C,ae.x-oe,ae.y-ce,Me,Se),it=Math.abs(Ne[0]-Ne[1]),De=Math.abs(Ne[2]-Ne[3]),Ue=Math.abs(Ne[0]-Ne[2])+Math.abs(Ne[1]-Ne[3]),Ze=Math.min(.25,.5*K*(it+De)/Me),Qe=Math.min(.25,.5*K*Ue/Se);return se+Math.max(Ze*G,Qe*ee)}(u,p,y):x;return{base:x+(i===0)?-1:i,top:w?Math.max(A+a,x+i+2):x+a}}const J2=Mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Q2}=J2,ek=Mt([{name:"a_packed",components:4,type:"Float32"}]),{members:tk}=ek,nk=cf.types,ik=Math.cos(Math.PI/180*37.5);class df{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Qn,this.layoutVertexArray2=new Xn,this.indexArray=new Yi,this.programConfigurations=new Tl(e.layers,e.zoom),this.segments=new Ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){this.hasPattern=Rg("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:C,index:M,sourceLayerIndex:R}of e){const D=this.layers[0]._featureFilter.needGeometry,N=Cl(A,D);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),N,a))continue;const G=p?p.evaluate(N,{},a):void 0,ee={id:C,properties:A.properties,type:A.type,sourceLayerIndex:R,index:M,geometry:D?N.geometry:Ms(A,a,u),patterns:{},sortKey:G};g.push(ee)}p&&g.sort((A,C)=>A.sortKey-C.sortKey);const{lineAtlas:y,featureIndex:x}=i,w=this.addConstantDashes(y);for(const A of g){const{geometry:C,index:M,sourceLayerIndex:R}=A;if(w&&this.addFeatureDashes(A,y),this.hasPattern){const D=Dg("line",this.layers,A,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(A,C,M,a,y.positions,i.availableImages);x.insert(e[M].feature,C,M,R,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,y=u.value;if(!y)continue;e.addDash(y,g)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let y,x;if(p.kind==="constant"){if(y=p.value,!y)continue}else y=p.evaluate({zoom:a},e);x=g.kind==="constant"?g.value:g.evaluate({zoom:a},e),i.addDash(y,x),e.patterns[u.id]=i.getKey(y,x)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}addFeatures(e,i,a,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,tk)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Q2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,u,p,g){const y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),A=y.get("line-miter-limit"),C=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of i)this.addLine(M,e,x,w,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,g,u)}addLine(e,i,a,u,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=nk[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let w=0;for(;w<x-1&&e[w].equals(e[w+1]);)w++;if(x<(y?3:2))return;a==="bevel"&&(p=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,R,D,N,G;this.e1=this.e2=-1,y&&(M=e[x-2],G=e[w].sub(M)._unit()._perp());for(let ee=w;ee<x;ee++){if(D=ee===x-1?y?e[w+1]:void 0:e[ee+1],D&&e[ee].equals(D))continue;G&&(N=G),M&&(R=M),M=e[ee],G=D?D.sub(M)._unit()._perp():N,N=N||G;let se=N.add(G);se.x===0&&se.y===0||se._unit();const K=N.x*G.x+N.y*G.y,oe=se.x*G.x+se.y*G.y,ce=oe!==0?1/oe:1/0,ae=2*Math.sqrt(2-2*oe),Me=oe<ik&&R&&D,Se=N.x*G.y-N.y*G.x>0;if(Me&&ee>w){const De=M.dist(R);if(De>2*A){const Ue=M.sub(M.sub(R)._mult(A/De)._round());this.updateDistance(R,Ue),this.addCurrentVertex(Ue,N,0,0,C),R=Ue}}const Ne=R&&D;let it=Ne?a:y?"butt":u;if(Ne&&it==="round"&&(ce<g?it="miter":ce<=2&&(it="fakeround")),it==="miter"&&ce>p&&(it="bevel"),it==="bevel"&&(ce>2&&(it="flipbevel"),ce<p&&(it="miter")),R&&this.updateDistance(R,M),it==="miter")se._mult(ce),this.addCurrentVertex(M,se,0,0,C);else if(it==="flipbevel"){if(ce>100)se=G.mult(-1);else{const De=ce*N.add(G).mag()/N.sub(G).mag();se._perp()._mult(De*(Se?-1:1))}this.addCurrentVertex(M,se,0,0,C),this.addCurrentVertex(M,se.mult(-1),0,0,C)}else if(it==="bevel"||it==="fakeround"){const De=-Math.sqrt(ce*ce-1),Ue=Se?De:0,Ze=Se?0:De;if(R&&this.addCurrentVertex(M,N,Ue,Ze,C),it==="fakeround"){const Qe=Math.round(180*ae/Math.PI/20);for(let rt=1;rt<Qe;rt++){let Be=rt/Qe;if(Be!==.5){const Nt=Be-.5;Be+=Be*Nt*(Be-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*Nt*Nt+(.848013+K*(.215638*K-1.06021)))}const ct=G.sub(N)._mult(Be)._add(N)._unit()._mult(Se?-1:1);this.addHalfVertex(M,ct.x,ct.y,!1,Se,0,C)}}D&&this.addCurrentVertex(M,G,-Ue,-Ze,C)}else if(it==="butt")this.addCurrentVertex(M,se,0,0,C);else if(it==="square"){const De=R?1:-1;R||this.addCurrentVertex(M,se,De,De,C),this.addCurrentVertex(M,se,0,0,C),R&&this.addCurrentVertex(M,se,De,De,C)}else it==="round"&&(R&&(this.addCurrentVertex(M,N,0,0,C),this.addCurrentVertex(M,N,1,1,C,!0)),D&&(this.addCurrentVertex(M,G,-1,-1,C,!0),this.addCurrentVertex(M,G,0,0,C)));if(Me&&ee<x-1){const De=M.dist(D);if(De>2*A){const Ue=M.add(D.sub(M)._mult(A/De)._round());this.updateDistance(M,Ue),this.addCurrentVertex(Ue,G,0,0,C),M=Ue}}}}addCurrentVertex(e,i,a,u,p,g=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,g,!1,a,p),this.addHalfVertex(e,y,x,g,!0,-u,p)}addHalfVertex({x:e,y:i},a,u,p,g,y,x){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),g?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Et(df,"LineBucket",{omit:["layers","patternFeatures"]});const rk=new tt({"line-cap":new Re(je.layout_line["line-cap"]),"line-join":new Re(je.layout_line["line-join"]),"line-miter-limit":new ye(je.layout_line["line-miter-limit"]),"line-round-limit":new ye(je.layout_line["line-round-limit"]),"line-sort-key":new Re(je.layout_line["line-sort-key"])});var O0={paint:new tt({"line-opacity":new Re(je.paint_line["line-opacity"]),"line-color":new Re(je.paint_line["line-color"]),"line-translate":new ye(je.paint_line["line-translate"]),"line-translate-anchor":new ye(je.paint_line["line-translate-anchor"]),"line-width":new Re(je.paint_line["line-width"]),"line-gap-width":new Re(je.paint_line["line-gap-width"]),"line-offset":new Re(je.paint_line["line-offset"]),"line-blur":new Re(je.paint_line["line-blur"]),"line-dasharray":new Re(je.paint_line["line-dasharray"]),"line-pattern":new Re(je.paint_line["line-pattern"]),"line-gradient":new He(je.paint_line["line-gradient"]),"line-trim-offset":new ye(je.paint_line["line-trim-offset"])}),layout:rk};const B0=new class extends Re{possiblyEvaluate(n,e){return e=new xe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,a){return e=Jt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,a)}}(O0.paint.properties["line-width"].specification);function F0(n,e){return e>0?e+2*n:n}B0.useIntegerZoom=!0;const ok=Mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sk=Mt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ak=Mt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lk=Mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ck=Mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const j0=Mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uk=Mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mt([{name:"triangle",components:3,type:"Uint16"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mt([{type:"Float32",name:"offsetX"}]),Mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var er=24;const ts=128;function Bg(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new xe(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=i;let p=0;for(;p<a.length&&a[p]<=n;)p++;p=Math.max(0,p-1);let g=p;for(;g<a.length&&a[g]<n+1;)g++;g=Math.min(a.length-1,g);const y=a[p],x=a[g];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new xe(y)),maxSize:i.evaluate(new xe(x)),interpolationType:u}}}function pf(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:u}){return n.kind==="source"?a/ts:n.kind==="composite"?xn(a/ts,u/ts,i):e}function Jc(n,e){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:g}=n,y=u?At(oo.interpolationFactor(u,e,p,g),0,1):0;n.kind==="camera"?a=xn(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:a}}var hk=Object.freeze({__proto__:null,getSizeData:Bg,evaluateSizeForFeature:pf,evaluateSizeForZoom:Jc,SIZE_PACK_FACTOR:ts});function dk(n,e,i){return n.sections.forEach(a=>{a.text=function(u,p,g){const y=p.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),de.applyArabicShaping&&(u=de.applyArabicShaping(u)),u}(a.text,e,i)}),n}const Wh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function pk(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function fk(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var Hh=ei,N0=function(n,e,i,a,u){var p,g,y=8*u-a-1,x=(1<<y)-1,w=x>>1,A=-7,C=i?u-1:0,M=i?-1:1,R=n[e+C];for(C+=M,p=R&(1<<-A)-1,R>>=-A,A+=y;A>0;p=256*p+n[e+C],C+=M,A-=8);for(g=p&(1<<-A)-1,p>>=-A,A+=a;A>0;g=256*g+n[e+C],C+=M,A-=8);if(p===0)p=1-w;else{if(p===x)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,a),p-=w}return(R?-1:1)*g*Math.pow(2,p-a)},$0=function(n,e,i,a,u,p){var g,y,x,w=8*p-u-1,A=(1<<w)-1,C=A>>1,M=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:p-1,D=a?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=A):(g=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-g))<1&&(g--,x*=2),(e+=g+C>=1?M/x:M*Math.pow(2,1-C))*x>=2&&(g++,x/=2),g+C>=A?(y=0,g=A):g+C>=1?(y=(e*x-1)*Math.pow(2,u),g+=C):(y=e*Math.pow(2,C-1)*Math.pow(2,u),g=0));u>=8;n[i+R]=255&y,R+=D,y/=256,u-=8);for(g=g<<u|y,w+=u;w>0;n[i+R]=255&g,R+=D,g/=256,w-=8);n[i+R-D]|=128*N};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ei(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}ei.Varint=0,ei.Fixed64=1,ei.Bytes=2,ei.Fixed32=5;var Fg=4294967296,U0=1/Fg,V0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ls(n){return n.type===ei.Bytes?n.readVarint()+n.pos:n.pos+1}function Qc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function G0(n,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var u=i.pos-1;u>=n;u--)i.buf[u+a]=i.buf[u]}function mk(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function gk(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function _k(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function yk(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function vk(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function bk(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function xk(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function wk(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function Tk(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function ff(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function eu(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function Z0(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function Ek(n,e,i){e.glyphs=[],n===1&&i.readMessage(kk,e)}function kk(n,e,i){if(n===3){const{id:a,bitmap:u,width:p,height:g,left:y,top:x,advance:w}=i.readMessage(Sk,{});e.glyphs.push({id:a,bitmap:new Ps({width:p+6,height:g+6},u),metrics:{width:p,height:g,left:y,top:x,advance:w}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function Sk(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function jg(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,y)=>y.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const g of n)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,p=Math.max(p,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===x.w&&g.h===x.h){const w=a.pop();y<a.length&&(a[y]=w)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(a.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}ei.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),u=a>>3,p=this.pos;this.type=7&a,n(u,e,this),this.pos===p&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=ff(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Z0(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=ff(this.buf,this.pos)+ff(this.buf,this.pos+4)*Fg;return this.pos+=8,n},readSFixed64:function(){var n=ff(this.buf,this.pos)+Z0(this.buf,this.pos+4)*Fg;return this.pos+=8,n},readFloat:function(){var n=N0(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=N0(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(u,p,g){var y,x,w=g.buf;if(y=(112&(x=w[g.pos++]))>>4,x<128||(y|=(127&(x=w[g.pos++]))<<3,x<128)||(y|=(127&(x=w[g.pos++]))<<10,x<128)||(y|=(127&(x=w[g.pos++]))<<17,x<128)||(y|=(127&(x=w[g.pos++]))<<24,x<128)||(y|=(1&(x=w[g.pos++]))<<31,x<128))return Qc(u,y,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&V0?function(i,a,u){return V0.decode(i.subarray(a,u))}(this.buf,e,n):function(i,a,u){for(var p="",g=a;g<u;){var y,x,w,A=i[g],C=null,M=A>239?4:A>223?3:A>191?2:1;if(g+M>u)break;M===1?A<128&&(C=A):M===2?(192&(y=i[g+1]))==128&&(C=(31&A)<<6|63&y)<=127&&(C=null):M===3?(x=i[g+2],(192&(y=i[g+1]))==128&&(192&x)==128&&((C=(15&A)<<12|(63&y)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(x=i[g+2],w=i[g+3],(192&(y=i[g+1]))==128&&(192&x)==128&&(192&w)==128&&((C=(15&A)<<18|(63&y)<<12|(63&x)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,p+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),p+=String.fromCharCode(C),g+=M}return p}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==ei.Bytes)return n.push(this.readVarint(e));var i=Ls(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==ei.Bytes)return n.push(this.readSVarint());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==ei.Bytes)return n.push(this.readBoolean());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==ei.Bytes)return n.push(this.readFloat());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==ei.Bytes)return n.push(this.readDouble());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==ei.Bytes)return n.push(this.readFixed32());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==ei.Bytes)return n.push(this.readSFixed32());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==ei.Bytes)return n.push(this.readFixed64());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==ei.Bytes)return n.push(this.readSFixed64());var e=Ls(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===ei.Varint)for(;this.buf[this.pos++]>127;);else if(e===ei.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ei.Fixed32)this.pos+=4;else{if(e!==ei.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),eu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),eu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),eu(this.buf,-1&n,this.pos),eu(this.buf,Math.floor(n*U0),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),eu(this.buf,-1&n,this.pos),eu(this.buf,Math.floor(n*U0),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(p,g,y){y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,y.buf[y.pos]=127&(p>>>=7)}(a,0,i),function(p,g){var y=(7&p)<<4;g.buf[g.pos++]|=y|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,u,p){for(var g,y,x=0;x<u.length;x++){if((g=u.charCodeAt(x))>55295&&g<57344){if(!y){g>56319||x+1===u.length?(a[p++]=239,a[p++]=191,a[p++]=189):y=g;continue}if(g<56320){a[p++]=239,a[p++]=191,a[p++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(a[p++]=239,a[p++]=191,a[p++]=189,y=null);g<128?a[p++]=g:(g<2048?a[p++]=g>>6|192:(g<65536?a[p++]=g>>12|224:(a[p++]=g>>18|240,a[p++]=g>>12&63|128),a[p++]=g>>6&63|128),a[p++]=63&g|128)}return p}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&G0(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),$0(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),$0(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var a=this.pos-i;a>=128&&G0(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,i){this.writeTag(n,ei.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,mk,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,gk,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,vk,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,_k,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,yk,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,bk,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,xk,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,wk,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Tk,e)},writeBytesField:function(n,e){this.writeTag(n,ei.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,ei.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,ei.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,ei.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,ei.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,ei.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,ei.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,ei.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,ei.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,ei.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class Ng{constructor(e,{pixelRatio:i,version:a,stretchX:u,stretchY:p,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=p,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class q0{constructor(e,i){const a={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,a,p),this.addImages(i,u,p);const{w:g,h:y}=jg(p),x=new Nr({width:g||1,height:y||1});for(const w in e){const A=e[w],C=a[w].paddedRect;Nr.copy(A.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},A.data)}for(const w in i){const A=i[w],C=u[w].paddedRect,M=C.x+1,R=C.y+1,D=A.data.width,N=A.data.height;Nr.copy(A.data,x,{x:0,y:0},{x:M,y:R},A.data),Nr.copy(A.data,x,{x:0,y:N-1},{x:M,y:R-1},{width:D,height:1}),Nr.copy(A.data,x,{x:0,y:0},{x:M,y:R+N},{width:D,height:1}),Nr.copy(A.data,x,{x:D-1,y:0},{x:M-1,y:R},{width:1,height:N}),Nr.copy(A.data,x,{x:0,y:0},{x:M+D,y:R},{width:1,height:N})}this.image=x,this.iconPositions=a,this.patternPositions=u}addImages(e,i,a){for(const u in e){const p=e[u],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};a.push(g),i[u]=new Ng(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,p]=e.tl;a.update(i.data,void 0,{x:u,y:p})}}Et(Ng,"ImagePosition"),Et(q0,"ImageAtlas");const Yr={horizontal:1,vertical:2,horizontalOnly:3};class Xh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new Xh;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Xh;return i.imageName=e,i}}class tu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new tu;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?a.addImageSection(p):a.addTextSection(p,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,a){let u="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,y=i.charCodeAt(p-1)||null;u+=!a&&(g&&I(g)&&!Wh[i[p+1]]||y&&I(y)&&!Wh[i[p-1]])||!Wh[i[p]]?i[p]:Wh[i[p]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&mf[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&mf[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new tu;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Xh.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void ne("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Xh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ne("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $g(n,e,i,a,u,p,g,y,x,w,A,C,M,R,D){const N=tu.fromFeature(n,u);C===Yr.vertical&&N.verticalizePunctuation(M);let G=[];const ee=function(ae,Me,Se,Ne,it,De){if(!ae)return[];const Ue=[],Ze=function(ct,Nt,mt,St,ut,Vt){let dn=0;for(let ln=0;ln<ct.length();ln++){const on=ct.getSection(ln);dn+=W0(ct.getCharCode(ln),on,St,ut,Nt,Vt)}return dn/Math.max(1,Math.ceil(dn/mt))}(ae,Me,Se,Ne,it,De),Qe=ae.text.indexOf("​")>=0;let rt=0;for(let ct=0;ct<ae.length();ct++){const Nt=ae.getSection(ct),mt=ae.getCharCode(ct);if(mf[mt]||(rt+=W0(mt,Nt,Ne,it,Me,De)),ct<ae.length()-1){const St=!((Be=mt)<11904||!(Dp(Be)||jc(Be)||d(Be)||Vp(Be)||Fp(Be)||Rp(Be)||Op(Be)||bl(Be)||jp(Be)||kh(Be)||Bp(Be)||f(Be)||Fc(Be)||Th(Be)||wh(Be)||Eh(Be)||ua(Be)||xl(Be)||$p(Be)||Np(Be)));(Ak[mt]||St||Nt.imageName)&&Ue.push(X0(ct+1,rt,Ze,Ue,Ik(mt,ae.getCharCode(ct+1),St&&Qe),!1))}}var Be;return K0(X0(ae.length(),rt,Ze,Ue,0,!0))}(N,w,p,e,a,R),{processBidirectionalText:se,processStyledBidirectionalText:K}=de;if(se&&N.sections.length===1){const ae=se(N.toString(),ee);for(const Me of ae){const Se=new tu;Se.text=Me,Se.sections=N.sections;for(let Ne=0;Ne<Me.length;Ne++)Se.sectionIndex.push(0);G.push(Se)}}else if(K){const ae=K(N.text,N.sectionIndex,ee);for(const Me of ae){const Se=new tu;Se.text=Me[0],Se.sectionIndex=Me[1],Se.sections=N.sections,G.push(Se)}}else G=function(ae,Me){const Se=[],Ne=ae.text;let it=0;for(const De of Me)Se.push(ae.substring(it,De)),it=De;return it<Ne.length&&Se.push(ae.substring(it,Ne.length)),Se}(N,ee);const oe=[],ce={positionedLines:oe,text:N.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,Me,Se,Ne,it,De,Ue,Ze,Qe,rt,Be,ct){let Nt=0,mt=0,St=0;const ut=Ze==="right"?1:Ze==="left"?0:.5;let Vt=!1;for(const Xt of it){const pn=Xt.getSections();for(const Zn of pn){if(Zn.imageName)continue;const ri=Me[Zn.fontStack];if(ri&&(Vt=ri.ascender!==void 0&&ri.descender!==void 0,!Vt))break}if(!Vt)break}let dn=0;for(const Xt of it){Xt.trim();const pn=Xt.getMaxScale(),Zn=(pn-1)*er,ri={positionedGlyphs:[],lineOffset:0};ae.positionedLines[dn]=ri;const ti=ri.positionedGlyphs;let oi=0;if(!Xt.length()){mt+=De,++dn;continue}let ci=0,_i=0;for(let Nn=0;Nn<Xt.length();Nn++){const Li=Xt.getSection(Nn),Si=Xt.getSectionIndex(Nn),In=Xt.getCharCode(Nn);let pi=Li.scale,Di=null,qn=null,bi=null,sr=er,Zi=0;const qi=!(Qe===Yr.horizontal||!Be&&!k(In)||Be&&(mf[In]||(ln=In,vl(ln)||zp(ln)||xh(ln)||Nc(ln)||c(ln))));if(Li.imageName){const mr=Ne[Li.imageName];if(!mr)continue;bi=Li.imageName,ae.iconsInText=ae.iconsInText||!0,qn=mr.paddedRect;const Wi=mr.displaySize;pi=pi*er/ct,Di={width:Wi[0],height:Wi[1],left:1,top:-3,advance:qi?Wi[1]:Wi[0],localGlyph:!1},Zi=Vt?-Di.height*pi:pn*er-17-Wi[1]*pi,sr=Di.advance;const Rs=(qi?Wi[0]:Wi[1])*pi-er*pn;Rs>0&&Rs>oi&&(oi=Rs)}else{const mr=Se[Li.fontStack];if(!mr)continue;mr[In]&&(qn=mr[In]);const Wi=Me[Li.fontStack];if(!Wi)continue;const Rs=Wi.glyphs[In];if(!Rs)continue;if(Di=Rs.metrics,sr=In!==8203?er:0,Vt){const su=Wi.ascender!==void 0?Math.abs(Wi.ascender):0,id=Wi.descender!==void 0?Math.abs(Wi.descender):0,rd=(su+id)*pi;ci<rd&&(ci=rd,_i=(su-id)/2*pi),Zi=-su*pi}else Zi=(pn-pi)*er-17}qi?(ae.verticalizable=!0,ti.push({glyph:In,imageName:bi,x:Nt,y:mt+Zi,vertical:qi,scale:pi,localGlyph:Di.localGlyph,fontStack:Li.fontStack,sectionIndex:Si,metrics:Di,rect:qn}),Nt+=sr*pi+rt):(ti.push({glyph:In,imageName:bi,x:Nt,y:mt+Zi,vertical:qi,scale:pi,localGlyph:Di.localGlyph,fontStack:Li.fontStack,sectionIndex:Si,metrics:Di,rect:qn}),Nt+=Di.advance*pi+rt)}ti.length!==0&&(St=Math.max(Nt-rt,St),Vt?Y0(ti,ut,oi,_i,De*pn/2):Y0(ti,ut,oi,0,De/2)),Nt=0;const Gi=De*pn+oi;ri.lineOffset=Math.max(oi,Zn),mt+=Gi,++dn}var ln;const on=mt,{horizontalAlign:qt,verticalAlign:jn}=Ug(Ue);(function(Xt,pn,Zn,ri,ti,oi){const ci=(pn-Zn)*ti,_i=-oi*ri;for(const Gi of Xt)for(const Nn of Gi.positionedGlyphs)Nn.x+=ci,Nn.y+=_i})(ae.positionedLines,ut,qt,jn,St,on),ae.top+=-jn*on,ae.bottom=ae.top+on,ae.left+=-qt*St,ae.right=ae.left+St,ae.hasBaseline=Vt}(ce,e,i,a,G,g,y,x,C,w,M,D),!function(ae){for(const Me of ae)if(Me.positionedGlyphs.length!==0)return!1;return!0}(oe)&&ce}const mf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ak={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function W0(n,e,i,a,u,p){if(e.imageName){const g=a[e.imageName];return g?g.displaySize[0]*e.scale*er/p+u:0}{const g=i[e.fontStack],y=g&&g.glyphs[n];return y?y.metrics.advance*e.scale+u:0}}function H0(n,e,i,a){const u=Math.pow(n-e,2);return a?n<e?u/2:2*u:u+Math.abs(i)*i}function Ik(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function X0(n,e,i,a,u,p){let g=null,y=H0(e,i,u,p);for(const x of a){const w=H0(e-x.x,i,u,p)+x.badness;w<=y&&(g=x,y=w)}return{index:n,x:e,priorBreak:g,badness:y}}function K0(n){return n?K0(n.priorBreak).concat(n.index):[]}function Ug(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Y0(n,e,i,a,u){if(!(e||i||a||u))return;const p=n.length-1,g=n[p],y=(g.x+g.metrics.advance*g.scale)*e;for(let x=0;x<=p;x++)n[x].x-=y,n[x].y+=i+a+u}function Ck(n,e,i){const{horizontalAlign:a,verticalAlign:u}=Ug(i),p=e[0]-n.displaySize[0]*a,g=e[1]-n.displaySize[1]*u;return{image:n,top:g,bottom:g+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function J0(n,e,i,a,u,p){const g=n.image;let y;if(g.content){const G=g.content,ee=g.pixelRatio||1;y=[G[0]/ee,G[1]/ee,g.displaySize[0]-G[2]/ee,g.displaySize[1]-G[3]/ee]}const x=e.left*p,w=e.right*p;let A,C,M,R;i==="width"||i==="both"?(R=u[0]+x-a[3],C=u[0]+w+a[1]):(R=u[0]+(x+w-g.displaySize[0])/2,C=R+g.displaySize[0]);const D=e.top*p,N=e.bottom*p;return i==="height"||i==="both"?(A=u[1]+D-a[0],M=u[1]+N+a[2]):(A=u[1]+(D+N-g.displaySize[1])/2,M=A+g.displaySize[1]),{image:g,top:A,right:C,bottom:M,left:R,collisionPadding:y}}class zs extends fe{constructor(e,i,a,u,p){super(e,i),this.angle=u,this.z=a,p!==void 0&&(this.segment=p)}clone(){return new zs(this.x,this.y,this.z,this.angle,this.segment)}}function Q0(n,e,i,a,u){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=n[g].dist(p),p=n[g]}y+=n[g].dist(n[g+1]),g++;const x=[];let w=0;for(;y<i/2;){const A=n[g],C=n[g+1];if(!C)return!1;let M=n[g-1].angleTo(A)-A.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:M}),w+=M;y-x[0].distance>a;)w-=x.shift().angleDelta;if(w>u)return!1;g++,y+=A.dist(C)}return!0}function eb(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function tb(n,e,i){return n?.6*e*i:0}function nb(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Mk(n,e,i,a,u,p){const g=tb(i,u,p),y=nb(i,a)*p;let x=0;const w=eb(n)/2;for(let A=0;A<n.length-1;A++){const C=n[A],M=n[A+1],R=C.dist(M);if(x+R>w){const D=(w-x)/R,N=xn(C.x,M.x,D),G=xn(C.y,M.y,D),ee=new zs(N,G,0,M.angleTo(C),A);return!g||Q0(n,ee,y,g,e)?ee:void 0}x+=R}}function Pk(n,e,i,a,u,p,g,y,x){const w=tb(a,p,g),A=nb(a,u),C=A*g,M=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-C<e/4&&(e=C+e/4),ib(n,M?e/2*y%e:(A/2+2*p)*g*y%e,e,w,i,C,M,!1,x)}function ib(n,e,i,a,u,p,g,y,x){const w=p/2,A=eb(n);let C=0,M=e-i,R=[];for(let D=0;D<n.length-1;D++){const N=n[D],G=n[D+1],ee=N.dist(G),se=G.angleTo(N);for(;M+i<C+ee;){M+=i;const K=(M-C)/ee,oe=xn(N.x,G.x,K),ce=xn(N.y,G.y,K);if(oe>=0&&oe<x&&ce>=0&&ce<x&&M-w>=0&&M+w<=A){const ae=new zs(oe,ce,0,se,D);ae._round(),a&&!Q0(n,ae,p,a,u)||R.push(ae)}}C+=ee}return y||R.length||g||(R=ib(n,C/2,i,a,u,p,g,!0,x)),R}function rb(n,e,i,a,u){const p=[];for(let g=0;g<n.length;g++){const y=n[g];let x;for(let w=0;w<y.length-1;w++){let A=y[w],C=y[w+1];A.x<e&&C.x<e||(A.x<e?A=new fe(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x<e&&(C=new fe(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y<i&&C.y<i||(A.y<i?A=new fe(A.x+(i-A.y)/(C.y-A.y)*(C.x-A.x),i)._round():C.y<i&&(C=new fe(A.x+(i-A.y)/(C.y-A.y)*(C.x-A.x),i)._round()),A.x>=a&&C.x>=a||(A.x>=a?A=new fe(a,A.y+(a-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x>=a&&(C=new fe(a,A.y+(a-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y>=u&&C.y>=u||(A.y>=u?A=new fe(A.x+(u-A.y)/(C.y-A.y)*(C.x-A.x),u)._round():C.y>=u&&(C=new fe(A.x+(u-A.y)/(C.y-A.y)*(C.x-A.x),u)._round()),x&&A.equals(x[x.length-1])||(x=[A],p.push(x)),x.push(C)))))}}return p}Et(zs,"Anchor");const Kh=1e20;function ob(n,e,i,a,u,p,g,y,x){for(let w=e;w<e+a;w++)sb(n,i*p+w,p,u,g,y,x);for(let w=i;w<i+u;w++)sb(n,w*p+e,1,a,g,y,x)}function sb(n,e,i,a,u,p,g){p[0]=0,g[0]=-Kh,g[1]=Kh,u[0]=n[e];for(let y=1,x=0,w=0;y<a;y++){u[y]=n[e+y*i];const A=y*y;do{const C=p[x];w=(u[y]-u[C]+A-C*C)/(y-C)/2}while(w<=g[x]&&--x>-1);x++,p[x]=y,g[x]=w,g[x+1]=Kh}for(let y=0,x=0;y<a;y++){for(;g[x+1]<y;)x++;const w=p[x],A=y-w;n[e+y*i]=u[w]+A*A}}const Vg={none:0,ideographs:1,all:2};class nu{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[];for(const u in e)for(const p of e[u])a.push({stack:u,id:p});Ft(a,({stack:u,id:p},g)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[p];if(x!==void 0)return void g(null,{stack:u,id:p,glyph:x});if(x=this._tinySDF(y,u,p),x)return y.glyphs[p]=x,void g(null,{stack:u,id:p,glyph:x});const w=Math.floor(p/256);if(256*w>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void g(null,{stack:u,id:p,glyph:x});let A=y.requests[w];A||(A=y.requests[w]=[],nu.loadGlyphRange(u,w,this.url,this.requestManager,(C,M)=>{if(M){y.ascender=M.ascender,y.descender=M.descender;for(const R in M.glyphs)this._doesCharSupportLocalGlyph(+R)||(y.glyphs[+R]=M.glyphs[+R]);y.ranges[w]=!0}for(const R of A)R(C,M);delete y.requests[w]})),A.push((C,M)=>{C?g(C):M&&g(null,{stack:u,id:p,glyph:M.glyphs[p]||null})})},(u,p)=>{if(u)i(u);else if(p){const g={};for(const{stack:y,id:x,glyph:w}of p)g[y]===void 0&&(g[y]={}),g[y].glyphs===void 0&&(g[y].glyphs={}),g[y].glyphs[x]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Vg.none&&(this.localGlyphMode===Vg.all?!!this.localFontFamily:!!this.localFontFamily&&(kh(e)||Up(e)||Fc(e)||ua(e)||bl(e)))}_tinySDF(e,i,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let p=e.tinySDF;if(!p){let N="400";/bold/i.test(i)?N="900":/medium/i.test(i)?N="500":/light/i.test(i)&&(N="200"),p=e.tinySDF=new nu.TinySDF({fontFamily:u,fontWeight:N,fontSize:48,buffer:6,radius:16}),p.fontWeight=N}if(this.localGlyphs[p.fontWeight][a])return this.localGlyphs[p.fontWeight][a];const g=String.fromCharCode(a),{data:y,width:x,height:w,glyphWidth:A,glyphHeight:C,glyphLeft:M,glyphTop:R,glyphAdvance:D}=p.draw(g);return this.localGlyphs[p.fontWeight][a]={id:a,bitmap:new Ps({width:x,height:w},y),metrics:{width:A/2,height:C/2,left:M/2,top:R/2-27,advance:D/2,localGlyph:!0}}}}function ab(n,e,i,a){const u=[],p=n.image,g=p.pixelRatio,y=p.paddedRect.w-2,x=p.paddedRect.h-2,w=n.right-n.left,A=n.bottom-n.top,C=p.stretchX||[[0,y]],M=p.stretchY||[[0,x]],R=(De,Ue)=>De+Ue[1]-Ue[0],D=C.reduce(R,0),N=M.reduce(R,0),G=y-D,ee=x-N;let se=0,K=D,oe=0,ce=N,ae=0,Me=G,Se=0,Ne=ee;if(p.content&&a){const De=p.content;se=gf(C,0,De[0]),oe=gf(M,0,De[1]),K=gf(C,De[0],De[2]),ce=gf(M,De[1],De[3]),ae=De[0]-se,Se=De[1]-oe,Me=De[2]-De[0]-K,Ne=De[3]-De[1]-ce}const it=(De,Ue,Ze,Qe)=>{const rt=_f(De.stretch-se,K,w,n.left),Be=yf(De.fixed-ae,Me,De.stretch,D),ct=_f(Ue.stretch-oe,ce,A,n.top),Nt=yf(Ue.fixed-Se,Ne,Ue.stretch,N),mt=_f(Ze.stretch-se,K,w,n.left),St=yf(Ze.fixed-ae,Me,Ze.stretch,D),ut=_f(Qe.stretch-oe,ce,A,n.top),Vt=yf(Qe.fixed-Se,Ne,Qe.stretch,N),dn=new fe(rt,ct),ln=new fe(mt,ct),on=new fe(mt,ut),qt=new fe(rt,ut),jn=new fe(Be/g,Nt/g),Xt=new fe(St/g,Vt/g),pn=e*Math.PI/180;if(pn){const ti=Math.sin(pn),oi=Math.cos(pn),ci=[oi,-ti,ti,oi];dn._matMult(ci),ln._matMult(ci),qt._matMult(ci),on._matMult(ci)}const Zn=De.stretch+De.fixed,ri=Ue.stretch+Ue.fixed;return{tl:dn,tr:ln,bl:qt,br:on,tex:{x:p.paddedRect.x+1+Zn,y:p.paddedRect.y+1+ri,w:Ze.stretch+Ze.fixed-Zn,h:Qe.stretch+Qe.fixed-ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jn,pixelOffsetBR:Xt,minFontScaleX:Me/g/w,minFontScaleY:Ne/g/A,isSDF:i}};if(a&&(p.stretchX||p.stretchY)){const De=lb(C,G,D),Ue=lb(M,ee,N);for(let Ze=0;Ze<De.length-1;Ze++){const Qe=De[Ze],rt=De[Ze+1];for(let Be=0;Be<Ue.length-1;Be++)u.push(it(Qe,Ue[Be],rt,Ue[Be+1]))}}else u.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function gf(n,e,i){let a=0;for(const u of n)a+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return a}function lb(n,e,i){const a=[{fixed:-1,stretch:0}];for(const[u,p]of n){const g=a[a.length-1];a.push({fixed:u-g.stretch,stretch:g.stretch}),a.push({fixed:u-g.stretch,stretch:g.stretch+(p-u)})}return a.push({fixed:e+1,stretch:i}),a}function _f(n,e,i,a){return n/e*i+a}function yf(n,e,i,a){return n-e*i/a}function Lk(n,e,i,a){const u=e+n.positionedLines[a].lineOffset;return a===0?i+u/2:i+(u+(e+n.positionedLines[a-1].lineOffset))/2}nu.loadGlyphRange=function(n,e,i,a,u){const p=256*e,g=p+255,y=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${p}-${g}`),Fi.Glyphs);no(y,(x,w)=>{if(x)u(x);else if(w){const A={},C=function(M){return new Hh(M).readFields(Ek,{})}(w);for(const M of C.glyphs)A[M.id]=M;u(null,{glyphs:A,ascender:C.ascender,descender:C.descender})}})},nu.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const y=this.size=n+4*e,x=this._createCanvas(y),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${g} ${p} ${n}px ${u}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(n),g=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),x=Math.min(this.size-this.buffer,g+Math.ceil(a)),w=y+2*this.buffer,A=x+2*this.buffer,C=Math.max(w*A,0),M=new Uint8ClampedArray(C),R={data:M,width:w,height:A,glyphWidth:y,glyphHeight:x,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return R;const{ctx:D,buffer:N,gridInner:G,gridOuter:ee}=this;D.clearRect(N,N,y,x),D.fillText(n,N,N+g);const se=D.getImageData(N,N,y,x);ee.fill(Kh,0,C),G.fill(0,0,C);for(let K=0;K<x;K++)for(let oe=0;oe<y;oe++){const ce=se.data[4*(K*y+oe)+3]/255;if(ce===0)continue;const ae=(K+N)*w+oe+N;if(ce===1)ee[ae]=0,G[ae]=Kh;else{const Me=.5-ce;ee[ae]=Me>0?Me*Me:0,G[ae]=Me<0?Me*Me:0}}ob(ee,0,0,w,A,w,this.f,this.v,this.z),ob(G,N,N,y,x,w,this.f,this.v,this.z);for(let K=0;K<C;K++){const oe=Math.sqrt(ee[K])-Math.sqrt(G[K]);M[K]=Math.round(255-255*(oe/this.radius+this.cutoff))}return R}};class zk{constructor(e=[],i=Rk){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,u=i[e];for(;e>0;){const p=e-1>>1,g=i[p];if(a(u,g)>=0)break;i[e]=g,e=p}i[e]=u}_down(e){const{data:i,compare:a}=this,u=this.length>>1,p=i[e];for(;e<u;){let g=1+(e<<1),y=i[g];const x=g+1;if(x<this.length&&a(i[x],y)<0&&(g=x,y=i[x]),a(y,p)>=0)break;i[e]=y,e=g}i[e]=p}}function Rk(n,e){return n<e?-1:n>e?1:0}function Dk(n,e=1,i=!1){let a=1/0,u=1/0,p=-1/0,g=-1/0;const y=n[0];for(let R=0;R<y.length;R++){const D=y[R];(!R||D.x<a)&&(a=D.x),(!R||D.y<u)&&(u=D.y),(!R||D.x>p)&&(p=D.x),(!R||D.y>g)&&(g=D.y)}const x=Math.min(p-a,g-u);let w=x/2;const A=new zk([],Ok);if(x===0)return new fe(a,u);for(let R=a;R<p;R+=x)for(let D=u;D<g;D+=x)A.push(new iu(R+w,D+w,w,n));let C=function(R){let D=0,N=0,G=0;const ee=R[0];for(let se=0,K=ee.length,oe=K-1;se<K;oe=se++){const ce=ee[se],ae=ee[oe],Me=ce.x*ae.y-ae.x*ce.y;N+=(ce.x+ae.x)*Me,G+=(ce.y+ae.y)*Me,D+=3*Me}return new iu(N/D,G/D,0,R)}(n),M=A.length;for(;A.length;){const R=A.pop();(R.d>C.d||!C.d)&&(C=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,M)),R.max-C.d<=e||(w=R.h/2,A.push(new iu(R.p.x-w,R.p.y-w,w,n)),A.push(new iu(R.p.x+w,R.p.y-w,w,n)),A.push(new iu(R.p.x-w,R.p.y+w,w,n)),A.push(new iu(R.p.x+w,R.p.y+w,w,n)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function Ok(n,e){return e.max-n.max}function iu(n,e,i,a){this.p=new fe(n,e),this.h=i,this.d=function(u,p){let g=!1,y=1/0;for(let x=0;x<p.length;x++){const w=p[x];for(let A=0,C=w.length,M=C-1;A<C;M=A++){const R=w[A],D=w[M];R.y>u.y!=D.y>u.y&&u.x<(D.x-R.x)*(u.y-R.y)/(D.y-R.y)+R.x&&(g=!g),y=Math.min(y,s0(u,R,D))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const Gg=Number.POSITIVE_INFINITY,Bk=Math.sqrt(2);function cb(n,[e,i]){let a=0,u=0;if(i===Gg){e<0&&(e=0);const p=e/Bk;switch(n){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(n){case"top-right":case"bottom-right":a=-p;break;case"top-left":case"bottom-left":a=p;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function Fk(n,e,i,a,u,p,g,y,x,w){n.createArrays(),n.tilePixelRatio=Ht/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,C=n.layers[0]._unevaluatedLayout._values,M={};if(n.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:G}=n.textSizeData;M.compositeTextSizes=[C["text-size"].possiblyEvaluate(new xe(N),y),C["text-size"].possiblyEvaluate(new xe(G),y)]}if(n.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:G}=n.iconSizeData;M.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new xe(N),y),C["icon-size"].possiblyEvaluate(new xe(G),y)]}M.layoutTextSize=C["text-size"].possiblyEvaluate(new xe(x+1),y),M.layoutIconSize=C["icon-size"].possiblyEvaluate(new xe(x+1),y),M.textMaxSize=C["text-size"].possiblyEvaluate(new xe(18),y);const R=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",D=A.get("text-size");for(const N of n.features){const G=A.get("text-font").evaluate(N,{},y).join(","),ee=D.evaluate(N,{},y),se=M.layoutTextSize.evaluate(N,{},y),K=(M.layoutIconSize.evaluate(N,{},y),{horizontal:{},vertical:void 0}),oe=N.text;let ce,ae=[0,0];if(oe){const Ne=oe.toString(),it=A.get("text-letter-spacing").evaluate(N,{},y)*er,De=A.get("text-line-height").evaluate(N,{},y)*er,Ue=b(Ne)?it:0,Ze=A.get("text-anchor").evaluate(N,{},y),Qe=A.get("text-variable-anchor");if(!Qe){const mt=A.get("text-radial-offset").evaluate(N,{},y);ae=mt?cb(Ze,[mt*er,Gg]):A.get("text-offset").evaluate(N,{},y).map(St=>St*er)}let rt=R?"center":A.get("text-justify").evaluate(N,{},y);const Be=A.get("symbol-placement")==="point",ct=Be?A.get("text-max-width").evaluate(N,{},y)*er:1/0,Nt=mt=>{n.allowVerticalPlacement&&_(Ne)&&(K.vertical=$g(oe,e,i,u,G,ct,De,Ze,mt,Ue,ae,Yr.vertical,!0,se,ee))};if(!R&&Qe){const mt=rt==="auto"?Qe.map(ut=>Zg(ut)):[rt];let St=!1;for(let ut=0;ut<mt.length;ut++){const Vt=mt[ut];if(!K.horizontal[Vt])if(St)K.horizontal[Vt]=K.horizontal[0];else{const dn=$g(oe,e,i,u,G,ct,De,"center",Vt,Ue,ae,Yr.horizontal,!1,se,ee);dn&&(K.horizontal[Vt]=dn,St=dn.positionedLines.length===1)}}Nt("left")}else{if(rt==="auto"&&(rt=Zg(Ze)),Be||A.get("text-writing-mode").indexOf("horizontal")>=0||!_(Ne)){const mt=$g(oe,e,i,u,G,ct,De,Ze,rt,Ue,ae,Yr.horizontal,!1,se,ee);mt&&(K.horizontal[rt]=mt)}Nt(Be?"left":rt)}}let Me=!1;if(N.icon&&N.icon.name){const Ne=a[N.icon.name];Ne&&(ce=Ck(u[N.icon.name],A.get("icon-offset").evaluate(N,{},y),A.get("icon-anchor").evaluate(N,{},y)),Me=Ne.sdf,n.sdfIcons===void 0?n.sdfIcons=Ne.sdf:n.sdfIcons!==Ne.sdf&&ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==n.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Se=hb(K.horizontal)||K.vertical;n.iconsInText||(n.iconsInText=!!Se&&Se.iconsInText),(Se||ce)&&jk(n,N,K,ce,a,M,se,0,ae,Me,g,y,w)}p&&n.generateCollisionDebugBuffers(x,n.collisionBoxArray)}function Zg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jk(n,e,i,a,u,p,g,y,x,w,A,C,M){let R=p.textMaxSize.evaluate(e,{},C);R===void 0&&(R=g);const D=n.layers[0].layout,N=D.get("icon-offset").evaluate(e,{},C),G=hb(i.horizontal)||i.vertical,ee=M.name==="globe",se=g/24,K=n.tilePixelRatio*R/24,oe=(Ue=n.overscaling,n.zoom>18&&Ue>2&&(Ue>>=1),Math.max(Ht/(512*Ue),1)*D.get("symbol-spacing")),ce=D.get("text-padding")*n.tilePixelRatio,ae=D.get("icon-padding")*n.tilePixelRatio,Me=Ye(D.get("text-max-angle")),Se=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Ne=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",it=D.get("symbol-placement"),De=oe/2;var Ue;const Ze=D.get("icon-text-fit");let Qe;a&&Ze!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Qe=J0(a,i.vertical,Ze,D.get("icon-text-fit-padding"),N,se)),G&&(a=J0(a,G,Ze,D.get("icon-text-fit-padding"),N,se)));const rt=(Be,ct,Nt)=>{if(ct.x<0||ct.x>=Ht||ct.y<0||ct.y>=Ht)return;let mt=null;if(ee){const{x:St,y:ut,z:Vt}=M.projectTilePoint(ct.x,ct.y,Nt);mt={anchor:new zs(St,ut,Vt,0,void 0),up:M.upVector(Nt,ct.x,ct.y)}}(function(St,ut,Vt,dn,ln,on,qt,jn,Xt,pn,Zn,ri,ti,oi,ci,_i,Gi,Nn,Li,Si,In,pi,Di,qn,bi){const sr=St.addToLineVertexArray(ut,dn);let Zi,qi,mr,Wi,Rs,su,id,rd=0,Nb=0,$b=0,Ub=0,i_=-1,r_=-1;const os={};let Vb=wl("");const Rl=Vt?Vt.anchor:ut;let o_=0,s_=0;if(Xt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[o_,s_]=Xt.layout.get("text-offset").evaluate(In,{},bi).map($r=>$r*er):(o_=Xt.layout.get("text-radial-offset").evaluate(In,{},bi)*er,s_=Gg),St.allowVerticalPlacement&&ln.vertical){const $r=ln.vertical;if(ci)su=qg($r),jn&&(id=qg(jn));else{const Ur=Xt.layout.get("text-rotate").evaluate(In,{},bi)+90;mr=vf(pn,Rl,ut,Zn,ri,ti,$r,oi,Ur,_i),jn&&(Wi=vf(pn,Rl,ut,Zn,ri,ti,jn,Nn,Ur))}}if(on){const $r=Xt.layout.get("icon-rotate").evaluate(In,{},bi),Ur=Xt.layout.get("icon-text-fit")!=="none",od=ab(on,$r,Di,Ur),l_=jn?ab(jn,$r,Di,Ur):void 0;qi=vf(pn,Rl,ut,Zn,ri,ti,on,Nn,$r),rd=4*od.length;const Gb=St.iconSizeData;let Dl=null;Gb.kind==="source"?(Dl=[ts*Xt.layout.get("icon-size").evaluate(In,{},bi)],Dl[0]>ga&&ne(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Gb.kind==="composite"&&(Dl=[ts*pi.compositeIconSizes[0].evaluate(In,{},bi),ts*pi.compositeIconSizes[1].evaluate(In,{},bi)],(Dl[0]>ga||Dl[1]>ga)&&ne(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),St.addSymbols(St.icon,od,Dl,Si,Li,In,!1,Vt,ut,sr.lineStartIndex,sr.lineLength,-1,qn,bi),i_=St.icon.placedSymbolArray.length-1,l_&&(Nb=4*l_.length,St.addSymbols(St.icon,l_,Dl,Si,Li,In,Yr.vertical,Vt,ut,sr.lineStartIndex,sr.lineLength,-1,qn,bi),r_=St.icon.placedSymbolArray.length-1)}for(const $r in ln.horizontal){const Ur=ln.horizontal[$r];Zi||(Vb=wl(Ur.text),ci?Rs=qg(Ur):Zi=vf(pn,Rl,ut,Zn,ri,ti,Ur,oi,Xt.layout.get("text-rotate").evaluate(In,{},bi),_i));const od=Ur.positionedLines.length===1;if($b+=ub(St,Vt,ut,Ur,qt,Xt,ci,In,_i,sr,ln.vertical?Yr.horizontal:Yr.horizontalOnly,od?Object.keys(ln.horizontal):[$r],os,i_,pi,qn,bi),od)break}ln.vertical&&(Ub+=ub(St,Vt,ut,ln.vertical,qt,Xt,ci,In,_i,sr,Yr.vertical,["vertical"],os,r_,pi,qn,bi));let wa=-1;const a_=($r,Ur)=>$r?Math.max($r,Ur):Ur;wa=a_(Rs,wa),wa=a_(su,wa),wa=a_(id,wa);const hS=wa>-1?1:0;St.glyphOffsetArray.length>=ya.MAX_GLYPHS&&ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),In.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,In.sortKey),St.symbolInstances.emplaceBack(Rl.x,Rl.y,Rl.z,ut.x,ut.y,os.right>=0?os.right:-1,os.center>=0?os.center:-1,os.left>=0?os.left:-1,os.vertical>=0?os.vertical:-1,i_,r_,Vb,Zi!==void 0?Zi:St.collisionBoxArray.length,Zi!==void 0?Zi+1:St.collisionBoxArray.length,mr!==void 0?mr:St.collisionBoxArray.length,mr!==void 0?mr+1:St.collisionBoxArray.length,qi!==void 0?qi:St.collisionBoxArray.length,qi!==void 0?qi+1:St.collisionBoxArray.length,Wi||St.collisionBoxArray.length,Wi?Wi+1:St.collisionBoxArray.length,Zn,$b,Ub,rd,Nb,hS,0,o_,s_,wa)})(n,ct,mt,Be,i,a,u,Qe,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,ce,Se,x,0,ae,Ne,N,e,p,w,A,C)};if(it==="line")for(const Be of rb(e.geometry,0,0,Ht,Ht)){const ct=Pk(Be,oe,Me,i.vertical||G,a,24,K,n.overscaling,Ht);for(const Nt of ct){const mt=G;mt&&Nk(n,mt.text,De,Nt)||rt(Be,Nt,C)}}else if(it==="line-center"){for(const Be of e.geometry)if(Be.length>1){const ct=Mk(Be,Me,i.vertical||G,a,24,K);ct&&rt(Be,ct,C)}}else if(e.type==="Polygon")for(const Be of zg(e.geometry,0)){const ct=Dk(Be,16);rt(Be[0],new zs(ct.x,ct.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Be of e.geometry)rt(Be,new zs(Be[0].x,Be[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Be of e.geometry)for(const ct of Be)rt([ct],new zs(ct.x,ct.y,0,0,void 0),C)}const ga=32640;function ub(n,e,i,a,u,p,g,y,x,w,A,C,M,R,D,N,G){const ee=function(oe,ce,ae,Me,Se,Ne,it,De){const Ue=[];if(ce.positionedLines.length===0)return Ue;const Ze=Me.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,Qe=function(mt){const St=mt[0],ut=mt[1],Vt=St*ut;return Vt>0?[St,-ut]:Vt<0?[-St,ut]:St===0?[ut,St]:[ut,-St]}(ae);let rt=Math.abs(ce.top-ce.bottom);for(const mt of ce.positionedLines)rt-=mt.lineOffset;const Be=ce.positionedLines.length,ct=rt/Be;let Nt=ce.top-ae[1];for(let mt=0;mt<Be;++mt){const St=ce.positionedLines[mt];Nt=Lk(ce,ct,Nt,mt);for(const ut of St.positionedGlyphs){if(!ut.rect)continue;const Vt=ut.rect||{};let dn=4,ln=!0,on=1,qt=0;if(ut.imageName){const qn=it[ut.imageName];if(!qn)continue;if(qn.sdf){ne("SDF images are not supported in formatted text and will be ignored.");continue}ln=!1,on=qn.pixelRatio,dn=1/on}const jn=(Se||De)&&ut.vertical,Xt=ut.metrics.advance*ut.scale/2,pn=ut.metrics,Zn=ut.rect;if(Zn===null)continue;De&&ce.verticalizable&&(qt=ut.imageName?Xt-ut.metrics.width*ut.scale/2:0);const ri=Se?[ut.x+Xt,ut.y]:[0,0];let ti=[0,0],oi=[0,0],ci=!1;Se||(jn?(oi=[ut.x+Xt+Qe[0],ut.y+Qe[1]-qt],ci=!0):ti=[ut.x+Xt+ae[0],ut.y+ae[1]-qt]);const _i=Zn.w*ut.scale/(on*(ut.localGlyph?2:1)),Gi=Zn.h*ut.scale/(on*(ut.localGlyph?2:1));let Nn,Li,Si,In;if(jn){const qn=ut.y-Nt,bi=new fe(-Xt,Xt-qn),sr=-Math.PI/2,Zi=new fe(...oi);Nn=new fe(-Xt+ti[0],ti[1]),Nn._rotateAround(sr,bi)._add(Zi),Nn.x+=-qn+Xt,Nn.y-=(pn.left-dn)*ut.scale;const qi=ut.imageName?pn.advance*ut.scale:er*ut.scale,mr=String.fromCharCode(ut.glyph);pk(mr)?Nn.x+=(1-dn)*ut.scale:fk(mr)?Nn.x+=qi-pn.height*ut.scale+(-dn-1)*ut.scale:Nn.x+=ut.imageName||pn.width+2*dn===Zn.w&&pn.height+2*dn===Zn.h?(qi-Gi)/2:(qi-(pn.height+2*dn)*ut.scale)/2,Li=new fe(Nn.x,Nn.y-_i),Si=new fe(Nn.x+Gi,Nn.y),In=new fe(Nn.x+Gi,Nn.y-_i)}else{const qn=(pn.left-dn)*ut.scale-Xt+ti[0],bi=(-pn.top-dn)*ut.scale+ti[1],sr=qn+_i,Zi=bi+Gi;Nn=new fe(qn,bi),Li=new fe(sr,bi),Si=new fe(qn,Zi),In=new fe(sr,Zi)}if(Ze){let qn;qn=Se?new fe(0,0):ci?new fe(Qe[0],Qe[1]):new fe(ae[0],ae[1]),Nn._rotateAround(Ze,qn),Li._rotateAround(Ze,qn),Si._rotateAround(Ze,qn),In._rotateAround(Ze,qn)}const pi=new fe(0,0),Di=new fe(0,0);Ue.push({tl:Nn,tr:Li,bl:Si,br:In,tex:Vt,writingMode:ce.writingMode,glyphOffset:ri,sectionIndex:ut.sectionIndex,isSDF:ln,pixelOffsetTL:pi,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}}return Ue}(0,a,x,p,g,y,u,n.allowVerticalPlacement),se=n.textSizeData;let K=null;se.kind==="source"?(K=[ts*p.layout.get("text-size").evaluate(y,{},G)],K[0]>ga&&ne(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(K=[ts*D.compositeTextSizes[0].evaluate(y,{},G),ts*D.compositeTextSizes[1].evaluate(y,{},G)],(K[0]>ga||K[1]>ga)&&ne(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,ee,K,x,g,y,A,e,i,w.lineStartIndex,w.lineLength,R,N,G);for(const oe of C)M[oe]=n.text.placedSymbolArray.length-1;return 4*ee.length}function hb(n){for(const e in n)return n[e];return null}function vf(n,e,i,a,u,p,g,y,x,w){let A=g.top,C=g.bottom,M=g.left,R=g.right;const D=g.collisionPadding;if(D&&(M-=D[0],A-=D[1],R+=D[2],C+=D[3]),x){const N=new fe(M,A),G=new fe(R,A),ee=new fe(M,C),se=new fe(R,C),K=Ye(x);let oe=new fe(0,0);w&&(oe=new fe(w[0],w[1])),N._rotateAround(K,oe),G._rotateAround(K,oe),ee._rotateAround(K,oe),se._rotateAround(K,oe),M=Math.min(N.x,G.x,ee.x,se.x),R=Math.max(N.x,G.x,ee.x,se.x),A=Math.min(N.y,G.y,ee.y,se.y),C=Math.max(N.y,G.y,ee.y,se.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,A,R,C,y,a,u,p),n.length-1}function qg(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function Nk(n,e,i,a){const u=n.compareText;if(e in u){const p=u[e];for(let g=p.length-1;g>=0;g--)if(a.dist(p[g])<i)return!0}else u[e]=[];return u[e].push(a),!1}function db(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*p+u;return Math.min(1.01*g,u*(1/n._horizonShift))}function Ll(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,u=(n.x+1)*i,p=n.y*i,g=(n.y+1)*i,y=Kr(a),x=Kr(u),w=Ji(p),A=Ji(g),C=e.project(y,w),M=e.project(x,w),R=e.project(x,A),D=e.project(y,A);let N=Math.min(C.x,M.x,R.x,D.x),G=Math.min(C.y,M.y,R.y,D.y),ee=Math.max(C.x,M.x,R.x,D.x),se=Math.max(C.y,M.y,R.y,D.y);const K=i/16;function oe(ae,Me,Se,Ne,it,De){const Ue=(Se+it)/2,Ze=(Ne+De)/2,Qe=e.project(Kr(Ue),Ji(Ze)),rt=Math.max(0,N-Qe.x,G-Qe.y,Qe.x-ee,Qe.y-se);N=Math.min(N,Qe.x),ee=Math.max(ee,Qe.x),G=Math.min(G,Qe.y),se=Math.max(se,Qe.y),rt>K&&(oe(ae,Qe,Se,Ne,Ue,Ze),oe(Qe,Me,Ue,Ze,it,De))}oe(C,M,a,p,u,p),oe(M,R,u,p,u,g),oe(R,D,u,g,a,g),oe(D,C,a,g,a,p),N-=K,G-=K,ee+=K,se+=K;const ce=1/Math.max(ee-N,se-G);return{scale:ce,x:N*ce,y:G*ce,x2:ee*ce,y2:se*ce,projection:e}}const $k=ko(new Float32Array(16));class _a{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new kn(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a=!0){return e._coordinatePoint(e.locationCoordinate(i),a)}pixelsPerMeter(e,i){return Ao(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return db(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,u){const p=e.horizonLineFromTop(!1),g=new fe(i,Math.max(p,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,i,a){const u=new fe(i,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return $k}createTileMatrix(e,i,a){let u,p,g;const y=a.canonical,x=ko(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Ll(y,this);u=1,p=w.x+a.wrap*w.scale,g=w.y,kl(x,x,[u/w.scale,u/w.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(y.z),p=(y.x+Math.pow(2,y.z)*a.wrap)*u,g=y.y*u;return Ah(x,x,[p,g,0]),kl(x,x,[u/Ht,u/Ht,1]),x}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class Uk extends _a{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Ye(i));this.n=(u+Math.sin(Ye(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:u,r0:p}=this,g=Ye(e-this.center[0]),y=Ye(i),x=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:x*Math.sin(g*a),y:x*Math.cos(g*a)-p,z:0}}unproject(e,i){const{n:a,c:u,r0:p}=this,g=p+i;let y=Math.atan2(e,Math.abs(g))*Math.sign(g);g*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(g));const x=Ye(this.center[0])*a;y=rn(y,-Math.PI-x,Math.PI-x);const w=At(dt(y/a)+this.center[0],-180,180),A=Math.asin(At((u-(e*e+g*g)*a*a)/(2*a),-1,1)),C=At(dt(A),-Qi,Qi);return new kn(w,C)}}const Yh=1.340264,Jh=-.081106,Qh=893e-6,ed=.003796,bf=Math.sqrt(3)/2;class Vk extends _a{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(bf*Math.sin(i)),u=a*a,p=u*u*u;return{x:.5*(e*Math.cos(a)/(bf*(Yh+3*Jh*u+p*(7*Qh+9*ed*u)))/Math.PI+.5),y:1-.5*(a*(Yh+Jh*u+p*(Qh+ed*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=a*a,p=u*u*u;for(let A,C,M,R=0;R<12&&(C=a*(Yh+Jh*u+p*(Qh+ed*u))-i,M=Yh+3*Jh*u+p*(7*Qh+9*ed*u),A=C/M,a=At(a-A,-Math.PI/3,Math.PI/3),u=a*a,p=u*u*u,!(Math.abs(A)<1e-12));++R);const g=bf*e*(Yh+3*Jh*u+p*(7*Qh+9*ed*u))/Math.cos(a),y=Math.asin(Math.sin(a)/bf),x=At(180*g/Math.PI,-180,180),w=At(180*y/Math.PI,-Qi,Qi);return new kn(x,w)}}class Gk extends _a{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),u=At(360*(.5-i),-Qi,Qi);return new kn(a,u)}}const ru=Math.PI/2;function xf(n){return Math.tan((ru+n)/2)}class Zk extends _a{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let u=Ye(i),p=Ye(a);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const g=Math.cos(u),y=xf(u);this.n=u===p?Math.sin(u):Math.log(g/Math.cos(p))/Math.log(xf(p)/y),this.f=g*Math.pow(xf(u),this.n)/this.n}project(e,i){i=Ye(i),this.southernCenter&&(i=-i),e=Ye(e-this.center[0]);const a=1e-6,{n:u,f:p}=this;p>0?i<-ru+a&&(i=-ru+a):i>ru-a&&(i=ru-a);const g=p/Math.pow(xf(i),u);let y=g*Math.sin(u*e),x=p-g*Math.cos(u*e);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:u}=this,p=u-i,g=Math.sign(p),y=Math.sign(a)*Math.sqrt(e*e+p*p);let x=Math.atan2(e,Math.abs(p))*g;p*a<0&&(x-=Math.PI*Math.sign(e)*g);const w=At(dt(x/a)+this.center[0],-180,180),A=At(dt(2*Math.atan(Math.pow(u/y,1/a))-ru),-Qi,Qi);return new kn(w,this.southernCenter?-A:A)}}class pb extends _a{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Qo(e),y:es(i),z:0}}unproject(e,i){const a=Kr(e),u=Ji(i);return new kn(a,u)}}const fb=Ye(Qi);class qk extends _a{project(e,i){const a=(i=Ye(i))*i,u=a*a;return{x:.5*((e=Ye(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=25,p=0,g=a*a;do{g=a*a;const w=g*g;p=(a*(1.007226+g*(.015085+w*(.028874*g-.044475-.005916*w)))-i)/(1.007226+g*(.045255+w*(.259866*g-.311325-.005916*11*w))),a=At(a-p,-fb,fb)}while(Math.abs(p)>1e-6&&--u>0);g=a*a;const y=At(dt(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),x=dt(a);return new kn(y,x)}}const mb=Ye(Qi);class Wk extends _a{project(e,i){i=Ye(i),e=Ye(e);const a=Math.cos(i),u=2/Math.PI,p=Math.acos(a*Math.cos(e/2)),g=Math.sin(p)/p,y=.5*(e*u+2*a*Math.sin(e/2)/g)||0,x=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let y=0,x=0;do{const w=Math.cos(u),A=Math.sin(u),C=2*A*w,M=A*A,R=w*w,D=Math.cos(a/2),N=Math.sin(a/2),G=2*D*N,ee=N*N,se=1-R*D*D,K=se?1/se:0,oe=se?Math.acos(w*D)*Math.sqrt(1/se):0,ce=.5*(2*oe*w*N+2*a/Math.PI)-e,ae=.5*(oe*A+u)-i,Me=.5*K*(R*ee+oe*w*D*M)+1/Math.PI,Se=K*(G*C/4-oe*A*N),Ne=.125*K*(C*N-oe*A*R*G),it=.5*K*(M*D+oe*ee*w)+.5,De=Se*Ne-it*Me;y=(ae*Se-ce*it)/De,x=(ce*Ne-ae*Me)/De,a=At(a-y,-Math.PI,Math.PI),u=At(u-x,-mb,mb)}while((Math.abs(y)>g||Math.abs(x)>g)&&--p>0);return new kn(dt(a),dt(u))}}class gb extends _a{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ye(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:u}=this;return{x:Ye(e)*u*a+.5,y:-Math.sin(Ye(i))/u*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:u}=this,p=-(i-.5)/a,g=At(dt((e-.5)/a)/u,-180,180),y=Math.asin(At(p*u,-1,1)),x=At(dt(y),-Qi,Qi);return new kn(g,x)}}class Hk extends pb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const u=Dh(e,i,a);return vi(u,u,Oh(Jo(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const a=Gc(i.lat,i.lng),u=dr([],a),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Ph(a,a,u,Ao(1,0)*Ht*p);const g=ko(new Float64Array(16));return El(g,e.pixelMatrix,e.globeMatrix),vi(a,a,g),new fe(a[0],a[1])}pixelsPerMeter(e,i){return Ao(1,0)*i}pixelSpaceConversion(e,i,a){const u=Ao(1,e)*i,p=xn(Ao(1,45)*i,u,a);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,a){const u=vg(Jo(a.canonical));return El(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:a}=e,u=Oh(Jo(i));return Xp(u,u,Ye(a.lng)),ug(u,u,Ye(a.lat)),kl(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,a,u){return qv(e,i,a,!0)||new qc(0,0)}pointCoordinate3D(e,i,a){const u=this.pointCoordinate(e,i,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!qv(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,p){const g=u.cameraToCenterDistance,y=u._centerAltitude*p,x=u._camera,w=u._camera.forward(),A=Cs([],Xr([],w,-g),[0,0,y]),C=u.worldSize/(2*Math.PI),M=[0,0,-C],R=u.width/u.height,D=Math.tan(u.fovAboveCenter),N=Xr([],x.up(),D),G=Xr([],x.right(),D*R),ee=dr([],Cs([],Cs([],w,N),G)),se=[];let K;if(new fg(A,ee).closestPointOnSphere(M,C,se)){const oe=Cs([],se,M),ce=So([],oe,A);K=Math.cos(u.fovAboveCenter)*Ih(ce)}else{const oe=So([],A,M),ce=So([],M,A);dr(ce,ce);const ae=Ih(oe)-C;K=Math.sqrt(ae*(ae+2*C));const Me=Math.acos(K/(C+ae))-Math.acos(ao(w,ce));K*=Math.cos(Me)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Zc(e.zoom);if(a>0){const u=db(e,Ao(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return xn(i,u+p*(1-Math.cos(g)),Math.pow(a,10))}return i}upVector(e,i,a){return Dh(i,a,e,1)}upVectorScale(e){return{metersToTile:Kp(Jp(Jo(e)))}}}function _b(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new pb(n);case"equirectangular":return new Gk(n);case"naturalEarth":return new qk(n);case"equalEarth":return new Vk(n);case"winkelTripel":return new Wk(n);case"albers":return i?new gb(n):new Uk(n);case"lambertConformalConic":return i?new gb(n):new Zk(n);case"globe":return new Hk(n)}throw new Error(`Invalid projection name: ${n.name}`)}const Xk=cf.types,Kk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wf(n,e,i,a,u,p,g,y,x,w,A,C,M){const R=y?Math.min(ga,Math.round(y[0])):0,D=y?Math.min(ga,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*u),p,g,(R<<1)+(x?1:0),D,16*w,16*A,256*C,256*M)}function Tf(n,e,i,a,u,p,g){n.emplaceBack(e,i,a,u,p,g)}function Ef(n,e,i,a,u){n.emplaceBack(e,i,a,u),n.emplaceBack(e,i,a,u),n.emplaceBack(e,i,a,u),n.emplaceBack(e,i,a,u)}function Yk(n){for(const e of n.sections)if(j(e.text))return!0;return!1}class Wg{constructor(e){this.layoutVertexArray=new xo,this.indexArray=new Yi,this.programConfigurations=e,this.segments=new Ei,this.dynamicLayoutVertexArray=new Xn,this.opacityVertexArray=new Kn,this.placedSymbolArray=new yv,this.globeExtVertexArray=new li}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ok.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ak.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Kk,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,sk.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Et(Wg,"SymbolBuffers");class Hg{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Ei,this.collisionVertexArray=new ii,this.collisionVertexArrayExt=new Ki}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,lk.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ck.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(Hg,"CollisionBuffers");class ya{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ko([]),this.placementViewportMatrix=ko([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bg(this.zoom,i["text-size"]),this.iconSizeData=Bg(this.zoom,i["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>Yr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Wg(new Tl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Wg(new Tl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new xv,this.lineVertexArray=new wv,this.symbolInstances=new bv}calculateGlyphDependencies(e,i,a,u,p){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,u&&p){const y=Wh[e.charAt(g)];y&&(i[y.charCodeAt(0)]=!0)}}populate(e,i,a,u){const p=this.layers[0],g=p.layout,y=this.projection.name==="globe",x=g.get("text-font"),w=g.get("text-field"),A=g.get("icon-image"),C=(w.value.kind!=="constant"||w.value.value instanceof ur&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),M=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,R=g.get("symbol-sort-key");if(this.features=[],!C&&!M)return;const D=i.iconDependencies,N=i.glyphDependencies,G=i.availableImages,ee=new xe(this.zoom);for(const{feature:se,id:K,index:oe,sourceLayerIndex:ce}of e){const ae=p._featureFilter.needGeometry,Me=Cl(se,ae);if(!p._featureFilter.filter(ee,Me,a))continue;if(ae||(Me.geometry=Ms(se,a,u)),y&&se.type!==1&&a.z<=5){const De=Me.geometry,Ue=.98078528056,Ze=(Qe,rt)=>ao(Dh(Qe.x,Qe.y,a,1),Dh(rt.x,rt.y,a,1))<Ue;for(let Qe=0;Qe<De.length;Qe++)De[Qe]=a2(De[Qe],Ze)}let Se,Ne;if(C){const De=p.getValueAndResolveTokens("text-field",Me,a,G),Ue=ur.factory(De);Yk(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||ue()==="unavailable"||this.hasRTLText&&de.isParsed())&&(Se=dk(Ue,p,Me))}if(M){const De=p.getValueAndResolveTokens("icon-image",Me,a,G);Ne=De instanceof or?De:or.fromString(De)}if(!Se&&!Ne)continue;const it=this.sortFeaturesByKey?R.evaluate(Me,{},a):void 0;if(this.features.push({id:K,text:Se,icon:Ne,index:oe,sourceLayerIndex:ce,geometry:Me.geometry,properties:se.properties,type:Xk[se.type],sortKey:it}),Ne&&(D[Ne.name]=!0),Se){const De=x.evaluate(Me,{},a).join(","),Ue=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yr.vertical)>=0;for(const Ze of Se.sections)if(Ze.image)D[Ze.image.name]=!0;else{const Qe=_(Se.toString()),rt=Ze.fontStack||De,Be=N[rt]=N[rt]||{};this.calculateGlyphDependencies(Ze.text,Be,Ue,this.allowVerticalPlacement,Qe)}}}g.get("symbol-placement")==="line"&&(this.features=function(se){const K={},oe={},ce=[];let ae=0;function Me(De){ce.push(se[De]),ae++}function Se(De,Ue,Ze){const Qe=oe[De];return delete oe[De],oe[Ue]=Qe,ce[Qe].geometry[0].pop(),ce[Qe].geometry[0]=ce[Qe].geometry[0].concat(Ze[0]),Qe}function Ne(De,Ue,Ze){const Qe=K[Ue];return delete K[Ue],K[De]=Qe,ce[Qe].geometry[0].shift(),ce[Qe].geometry[0]=Ze[0].concat(ce[Qe].geometry[0]),Qe}function it(De,Ue,Ze){const Qe=Ze?Ue[0][Ue[0].length-1]:Ue[0][0];return`${De}:${Qe.x}:${Qe.y}`}for(let De=0;De<se.length;De++){const Ue=se[De],Ze=Ue.geometry,Qe=Ue.text?Ue.text.toString():null;if(!Qe){Me(De);continue}const rt=it(Qe,Ze),Be=it(Qe,Ze,!0);if(rt in oe&&Be in K&&oe[rt]!==K[Be]){const ct=Ne(rt,Be,Ze),Nt=Se(rt,Be,ce[ct].geometry);delete K[rt],delete oe[Be],oe[it(Qe,ce[Nt].geometry,!0)]=Nt,ce[ct].geometry=null}else rt in oe?Se(rt,Be,Ze):Be in K?Ne(rt,Be,Ze):(Me(De),K[rt]=ae-1,oe[Be]=ae-1)}return ce.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,K)=>se.sortKey-K.sortKey)}update(e,i,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,a,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_b(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,u,p,g,y,x,w,A,C,M,R,D){const N=e.indexArray,G=e.layoutVertexArray,ee=e.globeExtVertexArray,se=e.segments.prepareSegment(4*i.length,G,N,this.canOverlap?g.sortKey:void 0),K=this.glyphOffsetArray.length,oe=se.vertexLength,ce=this.allowVerticalPlacement&&y===Yr.vertical?Math.PI/2:0,ae=g.text&&g.text.sections;for(let Se=0;Se<i.length;Se++){const{tl:Ne,tr:it,bl:De,br:Ue,tex:Ze,pixelOffsetTL:Qe,pixelOffsetBR:rt,minFontScaleX:Be,minFontScaleY:ct,glyphOffset:Nt,isSDF:mt,sectionIndex:St}=i[Se],ut=se.vertexLength,Vt=Nt[1];if(wf(G,w.x,w.y,Ne.x,Vt+Ne.y,Ze.x,Ze.y,a,mt,Qe.x,Qe.y,Be,ct),wf(G,w.x,w.y,it.x,Vt+it.y,Ze.x+Ze.w,Ze.y,a,mt,rt.x,Qe.y,Be,ct),wf(G,w.x,w.y,De.x,Vt+De.y,Ze.x,Ze.y+Ze.h,a,mt,Qe.x,rt.y,Be,ct),wf(G,w.x,w.y,Ue.x,Vt+Ue.y,Ze.x+Ze.w,Ze.y+Ze.h,a,mt,rt.x,rt.y,Be,ct),x){const{x:dn,y:ln,z:on}=x.anchor,[qt,jn,Xt]=x.up;Tf(ee,dn,ln,on,qt,jn,Xt),Tf(ee,dn,ln,on,qt,jn,Xt),Tf(ee,dn,ln,on,qt,jn,Xt),Tf(ee,dn,ln,on,qt,jn,Xt),Ef(e.dynamicLayoutVertexArray,dn,ln,on,ce)}else Ef(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ce);N.emplaceBack(ut,ut+1,ut+2),N.emplaceBack(ut+1,ut+2,ut+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Se!==i.length-1&&St===i[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,g,g.index,{},R,D,ae&&ae[St])}const Me=x?x.anchor:w;e.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,w.x,w.y,K,this.glyphOffsetArray.length-K,oe,A,C,w.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,M,0)}_commitLayoutVertex(e,i,a,u,p,g,y){e.emplaceBack(i,a,u,p,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,a,u,p,g,y){const x=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=x.vertexLength,A=y.tileAnchorX,C=y.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,A,C,new fe(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,A,C,new fe(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,A,C,new fe(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,p,g,A,C,new fe(e.x1,e.y2)),x.vertexLength+=4;const M=a.indexArray;M.emplaceBack(w,w+1),M.emplaceBack(w+1,w+2),M.emplaceBack(w+2,w+3),M.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,u,p,g){for(let y=u;y<p;y++){const x=a.get(y),w=this.getSymbolInstanceTextSize(e,g,i,y);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,a,u,p,g){for(let y=u;y<p;y++){const x=a.get(y),w=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hg(gi,j0.members,Xo),this.iconCollisionBox=new Hg(gi,j0.members,Xo);const a=Jc(this.iconSizeData,e),u=Jc(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,a,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=pf(this.textSizeData,e,p)/er;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,a){const u=this.icon.placedSymbolArray.get(a),p=pf(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,a){e.emplaceBack(i,-a,-a),e.emplaceBack(i,a,-a),e.emplaceBack(i,a,a),e.emplaceBack(i,-a,a)}_updateTextDebugCollisionBoxes(e,i,a,u,p,g){for(let y=u;y<p;y++){const x=a.get(y),w=this.getSymbolInstanceTextSize(e,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding)}}_updateIconDebugCollisionBoxes(e,i,a,u,p,g){for(let y=u;y<p;y++){const x=a.get(y),w=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Jc(this.iconSizeData,e),u=Jc(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,u,p,g,y,x,w){const A={};if(i<a){const{x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe,featureIndex:ce}=e.get(i);A.textBox={x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe},A.textFeatureIndex=ce}if(u<p){const{x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe,featureIndex:ce}=e.get(u);A.verticalTextBox={x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe},A.verticalTextFeatureIndex=ce}if(g<y){const{x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe,featureIndex:ce}=e.get(g);A.iconBox={x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe},A.iconFeatureIndex=ce}if(x<w){const{x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe,featureIndex:ce}=e.get(x);A.verticalIconBox={x1:C,y1:M,x2:R,y2:D,padding:N,projectedAnchorX:G,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:K,tileAnchorY:oe},A.verticalIconFeatureIndex=ce}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),u=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),u=[],p=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.tileAnchorX+a*x.tileAnchorY)),p.push(x.featureIndex)}return g.sort((y,x)=>u[y]-u[x]||p[x]-p[y]),g}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et(ya,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ya.MAX_GLYPHS=65535,ya.addDynamicAttributes=Ef;const Jk=new tt({"symbol-placement":new ye(je.layout_symbol["symbol-placement"]),"symbol-spacing":new ye(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ye(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Re(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ye(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ye(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ye(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new ye(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ye(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Re(je.layout_symbol["icon-size"]),"icon-text-fit":new ye(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ye(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Re(je.layout_symbol["icon-image"]),"icon-rotate":new Re(je.layout_symbol["icon-rotate"]),"icon-padding":new ye(je.layout_symbol["icon-padding"]),"icon-keep-upright":new ye(je.layout_symbol["icon-keep-upright"]),"icon-offset":new Re(je.layout_symbol["icon-offset"]),"icon-anchor":new Re(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ye(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ye(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ye(je.layout_symbol["text-rotation-alignment"]),"text-field":new Re(je.layout_symbol["text-field"]),"text-font":new Re(je.layout_symbol["text-font"]),"text-size":new Re(je.layout_symbol["text-size"]),"text-max-width":new Re(je.layout_symbol["text-max-width"]),"text-line-height":new Re(je.layout_symbol["text-line-height"]),"text-letter-spacing":new Re(je.layout_symbol["text-letter-spacing"]),"text-justify":new Re(je.layout_symbol["text-justify"]),"text-radial-offset":new Re(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ye(je.layout_symbol["text-variable-anchor"]),"text-anchor":new Re(je.layout_symbol["text-anchor"]),"text-max-angle":new ye(je.layout_symbol["text-max-angle"]),"text-writing-mode":new ye(je.layout_symbol["text-writing-mode"]),"text-rotate":new Re(je.layout_symbol["text-rotate"]),"text-padding":new ye(je.layout_symbol["text-padding"]),"text-keep-upright":new ye(je.layout_symbol["text-keep-upright"]),"text-transform":new Re(je.layout_symbol["text-transform"]),"text-offset":new Re(je.layout_symbol["text-offset"]),"text-allow-overlap":new ye(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ye(je.layout_symbol["text-ignore-placement"]),"text-optional":new ye(je.layout_symbol["text-optional"])});var Xg={paint:new tt({"icon-opacity":new Re(je.paint_symbol["icon-opacity"]),"icon-color":new Re(je.paint_symbol["icon-color"]),"icon-halo-color":new Re(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Re(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Re(je.paint_symbol["icon-halo-blur"]),"icon-translate":new ye(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new ye(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new Re(je.paint_symbol["text-opacity"]),"text-color":new Re(je.paint_symbol["text-color"],{runtimeType:ro,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Re(je.paint_symbol["text-halo-color"]),"text-halo-width":new Re(je.paint_symbol["text-halo-width"]),"text-halo-blur":new Re(je.paint_symbol["text-halo-blur"]),"text-translate":new ye(je.paint_symbol["text-translate"]),"text-translate-anchor":new ye(je.paint_symbol["text-translate-anchor"])}),layout:Jk};class yb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(yb,"FormatSectionOverride",{omit:["defaultValue"]});class kf extends Eo{constructor(e){super(e,Xg)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const p of a)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,u){const p=this.layout.get(e).evaluate(i,{},a,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||ra(g.value)||!p?p:function(y,x){return x.replace(/{([^{}]+)}/g,(w,A)=>A in y?String(y[A]):"")}(i.properties,p)}createBucket(e){return new ya(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Xg.paint.overridableProperties){if(!kf.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new yb(i),u=new Ac(a,i.property.specification);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Ic("source",u):new ks("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Je(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&kf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),u=Xg.paint.properties[i];let p=!1;const g=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ur)g(a.value.value.sections);else if(a.value.kind==="source"){const y=w=>{p||(w instanceof Ka&&Pi(w.value)===Ws?g(w.value.sections):w instanceof Ya?g(w.sections):w.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return p}getProgramConfiguration(e){return new fa(this,e)}}var Qk={paint:new tt({"background-color":new ye(je.paint_background["background-color"]),"background-pattern":new ye(je.paint_background["background-pattern"]),"background-opacity":new ye(je.paint_background["background-opacity"])})},eS={paint:new tt({"raster-opacity":new ye(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new ye(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ye(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ye(je.paint_raster["raster-brightness-max"]),"raster-saturation":new ye(je.paint_raster["raster-saturation"]),"raster-contrast":new ye(je.paint_raster["raster-contrast"]),"raster-resampling":new ye(je.paint_raster["raster-resampling"]),"raster-fade-duration":new ye(je.paint_raster["raster-fade-duration"])})};class tS extends Eo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var nS={paint:new tt({"sky-type":new ye(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new ye(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ye(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ye(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ye(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new He(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ye(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ye(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ye(je.paint_sky["sky-opacity"])})};function Kg(n,e,i){const a=[0,0,1],u=$v([]);return Vv(u,u,i?-Ye(n)+Math.PI:Ye(n)),Uv(u,u,-Ye(e)),Bv(a,a,u),dr(a,a)}const iS={circle:class extends Eo{constructor(n){super(n,f2)}createBucket(n){return new kg(n)}queryRadius(n){const e=n;return Wc("circle-radius",this,e)+Wc("circle-stroke-width",this,e)+tf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,u,p,g,y){const x=u0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return h0(n,a,p,g,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new fa(this,n)}},heatmap:class extends Eo{createBucket(n){return new p0(n)}constructor(n){super(n,y2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Wc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,u,p,g,y){const x=this.paint.get("heatmap-radius").evaluate(e,i);return h0(n,a,p,g,y,!0,!0,new fe(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new fa(this,n)}},hillshade:class extends Eo{constructor(n){super(n,v2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Eo{constructor(n){super(n,D2)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new fa(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new af(n)}queryRadius(){return tf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,u,p){return!n.queryGeometry.isAboveHorizon&&o0(c0(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Eo{constructor(n){super(n,Y2)}createBucket(n){return new Gh(n)}queryRadius(){return tf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new fa(this,n)}queryIntersectsFeature(n,e,i,a,u,p,g,y,x){const w=u0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],R=y&&p.elevation,D=p.elevation?p.elevation.exaggeration():1,N=n.tile.getBucket(this);if(R&&N instanceof Gh){const oe=N.centroidVertexArray,ce=x+1;ce<oe.length&&(M[0]=oe.geta_centroid_pos0(ce),M[1]=oe.geta_centroid_pos1(ce))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(a=P0([a],[new fe(0,0),new fe(Ht,Ht)],n.tileID.canonical).map(oe=>oe.polygon).flat());const G=R?y:null,[ee,se]=function(oe,ce,ae,Me,Se,Ne,it,De,Ue,Ze,Qe){return oe.projection.name==="globe"?function(rt,Be,ct,Nt,mt,St,ut,Vt,dn,ln,on){const qt=[],jn=[],Xt=rt.projection.upVectorScale(on,rt.center.lat,rt.worldSize).metersToTile,pn=[0,0,0,1],Zn=[0,0,0,1],ri=(oi,ci,_i,Gi)=>{oi[0]=ci,oi[1]=_i,oi[2]=Gi,oi[3]=1},ti=M0();ct>0&&(ct+=ti),Nt+=ti;for(const oi of Be){const ci=[],_i=[];for(const Gi of oi){const Nn=Gi.x+mt.x,Li=Gi.y+mt.y,Si=rt.projection.projectTilePoint(Nn,Li,on),In=rt.projection.upVector(on,Gi.x,Gi.y);let pi=ct,Di=Nt;if(ut){const qn=D0(Nn,Li,ct,Nt,ut,Vt,dn,ln);pi+=qn.base,Di+=qn.top}ct!==0?ri(pn,Si.x+In[0]*Xt*pi,Si.y+In[1]*Xt*pi,Si.z+In[2]*Xt*pi):ri(pn,Si.x,Si.y,Si.z),ri(Zn,Si.x+In[0]*Xt*Di,Si.y+In[1]*Xt*Di,Si.z+In[2]*Xt*Di),vi(pn,pn,St),vi(Zn,Zn,St),ci.push(new Yc(pn[0],pn[1],pn[2])),_i.push(new Yc(Zn[0],Zn[1],Zn[2]))}qt.push(ci),jn.push(_i)}return[qt,jn]}(oe,ce,ae,Me,Se,Ne,it,De,Ue,Ze,Qe):it?function(rt,Be,ct,Nt,mt,St,ut,Vt,dn){const ln=[],on=[],qt=[0,0,0,1];for(const jn of rt){const Xt=[],pn=[];for(const Zn of jn){const ri=Zn.x+Nt.x,ti=Zn.y+Nt.y,oi=D0(ri,ti,Be,ct,St,ut,Vt,dn);qt[0]=ri,qt[1]=ti,qt[2]=oi.base,qt[3]=1,Sl(qt,qt,mt),qt[3]=Math.max(qt[3],1e-5);const ci=new Yc(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);qt[0]=ri,qt[1]=ti,qt[2]=oi.top,qt[3]=1,Sl(qt,qt,mt),qt[3]=Math.max(qt[3],1e-5);const _i=new Yc(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);Xt.push(ci),pn.push(_i)}ln.push(Xt),on.push(pn)}return[ln,on]}(ce,ae,Me,Se,Ne,it,De,Ue,Ze):function(rt,Be,ct,Nt,mt){const St=[],ut=[],Vt=mt[8]*Be,dn=mt[9]*Be,ln=mt[10]*Be,on=mt[11]*Be,qt=mt[8]*ct,jn=mt[9]*ct,Xt=mt[10]*ct,pn=mt[11]*ct;for(const Zn of rt){const ri=[],ti=[];for(const oi of Zn){const ci=oi.x+Nt.x,_i=oi.y+Nt.y,Gi=mt[0]*ci+mt[4]*_i+mt[12],Nn=mt[1]*ci+mt[5]*_i+mt[13],Li=mt[2]*ci+mt[6]*_i+mt[14],Si=mt[3]*ci+mt[7]*_i+mt[15],In=Gi+Vt,pi=Nn+dn,Di=Li+ln,qn=Math.max(Si+on,1e-5),bi=Gi+qt,sr=Nn+jn,Zi=Li+Xt,qi=Math.max(Si+pn,1e-5);ri.push(new Yc(In/qn,pi/qn,Di/qn)),ti.push(new Yc(bi/qi,sr/qi,Zi/qi))}St.push(ri),ut.push(ti)}return[St,ut]}(ce,ae,Me,Se,Ne)}(p,a,C,A,w,g,G,M,D,p.center.lat,n.tileID.canonical),K=n.queryGeometry;return function(oe,ce,ae){let Me=1/0;o0(ae,ce)&&(Me=R0(ae,ce[0]));for(let Se=0;Se<ce.length;Se++){const Ne=ce[Se],it=oe[Se];for(let De=0;De<Ne.length-1;De++){const Ue=Ne[De],Ze=[Ue,Ne[De+1],it[De+1],it[De],Ue];r0(ae,Ze)&&(Me=Math.min(Me,R0(ae,Ze)))}}return Me!==1/0&&Me}(ee,se,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Eo{constructor(n){super(n,O0),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ku,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=B0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new df(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new fa(this,n)}queryRadius(n){const e=n,i=F0(Wc("line-width",this,e),Wc("line-gap-width",this,e)),a=Wc("line-offset",this,e);return i/2+Math.abs(a)+tf(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,u,p){if(n.queryGeometry.isAboveHorizon)return!1;const g=c0(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*F0(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(a=function(w,A){const C=[],M=new fe(0,0);for(let R=0;R<w.length;R++){const D=w[R],N=[];for(let G=0;G<D.length;G++){const ee=D[G-1],se=D[G],K=D[G+1],oe=G===0?M:se.sub(ee)._unit()._perp(),ce=G===D.length-1?M:K.sub(se)._unit()._perp(),ae=oe._add(ce)._unit();ae._mult(1/(ae.x*ce.x+ae.y*ce.y)),N.push(ae._mult(A)._add(se))}C.push(N)}return C}(a,x*n.pixelToTileUnitsFactor)),function(w,A,C){for(let M=0;M<A.length;M++){const R=A[M];if(w.length>=3){for(let D=0;D<R.length;D++)if(Ml(w,R[D]))return!0}if(u2(w,R,C))return!0}return!1}(g,a,y)}isTileClipped(){return!0}},symbol:kf,background:class extends Eo{constructor(n){super(n,Qk)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Eo{constructor(n){super(n,eS)}getProgramIds(){return["raster"]}},sky:class extends Eo{constructor(n){super(n,nS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Cg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,p=n.style.light,g=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&ne("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Kg(g.azimuthal,90-g.polar,e):Kg(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Kg(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class td{constructor(e,i,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,a){const{width:u,height:p}=e,{context:g}=this,{gl:y}=g,{HTMLImageElement:x,HTMLCanvasElement:w,HTMLVideoElement:A,ImageData:C,ImageBitmap:M}=S;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===p){const{x:R,y:D}=a||{x:0,y:0};e instanceof x||e instanceof w||e instanceof A||e instanceof C||M&&e instanceof M?y.texSubImage2D(y.TEXTURE_2D,0,R,D,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,R,D,u,p,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof x||e instanceof w||e instanceof A||e instanceof C||M&&e instanceof M?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,p,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class rS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class oS{constructor(){this.tasks={},this.taskQueue=[],xt(["process"],this),this.invoker=new rS(this.process),this.nextId=0}add(e,i){const a=this.nextId++,u=function({type:p,isSymbolTile:g,zoom:y}){return y=y||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-y:p==="maybePrepare"&&g?400-y:500:200-y:100-y}(i);if(u===0){We();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:i,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){We();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class vb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const sS=["tile","layer","source","sourceLayer","state"];class bb{constructor(e,i,a,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=u,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of sS)this[i]!==void 0&&(e[i]=this[i]);return e}}const uo=32,ns=33,va=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,a=0,u=0,p=0,g=0,y=0;for(1&e?u=p=g=uo:i=a=y=uo;(e>>=1)>1;){const w=i+u>>1,A=a+p>>1;1&e?(u=i,p=a,i=g,a=y):(i=u,a=p,u=g,p=y),g=w,y=A}const x=4*n;va[x+0]=i,va[x+1]=a,va[x+2]=u,va[x+3]=p}const is=new Uint16Array(2178),ba=new Uint8Array(1089),Sf=new Uint16Array(1089);function xb(n){return n===0?-.03125:n===32?.03125:0}var wb=Mt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Tb={type:2,extent:Ht,loadGeometry:()=>[[new fe(0,0),new fe(8193,0),new fe(8193,8193),new fe(0,8193),new fe(0,0)]]};class Yg{constructor(e,i,a,u,p){this.tileID=e,this.uid=Fn(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<zn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ll(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const g={};if(!p)return g;for(const y of u){const x=y.layerIds.map(w=>p.getLayer(w)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>x.filter(A=>A.id===w)[0]));for(const w of x)g[w.id]=y}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof ya){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof ya&&p.hasRTLText){this.hasRTLText=!0,de.isLoading()||de.isLoaded()||ue()!=="deferred"||le();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new rg}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new td(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new td(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new td(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,u,p,g,y,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:g,params:p,tileTransform:this.tileTransform},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),p=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[p];if(!g)return;const y=Mc(i&&i.filter),{z:x,x:w,y:A}=this.tileID.canonical,C={z:x,x:w,y:A};for(let M=0;M<g.length;M++){const R=g.feature(M);if(y.needGeometry){const G=Cl(R,!0);if(!y.filter(new xe(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!y.filter(new xe(this.tileID.overscaledZ),R))continue;const D=a.getId(R,p),N=new bb(R,x,w,A,D);N.tile=C,e.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=ot(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const p=this.expirationTime-i;p?this.expirationTime=a+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const a=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],y=g.layers[0].sourceLayer||"_geojsonTileLayer",x=a[y],w=e[y];if(!x||!w||Object.keys(w).length===0)continue;if(g.update(w,x,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof df||g instanceof af){const C=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&C&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(C.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(p);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=zn.now()+e}setTexture(e,i){const a=i.context,u=a.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new td(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(e,i){const a={};for(const u of i)a[u]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const u=this.dependencies[a];if(u){for(const p of i)if(u[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const a=Ms(Tb,this.tileID.canonical,this.tileTransform)[0],u=new Dt,p=new Ko;for(let g=0;g<a.length;g++){const{x:y,y:x}=a[g];u.emplaceBack(y,x),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,zh.members),this._tileDebugSegments=Ei.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const a=Ms(Tb,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const g=function(y,x){const w=Ll(y,x),A=Math.pow(2,y.z);for(let G=0;G<ns;G++)for(let ee=0;ee<ns;ee++){const se=Kr((y.x+(ee+xb(ee))/uo)/A),K=Ji((y.y+(G+xb(G))/uo)/A),oe=x.project(se,K),ce=G*ns+ee;is[2*ce+0]=Math.round((oe.x*w.scale-w.x)*Ht),is[2*ce+1]=Math.round((oe.y*w.scale-w.y)*Ht)}ba.fill(0),Sf.fill(0);for(let G=2045;G>=0;G--){const ee=4*G,se=va[ee+0],K=va[ee+1],oe=va[ee+2],ce=va[ee+3],ae=se+oe>>1,Me=K+ce>>1,Se=ae+Me-K,Ne=Me+se-ae,it=K*ns+se,De=ce*ns+oe,Ue=Me*ns+ae,Ze=Math.hypot((is[2*it+0]+is[2*De+0])/2-is[2*Ue+0],(is[2*it+1]+is[2*De+1])/2-is[2*Ue+1])>=16;if(ba[Ue]=ba[Ue]||(Ze?1:0),G<1022){const Qe=(K+Ne>>1)*ns+(se+Se>>1),rt=(ce+Ne>>1)*ns+(oe+Se>>1);ba[Ue]=ba[Ue]||ba[Qe]||ba[rt]}}const C=new Gn,M=new Yi;let R=0;function D(G,ee){const se=ee*ns+G;return Sf[se]===0&&(C.emplaceBack(is[2*se+0],is[2*se+1],G*Ht/uo,ee*Ht/uo),Sf[se]=++R),Sf[se]-1}function N(G,ee,se,K,oe,ce){const ae=G+se>>1,Me=ee+K>>1;if(Math.abs(G-oe)+Math.abs(ee-ce)>1&&ba[Me*ns+ae])N(oe,ce,G,ee,ae,Me),N(se,K,oe,ce,ae,Me);else{const Se=D(G,ee),Ne=D(se,K),it=D(oe,ce);M.emplaceBack(Se,Ne,it)}}return N(0,0,uo,uo,uo,0),N(uo,uo,0,0,0,uo),{vertices:C,indices:M}}(this.tileID.canonical,i);u=g.vertices,p=g.indices}else{u=new Gn,p=new Yi;for(const{x:y,y:x}of a)u.emplaceBack(y,x,0,0);const g=Hc(u.int16,void 0,4);for(let y=0;y<g.length;y+=3)p.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,wb.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Ei.simpleSegment(0,0,u.length,p.length)}_makeGlobeTileDebugBuffers(e,i){const a=i.projection;if(!a||a.name!=="globe"||i.freezeTileCoverage)return;const u=this.tileID.canonical,p=Oh(Wv(u,i)),g=Zc(i.zoom);let y;g>0&&(y=cg(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,i,p,y,g),this._makeGlobeTileDebugTextBuffer(e,u,i,p,y,g)}_globePoint(e,i,a,u,p,g,y){let x=Dh(e,i,a);if(g){const w=1<<a.z,A=Qo(u.center.lng),C=es(u.center.lat),M=(a.x+.5)/w-A;let R=0;M>.5?R=-1:M<-.5&&(R=1);let D=(e/Ht+a.x)/w+R,N=(i/Ht+a.y)/w;D=(D-A)*u._pixelsPerMercatorPixel+A,N=(N-C)*u._pixelsPerMercatorPixel+C;const G=[D*u.worldSize,N*u.worldSize,0];vi(G,G,g),x=Il(x,G,y)}return vi(x,x,p)}_makeGlobeTileDebugBorderBuffer(e,i,a,u,p,g){const y=new Dt,x=new Ko,w=new Dn,A=(M,R,D,N,G)=>{const ee=(D-M)/(G-1),se=(N-R)/(G-1),K=y.length;for(let oe=0;oe<G;oe++){const ce=M+oe*ee,ae=R+oe*se;y.emplaceBack(ce,ae);const Me=this._globePoint(ce,ae,i,a,u,p,g);w.emplaceBack(Me[0],Me[1],Me[2]),x.emplaceBack(K+oe)}},C=Ht;A(0,0,C,0,16),A(C,0,C,C,16),A(C,C,0,C,16),A(0,C,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(y,zh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,Zv.members),this._tileDebugSegments=Ei.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugTextBuffer(e,i,a,u,p,g){const y=new Dt,x=new Yi,w=new Dn,A=25;x.reserve(32),y.reserve(A),w.reserve(A);const C=(M,R)=>A*M+R;for(let M=0;M<A;M++){const R=2048*M;for(let D=0;D<A;D++){const N=2048*D;y.emplaceBack(N,R);const G=this._globePoint(N,R,i,a,u,p,g);w.emplaceBack(G[0],G[1],G[2])}}for(let M=0;M<4;M++)for(let R=0;R<4;R++){const D=C(M,R),N=C(M,R+1),G=C(M+1,R),ee=C(M+1,R+1);x.emplaceBack(D,N,G),x.emplaceBack(G,N,ee)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(y,zh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(w,Zv.members),this._tileDebugTextSegments=Ei.simpleSegment(0,0,A,32)}}class aS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Jt(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])a[p]||(this.deletedStates[e][u][p]=null)}else for(const p in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),u=Jt({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(p===null)return{};for(const g in p)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Jt(this.state[u][g],this.stateChanges[u][g]),p[g]=this.state[u][g];a[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const g in this.state[u])p[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else if(this.state[u][g])for(const y of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][y];p[g]=this.state[u][g]}a[u]=a[u]||{},Jt(a[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,i)}}class Eb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function kb(n,e,i,a){let u=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const y=1/a[g];let x=(n[g]-i[g])*y,w=(e[g]-i[g])*y;if(x>w){const A=x;x=w,w=A}if(x>u&&(u=x),w<p&&(p=w),u>p)return null}return u}function Sb(n,e,i,a,u,p,g,y,x,w,A){const C=a-n,M=u-e,R=p-i,D=g-n,N=y-e,G=x-i,ee=A[1]*G-A[2]*N,se=A[2]*D-A[0]*G,K=A[0]*N-A[1]*D,oe=C*ee+M*se+R*K;if(Math.abs(oe)<1e-15)return null;const ce=1/oe,ae=w[0]-n,Me=w[1]-e,Se=w[2]-i,Ne=(ae*ee+Me*se+Se*K)*ce;if(Ne<0||Ne>1)return null;const it=Me*R-Se*M,De=Se*C-ae*R,Ue=ae*M-Me*C,Ze=(A[0]*it+A[1]*De+A[2]*Ue)*ce;return Ze<0||Ne+Ze>1?null:(D*it+N*De+G*Ue)*ce}function Ab(n,e,i){return(n-e)/(i-e)}function Ib(n,e,i,a,u,p,g,y,x){const w=1<<i,A=p-a,C=g-u,M=(n+1)/w*A+a,R=(e+0)/w*C+u,D=(e+1)/w*C+u;y[0]=(n+0)/w*A+a,y[1]=R,x[0]=M,x[1]=D}class Cb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),y=[];let x=Math.ceil(Math.pow(2,g));const w=1/x,A=(R,D,N,G,ee)=>{const se=G?1:0,K=(R+1)*N-se,oe=D*N,ce=(D+1)*N-se;ee[0]=R*N,ee[1]=oe,ee[2]=K,ee[3]=ce};let C=new Eb(x);const M=[];for(let R=0;R<x*x;R++){A(R%x,Math.floor(R/x),w,!1,M);const D=xa(M[0],M[1],p),N=xa(M[2],M[1],p),G=xa(M[2],M[3],p),ee=xa(M[0],M[3],p);C.minimums.push(Math.min(D,N,G,ee)),C.maximums.push(Math.max(D,N,G,ee)),C.leaves.push(1)}for(y.push(C),x/=2;x>=1;x/=2){const R=y[y.length-1];C=new Eb(x);for(let D=0;D<x*x;D++){A(D%x,Math.floor(D/x),2,!0,M);const N=R.getElevation(M[0],M[1]),G=R.getElevation(M[2],M[1]),ee=R.getElevation(M[2],M[3]),se=R.getElevation(M[0],M[3]),K=R.isLeaf(M[0],M[1]),oe=R.isLeaf(M[2],M[1]),ce=R.isLeaf(M[2],M[3]),ae=R.isLeaf(M[0],M[3]),Me=Math.min(N.min,G.min,ee.min,se.min),Se=Math.max(N.max,G.max,ee.max,se.max),Ne=K&&oe&&ce&&ae;C.maximums.push(Se),C.minimums.push(Me),C.leaves.push(Se-Me<=5&&Ne?1:0)}y.push(C)}return y}(this.dem),a=i.length-1,u=i[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,u,p,g,y=1){return kb([e,i,-100],[a,u,this.maximums[0]*y],p,g)}raycast(e,i,a,u,p,g,y=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,a,u,p,g,y);if(x==null)return null;const w=[],A=[],C=[],M=[],R=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:D,t:N,nodex:G,nodey:ee,depth:se}=R.pop();if(this.leaves[D]){Ib(G,ee,se,e,i,a,u,C,M);const oe=1<<se,ce=(G+0)/oe,ae=(G+1)/oe,Me=(ee+0)/oe,Se=(ee+1)/oe,Ne=xa(ce,Me,this.dem)*y,it=xa(ae,Me,this.dem)*y,De=xa(ae,Se,this.dem)*y,Ue=xa(ce,Se,this.dem)*y,Ze=Sb(C[0],C[1],Ne,M[0],C[1],it,M[0],M[1],De,p,g),Qe=Sb(M[0],M[1],De,C[0],M[1],Ue,C[0],C[1],Ne,p,g),rt=Math.min(Ze!==null?Ze:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const Be=Ph([],p,g,N);if(Mb(Ne,it,Ue,De,Ab(Be[0],C[0],M[0]),Ab(Be[1],C[1],M[1]))>=Be[2])return N}continue}let K=0;for(let oe=0;oe<this._siblingOffset.length;oe++){Ib((G<<1)+this._siblingOffset[oe][0],(ee<<1)+this._siblingOffset[oe][1],se+1,e,i,a,u,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[D]+oe]*y;const ce=kb(C,M,p,g);if(ce!=null){const ae=ce;w[oe]=ae;let Me=!1;for(let Se=0;Se<K&&!Me;Se++)ae>=w[A[Se]]&&(A.splice(Se,0,oe),Me=!0);Me||(A[K]=oe),K++}}for(let oe=0;oe<K;oe++){const ce=A[oe];R.push({idx:this.childOffsets[D]+ce,t:w[ce],nodex:(G<<1)+this._siblingOffset[ce][0],nodey:(ee<<1)+this._siblingOffset[ce][1],depth:se+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,u,p){if(e[u].isLeaf(i,a)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=u-1,y=e[g];let x=0,w=0;for(let A=0;A<this._siblingOffset.length;A++){const C=2*i+this._siblingOffset[A][0],M=2*a+this._siblingOffset[A][1],R=y.getElevation(C,M),D=y.isLeaf(C,M),N=this._addNode(R.min,R.max,D);D&&(x|=1<<A),w||(w=N)}for(let A=0;A<this._siblingOffset.length;A++)x&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*a+this._siblingOffset[A][1],g,w+A)}}function Mb(n,e,i,a,u,p){return xn(xn(n,i,p),xn(e,a,p),u)}function xa(n,e,i){const a=i.dim,u=At(n*a-.5,0,a-1),p=At(e*a-.5,0,a-1),g=Math.floor(u),y=Math.floor(p),x=Math.min(g+1,a-1),w=Math.min(y+1,a-1);return Mb(i.get(g,y),i.get(x,y),i.get(g,w),i.get(x,w),u-g,p-y)}const Pb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Af{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,u=!1,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return ne(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let x=0;x<g;x++)y[this._idx(-1,x)]=y[this._idx(0,x)],y[this._idx(g,x)]=y[this._idx(g-1,x)],y[this._idx(x,-1)]=y[this._idx(x,0)],y[this._idx(x,g)]=y[this._idx(x,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Cb(this)}get(e,i,a=!1){a&&(e=At(e,-1,this.dim),i=At(i,-1,this.dim));const u=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return Pb[e]}get unpackVector(){return Pb[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,a){return(256*e*256+256*i+a)/10-1e4}_unpackTerrarium(e,i,a){return 256*e+i+a/256-32768}static pack(e,i){const a=[0,0,0,0],u=Af.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return a[2]=p%256,p=Math.floor(p/256),a[1]=p%256,p=Math.floor(p/256),a[0]=p,a}getPixels(){return new Nr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,g=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(a){case-1:g=y-1;break;case 1:y=g+1}const x=-i*this.dim,w=-a*this.dim;for(let A=g;A<y;A++)for(let C=u;C<p;C++){const M=4*this._idx(C,A),R=4*this._idx(C+x,A+w);this.pixels[M+0]=e.pixels[R+0],this.pixels[M+1]=e.pixels[R+1],this.pixels[M+2]=e.pixels[R+2],this.pixels[M+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et(Af,"DEMData"),Et(Cb,"DemMinMaxQuadTree",{omit:["dem"]});class lS{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:i,timeout:void 0};if(a!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},a)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,u=i===void 0?0:this.data[a].indexOf(i),p=this.data[a][u];return this.data[a].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||i.push(u);for(const a of i)this.remove(a.value.tileID,a)}}class ou{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}ou.ReadOnly=!1,ou.ReadWrite=!0,ou.disabled=new ou(519,ou.ReadOnly,[0,1]);const Jg=7680;class Qg{constructor(e,i,a,u,p,g){this.test=e,this.ref=i,this.mask=a,this.fail=u,this.depthFail=p,this.pass=g}}Qg.disabled=new Qg({func:519,mask:0},0,0,Jg,Jg,Jg);class rs{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}rs.Replace=[1,0],rs.disabled=new rs(rs.Replace,yi.transparent,[!1,!1,!1,!1]),rs.unblended=new rs(rs.Replace,yi.transparent,[!0,!0,!0,!0]),rs.alphaBlended=new rs([1,771],yi.transparent,[!0,!0,!0,!0]);const e_=1029,t_=2305;class Io{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Io.disabled=new Io(!1,e_,t_),Io.backCCW=new Io(!0,e_,t_),Io.backCW=new Io(!0,e_,2304),Io.frontCW=new Io(!0,1028,2304),Io.frontCCW=new Io(!0,1028,t_);class zl extends go{constructor(e,i,a){super(),this.id=e,this._onlySymbols=a,i.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new lS(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new aS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return ni(this._tiles).map(e=>e.tileID).sort(Lb).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&i.push(this._tiles[a]);return e?i.sort((a,u)=>{const p=a.tileID,g=u.tileID,y=new fe(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),x=new fe(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||x.y-y.y||x.x-y.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(Lb).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,e,i)))}_tileLoaded(e,i,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Uo(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=zn.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Vn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const p=i[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const g=this.getTileByID(p);a(e,g),a(g,e)}}function a(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-u.tileID.canonical.x;const y=p.tileID.canonical.y-u.tileID.canonical.y,x=Math.pow(2,u.tileID.canonical.z),w=p.tileID.key;g===0&&y===0||Math.abs(y)>1||(Math.abs(g)>1&&(Math.abs(g+x)===1?g+=x:Math.abs(g-x)===1&&(g-=x)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,g,y),u.neighboringTiles&&u.neighboringTiles[w]&&(u.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,u){for(const p in this._tiles){let g=this._tiles[p];if(u[p]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const w=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[w.key],g&&g.hasData()&&(y=w)}let x=y;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){u[y.key]=y;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const u=e.scaledTo(a),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const a=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,p=Math.floor(a*u*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),a[p.tileID.key]=p}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new fr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const p=this._updateRetainedTiles(u);if(zb(this._source.type)&&u.length!==0){const y={},x={},w=Object.keys(p);for(const C of w){const M=p[C],R=this._tiles[C];if(!R||R.fadeEndTime&&R.fadeEndTime<=zn.now())continue;const D=this.findLoadedParent(M,Math.max(M.overscaledZ-zl.maxOverzooming,this._source.minzoom));D&&(this._addTile(D.tileID),y[D.tileID.key]=D.tileID),x[C]=M}const A=u[u.length-1].overscaledZ;for(const C in this._tiles){const M=this._tiles[C];if(p[C]||!M.hasData())continue;let R=M.tileID;for(;R.overscaledZ>A;){R=R.scaledTo(R.overscaledZ-1);const D=this._tiles[R.key];if(D&&D.hasData()&&x[R.key]){p[C]=M.tileID;break}}}for(const C in y)p[C]||(this._coveredTiles[C]=!0,p[C]=y[C])}for(const y in p)this._tiles[y].clearFadeHold();const g=function(y,x){const w=[];for(const A in y)A in x||w.push(A);return w}(this._tiles,p);for(const y of g){const x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const a={},u=e.reduce((w,A)=>Math.min(w,A.overscaledZ),1/0),p=e[0].overscaledZ,g=Math.max(p-zl.maxOverzooming,this._source.minzoom),y=Math.max(p+zl.maxUnderzooming,this._source.minzoom),x={};for(const w of e){const A=this._addTile(w);i[w.key]=w,A.hasData()||u<this._source.maxzoom&&(x[w.key]=w)}this._retainLoadedChildren(x,u,y,i);for(const w of e){let A=this._tiles[w.key];if(A.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const M=w.children(this._source.maxzoom)[0],R=this.getTile(M);if(R&&R.hasData()){i[M.key]=M;continue}}else{const M=w.children(this._source.maxzoom);if(i[M[0].key]&&i[M[1].key]&&i[M[2].key]&&i[M[3].key])continue}let C=A.wasRequested();for(let M=w.overscaledZ-1;M>=g;--M){const R=w.scaledTo(M);if(a[R.key]||(a[R.key]=!0,A=this.getTile(R),!A&&C&&(A=this._addTile(R)),A&&(i[R.key]=R,C=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}i.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;u=p}for(const p of i)this._loadedParentTiles[p]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=Boolean(i);if(!a){const u=this.map?this.map.painter:null;i=new Yg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,a||this._source.fire(new Vn("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,a){const u=[],p=this.transform;if(!p)return u;const g=p.projection.name==="globe",y=Qo(p.center.lng);for(const x in this._tiles){const w=this._tiles[x];if(a&&w.clearQueryDebugViz(),w.holdingForFade())continue;let A;if(g){const C=w.tileID.canonical;if(C.z===0){const M=[Math.abs(At(y,...nd(C,-1))-y),Math.abs(At(y,...nd(C,1))-y)];A=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(At(y,...nd(C,-1))-y),Math.abs(At(y,...nd(C,0))-y),Math.abs(At(y,...nd(C,1))-y)];A=[M.indexOf(Math.min(...M))-1]}}else A=[0];for(const C of A){const M=e.containsTile(w,p,i,C);M&&u.push(M)}}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(zb(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=zn.now())return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const u=this._tiles[e];u&&u.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}_preloadTiles(e,i){const a=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const y of u){const x=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of x)a.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}Ft(Array.from(a.values()),(y,x)=>{const w=new Yg(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,A=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),x(A,w)})},i)}}function Lb(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function zb(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function nd(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}zl.maxOverzooming=10,zl.maxUnderzooming=3;class If{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const u=a||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,g=u.tileID,y=1<<i.canonical.z-g.canonical.z;return new If(u,u.tileSize/Ht/y,[(i.canonical.x/y-g.canonical.x)*p.dim,(i.canonical.y/y-g.canonical.y)*p.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(a);return new fe(u,p)}getElevationAt(e,i,a,u){const p=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(p),x=Math.floor(g),w=this._dem;return u=!!u,a?xn(xn(w.get(y,x,u),w.get(y,x+1,u),g-x),xn(w.get(y+1,x,u),w.get(y+1,x+1,u),g-x),p-y):w.get(y,x,u)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ao(1,e)*this._dem.stride}}class Rb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ca(Ht,16,0),this.featureIndexArray=new Ev,this.promoteId=i}insert(e,i,a,u,p,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,p,g);const x=this.grid;for(let w=0;w<i.length;w++){const A=i[w],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<A.length;M++){const R=A[M];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<Ht&&C[1]<Ht&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Og(new Hh(this.rawTileData)).layers,this.sourceLayerCoder=new vb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,a,u){this.loadVTLayers();const p=e.params||{},g=Mc(p.filter),y=e.tileResult,x=e.transform,w=y.bufferedTilespaceBounds,A=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(D,N,G,ee)=>l0(y.bufferedTilespaceGeometry,D,N,G,ee));A.sort(cS);let C=null;x.elevation&&A.length>0&&(C=If.create(x.elevation,this.tileID));const M={};let R;for(let D=0;D<A.length;D++){const N=A[D];if(N===R)continue;R=N;const G=this.featureIndexArray.get(N);let ee=null;this.loadMatchingFeature(M,G,g,p.layers,p.availableImages,i,a,u,(se,K,oe,ce=0)=>(ee||(ee=Ms(se,this.tileID.canonical,e.tileTransform)),K.queryIntersectsFeature(y,se,oe,ee,this.z,e.transform,e.pixelPosMatrix,C,ce)))}return M}loadMatchingFeature(e,i,a,u,p,g,y,x,w){const{featureIndex:A,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:R}=i,D=this.bucketLayerIDs[C];if(u&&!function(se,K){for(let oe=0;oe<se.length;oe++)if(K.indexOf(se[oe])>=0)return!0;return!1}(u,D))return;const N=this.sourceLayerCoder.decode(M),G=this.vtLayers[N].feature(A);if(a.needGeometry){const se=Cl(G,!0);if(!a.filter(new xe(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!a.filter(new xe(this.tileID.overscaledZ),G))return;const ee=this.getId(G,N);for(let se=0;se<D.length;se++){const K=D[se];if(u&&u.indexOf(K)<0)continue;const oe=g[K];if(!oe)continue;let ce={};ee!==void 0&&x&&(ce=x.getState(oe.sourceLayer||"_geojsonTileLayer",ee));const ae=Jt({},y[K]);ae.paint=Db(ae.paint,oe.paint,G,ce,p),ae.layout=Db(ae.layout,oe.layout,G,ce,p);const Me=!w||w(G,oe,ce,R);if(!Me)continue;const Se=new bb(G,this.z,this.x,this.y,ee);Se.layer=ae;let Ne=e[K];Ne===void 0&&(Ne=e[K]=[]),Ne.push({featureIndex:A,feature:Se,intersectionZ:Me})}}lookupSymbolFeatures(e,i,a,u,p,g,y,x){const w={};this.loadVTLayers();const A=Mc(p);for(const C of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:u,featureIndex:C,layoutVertexArrayOffset:0},A,g,y,x,i);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),p=this.vtFeatures[u];if(p[i])return p[i];const g=this.vtLayers[u].feature(i);return p[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function Db(n,e,i,a,u){return Bt(n,(p,g)=>{const y=e instanceof Ce?e.get(g):null;return y&&y.evaluate?y.evaluate(i,a,u):y})}function cS(n,e){return e-n}Et(Rb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Ob{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ps({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=fi(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const u=[];let p=e.length%2==1?-e[e.length-1]*a:0,g=e[0]*a,y=!0;u.push({left:p,right:g,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){y=!y;const A=e[w];p=x*a,x+=A,g=x*a,u.push({left:p,right:g,isDash:y,zeroLength:A===0})}return u}addRoundDash(e,i,a){const u=i/2;for(let p=-a;p<=a;p++){const g=this.width*(this.nextRow+a+p);let y=0,x=e[y];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++y]);const A=Math.abs(w-x.left),C=Math.abs(w-x.right),M=Math.min(A,C);let R;const D=p/a*(u+1);if(x.isDash){const N=u-Math.abs(D);R=Math.sqrt(M*M+N*N)}else R=u-Math.sqrt(M*M+D*D);this.image.data[g+w]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const w=e[x],A=e[x+1];w.zeroLength?e.splice(x,1):A&&A.isDash===w.isDash&&(A.left=w.left,e.splice(x,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const p=this.width*this.nextRow;let g=0,y=e[g];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++g]);const w=Math.abs(x-y.left),A=Math.abs(x-y.right),C=Math.min(w,A);this.image.data[p+x]=Math.max(0,Math.min(255,(y.isDash?C:-C)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const u=i==="round",p=u?7:0,g=2*p+1;if(this.nextRow+g>this.height)return ne("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let A=0;A<e.length;A++)e[A]<0&&(ne("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),y+=e[A];if(y!==0){const A=this.width/y,C=this.getDashRanges(e,this.width,A);u?this.addRoundDash(C,A,p):this.addRegularDash(C,i==="square"?.5*A:0)}const x=this.nextRow+p;this.nextRow+=g;const w={tl:[x,p],br:[y,0]};return this.positions[a]=w,w}}Et(Ob,"LineAtlas");class Bb{constructor(e){const i={},a=[];for(const y in e){const x=e[y],w=i[y]={};for(const A in x.glyphs){const C=x.glyphs[+A];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const M=C.metrics.localGlyph?2:1,R={x:0,y:0,w:C.bitmap.width+2*M,h:C.bitmap.height+2*M};a.push(R),w[A]=R}}const{w:u,h:p}=jg(a),g=new Ps({width:u||1,height:p||1});for(const y in e){const x=e[y];for(const w in x.glyphs){const A=x.glyphs[+w];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const C=i[y][w],M=A.metrics.localGlyph?2:1;Ps.copy(A.bitmap,g,{x:0,y:0},{x:C.x+M,y:C.y+M},A.bitmap)}}this.image=g,this.positions=i}}Et(Bb,"GlyphAtlas");class uS{constructor(e){this.tileID=new fr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ll(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,a,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new rg;const g=new vb(Object.keys(e.layers).sort()),y=new Rb(this.tileID,this.promoteId);y.bucketLayerIDs=[];const x={},w=new Ob(256,256),A={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:a},C=i.familiesBySource[this.source];for(const ce in C){const ae=e.layers[ce];if(!ae)continue;let Me=!1,Se=!1;for(const De of C[ce])De[0].type==="symbol"?Me=!0:Se=!0;if(this.isSymbolTile===!0&&!Me||this.isSymbolTile===!1&&!Se)continue;ae.version===1&&ne(`Vector tile source "${this.source}" layer "${ce}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ne=g.encode(ce),it=[];for(let De=0;De<ae.length;De++){const Ue=ae.feature(De),Ze=y.getId(Ue,ce);it.push({feature:Ue,id:Ze,index:De,sourceLayerIndex:Ne})}for(const De of C[ce]){const Ue=De[0];this.isSymbolTile!==void 0&&Ue.type==="symbol"!==this.isSymbolTile||Ue.minzoom&&this.zoom<Math.floor(Ue.minzoom)||Ue.maxzoom&&this.zoom>=Ue.maxzoom||Ue.visibility!=="none"&&(n_(De,this.zoom,a),(x[Ue.id]=Ue.createBucket({index:y.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ne,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(it,A,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(De.map(Ze=>Ze.id)))}}let M,R,D,N;w.trim();const G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=Bt(A.glyphDependencies,ce=>Object.keys(ce).map(Number));Object.keys(ee).length?u.send("getGlyphs",{uid:this.uid,stacks:ee},(ce,ae)=>{M||(M=ce,R=ae,oe.call(this))},void 0,!1,G):R={};const se=Object.keys(A.iconDependencies);se.length?u.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(ce,ae)=>{M||(M=ce,D=ae,oe.call(this))},void 0,!1,G):D={};const K=Object.keys(A.patternDependencies);function oe(){if(M)return p(M);if(R&&D&&N){const ce=new Bb(R),ae=new q0(D,N);for(const Me in x){const Se=x[Me];Se instanceof ya?(n_(Se.layers,this.zoom,a),Fk(Se,R,ce.positions,D,ae.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Se.hasPattern&&(Se instanceof df||Se instanceof af||Se instanceof Gh)&&(n_(Se.layers,this.zoom,a),Se.addFeatures(A,this.tileID.canonical,ae.patternPositions,a,this.tileTransform))}this.status="done",p(null,{buckets:ni(x).filter(Me=>!Me.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ce.image,lineAtlas:w,imageAtlas:ae,glyphMap:this.returnDependencies?R:null,iconMap:this.returnDependencies?D:null,glyphPositions:this.returnDependencies?ce.positions:null})}}K.length?u.send("getImages",{icons:K,source:this.source,tileID:this.tileID,type:"patterns"},(ce,ae)=>{M||(M=ce,N=ae,oe.call(this))},void 0,!1,G):N={},oe.call(this)}}function n_(n,e,i){const a=new xe(e);for(const u of n)u.recalculate(a,i)}class Fb{constructor(e){this.entries={},this.scheduler=e}request(e,i,a,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[g,y]=p.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},i):u(g,y),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=a((g,y)=>{p.result=[g,y];for(const x of p.callbacks)this.scheduler?this.scheduler.add(()=>{x(g,y)},i):x(g,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function jb(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const p=no(n.request,(g,y,x,w)=>{g?u(g):y&&u(null,{vectorTile:i?void 0:new Og(new Hh(y)),rawData:y,cacheControl:x,expires:w})});return()=>{p.cancel(),u()}},e)}s.ARRAY_TYPE=jr,s.AUTH_ERR_MSG=ms,s.Aabb=pr,s.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},xt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=We()?n:S,this.scheduler=new oS}send(n,e,i,a,u=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[g]=i);const y=Tt(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:_l(e,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(e.mustQueue||We()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),a&&a.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if(e.type==="<response>"){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(yl(e.error)):i(null,yl(e.data)))}else{const i=Tt(this.globalScope)?void 0:[],a=e.hasCallback?(p,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:p?_l(p):null,data:_l(g,i)},i)}:p=>{},u=yl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=hf,s.Color=yi,s.ColorMode=rs,s.CullFaceMode=Io,s.DEMData=Af,s.DataConstantProperty=ye,s.DedupedRequest=Fb,s.DepthMode=ou,s.EXTENT=Ht,s.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,u=Math.floor(n.x),p=Math.floor((n.x-u)*a),g=Math.floor(n.y*a),y=this.findDEMTileFor(new fr(i,u,i,p,g));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const u=a.getSource().maxzoom,p=1<<u,g=Math.floor(n.x),y=n.x-g,x=new fr(u,g,u,Math.floor(y*p),Math.floor(n.y*p)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;const A=w.dem,C=1<<w.tileID.canonical.z,M=(y*C-w.tileID.canonical.x)*A.dim,R=(n.y*C-w.tileID.canonical.y)*A.dim,D=Math.floor(M),N=Math.floor(R);return(i?this.exaggeration():1)*xn(xn(A.get(D,N),A.get(D,N+1),R-N),xn(A.get(D+1,N),A.get(D+1,N+1),R-N),M-D)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new qc(n.wrap+(n.canonical.x+e/Ht)/a,(n.canonical.y+i/Ht)/a))}getAtTileOffsetFunc(n,e,i,a){return u=>{const p=this.getAtTileOffset(n,u.x,u.y),g=a.upVector(n.canonical,u.x,u.y);return Xr(g,g,p*a.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const u=If.create(this,n,a);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,u=1<<n.canonical.z-a.canonical.z;let p=n.canonical.x/u-a.canonical.x,g=n.canonical.y/u-a.canonical.y,y=0;for(let x=0;x<n.canonical.z-a.canonical.z&&!i.leaves[y];x++){p*=2,g*=2;const w=2*Math.floor(g)+Math.floor(p);y=i.childOffsets[y]+w,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Uo,s.EvaluationParameters=xe,s.Event=Vn,s.Evented=go,s.FillExtrusionBucket=Gh,s.Frustum=gg,s.FrustumCorners=mg,s.GLOBE_RADIUS=Yo,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const i=new Dt,a=new Yi,u=[],p=n+1+2,g=e[0]+1,y=e[0]+1+(1+e.length),x=(w,A,C)=>{let M=w===p-1?w-2:w===0?w:w-1;return M+=C?24575:0,[M,A]};for(let w=0;w<p;++w)i.emplaceBack(...x(w,0,!0));for(let w=0;w<g;++w)for(let A=0;A<p;++A)i.emplaceBack(...x(A,w,(A===0||A===p-1)&&!0));for(let w=0;w<e.length;++w){const A=e[w];for(let C=0;C<p;++C)i.emplaceBack(...x(C,A,!0))}for(let w=0;w<e.length;++w){const A=a.length,C=e[w]+1+2,M=new Yi;for(let N=0;N<C-1;N++){const G=N===C-2,ee=G?p*(y-e.length+w-N):p;for(let se=0;se<p-1;se++){const K=N*p+se;N===0||G||se===0||se===p-2?(M.emplaceBack(K+1,K,K+ee),M.emplaceBack(K+ee,K+ee+1,K+1)):(a.emplaceBack(K+1,K,K+ee),a.emplaceBack(K+ee,K+ee+1,K+1))}}const R=Ei.simpleSegment(0,A,i.length,a.length-A);for(let N=0;N<M.uint16.length;N+=3)a.emplaceBack(M.uint16[N],M.uint16[N+1],M.uint16[N+2]);const D=Ei.simpleSegment(0,A,i.length,a.length-A);u.push({withoutSkirts:R,withSkirts:D})}return{vertices:i,indices:a,segments:u}}_createGrid(n){const e=this._fillGridMeshWithLods(Al,Rh);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,zh.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Yi;for(let u=0;u<=Al;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Fr,a=new Fr;this._poleSegments=[];for(let u=0,p=0;u<5;u++){const g=360/(1<<u);i.emplaceBack(0,-Yo,0,.5,0),a.emplaceBack(0,-Yo,0,.5,1);for(let y=0;y<=Al;y++){const x=y/Al,w=xn(0,g,x),[A,C,M]=Vc(o2,s2,w,Yo);i.emplaceBack(A,C,M,x,0),a.emplaceBack(A,C,M,x,1)}this._poleSegments.push(Ei.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Gv,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,Gv,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new Xo,a=Al,u=a+1+2,p=1;this._wireframeSegments=[];for(let g=0,y=0;g<Rh.length;g++){const x=Rh[g];for(let A=p;A<x+p;A++)for(let C=p;C<a+p;C++){const M=A*u+C;i.emplaceBack(M,M+1),i.emplaceBack(M,M+u),i.emplaceBack(M,M+u+1)}const w=x*a*3;this._wireframeSegments.push(Ei.simpleSegment(0,y,(x+1)*u,w)),y+=w}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=nu,s.ImagePosition=Ng,s.LivePerformanceUtils=Ke,s.LngLat=kn,s.LngLatBounds=ma,s.LocalGlyphMode=Vg,s.MAX_MERCATOR_LATITUDE=Qi,s.MercatorCoordinate=qc,s.ONE_EM=er,s.OverscaledTileID=fr,s.PerformanceMarkers=ke,s.Properties=tt,s.RGBAImage=Nr,s.Ray=fg,s.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$e,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!Wr(n))return n;const i=Sr(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!Wr(n))return n;const i=Sr(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,a){if(!Wr(n))return n;const u=Sr(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,a){const u=Sr(n);return Wr(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${i}`,$o(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Wr(n))return n;const a=Sr(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&a.authority!=="raster"&&i===512?"@2x":""}${Z.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${B.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${B.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(p){for(const g of p){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(n,e){const i=Sr(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${B.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${B.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(n,e){const i=!!e&&Wr(e),a=[];for(const u of n.tiles||[])gs(u)?a.push(this.canonicalizeTileURL(u,i)):a.push(u);return a}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Sr(B.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,n.protocol==="http"){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if(a.path!=="/"&&(n.path=`${a.path}${n.path}`),!B.REQUIRE_ACCESS_TOKEN)return $o(n);if(e=e||B.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>u.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),$o(n)}},s.ResourceType=Fi,s.SegmentVector=Ei,s.SourceCache=zl,s.StencilMode=Qg,s.StructArrayLayout1ui2=Ko,s.StructArrayLayout2f1f2i16=Xi,s.StructArrayLayout2i4=Dt,s.StructArrayLayout2ui4=Xo,s.StructArrayLayout3f12=Ki,s.StructArrayLayout3ui6=Yi,s.StructArrayLayout4i8=Gn,s.StructArrayLayout5f20=Fr,s.Texture=td,s.Tile=Yg,s.Transitionable=st,s.Uniform1f=qp,s.Uniform1i=class extends As{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends As{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},s.Uniform3f=class extends As{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},s.Uniform4f=Iv,s.UniformColor=Cv,s.UniformMatrix2f=class extends As{constructor(n){super(n),this.current=GE}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},s.UniformMatrix3f=class extends As{constructor(n){super(n),this.current=VE}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.UniformMatrix4f=class extends As{constructor(n){super(n),this.current=UE}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},s.UnwrappedTileID=z0,s.ValidationError=_t,s.VectorTileFeature=cf,s.VectorTileWorkerSource=class extends go{constructor(n,e,i,a,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||jb,this.loading={},this.loaded={},this.deduped=new Fb(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,a=n&&n.request,u=a&&a.collectResourceTiming,p=this.loading[i]=new uS(n);p.abort=this.loadVectorData(n,(g,y)=>{const x=!this.loading[i];if(delete this.loading[i],x||g||!y)return p.status="done",x||(this.loaded[i]=p),e(g);const w=y.rawData,A={};y.expires&&(A.expires=y.expires),y.cacheControl&&(A.cacheControl=y.cacheControl),p.vectorTile=y.vectorTile||new Og(new Hh(w));const C=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,R)=>{if(M||!R)return e(M);const D={};if(u){const N=jt(a);N.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(N)))}e(null,Jt({rawTileData:w.slice(0)},R,A,D))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(n,e){const i=this.loaded,a=n.uid,u=this;if(i&&i[a]){const p=i[a];p.showCollisionBoxes=n.showCollisionBoxes,p.enableTerrain=!!n.enableTerrain,p.projection=n.projection,p.tileTransform=Ll(n.tileID.canonical,n.projection);const g=(y,x)=>{const w=p.reloadCallback;w&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,w)),e(y,x)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,a=n.uid;i&&i[a]&&delete i[a],e()}},s.WritingMode=Yr,s.ZoomDependentExpression=ks,s.add=Cs,s.addDynamicAttributes=Ef,s.adjoint=function(n,e){var i=e[0],a=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],w=e[7],A=e[8];return n[0]=g*A-y*w,n[1]=u*w-a*A,n[2]=a*y-u*g,n[3]=y*x-p*A,n[4]=i*A-u*x,n[5]=u*p-i*y,n[6]=p*w-g*x,n[7]=a*x-i*w,n[8]=i*g-a*p,n},s.asyncAll=Ft,s.bezier=Zt,s.bindAll=xt,s.boundsAttributes=wb,s.bufferConvexPolygon=function(n,e){const i=[];for(let a=0;a<n.length;a++){const u=rn(a-1,-1,n.length-1),p=rn(a+1,-1,n.length-1),g=n[a],y=n[p],x=n[u].sub(g).unit(),w=y.sub(g).unit(),A=w.angleWithSep(x.x,x.y),C=x.add(w).unit().mult(-1*e/Math.sin(A/2));i.push(g.add(C))}return i},s.cacheEntryPossiblyAdded=function(n){ai++,ai>Kt&&(n.getActor().send("enforceCacheSizeLimit",$t),ai=0)},s.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:a}=n.point,u=Kv(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return El(u,u,vg(Jo(e)))},s.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:a,lat:u}=n._center;return Kv(e,i,n.worldSize,a,u)},s.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/Ao(1,n.center.lat),a=ko(new Float64Array(16));return Ah(a,a,[n.point.x,n.point.y,0]),kl(a,a,[i,i,e]),Float32Array.from(a)},s.circumferenceAtLatitude=xg,s.clamp=At,s.clearTileCache=function(n){if(!cn())return;const e=S.caches.delete(at);n&&e.catch(n).then(()=>n())},s.clipLine=rb,s.clone=function(n){var e=new jr(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.clone$1=En,s.collisionCircleLayout=uk,s.config=B,s.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.create=function(){var n=new jr(16);return jr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},s.create$1=Pv,s.createExpression=oa,s.createLayout=Mt,s.createStyleLayer=function(n){return n.type==="custom"?new tS(n):new iS[n.type](n)},s.cross=pg,s.degToRad=Ye,s.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},s.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},s.dot=ao,s.earthRadius=Bh,s.ease=si,s.easeCubicInOut=Tn,s.ecefToLatLng=function([n,e,i]){const a=Math.hypot(n,e,i),u=Math.atan2(n,i),p=.5*Math.PI-Math.acos(-e/a);return new kn(dt(u),dt(p))},s.emitValidationErrors=Pp,s.endsWith=pt,s.enforceCacheSizeLimit=function(n){Pn(),zt&&zt.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a])})})},s.evaluateSizeForFeature=pf,s.evaluateSizeForZoom=Jc,s.evaluateVariableOffset=cb,s.evented=ie,s.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},s.exported=zn,s.exported$1=Z,s.extend=Jt,s.extend$1=_o,s.fillExtrusionHeightLift=M0,s.filterObject=gn,s.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.fromQuat=function(n,e){var i=e[0],a=e[1],u=e[2],p=e[3],g=i+i,y=a+a,x=u+u,w=i*g,A=a*g,C=a*y,M=u*g,R=u*y,D=u*x,N=p*g,G=p*y,ee=p*x;return n[0]=1-C-D,n[1]=A+ee,n[2]=M-G,n[3]=0,n[4]=A-ee,n[5]=1-w-D,n[6]=R+N,n[7]=0,n[8]=M+G,n[9]=R-N,n[10]=1-w-C,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},s.fromRotation=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.fromScaling=zv,s.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return wt[e]},s.getAABBPointSquareDist=function(n,e,i){let a=0;for(let u=0;u<2;++u){const p=i?i[u]:0;n[u]>p&&(a+=(n[u]-p)*(n[u]-p)),e[u]<p&&(a+=(p-e[u])*(p-e[u]))}return a},s.getAnchorAlignment=Ug,s.getAnchorJustification=Zg,s.getBounds=function(n){let e=1/0,i=1/0,a=-1/0,u=-1/0;for(const p of n)e=Math.min(e,p.x),i=Math.min(i,p.y),a=Math.max(a,p.x),u=Math.max(u,p.y);return{min:new fe(e,i),max:new fe(a,u)}},s.getColumn=yt,s.getGridMatrix=function(n,e,i,a){const u=e.getNorth(),p=e.getSouth(),g=e.getWest(),y=e.getEast(),x=1<<n.z,w=y-g,A=u-p,C=w/Al,M=-A/Rh[i],R=[0,C,0,M,0,0,u,g,0];if(n.z>0){const D=180/a;Lv(R,R,[D/w+1,0,0,0,D/A+1,0,-.5*D/C,.5*D/M,1])}return R[2]=x,R[5]=n.x,R[8]=n.y,R},s.getImage=Za,s.getJSON=function(n,e){return ar(Jt(n,{type:"json"}),e)},s.getLatitudinalLod=function(n){const e=Qi-5;n=At(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ye(n))),3);return Math.round(i*(Rh.length-1))},s.getMapSessionAPI=be,s.getPerformanceMeasurement=jt,s.getProjection=_b,s.getRTLTextPluginStatus=ue,s.getReferrer=No,s.getTilePoint=function(n,{x:e,y:i},a=0){return new fe(((e-a)*n.scale-n.x)*Ht,(i*n.scale-n.y)*Ht)},s.getTileVec3=function(n,e,i=0){return Uc(((e.x-i)*n.scale-n.x)*Ht,(e.y*n.scale-n.y)*Ht,e0(e.z,e.y))},s.getVideo=function(n,e){const i=S.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const u=S.document.createElement("source");Ri(n[a])||(i.crossOrigin="Anonymous"),u.src=n[a],i.appendChild(u)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=ko(new Float64Array(16));return El(i,n.pixelMatrix,n.globeMatrix),vi(e,e,i),new fe(e[0],e[1])},s.globeDenormalizeECEF=vg,s.globeECEFOrigin=function(n,e){const i=[0,0,0];return vi(i,i,Oh(Jo(e.canonical))),vi(i,i,n),i},s.globeMetersToEcef=Kp,s.globeNormalizeECEF=Oh,s.globePixelsToTileUnits=function(n,e){return Ht/(512*Math.pow(2,n))*Jp(Jo(e))},s.globePoleMatrixForTile=function(n,e,i){const a=ko(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return Xp(a,i.globeMatrix,u),Float32Array.from(a)},s.globeTileBounds=Jo,s.globeTiltAtLngLat=Yv,s.globeToMercatorTransition=Zc,s.globeUseCustomAntiAliasing=function(n,e,i){const a=Zc(i.zoom),u=n.style.map._antialias,p=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return a===0&&!u&&!g&&p},s.identity=ko,s.identity$1=$v,s.invert=cg,s.isFullscreen=function(){return!!S.document.fullscreenElement||!!S.document.webkitFullscreenElement},s.isLngLatBehindGlobe=bg,s.isMapAuthenticated=function(n){return pe.has(n)},s.isMapboxURL=Wr,s.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Tt(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Ji,s.latLngToECEF=Gc,s.len=QE,s.length=Ih,s.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},s.lngFromMercatorX=Kr,s.loadVectorTile=jb,s.makeRequest=ar,s.mapValue=function(n,e,i,a,u){return At((n-e)/(i-e)*(u-a)+a,a,u)},s.mercatorScale=t0,s.mercatorXfromLng=Qo,s.mercatorYfromLat=es,s.mercatorZfromAltitude=Ao,s.mul=YE,s.mul$1=JE,s.multiply=El,s.multiply$1=Lv,s.multiply$2=Ov,s.nextPowerOfTwo=fi,s.normalize=dr,s.normalize$1=e2,s.normalize$2=jv,s.number=xn,s.ortho=function(n,e,i,a,u,p,g){var y=1/(e-i),x=1/(a-u),w=1/(p-g);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+i)*y,n[13]=(u+a)*x,n[14]=(g+p)*w,n[15]=1,n},s.pbf=Hh,s.perspective=function(n,e,i,a,u){var p,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0?(n[10]=(u+a)*(p=1/(a-u)),n[14]=2*u*a*p):(n[10]=-1,n[14]=-2*a),n},s.pick=function(n,e){const i={};for(let a=0;a<e.length;a++){const u=e[a];u in n&&(i[u]=n[u])}return i},s.plugin=de,s.pointGeometry=fe,s.polesInViewport=function(n){const e=ko(new Float64Array(16));El(e,n.pixelMatrix,n.globeMatrix);const i=[0,lo,0],a=[0,co,0];return vi(i,i,e),vi(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!bg(n,new kn(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!bg(n,new kn(n.center.lat,-90))]},s.polygonContainsPoint=Ml,s.polygonIntersectsBox=l0,s.polygonIntersectsPolygon=r0,s.polygonizeBounds=function(n,e,i=0,a=!0){const u=new fe(i,i),p=n.sub(u),g=e.add(u),y=[p,new fe(g.x,p.y),g,new fe(p.x,g.y)];return a&&y.push(p.clone()),y},s.posAttributes=zh,s.postMapLoadEvent=Y,s.postPerformanceEvent=he,s.postTurnstileEvent=F,s.potpack=jg,s.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.radToDeg=dt,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(n){return n({pluginStatus:X,pluginURL:U}),ie.on("pluginStateChange",n),n},s.removeAuthState=function(n){pe.delete(n)},s.renderColorRamp=Cg,s.resample=n0,s.rotateX=ug,s.rotateX$1=Uv,s.rotateY=Xp,s.rotateY$1=Vv,s.rotateZ=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),p=e[0],g=e[1],y=e[2],x=e[3],w=e[4],A=e[5],C=e[6],M=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*u+w*a,n[1]=g*u+A*a,n[2]=y*u+C*a,n[3]=x*u+M*a,n[4]=w*u-p*a,n[5]=A*u-g*a,n[6]=C*u-y*a,n[7]=M*u-x*a,n},s.rotateZ$1=function(n,e,i){i*=.5;var a=e[0],u=e[1],p=e[2],g=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=a*x+u*y,n[1]=u*x-a*y,n[2]=p*x+g*y,n[3]=g*x-p*y,n},s.scale=kl,s.scale$1=Fv,s.scale$2=Xr,s.scaleAndAdd=Ph,s.set=function(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n},s.setCacheLimits=function(n,e){$t=n,Kt=e},s.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},s.setRTLTextPlugin=function(n,e,i=!1){if(X===V||X===W||X===q)throw new Error("setRTLTextPlugin cannot be called multiple times.");U=zn.resolveURL(n),X=V,H=e,Q(),i||le()},s.smoothstep=Cn,s.spec=je,s.squaredLength=function(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a},s.storeAuthState=function(n,e){e?pe.add(n):pe.delete(n)},s.sub=So,s.subtract=dg,s.symbolSize=hk,s.tileAABB=function(n,e,i,a,u,p,g,y,x){if(x.name==="globe")return r2(n,e,new hf(i,a,u));const w=Ll({z:i,x:a,y:u},x);return new pr([(p+w.x/w.scale)*e,e*(w.y/w.scale),g],[(p+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},s.tileCornersToBounds=Yp,s.tileTransform=Ll,s.transformMat3=function(n,e,i){var a=e[0],u=e[1],p=e[2];return n[0]=a*i[0]+u*i[3]+p*i[6],n[1]=a*i[1]+u*i[4]+p*i[7],n[2]=a*i[2]+u*i[5]+p*i[8],n},s.transformMat4=vi,s.transformMat4$1=Sl,s.transformQuat=Bv,s.transitionTileAABBinECEF=Wv,s.translate=Ah,s.transpose=function(n,e){if(n===e){var i=e[1],a=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=a,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},s.triggerPluginCompletionEvent=te,s.uniqueId=Fn,s.updateGlobeVertexNormal=function(n,e,i,a,u){const p=5*e+2;n.float32[p+0]=i,n.float32[p+1]=a,n.float32[p+2]=u},s.validateCustomStyleLayer=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=n=>bo(_h(n)),s.validateFog=n=>bo(Ip(n)),s.validateLayer=n=>bo(vh(n)),s.validateLight=n=>bo(Ap(n)),s.validateSource=n=>bo(ml(n)),s.validateStyle=Cp,s.validateTerrain=n=>bo(bh(n)),s.values=ni,s.vectorTile=lf,s.version=z,s.warnOnce=ne,s.window=S,s.wrap=rn}),v(["./shared"],function(s){function S(J){if(typeof J=="number"||typeof J=="boolean"||typeof J=="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let $="[";for(const Y of J)$+=`${S(Y)},`;return`${$}]`}let F="{";for(const $ of Object.keys(J).sort())F+=`${$}:${S(J[$])},`;return`${F}}`}function z(J){let F="";for(const $ of s.refProperties)F+=`/${S(J[$])}`;return F}class O{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,$){for(const re of F)this._layerConfigs[re.id]=re,(this._layers[re.id]=s.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of $)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const Y=function(re,he){const we={};for(let pe=0;pe<re.length;pe++){const ke=he&&he[re[pe].id]||z(re[pe]);he&&(he[re[pe].id]=ke);let Ke=we[ke];Ke||(Ke=we[ke]=[]),Ke.push(re[pe])}const be=[];for(const pe in we)be.push(we[pe]);return be}(s.values(this._layerConfigs),this.keyCache);for(const re of Y){const he=re.map(gt=>this._layers[gt.id]),we=he[0];if(we.visibility==="none")continue;const be=we.source||"";let pe=this.familiesBySource[be];pe||(pe=this.familiesBySource[be]={});const ke=we.sourceLayer||"_geojsonTileLayer";let Ke=pe[ke];Ke||(Ke=pe[ke]=[]),Ke.push(he)}}}class B{loadTile(F,$){const{uid:Y,encoding:re,rawImageData:he,padding:we,buildQuadTree:be}=F,pe=s.window.ImageBitmap&&he instanceof s.window.ImageBitmap?this.getImageData(he,we):he;$(null,new s.DEMData(Y,pe,re,we<1,be))}getImageData(F,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const Y=this.offscreenCanvasContext.getImageData(-$,-$,F.width+2*$,F.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Y}}var Z=function J(F,$){var Y,re=F&&F.type;if(re==="FeatureCollection")for(Y=0;Y<F.features.length;Y++)J(F.features[Y],$);else if(re==="GeometryCollection")for(Y=0;Y<F.geometries.length;Y++)J(F.geometries[Y],$);else if(re==="Feature")J(F.geometry,$);else if(re==="Polygon")me(F.coordinates,$);else if(re==="MultiPolygon")for(Y=0;Y<F.coordinates.length;Y++)me(F.coordinates[Y],$);return F};function me(J,F){if(J.length!==0){_e(J[0],F);for(var $=1;$<J.length;$++)_e(J[$],!F)}}function _e(J,F){for(var $=0,Y=0,re=0,he=J.length,we=he-1;re<he;we=re++){var be=(J[re][0]-J[we][0])*(J[we][1]+J[re][1]),pe=$+be;Y+=Math.abs($)>=Math.abs(be)?$-pe+be:be-pe+$,$=pe}$+Y>=0!=!!F&&J.reverse()}const Ie=s.VectorTileFeature.prototype.toGeoJSON;class Te{constructor(F){this._feature=F,this.extent=s.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){const F=[];for(const $ of this._feature.geometry)F.push([new s.pointGeometry($[0],$[1])]);return F}{const F=[];for(const $ of this._feature.geometry){const Y=[];for(const re of $)Y.push(new s.pointGeometry(re[0],re[1]));F.push(Y)}return F}}toGeoJSON(F,$,Y){return Ie.call(this,F,$,Y)}}class ve{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=F.length,this._features=F}feature(F){return new Te(this._features[F])}}var $e={},Fe={get exports(){return $e},set exports(J){$e=J}},qe=s.pointGeometry,fe=s.vectorTile.VectorTileFeature,et=Pe;function Pe(J,F){this.options=F||{},this.features=J,this.length=J.length}function Ge(J,F){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=F||4096}Pe.prototype.feature=function(J){return new Ge(this.features[J],this.options.extent)},Ge.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var F=0;F<J.length;F++){for(var $=J[F],Y=[],re=0;re<$.length;re++)Y.push(new qe($[re][0],$[re][1]));this.geometry.push(Y)}return this.geometry},Ge.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,F=1/0,$=-1/0,Y=1/0,re=-1/0,he=0;he<J.length;he++)for(var we=J[he],be=0;be<we.length;be++){var pe=we[be];F=Math.min(F,pe.x),$=Math.max($,pe.x),Y=Math.min(Y,pe.y),re=Math.max(re,pe.y)}return[F,Y,$,re]},Ge.prototype.toGeoJSON=fe.prototype.toGeoJSON;var Ye=s.pbf,dt=et;function wt(J){var F=new Ye;return function($,Y){for(var re in $.layers)Y.writeMessage(3,Tn,$.layers[re])}(J,F),F.finish()}function Tn(J,F){var $;F.writeVarintField(15,J.version||1),F.writeStringField(1,J.name||""),F.writeVarintField(5,J.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<J.length;$++)Y.feature=J.feature($),F.writeMessage(2,Zt,Y);var re=Y.keys;for($=0;$<re.length;$++)F.writeStringField(3,re[$]);var he=Y.values;for($=0;$<he.length;$++)F.writeMessage(4,Ft,he[$])}function Zt(J,F){var $=J.feature;$.id!==void 0&&F.writeVarintField(1,$.id),F.writeMessage(2,si,J),F.writeVarintField(3,$.type),F.writeMessage(4,rn,$)}function si(J,F){var $=J.feature,Y=J.keys,re=J.values,he=J.keycache,we=J.valuecache;for(var be in $.properties){var pe=$.properties[be],ke=he[be];if(pe!==null){ke===void 0&&(Y.push(be),he[be]=ke=Y.length-1),F.writeVarint(ke);var Ke=typeof pe;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(pe=JSON.stringify(pe));var gt=Ke+":"+pe,nt=we[gt];nt===void 0&&(re.push(pe),we[gt]=nt=re.length-1),F.writeVarint(nt)}}}function At(J,F){return(F<<3)+(7&J)}function Cn(J){return J<<1^J>>31}function rn(J,F){for(var $=J.loadGeometry(),Y=J.type,re=0,he=0,we=$.length,be=0;be<we;be++){var pe=$[be],ke=1;Y===1&&(ke=pe.length),F.writeVarint(At(1,ke));for(var Ke=Y===3?pe.length-1:pe.length,gt=0;gt<Ke;gt++){gt===1&&Y!==1&&F.writeVarint(At(2,Ke-1));var nt=pe[gt].x-re,jt=pe[gt].y-he;F.writeVarint(Cn(nt)),F.writeVarint(Cn(jt)),re+=nt,he+=jt}Y===3&&F.writeVarint(At(7,1))}}function Ft(J,F){var $=typeof J;$==="string"?F.writeStringField(1,J):$==="boolean"?F.writeBooleanField(7,J):$==="number"&&(J%1!=0?F.writeDoubleField(3,J):J<0?F.writeSVarintField(6,J):F.writeVarintField(5,J))}function ni(J,F,$,Y,re,he){if(re-Y<=$)return;const we=Y+re>>1;Jt(J,F,we,Y,re,he%2),ni(J,F,$,Y,we-1,he+1),ni(J,F,$,we+1,re,he+1)}function Jt(J,F,$,Y,re,he){for(;re>Y;){if(re-Y>600){const ke=re-Y+1,Ke=$-Y+1,gt=Math.log(ke),nt=.5*Math.exp(2*gt/3),jt=.5*Math.sqrt(gt*nt*(ke-nt)/ke)*(Ke-ke/2<0?-1:1);Jt(J,F,$,Math.max(Y,Math.floor($-Ke*nt/ke+jt)),Math.min(re,Math.floor($+(ke-Ke)*nt/ke+jt)),he)}const we=F[2*$+he];let be=Y,pe=re;for(Mn(J,F,Y,$),F[2*re+he]>we&&Mn(J,F,Y,re);be<pe;){for(Mn(J,F,be,pe),be++,pe--;F[2*be+he]<we;)be++;for(;F[2*pe+he]>we;)pe--}F[2*Y+he]===we?Mn(J,F,Y,pe):(pe++,Mn(J,F,pe,re)),pe<=$&&(Y=pe+1),$<=pe&&(re=pe-1)}}function Mn(J,F,$,Y){Fn(J,$,Y),Fn(F,2*$,2*Y),Fn(F,2*$+1,2*Y+1)}function Fn(J,F,$){const Y=J[F];J[F]=J[$],J[$]=Y}function hi(J,F,$,Y){const re=J-$,he=F-Y;return re*re+he*he}Fe.exports=wt,$e.fromVectorTileJs=wt,$e.fromGeojsonVt=function(J,F){F=F||{};var $={};for(var Y in J)$[Y]=new dt(J[Y].features,F),$[Y].name=Y,$[Y].version=F.version,$[Y].extent=F.extent;return wt({layers:$})},$e.GeoJSONWrapper=dt;const fi=J=>J[0],Xe=J=>J[1];class xt{constructor(F,$=fi,Y=Xe,re=64,he=Float64Array){this.nodeSize=re,this.points=F;const we=F.length<65536?Uint16Array:Uint32Array,be=this.ids=new we(F.length),pe=this.coords=new he(2*F.length);for(let ke=0;ke<F.length;ke++)be[ke]=ke,pe[2*ke]=$(F[ke]),pe[2*ke+1]=Y(F[ke]);ni(be,pe,re,0,be.length-1,0)}range(F,$,Y,re){return function(he,we,be,pe,ke,Ke,gt){const nt=[0,he.length-1,0],jt=[];let Rt,Lt;for(;nt.length;){const Wt=nt.pop(),nn=nt.pop(),zn=nt.pop();if(nn-zn<=gt){for(let Vn=zn;Vn<=nn;Vn++)Rt=we[2*Vn],Lt=we[2*Vn+1],Rt>=be&&Rt<=ke&&Lt>=pe&&Lt<=Ke&&jt.push(he[Vn]);continue}const Ut=Math.floor((zn+nn)/2);Rt=we[2*Ut],Lt=we[2*Ut+1],Rt>=be&&Rt<=ke&&Lt>=pe&&Lt<=Ke&&jt.push(he[Ut]);const Un=(Wt+1)%2;(Wt===0?be<=Rt:pe<=Lt)&&(nt.push(zn),nt.push(Ut-1),nt.push(Un)),(Wt===0?ke>=Rt:Ke>=Lt)&&(nt.push(Ut+1),nt.push(nn),nt.push(Un))}return jt}(this.ids,this.coords,F,$,Y,re,this.nodeSize)}within(F,$,Y){return function(re,he,we,be,pe,ke){const Ke=[0,re.length-1,0],gt=[],nt=pe*pe;for(;Ke.length;){const jt=Ke.pop(),Rt=Ke.pop(),Lt=Ke.pop();if(Rt-Lt<=ke){for(let Un=Lt;Un<=Rt;Un++)hi(he[2*Un],he[2*Un+1],we,be)<=nt&&gt.push(re[Un]);continue}const Wt=Math.floor((Lt+Rt)/2),nn=he[2*Wt],zn=he[2*Wt+1];hi(nn,zn,we,be)<=nt&&gt.push(re[Wt]);const Ut=(jt+1)%2;(jt===0?we-pe<=nn:be-pe<=zn)&&(Ke.push(Lt),Ke.push(Wt-1),Ke.push(Ut)),(jt===0?we+pe>=nn:be+pe>=zn)&&(Ke.push(Wt+1),Ke.push(Rt),Ke.push(Ut))}return gt}(this.ids,this.coords,F,$,Y,this.nodeSize)}}const pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Bt=Math.fround||(gn=new Float32Array(1),J=>(gn[0]=+J,gn[0]));var gn;class En{constructor(F){this.options=Tt(Object.create(pt),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:$,minZoom:Y,maxZoom:re,nodeSize:he}=this.options;$&&console.time("total time");const we=`prepare ${F.length} points`;$&&console.time(we),this.points=F;let be=[];for(let pe=0;pe<F.length;pe++)F[pe].geometry&&be.push(ne(F[pe],pe));this.trees[re+1]=new xt(be,ht,yt,he,Float32Array),$&&console.timeEnd(we);for(let pe=re;pe>=Y;pe--){const ke=+Date.now();be=this._cluster(be,pe),this.trees[pe]=new xt(be,ht,yt,he,Float32Array),$&&console.log("z%d: %d clusters in %dms",pe,be.length,+Date.now()-ke)}return $&&console.timeEnd("total time"),this}getClusters(F,$){let Y=((F[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,F[1]));let he=F[2]===180?180:((F[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)Y=-180,he=180;else if(Y>he){const Ke=this.getClusters([Y,re,180,we],$),gt=this.getClusters([-180,re,he,we],$);return Ke.concat(gt)}const be=this.trees[this._limitZoom($)],pe=be.range(We(Y),ot(we),We(he),ot(re)),ke=[];for(const Ke of pe){const gt=be.points[Ke];ke.push(gt.numPoints?ge(gt):this.points[gt.index])}return ke}getChildren(F){const $=this._getOriginId(F),Y=this._getOriginZoom(F),re="No cluster with the specified id.",he=this.trees[Y];if(!he)throw new Error(re);const we=he.points[$];if(!we)throw new Error(re);const be=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),pe=he.within(we.x,we.y,be),ke=[];for(const Ke of pe){const gt=he.points[Ke];gt.parentId===F&&ke.push(gt.numPoints?ge(gt):this.points[gt.index])}if(ke.length===0)throw new Error(re);return ke}getLeaves(F,$,Y){const re=[];return this._appendLeaves(re,F,$=$||10,Y=Y||0,0),re}getTile(F,$,Y){const re=this.trees[this._limitZoom(F)],he=Math.pow(2,F),{extent:we,radius:be}=this.options,pe=be/we,ke=(Y-pe)/he,Ke=(Y+1+pe)/he,gt={features:[]};return this._addTileFeatures(re.range(($-pe)/he,ke,($+1+pe)/he,Ke),re.points,$,Y,he,gt),$===0&&this._addTileFeatures(re.range(1-pe/he,ke,1,Ke),re.points,he,Y,he,gt),$===he-1&&this._addTileFeatures(re.range(0,ke,pe/he,Ke),re.points,-1,Y,he,gt),gt.features.length?gt:null}getClusterExpansionZoom(F){let $=this._getOriginZoom(F)-1;for(;$<=this.options.maxZoom;){const Y=this.getChildren(F);if($++,Y.length!==1)break;F=Y[0].properties.cluster_id}return $}_appendLeaves(F,$,Y,re,he){const we=this.getChildren($);for(const be of we){const pe=be.properties;if(pe&&pe.cluster?he+pe.point_count<=re?he+=pe.point_count:he=this._appendLeaves(F,pe.cluster_id,Y,re,he):he<re?he++:F.push(be),F.length===Y)break}return he}_addTileFeatures(F,$,Y,re,he,we){for(const be of F){const pe=$[be],ke=pe.numPoints;let Ke,gt,nt;if(ke)Ke=ze(pe),gt=pe.x,nt=pe.y;else{const Lt=this.points[pe.index];Ke=Lt.properties,gt=We(Lt.geometry.coordinates[0]),nt=ot(Lt.geometry.coordinates[1])}const jt={type:1,geometry:[[Math.round(this.options.extent*(gt*he-Y)),Math.round(this.options.extent*(nt*he-re))]],tags:Ke};let Rt;ke?Rt=pe.id:this.options.generateId?Rt=pe.index:this.points[pe.index].id&&(Rt=this.points[pe.index].id),Rt!==void 0&&(jt.id=Rt),we.features.push(jt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,$){const Y=[],{radius:re,extent:he,reduce:we,minPoints:be}=this.options,pe=re/(he*Math.pow(2,$));for(let ke=0;ke<F.length;ke++){const Ke=F[ke];if(Ke.zoom<=$)continue;Ke.zoom=$;const gt=this.trees[$+1],nt=gt.within(Ke.x,Ke.y,pe),jt=Ke.numPoints||1;let Rt=jt;for(const Lt of nt){const Wt=gt.points[Lt];Wt.zoom>$&&(Rt+=Wt.numPoints||1)}if(Rt>jt&&Rt>=be){let Lt=Ke.x*jt,Wt=Ke.y*jt,nn=we&&jt>1?this._map(Ke,!0):null;const zn=(ke<<5)+($+1)+this.points.length;for(const Ut of nt){const Un=gt.points[Ut];if(Un.zoom<=$)continue;Un.zoom=$;const Vn=Un.numPoints||1;Lt+=Un.x*Vn,Wt+=Un.y*Vn,Un.parentId=zn,we&&(nn||(nn=this._map(Ke,!0)),we(nn,this._map(Un)))}Ke.parentId=zn,Y.push(sn(Lt/Rt,Wt/Rt,zn,Rt,nn))}else if(Y.push(Ke),Rt>1)for(const Lt of nt){const Wt=gt.points[Lt];Wt.zoom<=$||(Wt.zoom=$,Y.push(Wt))}}return Y}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,$){if(F.numPoints)return $?Tt({},F.properties):F.properties;const Y=this.points[F.index].properties,re=this.options.map(Y);return $&&re===Y?Tt({},re):re}}function sn(J,F,$,Y,re){return{x:Bt(J),y:Bt(F),zoom:1/0,id:$,parentId:-1,numPoints:Y,properties:re}}function ne(J,F){const[$,Y]=J.geometry.coordinates;return{x:Bt(We($)),y:Bt(ot(Y)),zoom:1/0,index:F,parentId:-1}}function ge(J){return{type:"Feature",id:J.id,properties:ze(J),geometry:{type:"Point",coordinates:[(F=J.x,360*(F-.5)),ft(J.y)]}};var F}function ze(J){const F=J.numPoints,$=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return Tt(Tt({},J.properties),{cluster:!0,cluster_id:J.id,point_count:F,point_count_abbreviated:$})}function We(J){return J/360+.5}function ot(J){const F=Math.sin(J*Math.PI/180),$=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return $<0?0:$>1?1:$}function ft(J){const F=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Tt(J,F){for(const $ in F)J[$]=F[$];return J}function ht(J){return J.x}function yt(J){return J.y}function at(J,F,$,Y){for(var re,he=Y,we=$-F>>1,be=$-F,pe=J[F],ke=J[F+1],Ke=J[$],gt=J[$+1],nt=F+3;nt<$;nt+=3){var jt=zt(J[nt],J[nt+1],pe,ke,Ke,gt);if(jt>he)re=nt,he=jt;else if(jt===he){var Rt=Math.abs(nt-we);Rt<be&&(re=nt,be=Rt)}}he>Y&&(re-F>3&&at(J,F,re,Y),J[re+2]=he,$-re>3&&at(J,re,$,Y))}function zt(J,F,$,Y,re,he){var we=re-$,be=he-Y;if(we!==0||be!==0){var pe=((J-$)*we+(F-Y)*be)/(we*we+be*be);pe>1?($=re,Y=he):pe>0&&($+=we*pe,Y+=be*pe)}return(we=J-$)*we+(be=F-Y)*be}function It(J,F,$,Y){var re={id:J===void 0?null:J,type:F,geometry:$,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var we=he.geometry,be=he.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")$t(he,we);else if(be==="Polygon"||be==="MultiLineString")for(var pe=0;pe<we.length;pe++)$t(he,we[pe]);else if(be==="MultiPolygon")for(pe=0;pe<we.length;pe++)for(var ke=0;ke<we[pe].length;ke++)$t(he,we[pe][ke])}(re),re}function $t(J,F){for(var $=0;$<F.length;$+=3)J.minX=Math.min(J.minX,F[$]),J.minY=Math.min(J.minY,F[$+1]),J.maxX=Math.max(J.maxX,F[$]),J.maxY=Math.max(J.maxY,F[$+1])}function Kt(J,F,$,Y){if(F.geometry){var re=F.geometry.coordinates,he=F.geometry.type,we=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),be=[],pe=F.id;if($.promoteId?pe=F.properties[$.promoteId]:$.generateId&&(pe=Y||0),he==="Point")cn(re,be);else if(he==="MultiPoint")for(var ke=0;ke<re.length;ke++)cn(re[ke],be);else if(he==="LineString")Pn(re,be,we,!1);else if(he==="MultiLineString"){if($.lineMetrics){for(ke=0;ke<re.length;ke++)Pn(re[ke],be=[],we,!1),J.push(It(pe,"LineString",be,F.properties));return}Ln(re,be,we,!1)}else if(he==="Polygon")Ln(re,be,we,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(ke=0;ke<F.geometry.geometries.length;ke++)Kt(J,{id:pe,geometry:F.geometry.geometries[ke],properties:F.properties},$,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<re.length;ke++){var Ke=[];Ln(re[ke],Ke,we,!0),be.push(Ke)}}J.push(It(pe,he,be,F.properties))}}function cn(J,F){F.push(ai(J[0])),F.push(Fi(J[1])),F.push(0)}function Pn(J,F,$,Y){for(var re,he,we=0,be=0;be<J.length;be++){var pe=ai(J[be][0]),ke=Fi(J[be][1]);F.push(pe),F.push(ke),F.push(0),be>0&&(we+=Y?(re*ke-pe*he)/2:Math.sqrt(Math.pow(pe-re,2)+Math.pow(ke-he,2))),re=pe,he=ke}var Ke=F.length-3;F[2]=1,at(F,0,Ke,$),F[Ke+2]=1,F.size=Math.abs(we),F.start=0,F.end=F.size}function Ln(J,F,$,Y){for(var re=0;re<J.length;re++){var he=[];Pn(J[re],he,$,Y),F.push(he)}}function ai(J){return J/360+.5}function Fi(J){var F=Math.sin(J*Math.PI/180),$=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return $<0?0:$>1?1:$}function Mi(J,F,$,Y,re,he,we,be){if(Y/=F,he>=($/=F)&&we<Y)return J;if(we<$||he>=Y)return null;for(var pe=[],ke=0;ke<J.length;ke++){var Ke=J[ke],gt=Ke.geometry,nt=Ke.type,jt=re===0?Ke.minX:Ke.minY,Rt=re===0?Ke.maxX:Ke.maxY;if(jt>=$&&Rt<Y)pe.push(Ke);else if(!(Rt<$||jt>=Y)){var Lt=[];if(nt==="Point"||nt==="MultiPoint")No(gt,Lt,$,Y,re);else if(nt==="LineString")ar(gt,Lt,$,Y,re,!1,be.lineMetrics);else if(nt==="MultiLineString")Ri(gt,Lt,$,Y,re,!1);else if(nt==="Polygon")Ri(gt,Lt,$,Y,re,!0);else if(nt==="MultiPolygon")for(var Wt=0;Wt<gt.length;Wt++){var nn=[];Ri(gt[Wt],nn,$,Y,re,!0),nn.length&&Lt.push(nn)}if(Lt.length){if(be.lineMetrics&&nt==="LineString"){for(Wt=0;Wt<Lt.length;Wt++)pe.push(It(Ke.id,nt,Lt[Wt],Ke.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(Lt.length===1?(nt="LineString",Lt=Lt[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=Lt.length===3?"Point":"MultiPoint"),pe.push(It(Ke.id,nt,Lt,Ke.tags))}}}return pe.length?pe:null}function No(J,F,$,Y,re){for(var he=0;he<J.length;he+=3){var we=J[he+re];we>=$&&we<=Y&&(F.push(J[he]),F.push(J[he+1]),F.push(J[he+2]))}}function ar(J,F,$,Y,re,he,we){for(var be,pe,ke=no(J),Ke=re===0?mo:fs,gt=J.start,nt=0;nt<J.length-3;nt+=3){var jt=J[nt],Rt=J[nt+1],Lt=J[nt+2],Wt=J[nt+3],nn=J[nt+4],zn=re===0?jt:Rt,Ut=re===0?Wt:nn,Un=!1;we&&(be=Math.sqrt(Math.pow(jt-Wt,2)+Math.pow(Rt-nn,2))),zn<$?Ut>$&&(pe=Ke(ke,jt,Rt,Wt,nn,$),we&&(ke.start=gt+be*pe)):zn>Y?Ut<Y&&(pe=Ke(ke,jt,Rt,Wt,nn,Y),we&&(ke.start=gt+be*pe)):Ui(ke,jt,Rt,Lt),Ut<$&&zn>=$&&(pe=Ke(ke,jt,Rt,Wt,nn,$),Un=!0),Ut>Y&&zn<=Y&&(pe=Ke(ke,jt,Rt,Wt,nn,Y),Un=!0),!he&&Un&&(we&&(ke.end=gt+be*pe),F.push(ke),ke=no(J)),we&&(gt+=be)}var Vn=J.length-3;jt=J[Vn],Rt=J[Vn+1],Lt=J[Vn+2],(zn=re===0?jt:Rt)>=$&&zn<=Y&&Ui(ke,jt,Rt,Lt),Vn=ke.length-3,he&&Vn>=3&&(ke[Vn]!==ke[0]||ke[Vn+1]!==ke[1])&&Ui(ke,ke[0],ke[1],ke[2]),ke.length&&F.push(ke)}function no(J){var F=[];return F.size=J.size,F.start=J.start,F.end=J.end,F}function Ri(J,F,$,Y,re,he){for(var we=0;we<J.length;we++)ar(J[we],F,$,Y,re,he,!1)}function Ui(J,F,$,Y){J.push(F),J.push($),J.push(Y)}function mo(J,F,$,Y,re,he){var we=(he-F)/(Y-F);return J.push(he),J.push($+(re-$)*we),J.push(1),we}function fs(J,F,$,Y,re,he){var we=(he-$)/(re-$);return J.push(F+(Y-F)*we),J.push(he),J.push(1),we}function Za(J,F){for(var $=[],Y=0;Y<J.length;Y++){var re,he=J[Y],we=he.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")re=ms(he.geometry,F);else if(we==="MultiLineString"||we==="Polygon"){re=[];for(var be=0;be<he.geometry.length;be++)re.push(ms(he.geometry[be],F))}else if(we==="MultiPolygon")for(re=[],be=0;be<he.geometry.length;be++){for(var pe=[],ke=0;ke<he.geometry[be].length;ke++)pe.push(ms(he.geometry[be][ke],F));re.push(pe)}$.push(It(he.id,we,re,he.tags))}return $}function ms(J,F){var $=[];$.size=J.size,J.start!==void 0&&($.start=J.start,$.end=J.end);for(var Y=0;Y<J.length;Y+=3)$.push(J[Y]+F,J[Y+1],J[Y+2]);return $}function Wr(J,F){if(J.transformed)return J;var $,Y,re,he=1<<J.z,we=J.x,be=J.y;for($=0;$<J.features.length;$++){var pe=J.features[$],ke=pe.geometry,Ke=pe.type;if(pe.geometry=[],Ke===1)for(Y=0;Y<ke.length;Y+=2)pe.geometry.push(gs(ke[Y],ke[Y+1],F,he,we,be));else for(Y=0;Y<ke.length;Y++){var gt=[];for(re=0;re<ke[Y].length;re+=2)gt.push(gs(ke[Y][re],ke[Y][re+1],F,he,we,be));pe.geometry.push(gt)}}return J.transformed=!0,J}function gs(J,F,$,Y,re,he){return[Math.round($*(J*Y-re)),Math.round($*(F*Y-he))]}function ic(J,F,$,Y,re){for(var he=F===re.maxZoom?0:re.tolerance/((1<<F)*re.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:Y,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<J.length;be++){we.numFeatures++,rc(we,J[be],he,re);var pe=J[be].minX,ke=J[be].minY,Ke=J[be].maxX,gt=J[be].maxY;pe<we.minX&&(we.minX=pe),ke<we.minY&&(we.minY=ke),Ke>we.maxX&&(we.maxX=Ke),gt>we.maxY&&(we.maxY=gt)}return we}function rc(J,F,$,Y){var re=F.geometry,he=F.type,we=[];if(he==="Point"||he==="MultiPoint")for(var be=0;be<re.length;be+=3)we.push(re[be]),we.push(re[be+1]),J.numPoints++,J.numSimplified++;else if(he==="LineString")Gs(we,re,J,$,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(be=0;be<re.length;be++)Gs(we,re[be],J,$,he==="Polygon",be===0);else if(he==="MultiPolygon")for(var pe=0;pe<re.length;pe++){var ke=re[pe];for(be=0;be<ke.length;be++)Gs(we,ke[be],J,$,!0,be===0)}if(we.length){var Ke=F.tags||null;if(he==="LineString"&&Y.lineMetrics){for(var gt in Ke={},F.tags)Ke[gt]=F.tags[gt];Ke.mapbox_clip_start=re.start/re.size,Ke.mapbox_clip_end=re.end/re.size}var nt={geometry:we,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:Ke};F.id!==null&&(nt.id=F.id),J.features.push(nt)}}function Gs(J,F,$,Y,re,he){var we=Y*Y;if(Y>0&&F.size<(re?we:Y))$.numPoints+=F.length/3;else{for(var be=[],pe=0;pe<F.length;pe+=3)(Y===0||F[pe+2]>we)&&($.numSimplified++,be.push(F[pe]),be.push(F[pe+1])),$.numPoints++;re&&function(ke,Ke){for(var gt=0,nt=0,jt=ke.length,Rt=jt-2;nt<jt;Rt=nt,nt+=2)gt+=(ke[nt]-ke[Rt])*(ke[nt+1]+ke[Rt+1]);if(gt>0===Ke)for(nt=0,jt=ke.length;nt<jt/2;nt+=2){var Lt=ke[nt],Wt=ke[nt+1];ke[nt]=ke[jt-2-nt],ke[nt+1]=ke[jt-1-nt],ke[jt-2-nt]=Lt,ke[jt-1-nt]=Wt}}(be,he),J.push(be)}}function _s(J,F){var $=(F=this.options=function(re,he){for(var we in he)re[we]=he[we];return re}(Object.create(this.options),F)).debug;if($&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(re,he){var we=[];if(re.type==="FeatureCollection")for(var be=0;be<re.features.length;be++)Kt(we,re.features[be],he,be);else Kt(we,re.type==="Feature"?re:{geometry:re},he);return we}(J,F);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(re,he){var we=he.buffer/he.extent,be=re,pe=Mi(re,1,-1-we,we,0,-1,2,he),ke=Mi(re,1,1-we,2+we,0,-1,2,he);return(pe||ke)&&(be=Mi(re,1,-we,1+we,0,-1,2,he)||[],pe&&(be=Za(pe,1).concat(be)),ke&&(be=be.concat(Za(ke,-1)))),be}(Y,F),Y.length&&this.splitTile(Y,0,0,0),$&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Sr(J,F,$){return 32*((1<<J)*$+F)+J}function $o(J,F){const $=J.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const Y=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!Y)return F(null,null);const re=new ve(Y.features);let he=$e(re);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),F(null,{vectorTile:re,rawData:he.buffer})}_s.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_s.prototype.splitTile=function(J,F,$,Y,re,he,we){for(var be=[J,F,$,Y],pe=this.options,ke=pe.debug;be.length;){Y=be.pop(),$=be.pop(),F=be.pop(),J=be.pop();var Ke=1<<F,gt=Sr(F,$,Y),nt=this.tiles[gt];if(!nt&&(ke>1&&console.time("creation"),nt=this.tiles[gt]=ic(J,F,$,Y,pe),this.tileCoords.push({z:F,x:$,y:Y}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,$,Y,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));var jt="z"+F;this.stats[jt]=(this.stats[jt]||0)+1,this.total++}if(nt.source=J,re){if(F===pe.maxZoom||F===re)continue;var Rt=1<<re-F;if($!==Math.floor(he/Rt)||Y!==Math.floor(we/Rt))continue}else if(F===pe.indexMaxZoom||nt.numPoints<=pe.indexMaxPoints)continue;if(nt.source=null,J.length!==0){ke>1&&console.time("clipping");var Lt,Wt,nn,zn,Ut,Un,Vn=.5*pe.buffer/pe.extent,Uo=.5-Vn,go=.5+Vn,je=1+Vn;Lt=Wt=nn=zn=null,Ut=Mi(J,Ke,$-Vn,$+go,0,nt.minX,nt.maxX,pe),Un=Mi(J,Ke,$+Uo,$+je,0,nt.minX,nt.maxX,pe),J=null,Ut&&(Lt=Mi(Ut,Ke,Y-Vn,Y+go,1,nt.minY,nt.maxY,pe),Wt=Mi(Ut,Ke,Y+Uo,Y+je,1,nt.minY,nt.maxY,pe),Ut=null),Un&&(nn=Mi(Un,Ke,Y-Vn,Y+go,1,nt.minY,nt.maxY,pe),zn=Mi(Un,Ke,Y+Uo,Y+je,1,nt.minY,nt.maxY,pe),Un=null),ke>1&&console.timeEnd("clipping"),be.push(Lt||[],F+1,2*$,2*Y),be.push(Wt||[],F+1,2*$,2*Y+1),be.push(nn||[],F+1,2*$+1,2*Y),be.push(zn||[],F+1,2*$+1,2*Y+1)}}},_s.prototype.getTile=function(J,F,$){var Y=this.options,re=Y.extent,he=Y.debug;if(J<0||J>24)return null;var we=1<<J,be=Sr(J,F=(F%we+we)%we,$);if(this.tiles[be])return Wr(this.tiles[be],re);he>1&&console.log("drilling down to z%d-%d-%d",J,F,$);for(var pe,ke=J,Ke=F,gt=$;!pe&&ke>0;)ke--,Ke=Math.floor(Ke/2),gt=Math.floor(gt/2),pe=this.tiles[Sr(ke,Ke,gt)];return pe&&pe.source?(he>1&&console.log("found parent tile z%d-%d-%d",ke,Ke,gt),he>1&&console.time("drilling down"),this.splitTile(pe.source,ke,Ke,gt,J,F,$),he>1&&console.timeEnd("drilling down"),this.tiles[be]?Wr(this.tiles[be],re):null):null};class oc extends s.VectorTileWorkerSource{constructor(F,$,Y,re,he){super(F,$,Y,re,$o),he&&(this.loadGeoJSON=he)}loadData(F,$){const Y=F&&F.request,re=Y&&Y.collectResourceTiming;this.loadGeoJSON(F,(he,we)=>{if(he||!we)return $(he);if(typeof we!="object")return $(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{Z(we,!0);try{if(F.filter){const pe=s.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(Ke=>pe.value.evaluate({zoom:0},Ke))}}this._geoJSONIndex=F.cluster?new En(function({superclusterOptions:pe,clusterProperties:ke}){if(!ke||!pe)return pe;const Ke={},gt={},nt={accumulated:null,zoom:0},jt={properties:null},Rt=Object.keys(ke);for(const Lt of Rt){const[Wt,nn]=ke[Lt],zn=s.createExpression(nn),Ut=s.createExpression(typeof Wt=="string"?[Wt,["accumulated"],["get",Lt]]:Wt);Ke[Lt]=zn.value,gt[Lt]=Ut.value}return pe.map=Lt=>{jt.properties=Lt;const Wt={};for(const nn of Rt)Wt[nn]=Ke[nn].evaluate(nt,jt);return Wt},pe.reduce=(Lt,Wt)=>{jt.properties=Wt;for(const nn of Rt)nt.accumulated=Lt[nn],Lt[nn]=gt[nn].evaluate(nt,jt)},pe}(F)).load(we.features):function(pe,ke){return new _s(pe,ke)}(we,F.geojsonVtOptions)}catch(pe){return $(pe)}this.loaded={};const be={};if(re){const pe=s.getPerformanceMeasurement(Y);pe&&(be.resourceTiming={},be.resourceTiming[F.source]=JSON.parse(JSON.stringify(pe)))}$(null,be)}})}reloadTile(F,$){const Y=this.loaded;return Y&&Y[F.uid]?super.reloadTile(F,$):this.loadTile(F,$)}loadGeoJSON(F,$){if(F.request)s.getJSON(F.request,$);else{if(typeof F.data!="string")return $(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(F.data))}catch{return $(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(Y){$(Y)}}getClusterChildren(F,$){try{$(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(Y){$(Y)}}getClusterLeaves(F,$){try{$(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(Y){$(Y)}}}class ys{constructor(F){this.self=F,this.actor=new s.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:oc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,Y)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=Y},this.self.registerRTLTextPlugin=$=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=$.applyArabicShaping,s.plugin.processBidirectionalText=$.processBidirectionalText,s.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(F,$,Y){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],Y()}checkIfReady(F,$,Y){Y()}setReferrer(F,$){this.referrer=$}spriteLoaded(F,$){this.isSpriteLoaded[F]=$;for(const Y in this.workerSources[F]){const re=this.workerSources[F][Y];for(const he in re)re[he]instanceof s.VectorTileWorkerSource&&(re[he].isSpriteLoaded=$,re[he].fire(new s.Event("isSpriteLoaded")))}}setImages(F,$,Y){this.availableImages[F]=$;for(const re in this.workerSources[F]){const he=this.workerSources[F][re];for(const we in he)he[we].availableImages=$}Y()}enableTerrain(F,$,Y){this.terrain=$,Y()}setProjection(F,$){this.projections[F]=s.getProjection($)}setLayers(F,$,Y){this.getLayerIndex(F).replace($),Y()}updateLayers(F,$,Y){this.getLayerIndex(F).update($.layers,$.removedIds),Y()}loadTile(F,$,Y){const re=this.enableTerrain?s.extend({enableTerrain:this.terrain},$):$;re.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,$.type,$.source).loadTile(re,Y)}loadDEMTile(F,$,Y){const re=this.enableTerrain?s.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(F,$.source).loadTile(re,Y)}reloadTile(F,$,Y){const re=this.enableTerrain?s.extend({enableTerrain:this.terrain},$):$;re.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,$.type,$.source).reloadTile(re,Y)}abortTile(F,$,Y){this.getWorkerSource(F,$.type,$.source).abortTile($,Y)}removeTile(F,$,Y){this.getWorkerSource(F,$.type,$.source).removeTile($,Y)}removeSource(F,$,Y){if(!this.workerSources[F]||!this.workerSources[F][$.type]||!this.workerSources[F][$.type][$.source])return;const re=this.workerSources[F][$.type][$.source];delete this.workerSources[F][$.type][$.source],re.removeSource!==void 0?re.removeSource($,Y):Y()}loadWorkerSource(F,$,Y){try{this.self.importScripts($.url),Y()}catch(re){Y(re.toString())}}syncRTLPluginState(F,$,Y){try{s.plugin.setState($);const re=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&re!=null){this.self.importScripts(re);const he=s.plugin.isParsed();Y(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),he)}}catch(re){Y(re.toString())}}getAvailableImages(F){let $=this.availableImages[F];return $||($=[]),$}getLayerIndex(F){let $=this.layerIndexes[F];return $||($=this.layerIndexes[F]=new O),$}getWorkerSource(F,$,Y){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][$]||(this.workerSources[F][$]={}),!this.workerSources[F][$][Y]){const re={send:(he,we,be,pe,ke,Ke)=>{this.actor.send(he,we,be,F,ke,Ke)},scheduler:this.actor.scheduler};this.workerSources[F][$][Y]=new this.workerSourceTypes[$](re,this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded[F])}return this.workerSources[F][$][Y]}getDEMWorkerSource(F,$){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][$]||(this.demWorkerSources[F][$]=new B),this.demWorkerSources[F][$]}enforceCacheSizeLimit(F,$){s.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(F,$,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ys(self)),ys}),v(["./shared"],function(s){function S(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let c=0;c<d.length;c++)if(!S(d[c],o[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&o!==null){if(typeof o!="object"||Object.keys(d).length!==Object.keys(o).length)return!1;for(const c in d)if(!S(d[c],o[c]))return!1;return!0}return d===o}var z=O;function O(d){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{_=new Worker(E),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(E),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var b=_.getImageData(0,0,1,1);return b&&b.width===f.width}()?(B[c=o&&o.failIfMajorPerformanceCaveat]===void 0&&(B[c]=function(f){var _,b=function(E){var k=document.createElement("canvas"),I=Object.create(O.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=E,k.getContext("webgl",I)||k.getContext("experimental-webgl",I)}(f);if(!b)return!1;try{_=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!_||b.isContextLost())&&(b.shaderSource(_,"void main() {}"),b.compileShader(_),b.getShaderParameter(_,b.COMPILE_STATUS)===!0)}(c)),B[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(d)}var B={};function Z(d,o,c){const f=s.window.document.createElement(d);return o!==void 0&&(f.className=o),c&&c.appendChild(f),f}function me(d,o,c){const f=s.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(o))f.setAttributeNS(null,_,o[_]);return c&&c.appendChild(f),f}O.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const _e=s.window.document&&s.window.document.documentElement.style,Ie=_e&&_e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Te;function ve(){_e&&Ie&&(Te=_e[Ie],_e[Ie]="none")}function $e(){_e&&Ie&&(_e[Ie]=Te)}function Fe(d){d.preventDefault(),d.stopPropagation(),s.window.removeEventListener("click",Fe,!0)}function qe(){s.window.addEventListener("click",Fe,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Fe,!0)},0)}function fe(d,o){const c=d.getBoundingClientRect();return Ge(d,c,o)}function et(d,o){const c=d.getBoundingClientRect(),f=[];for(let _=0;_<o.length;_++)f.push(Ge(d,c,o[_]));return f}function Pe(d){return s.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Ge(d,o,c){const f=d.offsetWidth===o.width?1:d.offsetWidth/o.width;return new s.pointGeometry((c.clientX-o.left)*f,(c.clientY-o.top)*f)}function Ye(d,o){var c=o[0],f=o[1],_=o[2],b=o[3],E=c*b-_*f;return E?(d[0]=b*(E=1/E),d[1]=-f*E,d[2]=-_*E,d[3]=c*E,d):null}function dt(d){const{userImage:o}=d;return!!(o&&o.render&&o.render())&&(d.data.replace(new Uint8Array(o.data.buffer)),!0)}class wt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,f);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,c){this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),f=!1),f}_validateStretch(o,c){if(!o)return!0;let f=0;for(const _ of o){if(_[0]<f||_[1]<_[0]||c<_[1])return!1;f=_[1]}return!0}_validateContent(o,c){return!(o&&(o.length!==4||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){c.version=this.images[o].version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let f=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(f=!1);this.isLoaded()||f?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const f={};for(const _ of o){this.images[_]||this.fire(new s.Event("styleimagemissing",{id:_}));const b=this.images[_];b?f[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:s.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],f=this.getImage(o);if(!f)return null;if(c&&c.position.version===f.version)return c.position;if(c)c.position.version=f.version;else{const _={w:f.data.width+2,h:f.data.height+2,x:0,y:0},b=new s.ImagePosition(_,f);this.patterns[o]={bin:_,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(o,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:c,h:f}=s.potpack(o),_=this.atlasImage;_.resize({width:c||1,height:f||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],k=E.x+1,I=E.y+1,P=this.images[b].data,L=P.width,j=P.height;s.RGBAImage.copy(P,_,{x:0,y:0},{x:k,y:I},{width:L,height:j}),s.RGBAImage.copy(P,_,{x:0,y:j-1},{x:k,y:I-1},{width:L,height:1}),s.RGBAImage.copy(P,_,{x:0,y:0},{x:k,y:I+j},{width:L,height:1}),s.RGBAImage.copy(P,_,{x:L-1,y:0},{x:k-1,y:I},{width:1,height:j}),s.RGBAImage.copy(P,_,{x:0,y:0},{x:k+L,y:I},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const f=this.images[c];dt(f)&&this.updateImage(c,f)}}}const Tn=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(d,o){return function([c,f,_]){const b=s.degToRad(f+90),E=s.degToRad(_);return{x:c*Math.cos(b)*Math.sin(E),y:c*Math.sin(b)*Math.sin(E),z:c*Math.cos(E),azimuthal:f,polar:_}}(d.expression.evaluate(o))}interpolate(d,o,c){return{x:s.number(d.x,o.x,c),y:s.number(d.y,o.y,c),z:s.number(d.z,o.z,c),azimuthal:s.number(d.azimuthal,o.azimuthal,c),polar:s.number(d.polar,o.polar,c)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),Zt="-transition";class si extends s.Evented{constructor(o){super(),this._transitionable=new s.Transitionable(Tn),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(s.validateLight,o,c))for(const f in o){const _=o[f];s.endsWith(f,Zt)?this._transitionable.setTransition(f.slice(0,-Zt.length),_):this._transitionable.setValue(f,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const At=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Cn="-transition";class rn extends s.Evented{constructor(o,c){super(),this._transitionable=new s.Transitionable(At),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(o){for(const c in o){const f=o[c];s.endsWith(c,Cn)?this._transitionable.setTransition(c.slice(0,-Cn.length),f):this._transitionable.setValue(c,f)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function Ft(d,o,c,f){const _=s.smoothstep(45,65,c),[b,E]=ni(d,f),k=s.length(o);let I=1-Math.min(1,Math.exp((k-b)/(E-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*_*d.alpha}function ni(d,o){const c=.5/Math.tan(.5*o);return[d.range[0]+c,d.range[1]+c]}const Jt=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),Mn="-transition";class Fn extends s.Evented{constructor(o,c){super(),this._transitionable=new s.Transitionable(Jt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const o=this._transform,c=o.projection.name==="globe",f=s.globeToMercatorTransition(o.zoom),_=this.properties.get("range"),b=[.5,3];return{range:c?[s.number(b[0],_[0],f),s.number(b[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(!this._validate(s.validateFog,o,c)){for(const f of Object.keys(s.spec.fog))o&&o[f]===void 0&&(o[f]=s.spec.fog[f].default);for(const f in o){const _=o[f];s.endsWith(f,Mn)?this._transitionable.setTransition(f.slice(0,-Mn.length),_):this._transitionable.setValue(f,_)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(f,_,b){const E=s.MercatorCoordinate.fromLngLat(_),k=b.elevation?b.elevation.getAtPointOrZero(E):0,I=[E.x,E.y,k];return s.transformMat4(I,I,b.mercatorFogMatrix),Ft(f,I,b.pitch,b._fov)}(this.state,o,c):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?ni(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,f){return(!f||f.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class hi{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const f=this.workerPool.acquire(this.id);for(let _=0;_<f.length;_++){const b=new hi.Actor(f[_],c,this.id);b.name=`Worker ${_}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,f){s.asyncAll(this.actors,(_,b)=>{_.send(o,c,b)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fi(d,o,c){return o*(s.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}hi.Actor=s.Actor;class Xe{constructor(o,c,f,_){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(o,c){let f,_;if(o instanceof s.pointGeometry||typeof o[0]=="number"){const b=s.pointGeometry.convert(o);f=[b],_=c.isPointAboveHorizon(b)}else{const b=s.pointGeometry.convert(o[0]),E=s.pointGeometry.convert(o[1]);f=[b,E],_=s.polygonizeBounds(b,E).every(k=>c.isPointAboveHorizon(k))}return new Xe(f,c.getCameraPoint(),_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),s.bufferConvexPolygon(_,o)}bufferedCameraGeometryGlobe(o){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(c,f,o),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>f.y))+((b.x>c.x)+(b.x>f.x))){case 0:_[0]=b,_[4]=b.clone();break;case 1:_.splice(1,0,b);break;case 2:_[1]=b;break;case 3:_.splice(4,0,b);break;case 5:_.splice(2,0,b);break;case 6:_[3]=b;break;case 7:_.splice(3,0,b);break;case 8:_[2]=b}return _}containsTile(o,c,f,_=0){const b=o.queryPadding/c._pixelsPerMercatorPixel+1,E=f?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let k=o.tileID.wrap+(E.unwrapped?_:0);const I=E.polygon.map(X=>s.getTilePoint(o.tileTransform,X,k));if(!s.polygonIntersectsBox(I,0,0,s.EXTENT,s.EXTENT))return;k=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const P=this.screenGeometryMercator.polygon.map(X=>s.getTileVec3(o.tileTransform,X,k)),L=P.map(X=>new s.pointGeometry(X[0],X[1])),j=c.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),V=s.getTileVec3(o.tileTransform,j,k),W=P.map(X=>{const U=s.sub(X,X,V);return s.normalize(U,U),new s.Ray(V,U)}),q=fi(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:W,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(H=s.getBounds(I),H.min.x=s.clamp(H.min.x,0,s.EXTENT),H.min.y=s.clamp(H.min.y,0,s.EXTENT),H.max.x=s.clamp(H.max.x,0,s.EXTENT),H.max.y=s.clamp(H.max.y,0,s.EXTENT),H),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:q};var H}_bufferedScreenMercator(o,c){const f=Bt(o);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(o,c){const f=Bt(o);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(o,c){const f=function(b,E){const k=s.multiply([],E.pixelMatrix,E.globeMatrix),I=[0,-s.GLOBE_RADIUS,0,1],P=[0,s.GLOBE_RADIUS,0,1],L=[0,0,0,1];s.transformMat4$1(I,I,k),s.transformMat4$1(P,P,k),s.transformMat4$1(L,L,k);const j=new s.pointGeometry(I[0]/I[3],I[1]/I[3]),V=new s.pointGeometry(P[0]/P[3],P[1]/P[3]),W=s.polygonContainsPoint(b,j)&&I[3]<L[3],q=s.polygonContainsPoint(b,V)&&P[3]<L[3];if(!W&&!q)return null;const H=function(de,xe,Ae){for(let Le=1;Le<de.length;Le++){const st=pt(xe.pointCoordinate3D(de[Le-1]).x),Ee=pt(xe.pointCoordinate3D(de[Le]).x);if(Ae<0){if(st<Ee)return{idx:Le,t:-st/(Ee-1-st)}}else if(Ee<st)return{idx:Le,t:(1-st)/(Ee+1-st)}}return null}(b,E,W?-1:1);if(!H)return null;const{idx:X,t:U}=H;let te=X>1?xt(b.slice(0,X),E):[],Q=X<b.length?xt(b.slice(X),E):[];te=te.map(de=>new s.pointGeometry(pt(de.x),de.y)),Q=Q.map(de=>new s.pointGeometry(pt(de.x),de.y));const ie=[...te];ie.length===0&&ie.push(Q[Q.length-1]);const ue=s.number(ie[ie.length-1].y,(Q.length===0?te[0]:Q[0]).y,U);let le;return le=W?[new s.pointGeometry(0,ue),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,ue)]:[new s.pointGeometry(1,ue),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,ue)],ie.push(...le),Q.length===0?ie.push(te[0]):ie.push(...Q),{polygon:ie.map(de=>new s.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(o,c);if(f)return f;const _=function(b,E){let k=!1,I=-1/0,P=0;for(let j=0;j<b.length-1;j++)b[j].x>I&&(I=b[j].x,P=j);for(let j=0;j<b.length-1;j++){const V=(P+j)%(b.length-1),W=b[V],q=b[V+1];Math.abs(W.x-q.x)>.5&&(W.x<q.x?(W.x+=1,V===0&&(b[b.length-1].x+=1)):(q.x+=1,V+1===b.length-1&&(b[0].x+=1)),k=!0)}const L=s.mercatorXfromLng(E.center.lng);return k&&L<Math.abs(L-1)&&b.forEach(j=>{j.x-=1}),{polygon:b,unwrapped:k}}(xt(o,c).map(b=>new s.pointGeometry(pt(b.x),b.y)),c);return{polygon:_.polygon.map(b=>new s.MercatorCoordinate(b.x,b.y)),unwrapped:_.unwrapped}}}function xt(d,o){return s.resample(d,c=>{const f=o.pointCoordinate3D(c);c.x=f.x,c.y=f.y},1/256)}function pt(d){return d<0?1+d%1:d%1}function Bt(d){return 100*d|0}function gn(d,o,c,f,_){const b=function(E,k){if(E)return _(E);if(k){d.url&&k.tiles&&d.tiles&&delete d.tiles;const I=s.pick(s.extend(k,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(I.vectorLayers=k.vector_layers,I.vectorLayerIds=I.vectorLayers.map(P=>P.id)),I.tiles=o.canonicalizeTileset(I,d.url),_(null,I)}};return d.url?s.getJSON(o.transformRequest(o.normalizeSourceURL(d.url,null,c,f),s.ResourceType.Source),b):s.exported.frame(()=>b(null,d))}class En{constructor(o,c,f){this.bounds=s.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),f=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*c),_=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=f&&o.x<b&&o.y>=_&&o.y<E}}class sn{constructor(o,c,f){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ne={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ge{constructor(o,c,f,_){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let f=0;f<this.attributes.length;f++){const _=c.attributes[this.attributes[f].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,c,f){for(let _=0;_<this.attributes.length;_++){const b=this.attributes[_],E=c.attributes[b.name];E!==void 0&&o.vertexAttribPointer(E,b.components,o[ne[b.type]],!1,this.itemSize,b.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ze{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class We extends ze{getDefault(){return s.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ot extends ze{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class ft extends ze{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Tt extends ze{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ht extends ze{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class yt extends ze{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class at extends ze{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class zt extends ze{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class It extends ze{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class $t extends ze{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Kt extends ze{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class cn extends ze{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Pn extends ze{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class Ln extends ze{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ai extends ze{getDefault(){return s.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Fi extends ze{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Mi extends ze{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class No extends ze{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ar extends ze{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class no extends ze{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ri extends ze{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ui extends ze{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class mo extends ze{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class fs extends ze{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Za extends ze{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class ms extends ze{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Wr extends ze{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class gs extends ze{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class ic extends ze{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class rc extends ze{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Gs extends ze{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class _s extends ze{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Sr extends _s{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class $o extends _s{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class oc extends $o{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ys{constructor(o,c,f,_){this.context=o,this.width=c,this.height=f;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Sr(o,b),_&&(this.depthAttachment=new $o(o,b))}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const f=this.depthAttachment.get();f&&o.deleteRenderbuffer(f)}o.deleteFramebuffer(this.framebuffer)}}class J{constructor(o,c=!1){if(this.gl=o,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const f=o;this.extVertexArrayObject={createVertexArrayOES:f.createVertexArray.bind(o),deleteVertexArrayOES:f.deleteVertexArray.bind(o),bindVertexArrayOES:f.bindVertexArray.bind(o)}}this.clearColor=new We(this),this.clearDepth=new ot(this),this.clearStencil=new ft(this),this.colorMask=new Tt(this),this.depthMask=new ht(this),this.stencilMask=new yt(this),this.stencilFunc=new at(this),this.stencilOp=new zt(this),this.stencilTest=new It(this),this.depthRange=new $t(this),this.depthTest=new Kt(this),this.depthFunc=new cn(this),this.blend=new Pn(this),this.blendFunc=new Ln(this),this.blendColor=new ai(this),this.blendEquation=new Fi(this),this.cullFace=new Mi(this),this.cullFaceSide=new No(this),this.frontFace=new ar(this),this.program=new no(this),this.activeTexture=new Ri(this),this.viewport=new Ui(this),this.bindFramebuffer=new mo(this),this.bindRenderbuffer=new fs(this),this.bindTexture=new Za(this),this.bindVertexBuffer=new ms(this),this.bindElementBuffer=new Wr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gs(this),this.pixelStoreUnpack=new ic(this),this.pixelStoreUnpackPremultiplyAlpha=new rc(this),this.pixelStoreUnpackFlipY=new Gs(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=o.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&o.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new sn(this,o,c)}createVertexBuffer(o,c,f){return new ge(this,o,c,f)}createRenderbuffer(o,c,f){const _=this.gl,b=_.createRenderbuffer();return this.bindRenderbuffer.set(b),_.renderbufferStorage(_.RENDERBUFFER,o,c,f),this.bindRenderbuffer.set(null),b}createFramebuffer(o,c,f){return new ys(this,o,c,f)}clear({color:o,depth:c,stencil:f}){const _=this.gl;let b=0;o&&(b|=_.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(b|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),_.clear(b)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){S(o.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class F extends s.Evented{constructor(o,c,f,_){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(c,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=gn(this._options,this.map._requestManager,c,f,(_,b)=>{this._tileJSONRequest=null,this._loaded=!0,_?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.ErrorEvent(_))):b&&(s.extend(this,b),b.bounds&&(this.tileBounds=new En(b.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(o,c){const f=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(f,s.ResourceType.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",_,b.bind(this));else if(o.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",_,b.bind(this),void 0,!0);else{const E=s.loadVectorTile.call({deduped:this._deduped},_,(k,I)=>{k||!I?b.call(this,k):(_.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},o.actor&&o.actor.send("loadTile",_,b.bind(this),void 0,!0))},!0);o.request={cancel:E}}function b(E,k){return delete o.request,o.aborted?c(null):E&&E.status!==404?c(E):(k&&k.resourceTiming&&(o.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&o.setExpiryData(k),o.loadVectorData(k,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id})}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $ extends s.Evented{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},c),s.extend(this,s.pick(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=gn(this._options,this.map._requestManager,null,null,(c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.ErrorEvent(c)):f&&(s.extend(this,f),f.bounds&&(this.tileBounds=new En(f.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(f.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(c)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const f=s.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);o.request=s.getImage(this.map._requestManager.transformRequest(_,s.ResourceType.Tile),(b,E,k,I)=>(delete o.request,o.aborted?(o.state="unloaded",c(null)):b?(o.state="errored",c(b)):E?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:k,expires:I}),o.setTexture(E,this.map.painter),o.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(o,c,f){o.setTexture(c,f)}static unloadTileData(o,c){o.texture&&c.saveTileTexture(o.texture)}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Y;function re(d,o,c,f,_,b,E,k){const I=[d,c,_,o,f,b,1,1,1],P=[E,k,1],L=s.adjoint([],I),[j,V,W]=s.transformMat3(P,P,s.transpose(L,L));return s.multiply$1(I,[j,0,0,0,V,0,0,0,W],I)}class he extends s.Evented{constructor(o,c,f,_){super(),this.id=o,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=c,this._dirty=!1}load(o,c){this._loaded=c||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(f,_)=>{if(this._imageRequest=null,this._loaded=!0,f)this.fire(new s.ErrorEvent(f));else if(_){const{HTMLImageElement:b}=s.window;this.image=_ instanceof b?s.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const c=o.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(f){let _=1/0,b=1/0,E=-1/0,k=-1/0;for(const j of f)_=Math.min(_,j.x),b=Math.min(b,j.y),E=Math.max(E,j.x),k=Math.max(k,j.y);const I=Math.max(E-_,k-b),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,P);return new s.CanonicalTileID(P,Math.floor((_+E)/2*L),Math.floor((b+k)/2*L))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const I in this.tiles){const P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const c=s.tileTransform(this.tileID,this.map.transform.projection),[f,_,b,E]=this.coordinates.map(I=>{const P=c.projection.project(I[0],I[1]);return s.getTilePoint(c,P)._round()});this.perspectiveTransform=function(I,P,L,j,V,W,q,H,X,U){const te=re(0,0,I,0,0,P,I,P),Q=re(L,j,V,W,q,H,X,U);return s.multiply$1(Q,s.adjoint(te,te),Q),[Q[6]/Q[8]*I/s.EXTENT,Q[7]/Q[8]*P/s.EXTENT]}(this.width,this.height,f.x,f.y,_.x,_.y,E.x,E.y,b.x,b.y);const k=this._boundsArray=new s.StructArrayLayout4i8;k.emplaceBack(f.x,f.y,0,0),k.emplaceBack(_.x,_.y,s.EXTENT,0),k.emplaceBack(E.x,E.y,0,s.EXTENT),k.emplaceBack(b.x,b.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(k,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,c=o.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(o)}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const we={vector:F,raster:$,"raster-dem":class extends ${constructor(d,o,c,f){super(d,o,c,f),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(d,o){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,b){_&&(d.state="errored",o(_)),b&&(d.dem=b,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",o(null))}d.request=s.getImage(this.map._requestManager.transformRequest(c,s.ResourceType.Tile),function(_,b,E,k){if(delete d.request,d.aborted)d.state="unloaded",o(null);else if(_)d.state="errored",o(_);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:E,expires:k});const I=s.window.ImageBitmap&&b instanceof s.window.ImageBitmap&&(Y==null&&(Y=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Y),P=1-(b.width-s.prevPowerOfTwo(b.width))/2;P<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=I?b:s.exported.getImageData(b,P),j={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:P};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",j,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const o=d.canonical,c=Math.pow(2,o.z),f=(o.x-1+c)%c,_=o.x===0?d.wrap-1:d.wrap,b=(o.x+1+c)%c,E=o.x+1===c?d.wrap+1:d.wrap,k={};return k[new s.OverscaledTileID(d.overscaledZ,_,o.z,f,o.y).key]={backfilled:!1},k[new s.OverscaledTileID(d.overscaledZ,E,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(k[new s.OverscaledTileID(d.overscaledZ,_,o.z,f,o.y-1).key]={backfilled:!1},k[new s.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new s.OverscaledTileID(d.overscaledZ,E,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<c&&(k[new s.OverscaledTileID(d.overscaledZ,_,o.z,f,o.y+1).key]={backfilled:!1},k[new s.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new s.OverscaledTileID(d.overscaledZ,E,o.z,b,o.y+1).key]={backfilled:!1}),k}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends s.Evented{constructor(d,o,c,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=o.data,this._options=s.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},o),this}getClusterChildren(d,o){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},o),this}getClusterLeaves(d,o,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:o,offset:c},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=s.extend({},this.workerOptions),o=this._data;typeof o=="string"?(d.request=this.map._requestManager.transformRequest(s.exported.resolveURL(o),s.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.ErrorEvent(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(_.resourceTiming=f.resourceTiming[this.id]),this.fire(new s.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,o){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,_)=>(delete d.request,d.unloadVectorData(),d.aborted?o(null):f?o(f):(d.loadVectorData(_,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends he{constructor(d,o,c,f){super(d,o,c,f),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const o of d.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.ResourceType.Source).url);s.getVideo(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new s.ErrorEvent(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const o=this.video.seekable;d<o.start(0)||d>o.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,o=d.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(d,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:he,canvas:class extends he{constructor(d,o,c,f){super(d,o,c,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(b=>typeof b!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.Evented{constructor(d,o,c,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new En(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:o,y:c,z:f}=d.canonical;return this._implementation.hasTile({x:o,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,o){const{x:c,y:f,z:_}=d.tileID.canonical,b=new s.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:_},{signal:b.signal})).then(function(E){return delete d.request,d.aborted?(d.state="unloaded",o(null)):E===void 0?(d.state="errored",o(null)):E===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",o(null)):function(k){return k instanceof s.window.ImageData||k instanceof s.window.HTMLCanvasElement||k instanceof s.window.ImageBitmap||k instanceof s.window.HTMLImageElement}(E)?(this.loadTileData(d,E),d.state="loaded",void o(null)):(d.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(E=>{E.code!==20&&(d.state="errored",o(E))}),d.request.cancel=()=>b.abort()}loadTileData(d,o){$.loadTileData(d,o,this._map.painter)}unloadTileData(d){$.unloadTileData(d,this._map.painter)}unloadTile(d,o){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:c,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:_})}o()}abortTile(d,o){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},be=function(d,o,c,f){const _=new we[o.type](d,o,c,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],_),_};function pe(d,o){const c=s.identity([]);return s.scale(c,c,[.5*d.width,.5*-d.height,1]),s.translate(c,c,[1,-1,0]),s.multiply(c,c,d.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(c)}function ke(d,o,c,f,_,b,E,k=!1){const I=d.tilesIn(f,E,k);I.sort(gt);const P=[];for(const j of I)P.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(o,c,d._state,j,_,b,pe(d.transform,j.tile.tileID),k)});const L=function(j){const V={},W={};for(const q of j){const H=q.queryResults,X=q.wrappedTileID,U=W[X]=W[X]||{};for(const te in H){const Q=H[te],ie=U[te]=U[te]||{},ue=V[te]=V[te]||[];for(const le of Q)ie[le.featureIndex]||(ie[le.featureIndex]=!0,ue.push(le))}}return V}(P);for(const j in L)L[j].forEach(V=>{const W=V.feature,q=W.layer;q&&q.type!=="background"&&q.type!=="sky"&&(W.source=q.source,q["source-layer"]&&(W.sourceLayer=q["source-layer"]),W.state=W.id!==void 0?d.getFeatureState(q["source-layer"],W.id):{})});return L}function Ke(d,o){const c=d.getRenderableIds().map(b=>d.getTileByID(b)),f=[],_={};for(let b=0;b<c.length;b++){const E=c[b],k=E.tileID.canonical.key;_[k]||(_[k]=!0,E.querySourceFeatures(f,o))}return f}function gt(d,o){const c=d.tileID,f=o.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function nt(){return xl.workerClass!=null?new xl.workerClass:new s.window.Worker(xl.workerUrl)}const jt="mapboxgl_preloaded_worker_pool";class Rt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Rt.workerCount;)this.workers.push(new nt);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}let Lt;function Wt(){return Lt||(Lt=new Rt),Lt}function nn(d,o){const c={};for(const f in d)f!=="ref"&&(c[f]=d[f]);return s.refProperties.forEach(f=>{f in o&&(c[f]=o[f])}),c}function zn(d){d=d.slice();const o=Object.create(null);for(let c=0;c<d.length;c++)o[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=nn(d[c],o[d[c].ref]));return d}Rt.workerCount=2;const Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Un(d,o,c){c.push({command:Ut.addSource,args:[d,o[d]]})}function Vn(d,o,c){o.push({command:Ut.removeSource,args:[d]}),c[d]=!0}function Uo(d,o,c,f){Vn(d,c,f),Un(d,o,c)}function go(d,o,c){let f;for(f in d[c])if(d[c].hasOwnProperty(f)&&f!=="data"&&!S(d[c][f],o[c][f]))return!1;for(f in o[c])if(o[c].hasOwnProperty(f)&&f!=="data"&&!S(d[c][f],o[c][f]))return!1;return!0}function je(d,o,c,f,_,b){let E;for(E in o=o||{},d=d||{})d.hasOwnProperty(E)&&(S(d[E],o[E])||c.push({command:b,args:[f,E,o[E],_]}));for(E in o)o.hasOwnProperty(E)&&!d.hasOwnProperty(E)&&(S(d[E],o[E])||c.push({command:b,args:[f,E,o[E],_]}))}function _o(d){return d.id}function wi(d,o){return d[o.id]=o,d}class Vo{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.clamp(o,0,1);let c=1,f=this._distances[c];const _=o*this.paddedLength+this.padding;for(;f<_&&c<this._distances.length;)f=this._distances[++c];const b=c-1,E=this._distances[b],k=f-E,I=k>0?(_-E)/k:0;return this.points[b].mult(1-I).add(this.points[c].mult(I))}}class qd{constructor(o,c,f){const _=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(c/f);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,f,_,b){this._forEachCell(c,f,_,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(b)}insertCircle(o,c,f,_){this._forEachCell(c-_,f-_,c+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(f),this.circles.push(_)}_insertBoxCell(o,c,f,_,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,c,f,_,b,E){this.circleCells[b].push(E)}_query(o,c,f,_,b,E){if(f<0||o>this.width||_<0||c>this.height)return!b&&[];const k=[];if(o<=0&&c<=0&&this.width<=f&&this.height<=_){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)k.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const P=this.circles[3*I],L=this.circles[3*I+1],j=this.circles[3*I+2];k.push({key:this.circleKeys[I],x1:P-j,y1:L-j,x2:P+j,y2:L+j})}return E?k.filter(E):k}return this._forEachCell(o,c,f,_,this._queryCell,k,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?k.length>0:k}_queryCircle(o,c,f,_,b){const E=o-f,k=o+f,I=c-f,P=c+f;if(k<0||E>this.width||P<0||I>this.height)return!_&&[];const L=[];return this._forEachCell(E,I,k,P,this._queryCellCircle,L,{hitTest:_,circle:{x:o,y:c,radius:f},seenUids:{box:{},circle:{}}},b),_?L.length>0:L}query(o,c,f,_,b){return this._query(o,c,f,_,!1,b)}hitTest(o,c,f,_,b){return this._query(o,c,f,_,!0,b)}hitTestCircle(o,c,f,_){return this._queryCircle(o,c,f,!0,_)}_queryCell(o,c,f,_,b,E,k,I){const P=k.seenUids,L=this.boxCells[b];if(L!==null){const V=this.bboxes;for(const W of L)if(!P.box[W]){P.box[W]=!0;const q=4*W;if(o<=V[q+2]&&c<=V[q+3]&&f>=V[q+0]&&_>=V[q+1]&&(!I||I(this.boxKeys[W]))){if(k.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[W],x1:V[q],y1:V[q+1],x2:V[q+2],y2:V[q+3]})}}}const j=this.circleCells[b];if(j!==null){const V=this.circles;for(const W of j)if(!P.circle[W]){P.circle[W]=!0;const q=3*W;if(this._circleAndRectCollide(V[q],V[q+1],V[q+2],o,c,f,_)&&(!I||I(this.circleKeys[W]))){if(k.hitTest)return E.push(!0),!0;{const H=V[q],X=V[q+1],U=V[q+2];E.push({key:this.circleKeys[W],x1:H-U,y1:X-U,x2:H+U,y2:X+U})}}}}}_queryCellCircle(o,c,f,_,b,E,k,I){const P=k.circle,L=k.seenUids,j=this.boxCells[b];if(j!==null){const W=this.bboxes;for(const q of j)if(!L.box[q]){L.box[q]=!0;const H=4*q;if(this._circleAndRectCollide(P.x,P.y,P.radius,W[H+0],W[H+1],W[H+2],W[H+3])&&(!I||I(this.boxKeys[q])))return E.push(!0),!0}}const V=this.circleCells[b];if(V!==null){const W=this.circles;for(const q of V)if(!L.circle[q]){L.circle[q]=!0;const H=3*q;if(this._circlesCollide(W[H],W[H+1],W[H+2],P.x,P.y,P.radius)&&(!I||I(this.circleKeys[q])))return E.push(!0),!0}}}_forEachCell(o,c,f,_,b,E,k,I){const P=this._convertToXCellCoord(o),L=this._convertToYCellCoord(c),j=this._convertToXCellCoord(f),V=this._convertToYCellCoord(_);for(let W=P;W<=j;W++)for(let q=L;q<=V;q++)if(b.call(this,o,c,f,_,this.xCellCount*q+W,E,k,I))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,f,_,b,E){const k=_-o,I=b-c,P=f+E;return P*P>k*k+I*I}_circleAndRectCollide(o,c,f,_,b,E,k){const I=(E-_)/2,P=Math.abs(o-(_+I));if(P>I+f)return!1;const L=(k-b)/2,j=Math.abs(c-(b+L));if(j>L+f)return!1;if(P<=I||j<=L)return!0;const V=P-I,W=j-L;return V*V+W*W<=f*f}}const io=Math.tan(85*Math.PI/180);function Zs(d,o,c,f,_,b,E){const k=s.create();if(c)if(b.name==="globe"){const I=s.calculateGlobeLabelMatrix(_,o);s.multiply(k,k,I)}else{const I=Ye([],E);k[0]=I[0],k[1]=I[1],k[4]=I[2],k[5]=I[3],f||s.rotateZ(k,k,_.angle)}else s.multiply(k,_.labelPlaneMatrix,d);return k}function Wd(d,o,c,f,_,b,E){const k=Zs(d,o,c,f,_,b,E);return b.name==="globe"&&c||(k[2]=k[6]=k[10]=k[14]=0),k}function qs(d,o,c,f,_,b,E){if(c){if(b.name==="globe"){const k=Zs(d,o,c,f,_,b,E);return s.invert(k,k),s.multiply(k,d,k),k}{const k=s.clone(d),I=s.identity([]);return I[0]=E[0],I[1]=E[1],I[4]=E[2],I[5]=E[3],s.multiply(k,k,I),f||s.rotateZ(k,k,-_.angle),k}}return _.glCoordMatrix}function lt(d,o,c,f){const _=[d,o,c,1];c?s.transformMat4$1(_,_,f):Hd(_,_,f);const b=_[3];return _[0]/=b,_[1]/=b,_[2]/=b,_}function _n(d,o){return Math.min(.5+d/o*.5,1.5)}function un(d,o){const c=d[0]/d[3],f=d[1]/d[3];return c>=-o[0]&&c<=o[0]&&f>=-o[1]&&f<=o[1]}function ro(d,o,c,f,_,b,E,k,I,P){const L=c.transform,j=f?d.textSizeData:d.iconSizeData,V=s.evaluateSizeForZoom(j,c.transform.zoom),W=L.projection.name==="globe",q=[256/c.width*2+1,256/c.height*2+1],H=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;H.clear();let X=null;W&&(X=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const U=d.lineVertexArray,te=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,Q=c.transform.width/c.transform.height;let ie,ue=!1;for(let le=0;le<te.length;le++){const de=te.get(le),{numGlyphs:xe,writingMode:Ae}=de;if(Ae!==s.WritingMode.vertical||ue||ie===s.WritingMode.horizontal||(ue=!0),ie=Ae,(de.hidden||Ae===s.WritingMode.vertical)&&!ue){Jn(xe,H);continue}ue=!1;const Le=new s.pointGeometry(de.tileAnchorX,de.tileAnchorY);let{x:st,y:Ee,z:Ve}=L.projection.projectTilePoint(Le.x,Le.y,P.canonical);if(I){const[Qt,kt,vt]=I(Le);st+=Qt,Ee+=kt,Ve+=vt}const Oe=[st,Ee,Ve,1];if(s.transformMat4$1(Oe,Oe,o),!un(Oe,q)){Jn(xe,H);continue}const Je=_n(c.transform.cameraToCenterDistance,Oe[3]),Ce=s.evaluateSizeForFeature(j,V,de),ye=E?Ce/Je:Ce*Je,Re=lt(st,Ee,Ve,_);if(Re[3]<=0){Jn(xe,H);continue}let He={};const tt=E?null:I,Ct=qa(de,ye,!1,k,o,_,b,d.glyphOffsetArray,U,H,X,Re,Le,He,Q,tt,L.projection,P,E);ue=Ct.useVertical,tt&&Ct.needsFlipping&&(He={}),(Ct.notEnoughRoom||ue||Ct.needsFlipping&&qa(de,ye,!0,k,o,_,b,d.glyphOffsetArray,U,H,X,Re,Le,He,Q,tt,L.projection,P,E).notEnoughRoom)&&Jn(xe,H)}f?(d.text.dynamicLayoutVertexBuffer.updateData(H),X&&d.text.globeExtVertexBuffer.updateData(X)):(d.icon.dynamicLayoutVertexBuffer.updateData(H),X&&d.icon.globeExtVertexBuffer.updateData(X))}function vs(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q,H){const{lineStartIndex:X,glyphStartIndex:U,segment:te}=k,Q=U+k.numGlyphs,ie=X+k.lineLength,ue=o.getoffsetX(U),le=o.getoffsetX(Q-1),de=rr(d*ue,c,f,_,b,E,te,X,ie,I,P,L,j,V,!0,W,q,H);if(!de)return null;const xe=rr(d*le,c,f,_,b,E,te,X,ie,I,P,L,j,V,!0,W,q,H);return xe?{first:de,last:xe}:null}function an(d,o,c,f){return d===s.WritingMode.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:d===s.WritingMode.vertical?f>0?{needsFlipping:!0}:null:o!==0&&function(_,b){return _===0||Math.abs(b/_)>io}(c,f)?o===1?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function qa(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q,H,X,U,te){const Q=o/24,ie=d.lineOffsetX*Q,ue=d.lineOffsetY*Q,{lineStartIndex:le,glyphStartIndex:de,numGlyphs:xe,segment:Ae,writingMode:Le,flipState:st}=d,Ee=le+d.lineLength,Ve=Oe=>{if(L){const[Re,He,tt]=Oe.up,Ct=P.length;s.updateGlobeVertexNormal(L,Ct+0,Re,He,tt),s.updateGlobeVertexNormal(L,Ct+1,Re,He,tt),s.updateGlobeVertexNormal(L,Ct+2,Re,He,tt),s.updateGlobeVertexNormal(L,Ct+3,Re,He,tt)}const[Je,Ce,ye]=Oe.point;s.addDynamicAttributes(P,Je,Ce,ye,Oe.angle)};if(xe>1){const Oe=vs(Q,k,ie,ue,c,j,V,d,I,b,W,H,!1,X,U,te);if(!Oe)return{notEnoughRoom:!0};if(f&&!c){let[Je,Ce,ye]=Oe.first.point,[Re,He,tt]=Oe.last.point;[Je,Ce]=lt(Je,Ce,ye,E),[Re,He]=lt(Re,He,tt,E);const Ct=an(Le,st,(Re-Je)*q,He-Ce);if(d.flipState=Ct&&Ct.needsFlipping?1:2,Ct)return Ct}Ve(Oe.first);for(let Je=de+1;Je<de+xe-1;Je++){const Ce=rr(Q*k.getoffsetX(Je),ie,ue,c,j,V,Ae,le,Ee,I,b,W,H,!1,!1,X,U,te);if(!Ce)return P.length-=4*(Je-de),{notEnoughRoom:!0};Ve(Ce)}Ve(Oe.last)}else{if(f&&!c){const Je=lt(V.x,V.y,0,_),Ce=le+Ae+1,ye=new s.pointGeometry(I.getx(Ce),I.gety(Ce)),Re=lt(ye.x,ye.y,0,_),He=Re[3]>0?Re:Hs(V,ye,Je,1,_,void 0,X,U.canonical),tt=an(Le,st,(He[0]-Je[0])*q,He[1]-Je[1]);if(d.flipState=tt&&tt.needsFlipping?1:2,tt)return tt}const Oe=rr(Q*k.getoffsetX(de),ie,ue,c,j,V,Ae,le,Ee,I,b,W,H,!1,!1,X,U,te);if(!Oe)return{notEnoughRoom:!0};Ve(Oe)}return{}}function Ws(d,o,c,f,_){const{x:b,y:E,z:k}=f.projectTilePoint(d.x,d.y,o);if(!_)return lt(b,E,k,c);const[I,P,L]=_(d);return lt(b+I,E+P,k+L,c)}function Hs(d,o,c,f,_,b,E,k){const I=Ws(d.sub(o)._unit()._add(d),k,_,E,b);return s.sub(I,c,I),s.normalize(I,I),s.scaleAndAdd(I,c,I,f)}function rr(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q,H,X,U){const te=f?d-o:d+o;let Q=te>0?1:-1,ie=0;f&&(Q*=-1,ie=Math.PI),Q<0&&(ie+=Math.PI);let ue=k+E+(Q>0?0:1)|0,le=_,de=_,xe=0,Ae=0;const Le=Math.abs(te),st=[],Ee=[];let Ve=b,Oe=Ve;const Je=()=>Hs(Oe,Ve,de,Le-xe+1,L,V,H,X.canonical);for(;xe+Ae<=Le;){if(ue+=Q,ue<k||ue>=I)return null;if(de=le,Oe=Ve,st.push(de),W&&Ee.push(Oe),Ve=new s.pointGeometry(P.getx(ue),P.gety(ue)),le=j[ue],!le){const vt=Ws(Ve,X.canonical,L,H,V);le=vt[3]>0?j[ue]=vt:Je()}xe+=Ae,Ae=s.distance(de,le)}q&&V&&(j[ue]&&(le=Je(),Ae=s.distance(de,le)),j[ue]=le);const Ce=(Le-xe)/Ae,ye=Ve.sub(Oe)._mult(Ce)._add(Oe),Re=s.sub([],le,de),He=s.scaleAndAdd([],de,Re,Ce);let tt=[0,0,1],Ct=Re[0],Qt=Re[1];if(U&&(tt=H.upVector(X.canonical,ye.x,ye.y),tt[0]!==0||tt[1]!==0||tt[2]!==1)){const vt=[tt[2],0,-tt[0]],Mt=s.cross([],tt,vt);s.normalize(vt,vt),s.normalize(Mt,Mt),Ct=s.dot(Re,vt),Qt=s.dot(Re,Mt)}if(c){const vt=s.cross([],tt,Re);s.normalize(vt,vt),s.scaleAndAdd(He,He,vt,c*Q)}const kt=ie+Math.atan2(Qt,Ct);return st.push(He),W&&Ee.push(ye),{point:He,angle:kt,path:st,tilePath:Ee,up:tt}}function Jn(d,o){const c=o.length,f=c+4*d;o.resize(f),o.float32.fill(-1/0,4*c,4*f)}function Hd(d,o,c){const f=o[0],_=o[1];return d[0]=c[0]*f+c[4]*_+c[12],d[1]=c[1]*f+c[5]*_+c[13],d[3]=c[3]*f+c[7]*_+c[15],d}const lr=100;class ju{constructor(o,c,f=new qd(o.width+200,o.height+200,25),_=new qd(o.width+200,o.height+200,25)){this.transform=o,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+lr,this.screenBottomBoundary=o.height+lr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,f,_,b,E,k,I){let P=f.projectedAnchorX,L=f.projectedAnchorY,j=f.projectedAnchorZ;const V=f.elevation,W=f.tileID,q=o.getProjection();if(V&&W){const[le,de,xe]=q.upVector(W.canonical,f.tileAnchorX,f.tileAnchorY),Ae=q.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=le*V*Ae,L+=de*V*Ae,j+=xe*V*Ae}const H=this.projectAndGetPerspectiveRatio(k,P,L,j,f.tileID,q.name==="globe"||!!V||this.transform.pitch>0,q),X=E*H.perspectiveRatio,U=(f.x1*c+_.x-f.padding)*X+H.point.x,te=(f.y1*c+_.y-f.padding)*X+H.point.y,Q=(f.x2*c+_.x+f.padding)*X+H.point.x,ie=(f.y2*c+_.y+f.padding)*X+H.point.y,ue=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(U,te,Q,ie)||!b&&this.grid.hitTest(U,te,Q,ie,I)||ue?{box:[],offscreen:!1,occluded:H.occluded}:{box:[U,te,Q,ie],offscreen:this.isOffscreen(U,te,Q,ie),occluded:!1}}placeCollisionCircles(o,c,f,_,b,E,k,I,P,L,j,V,W,q,H){const X=[],U=this.transform.elevation,te=o.getProjection(),Q=U?U.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,te):null,ie=new s.pointGeometry(f.tileAnchorX,f.tileAnchorY);let{x:ue,y:le,z:de}=te.projectTilePoint(ie.x,ie.y,H.canonical);if(Q){const[ye,Re,He]=Q(ie);ue+=ye,le+=Re,de+=He}const xe=te.name==="globe",Ae=this.projectAndGetPerspectiveRatio(k,ue,le,de,H,xe||!!U||this.transform.pitch>0,te),{perspectiveRatio:Le}=Ae,st=(j?E/Le:E*Le)/s.ONE_EM,Ee=lt(ue,le,de,I),Ve=Ae.signedDistanceFromCamera>0?vs(st,b,f.lineOffsetX*st,f.lineOffsetY*st,!1,Ee,ie,f,_,I,{},U&&!j?Q:null,j&&!!U,te,H,j):null;let Oe=!1,Je=!1,Ce=!0;if(Ve&&!Ae.occluded){const ye=.5*W*Le+q,Re=new s.pointGeometry(-100,-100),He=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),tt=new Vo,{first:Ct,last:Qt}=Ve,kt=Ct.path.length;let vt=[];for(let Dt=kt-1;Dt>=1;Dt--)vt.push(Ct.path[Dt]);for(let Dt=1;Dt<Qt.path.length;Dt++)vt.push(Qt.path[Dt]);const Mt=2.5*ye;P&&(vt=vt.map(([Dt,Dn,Gn],Qn)=>(Q&&!xe&&(Gn=Q(Qn<kt-1?Ct.tilePath[kt-1-Qn]:Qt.tilePath[Qn-kt+2])[2]),lt(Dt,Dn,Gn,P))),vt.some(Dt=>Dt[3]<=0)&&(vt=[]));let hn=[];if(vt.length>0){let Dt=1/0,Dn=-1/0,Gn=1/0,Qn=-1/0;for(const Xn of vt)Dt=Math.min(Dt,Xn[0]),Gn=Math.min(Gn,Xn[1]),Dn=Math.max(Dn,Xn[0]),Qn=Math.max(Qn,Xn[1]);Dn>=Re.x&&Dt<=He.x&&Qn>=Re.y&&Gn<=He.y&&(hn=[vt.map(Xn=>new s.pointGeometry(Xn[0],Xn[1]))],(Dt<Re.x||Dn>He.x||Gn<Re.y||Qn>He.y)&&(hn=s.clipLine(hn,Re.x,Re.y,He.x,He.y)))}for(const Dt of hn){tt.reset(Dt,.25*ye);let Dn=0;Dn=tt.length<=.5*ye?1:Math.ceil(tt.paddedLength/Mt)+1;for(let Gn=0;Gn<Dn;Gn++){const Qn=Gn/Math.max(Dn-1,1),Xn=tt.lerp(Qn),Ti=Xn.x+lr,hr=Xn.y+lr;X.push(Ti,hr,ye,0);const Hr=Ti-ye,xo=hr-ye,li=Ti+ye,Kn=hr+ye;if(Ce=Ce&&this.isOffscreen(Hr,xo,li,Kn),Je=Je||this.isInsideGrid(Hr,xo,li,Kn),!c&&this.grid.hitTestCircle(Ti,hr,ye,V)&&(Oe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!L&&Oe||!Je?[]:X,offscreen:Ce,collisionDetected:Oe,occluded:Ae.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let f=1/0,_=1/0,b=-1/0,E=-1/0;for(const L of o){const j=new s.pointGeometry(L.x+lr,L.y+lr);f=Math.min(f,j.x),_=Math.min(_,j.y),b=Math.max(b,j.x),E=Math.max(E,j.y),c.push(j)}const k=this.grid.query(f,_,b,E).concat(this.ignoredGrid.query(f,_,b,E)),I={},P={};for(const L of k){const j=L.key;if(I[j.bucketInstanceId]===void 0&&(I[j.bucketInstanceId]={}),I[j.bucketInstanceId][j.featureIndex])continue;const V=[new s.pointGeometry(L.x1,L.y1),new s.pointGeometry(L.x2,L.y1),new s.pointGeometry(L.x2,L.y2),new s.pointGeometry(L.x1,L.y2)];s.polygonIntersectsPolygon(c,V)&&(I[j.bucketInstanceId][j.featureIndex]=!0,P[j.bucketInstanceId]===void 0&&(P[j.bucketInstanceId]=[]),P[j.bucketInstanceId].push(j.featureIndex))}return P}insertCollisionBox(o,c,f,_,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,f,_,b){const E=c?this.ignoredGrid:this.grid,k={bucketInstanceId:f,featureIndex:_,collisionGroupID:b};for(let I=0;I<o.length;I+=4)E.insertCircle(k,o[I],o[I+1],o[I+2])}projectAndGetPerspectiveRatio(o,c,f,_,b,E,k){const I=[c,f,_,1];let P=!1;if(_||this.transform.pitch>0){s.transformMat4$1(I,I,o);const j=k.name==="globe";this.fogState&&b&&!j&&(P=function(W,q,H,X,U,te){const Q=te.calculateFogTileMatrix(U),ie=[q,H,X];return s.transformMat4(ie,ie,Q),Ft(W,ie,te.pitch,te._fov)}(this.fogState,c,f,_,b.toUnwrapped(),this.transform)>.9)}else Hd(I,I,o);const L=I[3];return{point:new s.pointGeometry((I[0]/L+1)/2*this.transform.width+lr,(-I[1]/L+1)/2*this.transform.height+lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/L*.5,1.5),signedDistanceFromCamera:L,occluded:E&&I[2]>L||P}}isOffscreen(o,c,f,_){return f<lr||o>=this.screenRightBoundary||_<lr||c>this.screenBottomBoundary}isInsideGrid(o,c,f,_){return f>=0&&o<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=s.identity([]);return s.translate(o,o,[-100,-100,0]),o}}function bs(d,o,c){const f=o.createTileMatrix(d,d.worldSize,c.toUnwrapped());return s.multiply(new Float32Array(16),d.projMatrix,f)}function Nu(d,o,c){if(o.projection.name===c.projection.name)return d.projMatrix;const f=c.clone();return f.setProjection(o.projection),bs(f,o.getProjection(),d)}function sc(d,o,c){return o.name===c.projection.name?d.projMatrix:bs(c,o,d)}class Wa{constructor(o,c,f,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class xs{constructor(o,c,f,_,b,E=!1){this.text=new Wa(o?o.text:null,c,f,b),this.icon=new Wa(o?o.icon:null,c,_,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xs{constructor(o,c,f,_=!1){this.text=o,this.icon=c,this.skipFade=f,this.clipped=_}}class $u{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class cr{constructor(o,c,f,_,b){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=b}}class yi{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[o]}}function ac(d,o,c,f,_){const{horizontalAlign:b,verticalAlign:E}=s.getAnchorAlignment(d),k=-(b-.5)*o,I=-(E-.5)*c,P=s.evaluateVariableOffset(d,f);return new s.pointGeometry(k+P[0]*_,I+P[1]*_)}function Ha(d,o,c,f,_){const b=new s.pointGeometry(d,o);return c&&b._rotate(f?_:-_),b}class ur{constructor(o,c,f,_,b){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new ju(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new yi(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,f,_){const b=f.getBucket(c),E=f.latestFeatureIndex;if(!b||!E||c.id!==b.layerIds[0])return;const k=b.layers[0].layout,I=f.collisionBoxArray,P=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/s.EXTENT,j=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);const V=(W=f.tileID,q=b.getProjection(),H=this.transform,q.name===this.projection?H.calculateProjMatrix(W.toUnwrapped()):bs(H,q,W));var W,q,H;const X=k.get("text-pitch-alignment")==="map",U=k.get("text-rotation-alignment")==="map";c.compileFilter();const te=c.dynamicFilter(),Q=c.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(f),ue=Wd(V,f.tileID.canonical,X,U,this.transform,b.getProjection(),ie);let le=null;if(X){const Ae=qs(V,f.tileID.canonical,X,U,this.transform,b.getProjection(),ie);le=s.multiply([],this.transform.labelPlaneMatrix,Ae)}let de=null;te&&f.latestFeatureIndex&&(de={unwrappedTileID:j,dynamicFilter:te,dynamicFilterNeedsFeature:Q,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new cr(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,f.tileID);const xe={bucket:b,layout:k,posMatrix:V,textLabelPlaneMatrix:ue,labelToScreenMatrix:le,clippingData:de,scale:P,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(_)for(const Ae of b.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:st,symbolInstanceEnd:Ee}=Ae;o.push({sortKey:Le,symbolInstanceStart:st,symbolInstanceEnd:Ee,parameters:xe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(o,c,f,_,b,E,k,I,P,L,j,V,W,q,H,X,U,te){const{textOffset0:Q,textOffset1:ie,crossTileID:ue}=V,le=[Q,ie],de=ac(o,f,_,le,b),xe=this.collisionIndex.placeCollisionBox(q,b,c,Ha(de.x,de.y,E,k,this.transform.angle),j,I,P,L.predicate);if(X){const Ae=q.getSymbolInstanceIconSize(te,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Ae,X,Ha(de.x,de.y,E,k,this.transform.angle),j,I,P,L.predicate).box.length===0)return}if(xe.box.length>0){let Ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(Ae=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:le,width:f,height:_,anchor:o,textScale:b,prevAnchor:Ae},this.markUsedJustification(q,o,V,H),q.allowVerticalPlacement&&(this.markUsedOrientation(q,H,V),this.placedOrientations[ue]=H),{shift:de,placedGlyphBoxes:xe}}}placeLayerBucketPart(o,c,f,_){const{bucket:b,layout:E,posMatrix:k,textLabelPlaneMatrix:I,labelToScreenMatrix:P,clippingData:L,textPixelRatio:j,holdingForFade:V,collisionBoxArray:W,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:H,collisionGroup:X}=o.parameters,U=E.get("text-optional"),te=E.get("icon-optional"),Q=E.get("text-allow-overlap"),ie=E.get("icon-allow-overlap"),ue=E.get("text-rotation-alignment")==="map",le=E.get("text-pitch-alignment")==="map",de=E.get("icon-text-fit")!=="none",xe=E.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ae=Q&&(ie||!b.hasIconData()||te),Le=ie&&(Q||!b.hasTextData()||U);!b.collisionArrays&&W&&b.deserializeCollisionBoxes(W),f&&_&&b.updateCollisionDebugBuffers(this.transform.zoom,W);const st=(Ee,Ve,Oe)=>{const{crossTileID:Je,numVerticalGlyphVertices:Ce}=Ee;if(L){const li={zoom:this.transform.zoom,pitch:this.transform.pitch};let Kn=null;if(L.dynamicFilterNeedsFeature){const An=this.retainedQueryData[b.bucketInstanceId];Kn=L.featureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:An.bucketIndex,sourceLayerIndex:An.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(li,Kn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new s.pointGeometry(Ee.tileAnchorX,Ee.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Je]=new Xs(!1,!1,!1,!0),void(c[Je]=!0)}if(c[Je])return;if(V)return void(this.placements[Je]=new Xs(!1,!1,!1));let ye=!1,Re=!1,He=!0,tt=!1,Ct=!1,Qt=null,kt={box:null,offscreen:null,occluded:null},vt={box:null,offscreen:null,occluded:null},Mt=null,hn=null,Dt=null,Dn=0,Gn=0,Qn=0;Oe.textFeatureIndex?Dn=Oe.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(Dn=Ee.featureIndex),Oe.verticalTextFeatureIndex&&(Gn=Oe.verticalTextFeatureIndex);const Xn=li=>{li.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Kn=this.transform.elevation;(Kn||li.elevation)&&(li.elevation=Kn?Kn.getAtTileOffset(li.tileID,li.tileAnchorX,li.tileAnchorY):0)},Ti=Oe.textBox;if(Ti){Xn(Ti);const li=An=>{let gi=s.WritingMode.horizontal;if(b.allowVerticalPlacement&&!An&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[Je];Xi&&(this.placedOrientations[Je]=Xi,gi=Xi,this.markUsedOrientation(b,gi,Ee))}return gi},Kn=(An,gi)=>{if(b.allowVerticalPlacement&&Ce>0&&Oe.verticalTextBox){for(const Xi of b.writingModes)if(Xi===s.WritingMode.vertical?(kt=gi(),vt=kt):kt=An(),kt&&kt.box&&kt.box.length)break}else kt=An()};if(E.get("text-variable-anchor")){let An=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Je]){const ii=this.prevPlacement.variableOffsets[Je];An.indexOf(ii.anchor)>0&&(An=An.filter(Ki=>Ki!==ii.anchor),An.unshift(ii.anchor))}const gi=(ii,Ki,Yi)=>{const Ho=b.getSymbolInstanceTextSize(q,Ee,this.transform.zoom,Ve),ha=(ii.x2-ii.x1)*Ho+2*ii.padding,Ar=(ii.y2-ii.y1)*Ho+2*ii.padding,Fr=de&&!ie?Ki:null;Fr&&Xn(Fr);let wo={box:[],offscreen:!1,occluded:!1};const Xo=Q?2*An.length:An.length;for(let Ko=0;Ko<Xo;++Ko){const da=this.attemptAnchorPlacement(An[Ko%An.length],ii,ha,Ar,Ho,ue,le,j,k,X,Ko>=An.length,Ee,Ve,b,Yi,Fr,q,H);if(da&&(wo=da.placedGlyphBoxes,wo&&wo.box&&wo.box.length)){ye=!0,Qt=da.shift;break}}return wo};Kn(()=>gi(Ti,Oe.iconBox,s.WritingMode.horizontal),()=>{const ii=Oe.verticalTextBox;return ii&&Xn(ii),b.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&Ce>0&&ii?gi(ii,Oe.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(ye=kt.box,He=kt.offscreen,tt=kt.occluded);const Xi=li(kt&&kt.box);if(!ye&&this.prevPlacement){const ii=this.prevPlacement.variableOffsets[Je];ii&&(this.variableOffsets[Je]=ii,this.markUsedJustification(b,ii.anchor,Ee,Xi))}}else{const An=(gi,Xi)=>{const ii=b.getSymbolInstanceTextSize(q,Ee,this.transform.zoom,Ve),Ki=this.collisionIndex.placeCollisionBox(b,ii,gi,new s.pointGeometry(0,0),Q,j,k,X.predicate);return Ki&&Ki.box&&Ki.box.length&&(this.markUsedOrientation(b,Xi,Ee),this.placedOrientations[Je]=Xi),Ki};Kn(()=>An(Ti,s.WritingMode.horizontal),()=>{const gi=Oe.verticalTextBox;return b.allowVerticalPlacement&&Ce>0&&gi?(Xn(gi),An(gi,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),li(kt&&kt.box&&kt.box.length)}}if(Mt=kt,ye=Mt&&Mt.box&&Mt.box.length>0,He=Mt&&Mt.offscreen,tt=Mt&&Mt.occluded,Ee.useRuntimeCollisionCircles){const li=b.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex>=0?Ee.centerJustifiedTextSymbolIndex:Ee.verticalPlacedTextSymbolIndex),Kn=s.evaluateSizeForFeature(b.textSizeData,q,li),An=E.get("text-padding");hn=this.collisionIndex.placeCollisionCircles(b,Q,li,b.lineVertexArray,b.glyphOffsetArray,Kn,k,I,P,f,le,X.predicate,Ee.collisionCircleDiameter*Kn/s.ONE_EM,An,this.retainedQueryData[b.bucketInstanceId].tileID),ye=Q||hn.circles.length>0&&!hn.collisionDetected,He=He&&hn.offscreen,tt=hn.occluded}if(Oe.iconFeatureIndex&&(Qn=Oe.iconFeatureIndex),Oe.iconBox){const li=Kn=>{Xn(Kn);const An=de&&Qt?Ha(Qt.x,Qt.y,ue,le,this.transform.angle):new s.pointGeometry(0,0),gi=b.getSymbolInstanceIconSize(H,this.transform.zoom,Ee.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,gi,Kn,An,ie,j,k,X.predicate)};vt&&vt.box&&vt.box.length&&Oe.verticalIconBox?(Dt=li(Oe.verticalIconBox),Re=Dt.box.length>0):(Dt=li(Oe.iconBox),Re=Dt.box.length>0),He=He&&Dt.offscreen,Ct=Dt.occluded}const hr=U||Ee.numHorizontalGlyphVertices===0&&Ce===0,Hr=te||Ee.numIconVertices===0;if(hr||Hr?Hr?hr||(Re=Re&&ye):ye=Re&&ye:Re=ye=Re&&ye,ye&&Mt&&Mt.box&&this.collisionIndex.insertCollisionBox(Mt.box,E.get("text-ignore-placement"),b.bucketInstanceId,vt&&vt.box&&Gn?Gn:Dn,X.ID),Re&&Dt&&this.collisionIndex.insertCollisionBox(Dt.box,E.get("icon-ignore-placement"),b.bucketInstanceId,Qn,X.ID),hn&&(ye&&this.collisionIndex.insertCollisionCircles(hn.circles,E.get("text-ignore-placement"),b.bucketInstanceId,Dn,X.ID),f)){const li=b.bucketInstanceId;let Kn=this.collisionCircleArrays[li];Kn===void 0&&(Kn=this.collisionCircleArrays[li]=new $u);for(let An=0;An<hn.circles.length;An+=4)Kn.circles.push(hn.circles[An+0]),Kn.circles.push(hn.circles[An+1]),Kn.circles.push(hn.circles[An+2]),Kn.circles.push(hn.collisionDetected?1:0)}const xo=b.projection.name!=="globe";Ae=Ae&&(xo||!tt),Le=Le&&(xo||!Ct),this.placements[Je]=new Xs(ye||Ae,Re||Le,He||b.justReloaded),c[Je]=!0};if(xe){const Ee=b.getSortedSymbolIndexes(this.transform.angle);for(let Ve=Ee.length-1;Ve>=0;--Ve){const Oe=Ee[Ve];st(b.symbolInstances.get(Oe),Oe,b.collisionArrays[Oe])}}else for(let Ee=o.symbolInstanceStart;Ee<o.symbolInstanceEnd;Ee++)st(b.symbolInstances.get(Ee),Ee,b.collisionArrays[Ee]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[b.bucketInstanceId];s.invert(Ee.invProjMatrix,k),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,c,f,_){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:I,crossTileID:P}=f,L=s.getAnchorJustification(c),j=_===s.WritingMode.vertical?I:L==="left"?b:L==="center"?E:L==="right"?k:-1;b>=0&&(o.text.placedSymbolArray.get(b).crossTileID=j>=0&&b!==j?0:P),E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=j>=0&&E!==j?0:P),k>=0&&(o.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:P),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=j>=0&&I!==j?0:P)}markUsedOrientation(o,c,f){const _=c===s.WritingMode.horizontal||c===s.WritingMode.horizontalOnly?c:0,b=c===s.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P}=f,L=o.text.placedSymbolArray;E>=0&&(L.get(E).placedOrientation=_),k>=0&&(L.get(k).placedOrientation=_),I>=0&&(L.get(I).placedOrientation=_),P>=0&&(L.get(P).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const _=c?c.symbolFadeChange(o):1,b=c?c.opacities:{},E=c?c.variableOffsets:{},k=c?c.placedOrientations:{};for(const I in this.placements){const P=this.placements[I],L=b[I];L?(this.opacities[I]=new xs(L,_,P.text,P.icon,null,P.clipped),f=f||P.text!==L.text.placed||P.icon!==L.icon.placed):(this.opacities[I]=new xs(null,_,P.text,P.icon,P.skipFade,P.clipped),f=f||P.text||P.icon)}for(const I in b){const P=b[I];if(!this.opacities[I]){const L=new xs(P,_,!1,!1);L.isHidden()||(this.opacities[I]=L,f=f||P.text.placed||P.icon.placed)}}for(const I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(const I in k)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=k[I]);f?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const f={};for(const _ of c){const b=_.getBucket(o);b&&_.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,f,_.collisionBoxArray)}}updateBucketOpacities(o,c,f){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),E=new xs(null,0,!1,!1,!0),k=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),P=_.get("text-variable-anchor"),L=_.get("text-rotation-alignment")==="map",j=_.get("text-pitch-alignment")==="map",V=_.get("icon-text-fit")!=="none",W=new xs(null,0,k&&(I||!o.hasIconData()||_.get("icon-optional")),I&&(k||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&f&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(f);const q=(X,U,te)=>{for(let Q=0;Q<U/4;Q++)X.opacityVertexArray.emplaceBack(te)};let H=0;for(let X=0;X<o.symbolInstances.length;X++){const U=o.symbolInstances.get(X),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:Q,crossTileID:ie,numIconVertices:ue}=U;let le=this.opacities[ie];c[ie]?le=E:le||(le=W,this.opacities[ie]=le),c[ie]=!0;const de=te>0||Q>0,xe=ue>0,Ae=this.placedOrientations[ie],Le=Ae===s.WritingMode.vertical,st=Ae===s.WritingMode.horizontal||Ae===s.WritingMode.horizontalOnly;if(!de&&!xe||le.isHidden()||H++,de){const Ee=cc(le.text);q(o.text,te,Le?Ks:Ee),q(o.text,Q,st?Ks:Ee);const Ve=le.text.isHidden(),{leftJustifiedTextSymbolIndex:Oe,centerJustifiedTextSymbolIndex:Je,rightJustifiedTextSymbolIndex:Ce,verticalPlacedTextSymbolIndex:ye}=U,Re=o.text.placedSymbolArray,He=Ve||Le?1:0;Oe>=0&&(Re.get(Oe).hidden=He),Je>=0&&(Re.get(Je).hidden=He),Ce>=0&&(Re.get(Ce).hidden=He),ye>=0&&(Re.get(ye).hidden=Ve||st?1:0);const tt=this.variableOffsets[ie];tt&&this.markUsedJustification(o,tt.anchor,U,Ae);const Ct=this.placedOrientations[ie];Ct&&(this.markUsedJustification(o,"left",U,Ct),this.markUsedOrientation(o,Ct,U))}if(xe){const Ee=cc(le.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:Oe}=U,Je=o.icon.placedSymbolArray,Ce=le.icon.isHidden()?1:0;Ve>=0&&(q(o.icon,ue,Le?Ks:Ee),Je.get(Ve).hidden=Ce),Oe>=0&&(q(o.icon,U.numVerticalIconVertices,st?Ks:Ee),Je.get(Oe).hidden=Ce)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ee=o.collisionArrays[X];if(Ee){let Ve=new s.pointGeometry(0,0),Oe=!0;if(Ee.textBox||Ee.verticalTextBox){if(P){const Ce=this.variableOffsets[ie];Ce?(Ve=ac(Ce.anchor,Ce.width,Ce.height,Ce.textOffset,Ce.textScale),L&&Ve._rotate(j?this.transform.angle:-this.transform.angle)):Oe=!1}b&&(Oe=!le.clipped),Ee.textBox&&or(o.textCollisionBox.collisionVertexArray,le.text.placed,!Oe||Le,Ve.x,Ve.y),Ee.verticalTextBox&&or(o.textCollisionBox.collisionVertexArray,le.text.placed,!Oe||st,Ve.x,Ve.y)}const Je=Oe&&Boolean(!st&&Ee.verticalIconBox);Ee.iconBox&&or(o.iconCollisionBox.collisionVertexArray,le.icon.placed,Je,V?Ve.x:0,V?Ve.y:0),Ee.verticalIconBox&&or(o.iconCollisionBox.collisionVertexArray,le.icon.placed,!Je,V?Ve.x:0,V?Ve.y:0)}}}if(o.fullyClipped=H===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=X.invProjMatrix,o.placementViewportMatrix=X.viewportMatrix,o.collisionCircleArray=X.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>o}setStale(){this.stale=!0}}function or(d,o,c,f,_){d.emplaceBack(o?1:0,c?1:0,f||0,_||0),d.emplaceBack(o?1:0,c?1:0,f||0,_||0),d.emplaceBack(o?1:0,c?1:0,f||0,_||0),d.emplaceBack(o?1:0,c?1:0,f||0,_||0)}const Xd=Math.pow(2,25),lc=Math.pow(2,24),Pi=Math.pow(2,17),Xa=Math.pow(2,16),Uu=Math.pow(2,9),Ka=Math.pow(2,8),Vi=Math.pow(2,1);function cc(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const o=d.placed?1:0,c=Math.floor(127*d.opacity);return c*Xd+o*lc+c*Pi+o*Xa+c*Uu+o*Ka+c*Vi+o}const Ks=0;class yo{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,c,f,_,b){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(E,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((k,I)=>k.sortKey-I.sortKey));this._currentPartIndex<E.length;){const k=E[this._currentPartIndex];if(c.placeLayerBucketPart(k,this._seenCrossTileIDs,f,k.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class Ya{constructor(o,c,f,_,b,E,k,I){this.placement=new ur(o,b,E,k,I),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,c,f){const _=s.exported.now(),b=()=>{const E=s.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[o[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=k)&&(!E.maxzoom||E.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new yo(E)),this._inProgressLayer.continuePlacement(f[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const uc=512/s.EXTENT/2;class qm{constructor(o,c,f){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let _=0;_<c.length;_++){const b=c.get(_),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,c){const f=uc/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*s.EXTENT+o.tileAnchorX)*f),y:Math.floor((c.canonical.y*s.EXTENT+o.tileAnchorY)*f)}}findMatches(o,c,f){const _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let b=0;b<o.length;b++){const E=o.get(b);if(E.crossTileID)continue;const k=this.indexedSymbolInstances[E.key];if(!k)continue;const I=this.getScaledCoordinates(E,c);for(const P of k)if(Math.abs(P.coord.x-I.x)<=_&&Math.abs(P.coord.y-I.y)<=_&&!f[P.crossTileID]){f[P.crossTileID]=!0,E.crossTileID=P.crossTileID;break}}}}class Vu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ys{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(c!==0)for(const f in this.indexes){const _=this.indexes[f],b={};for(const E in _){const k=_[E];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+c),b[k.tileID.key]=k}this.indexes[f]=b}this.lng=o}addBucket(o,c,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const _=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>o.overscaledZ)for(const k in E){const I=E[k];I.tileID.isChildOf(o)&&I.findMatches(c.symbolInstances,o,_)}else{const k=E[o.scaledTo(Number(b)).key];k&&k.findMatches(c.symbolInstances,o,_)}}for(let b=0;b<c.symbolInstances.length;b++){const E=c.symbolInstances.get(b);E.crossTileID||(E.crossTileID=f.generate(),_[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new qm(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const f in c.indexedSymbolInstances)for(const _ of c.indexedSymbolInstances[f])delete this.usedCrossTileIDs[o][_.crossTileID]}removeStaleBuckets(o){let c=!1;for(const f in this.indexes){const _=this.indexes[f];for(const b in _)o[_[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[b]),delete _[b],c=!0)}return c}}class Kd{constructor(){this.layerIndexes={},this.crossTileIDs=new Vu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,f,_){let b=this.layerIndexes[o.id];b===void 0&&(b=this.layerIndexes[o.id]=new Ys);let E=!1;const k={};_.name!=="globe"&&b.handleWrapJump(f);for(const I of c){const P=I.getBucket(o);P&&o.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,P,this.crossTileIDs)&&(E=!0),k[P.bucketInstanceId]=!0)}return b.removeStaleBuckets(k)&&(E=!0),E}pruneUnusedLayers(o){const c={};o.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const Ja=(d,o)=>s.emitValidationErrors(d,o&&o.filter(c=>c.identifier!=="source.canvas")),Js=s.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Go=s.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),hc={version:8,layers:[],sources:{}},Zo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Or extends s.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new hi(Wt(),this),this.imageManager=new wt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(o._requestManager,c.localFontFamily?s.LocalGlyphMode.all:c.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Kd,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const f=this;this._rtlTextPluginCallback=Or.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(b,E)=>{if(s.triggerPluginCompletionEvent(b),E&&E.every(k=>k))for(const k in f._sourceCaches){const I=f._sourceCaches[k],P=I.getSource().type;P!=="vector"&&P!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.getSource(_.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const k=this._layers[E];k.source===b.id&&this._validateLayer(k)}})}loadURL(o,c={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const f=typeof c.validate=="boolean"?c.validate:!s.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken);const _=this.map._requestManager.transformRequest(o,s.ResourceType.Style);this._request=s.getJSON(_,(b,E)=>{this._request=null,b?this.fire(new s.ErrorEvent(b)):E&&this._load(E,f)})}loadJSON(o,c={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(hc,!1)}_updateLayerCount(o,c){const f=c?1:-1;o.is3D()&&(this._num3DLayers+=f),o.type==="circle"&&(this._numCircleLayers+=f),o.type==="symbol"&&(this._numSymbolLayers+=f)}_load(o,c){if(c&&Ja(this,s.validateStyle(o)))return;this._loaded=!0,this.stylesheet=s.clone$1(o),this._updateMapProjection();for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const f=zn(this.stylesheet.layers);this._order=f.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of f)_=s.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new si(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(o){this._spriteRequest=function(c,f,_){let b,E,k;const I=s.exported.devicePixelRatio>1?"@2x":"";let P=s.getJSON(f.transformRequest(f.normalizeSpriteURL(c,I,".json"),s.ResourceType.SpriteJSON),(V,W)=>{P=null,k||(k=V,b=W,j())}),L=s.getImage(f.transformRequest(f.normalizeSpriteURL(c,I,".png"),s.ResourceType.SpriteImage),(V,W)=>{L=null,k||(k=V,E=W,j())});function j(){if(k)_(k);else if(b&&E){const V=s.exported.getImageData(E),W={};for(const q in b){const{width:H,height:X,x:U,y:te,sdf:Q,pixelRatio:ie,stretchX:ue,stretchY:le,content:de}=b[q],xe=new s.RGBAImage({width:H,height:X});s.RGBAImage.copy(V,xe,{x:U,y:te},{x:0,y:0},{width:H,height:X}),W[q]={data:xe,pixelRatio:ie,sdf:Q,stretchX:ue,stretchY:le,content:de}}_(null,W)}}return{cancel(){P&&(P.cancel(),P=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new s.ErrorEvent(c));else if(f)for(const _ in f)this.imageManager.addImage(_,f[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.getSource(o.source);if(!c)return;const f=o.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const f of o){const _=this._layers[f];_.type!=="custom"&&c.push(_.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&(typeof o.isLayerDraped=="function"?o.isLayerDraped():Zo[o.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(_.length||b.length)&&this._updateWorkerLayers(_,b);for(const E in this._updatedSources){const k=this._updatedSources[E];k==="reload"?this._reloadSource(E):k==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const f={};for(const _ in this._sourceCaches){const b=this._sourceCaches[_];f[_]=b.used,b.used=!1}for(const _ of this._order){const b=this._layers[_];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const k=this._getLayerSourceCache(b);k&&(k.used=!0)}const E=this.map.painter;if(E){const k=b.getProgramIds();if(!k)continue;const I=b.getProgramConfiguration(o.zoom);for(const P of k)E.useProgram(P,I)}}for(const _ in f){const b=this._sourceCaches[_];f[_]!==b.used&&b.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Ja(this,s.validateStyle(o)))return!1;(o=s.clone$1(o)).layers=zn(o.layers);const c=function(_,b){if(!_)return[{command:Ut.setStyle,args:[b]}];let E=[];try{if(!S(_.version,b.version))return[{command:Ut.setStyle,args:[b]}];S(_.center,b.center)||E.push({command:Ut.setCenter,args:[b.center]}),S(_.zoom,b.zoom)||E.push({command:Ut.setZoom,args:[b.zoom]}),S(_.bearing,b.bearing)||E.push({command:Ut.setBearing,args:[b.bearing]}),S(_.pitch,b.pitch)||E.push({command:Ut.setPitch,args:[b.pitch]}),S(_.sprite,b.sprite)||E.push({command:Ut.setSprite,args:[b.sprite]}),S(_.glyphs,b.glyphs)||E.push({command:Ut.setGlyphs,args:[b.glyphs]}),S(_.transition,b.transition)||E.push({command:Ut.setTransition,args:[b.transition]}),S(_.light,b.light)||E.push({command:Ut.setLight,args:[b.light]}),S(_.fog,b.fog)||E.push({command:Ut.setFog,args:[b.fog]}),S(_.projection,b.projection)||E.push({command:Ut.setProjection,args:[b.projection]});const k={},I=[];(function(j,V,W,q){let H;for(H in V=V||{},j=j||{})j.hasOwnProperty(H)&&(V.hasOwnProperty(H)||Vn(H,W,q));for(H in V)V.hasOwnProperty(H)&&(j.hasOwnProperty(H)?S(j[H],V[H])||(j[H].type==="geojson"&&V[H].type==="geojson"&&go(j,V,H)?W.push({command:Ut.setGeoJSONSourceData,args:[H,V[H].data]}):Uo(H,V,W,q)):Un(H,V,W))})(_.sources,b.sources,I,k);const P=[];_.layers&&_.layers.forEach(j=>{j.source&&k[j.source]?E.push({command:Ut.removeLayer,args:[j.id]}):P.push(j)});let L=_.terrain;L&&k[L.source]&&(E.push({command:Ut.setTerrain,args:[void 0]}),L=void 0),E=E.concat(I),S(L,b.terrain)||E.push({command:Ut.setTerrain,args:[b.terrain]}),function(j,V,W){V=V||[];const q=(j=j||[]).map(_o),H=V.map(_o),X=j.reduce(wi,{}),U=V.reduce(wi,{}),te=q.slice(),Q=Object.create(null);let ie,ue,le,de,xe,Ae,Le;for(ie=0,ue=0;ie<q.length;ie++)le=q[ie],U.hasOwnProperty(le)?ue++:(W.push({command:Ut.removeLayer,args:[le]}),te.splice(te.indexOf(le,ue),1));for(ie=0,ue=0;ie<H.length;ie++)le=H[H.length-1-ie],te[te.length-1-ie]!==le&&(X.hasOwnProperty(le)?(W.push({command:Ut.removeLayer,args:[le]}),te.splice(te.lastIndexOf(le,te.length-ue),1)):ue++,Ae=te[te.length-ie],W.push({command:Ut.addLayer,args:[U[le],Ae]}),te.splice(te.length-ie,0,le),Q[le]=!0);for(ie=0;ie<H.length;ie++)if(le=H[ie],de=X[le],xe=U[le],!Q[le]&&!S(de,xe))if(S(de.source,xe.source)&&S(de["source-layer"],xe["source-layer"])&&S(de.type,xe.type)){for(Le in je(de.layout,xe.layout,W,le,null,Ut.setLayoutProperty),je(de.paint,xe.paint,W,le,null,Ut.setPaintProperty),S(de.filter,xe.filter)||W.push({command:Ut.setFilter,args:[le,xe.filter]}),S(de.minzoom,xe.minzoom)&&S(de.maxzoom,xe.maxzoom)||W.push({command:Ut.setLayerZoomRange,args:[le,xe.minzoom,xe.maxzoom]}),de)de.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?je(de[Le],xe[Le],W,le,Le.slice(6),Ut.setPaintProperty):S(de[Le],xe[Le])||W.push({command:Ut.setLayerProperty,args:[le,Le,xe[Le]]}));for(Le in xe)xe.hasOwnProperty(Le)&&!de.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?je(de[Le],xe[Le],W,le,Le.slice(6),Ut.setPaintProperty):S(de[Le],xe[Le])||W.push({command:Ut.setLayerProperty,args:[le,Le,xe[Le]]}))}else W.push({command:Ut.removeLayer,args:[le]}),Ae=te[te.lastIndexOf(le)+1],W.push({command:Ut.addLayer,args:[xe,Ae]})}(P,b.layers,E)}catch(k){console.warn("Unable to compute style diff:",k),E=[{command:Ut.setStyle,args:[b]}]}return E}(this.serialize(),o).filter(_=>!(_.command in Go));if(c.length===0)return!1;const f=c.filter(_=>!(_.command in Js));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);return c.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,c){return this.getImage(o)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,c),this._afterImageUpdated(o),this)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,c,f={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(s.validateSource,`sources.${o}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const _=be(o,c,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:_.serialize(),sourceId:o}));const b=E=>{const k=(E?"symbol:":"other:")+o,I=this._sourceCaches[k]=new s.SourceCache(k,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[o]=I,I.style=this,I.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const c=this.getSource(o);if(!c)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(o);for(const _ of f)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getSource(o).setData(c),this._changed=!0}getSource(o){const c=this._getSourceCache(o);return c&&c.getSource()}_getSources(){const o=[];for(const c in this._otherSourceCaches){const f=this._getSourceCache(c);f&&o.push(f.getSource())}return o}addLayer(o,c,f={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let b;if(o.type==="custom"){if(Ja(this,s.validateCustomStyleLayer(o)))return;b=s.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=s.clone$1(o),o=s.extend(o,{source:_})),this._validate(s.validateLayer,`layers.${_}`,o,{arrayIndex:-1},f))return;b=s.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const E=c?this._order.indexOf(c):this._order.length;if(c&&E===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=b;const k=this._getLayerSourceCache(b);if(this._removedLayers[_]&&b.source&&k&&b.type!=="custom"){const I=this._removedLayers[_];delete this._removedLayers[_],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",k.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const f=this._order.indexOf(o);this._order.splice(f,1);const _=c?this._order.indexOf(c):this._order.length;c&&_===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const f=this._order.indexOf(o);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,f){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===c&&_.maxzoom===f||(c!=null&&(_.minzoom=c),f!=null&&(_.maxzoom=f),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,c,f={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!S(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(s.validateFilter,`layers.${_.id}.filter`,c,{layerType:_.type},f)||(_.filter=s.clone$1(c),this._updateLayer(_)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const c=this.getLayer(o);return c&&s.clone$1(c.filter)}setLayoutProperty(o,c,f,_={}){this._checkLoaded();const b=this.getLayer(o);b?S(b.getLayoutProperty(c),f)||(b.setLayoutProperty(c,f,_),this._updateLayer(b)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,c){const f=this.getLayer(o);if(f)return f.getLayoutProperty(c);this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,c,f,_={}){this._checkLoaded();const b=this.getLayer(o);b?S(b.getPaintProperty(c),f)||(b.setPaintProperty(c,f,_)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,c){const f=this.getLayer(o);return f&&f.getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const f=o.source,_=o.sourceLayer,b=this.getSource(f);if(!b)return void this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const E=b.type;if(E==="geojson"&&_)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(f);for(const I of k)I.setFeatureState(_,o.id,c)}removeFeatureState(o,c){this._checkLoaded();const f=o.source,_=this.getSource(f);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const b=_.type,E=b==="vector"?o.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(f);for(const I of k)I.removeFeatureState(E,o.id,c)}getFeatureState(o){this._checkLoaded();const c=o.source,f=o.sourceLayer,_=this.getSource(c);if(_){if(_.type!=="vector"||f)return o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(f,o.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const c in this._sourceCaches){const f=this._sourceCaches[c].getSource();o[f.id]||(o[f.id]=f.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const c=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",c.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=E=>this._layers[E].type==="fill-extrusion",f={},_=[];for(let E=this._order.length-1;E>=0;E--){const k=this._order[E];if(c(k)){f[k]=E;for(const I of o){const P=I[k];if(P)for(const L of P)_.push(L)}}}_.sort((E,k)=>k.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const k=this._order[E];if(c(k))for(let I=_.length-1;I>=0;I--){const P=_[I].feature;if(f[P.layer.id]<E)break;b.push(P),_.pop()}else for(const I of o){const P=I[k];if(P)for(const L of P)b.push(L.feature)}}return b}queryRenderedFeatures(o,c,f){c&&c.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const _={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of c.layers){const P=this._layers[I];if(!P)return this.fire(new s.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];_[P.source]=!0}}const b=[];c.availableImages=this._availableImages;const E=c&&c.layers?c.layers.some(I=>{const P=this.getLayer(I);return P&&P.is3D()}):this.has3DLayers(),k=Xe.createFromScreenPoints(o,f);for(const I in this._sourceCaches){const P=this._sourceCaches[I].getSource().id;c.layers&&!_[P]||b.push(ke(this._sourceCaches[I],this._layers,this._serializedLayers,k,c,f,E,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(I,P,L,j,V,W,q){const H={},X=W.queryRenderedSymbols(j),U=[];for(const te of Object.keys(X).map(Number))U.push(q[te]);U.sort(gt);for(const te of U){const Q=te.featureIndex.lookupSymbolFeatures(X[te.bucketInstanceId],P,te.bucketIndex,te.sourceLayerIndex,V.filter,V.layers,V.availableImages,I);for(const ie in Q){const ue=H[ie]=H[ie]||[],le=Q[ie];le.sort((de,xe)=>{const Ae=te.featureSortOrder;if(Ae){const Le=Ae.indexOf(de.featureIndex);return Ae.indexOf(xe.featureIndex)-Le}return xe.featureIndex-de.featureIndex});for(const de of le)ue.push(de)}}for(const te in H)H[te].forEach(Q=>{const ie=Q.feature,ue=L(I[te]).getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ue});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,c){c&&c.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const f=this._getSourceCaches(o);let _=[];for(const b of f)_=_.concat(Ke(b,c));return _}addSourceType(o,c,f){return Or.getSourceType(o)?f(new Error(`A source type called "${o}" already exists.`)):(Or.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const E in o)if(!S(o[E],f[E])){_=!0;break}if(!_)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(c===1){if(typeof o.source=="object"){const f="terrain-dem-src";this.addSource(f,o.source),o=s.clone$1(o),o=s.extend(o,{source:f})}if(this._validate(s.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(o,c);else{const f=this.terrain,_=f.get();for(const b of Object.keys(s.spec.terrain))!o.hasOwnProperty(b)&&s.spec.terrain[b].default&&(o[b]=s.spec.terrain[b].default);for(const b in o)if(!S(o[b],_[b])){f.set(o),this.stylesheet.terrain=o;const E=this._setTransitionParameters({duration:0});f.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new Fn(o,this.map.transform);this.stylesheet.fog=o;const f=this._setTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,f=c.get();Object.keys(o).length===0&&c.set(o);for(const _ in o)if(!S(o[_],f[_])){c.set(o),this.stylesheet.fog=o;const b=this._setTransitionParameters({duration:0});c.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:s.exported.now(),transition:s.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(f=>this.isLayerDraped(this._layers[f])),c=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const f=this.terrain=new rn(o,c);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,f,_,b={}){return(!b||b.validate!==!1)&&Ja(this,o.call(s.validateStyle,s.extend({key:c,style:this.serialize(),value:f,styleSpec:s.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const c=this._getSourceCaches(o);for(const f of c)f.clearTiles()}_reloadSource(o){const c=this._getSourceCaches(o);for(const f of c)f.resume(),f.reload()}_reloadSources(){for(const o of this._getSources())o.reload&&o.reload()}_updateSources(o){for(const c in this._sourceCaches)this._sourceCaches[c].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,f,_,b=!1){let E=!1,k=!1;const I={};for(const P of this._order){const L=this._layers[P];if(L.type!=="symbol")continue;if(!I[L.source]){const V=this._getLayerSourceCache(L);if(!V)continue;I[L.source]=V.getRenderableIds(!0).map(W=>V.getTileByID(W)).sort((W,q)=>q.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(q.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(L,I[L.source],o.center.lng,o.projection);E=E||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),o.zoom))&&(this.pauseablePlacement=new Ya(o,this._order,b,c,f,_,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),k=!0),E&&this.pauseablePlacement.placement.setStale()),k||E)for(const P of this._order){const L=this._layers[P];L.type==="symbol"&&this.placement.updateLayerOpacities(L,I[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,f){this.imageManager.getImages(c.icons,f),this._updateTilesForChangedImages();const _=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};_(this._otherSourceCaches[c.source]),_(this._symbolSourceCaches[c.source])}getGlyphs(o,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(o,c,f){return s.makeRequest(c,f)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){const c=this._getSourceCaches(o);return c.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):c.every(f=>f.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Or.getSourceType=function(d){return we[d]},Or.setSourceType=function(d,o){we[d]=o},Or.registerForPluginStateChange=s.registerForPluginStateChange;var Qa=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Yd="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,dc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Gu={},Zu={};const Qs=[];ws(Qa,Qs),ws(Jd,Qs),ws(dc,Qs),ws(Qd,Qs),Gu=Rn("",Jd),Zu=Rn(Qd,dc);const ep=Rn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),pc=Qa,fc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var qu={background:Rn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Rn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Rn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Rn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Rn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Rn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Rn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Rn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Rn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Rn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Rn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Rn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Rn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Rn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Rn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Rn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Rn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Rn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Rn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Rn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Rn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Rn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Rn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Rn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Rn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yd),skyboxGradient:Rn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yd),skyboxCapture:Rn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Rn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Rn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ws(d,o){const c=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of c)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const b of _)o.includes(b)||o.push(b)}}function Rn(d,o){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},b=[...Qs];return ws(d,b),ws(o,b),{fragmentSource:d=d.replace(c,(E,k,I,P,L)=>(_[L]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${I} ${P} ${L};
#else
uniform ${I} ${P} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${I} ${P} ${L} = u_${L};
#endif
`)),vertexSource:o=o.replace(c,(E,k,I,P,L)=>{const j=P==="float"?"vec2":"vec4",V=L.match(/color/)?"color":j;return _[L]?k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${I} ${j} a_${L};
varying ${I} ${P} ${L};
#else
uniform ${I} ${P} u_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${I} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${I} ${P} ${L} = u_${L};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${I} ${j} a_${L};
#else
uniform ${I} ${P} u_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${I} ${P} ${L} = a_${L};
#else
    ${I} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${I} ${P} ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${I} ${P} ${L} = u_${L};
#endif
`}),staticAttributes:f,usedDefines:b}}class el{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,f,_,b,E,k){this.context=o;let I=this.boundPaintVertexBuffers.length!==_.length;for(let L=0;!I&&L<_.length;L++)this.boundPaintVertexBuffers[L]!==_[L]&&(I=!0);let P=this.boundDynamicVertexBuffers.length!==k.length;for(let L=0;!P&&L<k.length;L++)this.boundDynamicVertexBuffers[L]!==k[L]&&(P=!0);if(!o.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||I||P||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(c,f,_,b,E,k);else{o.bindVertexArrayOES.set(this.vao);for(const L of k)L&&L.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(o,c,f,_,b,E){let k;const I=o.numAttributes,P=this.context,L=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E;else{k=P.currentNumAttributes||0;for(let j=I;j<k;j++)L.disableVertexAttribArray(j)}c.enableAttributes(L,o),c.bind(),c.setVertexAttribPointers(L,o,b);for(const j of f)j.enableAttributes(L,o),j.bind(),j.setVertexAttribPointers(L,o,b);for(const j of E)j&&(j.enableAttributes(L,o),j.bind(),j.setVertexAttribPointers(L,o,b));_&&_.bind(),P.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Wu(d,o){const c=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new s.MercatorCoordinate(0,f/c).toLngLat().lat,new s.MercatorCoordinate(0,(f+1)/c).toLngLat().lat]}function tl(d,o,c,f,_,b,E){const k=d.context,I=k.gl,P=c.fbo;if(!P)return;d.prepareDrawTile();const L=d.useProgram("hillshade");k.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get());const j=((H,X,U,te)=>{const Q=U.paint.get("hillshade-shadow-color"),ie=U.paint.get("hillshade-highlight-color"),ue=U.paint.get("hillshade-accent-color");let le=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=H.transform.angle);const de=!H.options.moving;return{u_matrix:te||H.transform.calculateProjMatrix(X.tileID.toUnwrapped(),de),u_image:0,u_latrange:Wu(0,X.tileID),u_light:[U.paint.get("hillshade-exaggeration"),le],u_shadow:Q,u_highlight:ie,u_accent:ue}})(d,c,f,d.terrain?o.projMatrix:null);d.prepareDrawProgram(k,L,o.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=d.getTileBoundsBuffers(c);L.draw(k,I.TRIANGLES,_,b,E,s.CullFaceMode.disabled,j,f.id,V,W,q)}function nl(d,o,c){if(!o.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||d.getTileTexture(c.stride);const b=c.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new s.Texture(f,b,_.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function mc(d,o,c,f,_,b){const E=d.context,k=E.gl;if(!o.dem)return;const I=o.dem;if(E.activeTexture.set(k.TEXTURE1),nl(d,o,I),!o.demTexture)return;o.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const P=I.dim;E.activeTexture.set(k.TEXTURE0);let L=o.fbo;if(!L){const q=new s.Texture(E,{width:P,height:P,data:null},k.RGBA);q.bind(k.LINEAR,k.CLAMP_TO_EDGE),L=o.fbo=E.createFramebuffer(P,P,!0),L.colorAttachment.set(q.texture)}E.bindFramebuffer.set(L.framebuffer),E.viewport.set([0,0,P,P]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:V,tileBoundsSegments:W}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(E,k.TRIANGLES,f,_,b,s.CullFaceMode.disabled,((q,H)=>{const X=H.stride,U=s.create();return s.ortho(U,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(U,U,[0,-s.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[X,X],u_zoom:q.overscaledZ,u_unpack:H.unpackVector}})(o.tileID,I),c.id,j,V,W),o.needsHillshadePrepare=!1}const gc=d=>({u_matrix:new s.UniformMatrix4f(d),u_image0:new s.Uniform1i(d),u_skirt_height:new s.Uniform1f(d)}),Hu=(d,o)=>({u_matrix:d,u_image0:0,u_skirt_height:o}),_c=(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_frustum_tl:E,u_frustum_tr:k,u_frustum_br:I,u_frustum_bl:P,u_globe_pos:L,u_globe_radius:j,u_viewport:V,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:W});function Xu(d,o){return d!=null&&o!=null&&!(!d.hasData()||!o.hasData())&&d.demTexture!=null&&o.demTexture!=null&&d.tileID.key!==o.tileID.key}const qo=new class{constructor(){this.operations={}}newMorphing(d,o,c,f,_){if(d in this.operations){const b=this.operations[d];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[d]={startTime:f,phase:0,duration:_,from:o,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const o=this.operations[d];return{from:o.from,to:o.to,phase:o.phase}}update(d){for(const o in this.operations){const c=this.operations[o];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[o];break}}}_nextOp(d,o){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=o,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Ts={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function yc(d){return 6*Math.pow(1.5,22-d)}function Ku(d,o){const c=1<<d.z;return!o&&(d.x===0||d.x===c-1)||d.y===0||d.y===c-1}const xn=d=>({u_matrix:d});function il(d,o,c,f,_){if(_>0){const b=s.exported.now(),E=(b-d.timeAdded)/_,k=o?(b-o.timeAdded)/_:-1,I=c.getSource(),P=f.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-P)>Math.abs(d.tileID.overscaledZ-P),j=L&&d.refreshedUponExpiration?1:s.clamp(L?E:1-k,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),o?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class tp extends s.SourceCache{constructor(o){const c={type:"raster-dem",maxzoom:o.transform.maxZoom},f=new hi(Wt(),null),_=be("mock-dem",c,f,o.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class np extends s.SourceCache{constructor(o){const c=be("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new hi(Wt(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,f){if(o.freezeTileCoverage)return;this.transform=o;const _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const k=new s.Tile(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);k.state="loaded",this._tiles[E.key]=k}return b},{});for(const b in this._tiles)b in _||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const c=this.proxyCachedFBO[o];if(c!==void 0){const f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Yu extends s.OverscaledTileID{constructor(o,c,f){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class Ju extends s.Elevation{constructor(o,c){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,b]=function(I){const P=new s.StructArrayLayout2i4,L=new s.StructArrayLayout3ui6,j=131;P.reserve(17161),L.reserve(33800);const V=s.EXTENT/128,W=s.EXTENT+V/2,q=W+V;for(let X=-V;X<q;X+=V)for(let U=-V;U<q;U+=V){const te=U<0||U>W||X<0||X>W?24575:0,Q=s.clamp(Math.round(U),0,s.EXTENT),ie=s.clamp(Math.round(X),0,s.EXTENT);P.emplaceBack(Q+te,ie)}const H=(X,U)=>{const te=U*j+X;L.emplaceBack(te+1,te,te+j),L.emplaceBack(te+j,te+j+1,te+1)};for(let X=1;X<129;X++)for(let U=1;U<129;U++)H(U,X);return[0,129].forEach(X=>{for(let U=0;U<130;U++)H(U,X),H(X,U)}),[P,L,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(f,s.posAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=s.SegmentVector.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,f.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new np(c.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const k=E.gl;this._overlapStencilMode=new s.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tp(c.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,f){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const _=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const b=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(c,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=c.getIds().map(I=>{const P=c.getTileByID(I).tileID;return P.projMatrix=f.calculateProjMatrix(P.toUnwrapped()),P});(function(I,P){const L=P.transform.pointCoordinate(P.transform.getCameraPoint()),j=new s.pointGeometry(L.x,L.y);I.sort((V,W)=>{if(W.overscaledZ-V.overscaledZ)return W.overscaledZ-V.overscaledZ;const q=new s.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),H=new s.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),X=j.mult(1<<V.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(q)-X.distSqr(H)})})(_,this.painter),this._previousZoom=f.zoom;const b=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const I in E){const P=E[I];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,o[I],b),P.usedForTerrain))continue;const L=o[I];P.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=_.map(I=>new Yu(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const k={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const P=this.terrainTileForTile[I.key];if(!P)continue;const L=P.tileID.key;L in k||(this._visibleDemTiles.push(P),k[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],b=_.dem;!b||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),nl(this.painter,_,b))}}_prepareDemTileUniforms(o,c,f,_){if(!c||c.demTexture==null)return!1;const b=o.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-b.z),k=_||"";return f[`u_dem_tl${k}`]=[b.x*E%1,b.y*E%1],f[`u_dem_scale${k}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){const f=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(o,f,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const c=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const b=_.dem.tree.minimums[0];return b>0&&o++,f+b},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(f,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(_,{premultiply:!1}):b=this._emptyDEMTexture=new s.Texture(o,_,c.RGBA,{premultiply:!1}),b}setupElevationDraw(o,c,f){const _=this.painter.context,b=_.gl,E=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let I=null,P=null,L=1;if(f&&f.morphing&&this._useVertexMorphing){const j=f.morphing.srcDemTile,V=f.morphing.dstDemTile;L=f.morphing.phase,j&&V&&(this._prepareDemTileUniforms(o,j,E,"_prev")&&(P=j),this._prepareDemTileUniforms(o,V,E)&&(I=V))}if(P&&I?(_.activeTexture.set(b.TEXTURE2),I.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),_.activeTexture.set(b.TEXTURE4),P.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),E.u_dem_lerp=L):(I=this.terrainTileForTile[o.tileID.key],_.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,I,E)?I.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),_.activeTexture.set(b.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&I){const j=(1<<I.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=j}if(f&&f.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(_,E),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,o.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,j)}}globeUniformValues(o,c,f){const _=o.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,s.EXTENT,0),u_tile_br_up:_.upVector(c,s.EXTENT,s.EXTENT),u_tile_bl_up:_.upVector(c,0,s.EXTENT),u_tile_up_scale:f?s.globeMetersToEcef(1):_.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const c=this.painter,f=this.painter.context;o.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,b,E,k,I){if(_.transform.projection.name==="globe")(function(P,L,j,V,W){const q=P.context,H=q.gl;let X,U;const te=P.options.showTerrainWireframe?2:0,Q=P.transform,ie=s.globeUseCustomAntiAliasing(P,q,Q),ue=(Je,Ce)=>{if(U===Je)return;const ye=[Ts[Je],"PROJECTION_GLOBE_VIEW"];ie&&ye.push("CUSTOM_ANTIALIASING"),Ce&&ye.push(Ts[te]),X=P.useProgram("globeRaster",null,ye),U=Je},le=P.colorModeForRenderPass(),de=new s.DepthMode(H.LEQUAL,s.DepthMode.ReadWrite,P.depthRangeFor3D);qo.update(W);const xe=s.calculateGlobeMercatorMatrix(Q),Ae=[s.mercatorXfromLng(Q.center.lng),s.mercatorYfromLat(Q.center.lat)],Le=te?[!1,!0]:[!1],st=P.globeSharedBuffers,Ee=[Q.width*s.exported.devicePixelRatio,Q.height*s.exported.devicePixelRatio],Ve=Float32Array.from(Q.globeMatrix),Oe={useDenormalizedUpVectorScale:!0};if(Le.forEach(Je=>{const Ce=P.transform,ye=yc(Ce.zoom)*L.exaggeration();U=-1;const Re=Je?H.LINES:H.TRIANGLES;for(const He of V){const tt=j.getTile(He),Ct=s.StencilMode.disabled,Qt=L.prevTerrainTileForTile[He.key],kt=L.terrainTileForTile[He.key];Xu(Qt,kt)&&qo.newMorphing(He.key,Qt,kt,W,250),q.activeTexture.set(H.TEXTURE0),tt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const vt=qo.getMorphValuesForProxy(He.key),Mt=vt?1:0;vt&&s.extend$1(Oe,{morphing:{srcDemTile:vt.from,dstDemTile:vt.to,phase:s.easeCubicInOut(vt.phase)}});const hn=s.tileCornersToBounds(He.canonical),Dt=s.getLatitudinalLod(hn.getCenter().lat),Dn=s.getGridMatrix(He.canonical,hn,Dt,Ce.worldSize/Ce._pixelsPerMercatorPixel),Gn=s.globeNormalizeECEF(s.globeTileBounds(He.canonical)),Qn=_c(Ce.projMatrix,Ve,xe,Gn,s.globeToMercatorTransition(Ce.zoom),Ae,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,Ee,ye,Dn);if(ue(Mt,Je),L.setupElevationDraw(tt,X,Oe),P.prepareDrawProgram(q,X,He.toUnwrapped()),st){const[Xn,Ti,hr]=Je?st.getWirefameBuffers(P.context,Dt):st.getGridBuffers(Dt,ye!==0);X.draw(q,Re,de,Ct,le,s.CullFaceMode.backCCW,Qn,"globe_raster",Xn,Ti,hr)}}}),st){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&Je.push("CUSTOM_ANTIALIASING"),X=P.useProgram("globeRaster",null,Je);for(const Ce of V){const{x:ye,y:Re,z:He}=Ce.canonical,tt=Re===0,Ct=Re===(1<<He)-1,[Qt,kt,vt,Mt]=st.getPoleBuffers(He);if(Mt&&(tt||Ct)){const hn=j.getTile(Ce);q.activeTexture.set(H.TEXTURE0),hn.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let Dt=s.globePoleMatrixForTile(He,ye,Q);const Dn=s.globeNormalizeECEF(s.globeTileBounds(Ce.canonical)),Gn=(Qn,Xn)=>Qn.draw(q,H.TRIANGLES,de,s.StencilMode.disabled,le,s.CullFaceMode.disabled,_c(Q.projMatrix,Dt,Dt,Dn,0,Ae,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,Ee,0),"globe_pole_raster",Xn,vt,Mt);L.setupElevationDraw(hn,X,Oe),P.prepareDrawProgram(q,X,Ce.toUnwrapped()),tt&&Gn(X,Qt),Ct&&(Dt=s.scale(s.create(),Dt,[1,-1,1]),Gn(X,kt))}}}})(_,b,E,k,I);else{const P=_.context,L=P.gl;let j,V;const W=_.options.showTerrainWireframe?2:0,q=(Q,ie)=>{if(V===Q)return;const ue=[Ts[Q]];ie&&ue.push(Ts[W]),j=_.useProgram("terrainRaster",null,ue),V=Q},H=_.colorModeForRenderPass(),X=new s.DepthMode(L.LEQUAL,s.DepthMode.ReadWrite,_.depthRangeFor3D);qo.update(I);const U=_.transform,te=yc(U.zoom)*b.exaggeration();(W?[!1,!0]:[!1]).forEach(Q=>{V=-1;const ie=Q?L.LINES:L.TRIANGLES,[ue,le]=Q?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const de of k){const xe=E.getTile(de),Ae=s.StencilMode.disabled,Le=b.prevTerrainTileForTile[de.key],st=b.terrainTileForTile[de.key];Xu(Le,st)&&qo.newMorphing(de.key,Le,st,I,250),P.activeTexture.set(L.TEXTURE0),xe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Ee=qo.getMorphValuesForProxy(de.key),Ve=Ee?1:0;let Oe;Ee&&(Oe={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:s.easeCubicInOut(Ee.phase)}});const Je=Hu(de.projMatrix,Ku(de.canonical,U.renderWorldCopies)?te/10:te);q(Ve,Q),b.setupElevationDraw(xe,j,Oe),_.prepareDrawProgram(P,j,de.toUnwrapped()),j.draw(P,ie,X,Ae,H,s.CullFaceMode.backCCW,Je,"terrain_raster",b.gridBuffer,ue,le)}})}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const c=this.painter,f=this.painter.context,_=this.proxySourceCache,b=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),k=[],I=c.style.order;let P=0;for(const L of b){const j=_.getTileByID(L.proxyTileKey),V=_.proxyCachedFBO[L.key]?_.proxyCachedFBO[L.key][o]:void 0,W=V!==void 0?_.renderCache[V]:this.pool[P++],q=V!==void 0;if(j.texture=W.tex,q&&!W.dirty){k.push(j.tileID);continue}let H;f.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(f.clear({color:s.Color.transparent,stencil:0}),W.dirty=!1);for(let X=E.start;X<=E.end;++X){const U=c.style._layers[I[X]];if(U.isHidden(c.transform.zoom))continue;const te=c.style._getLayerSourceCache(U),Q=te?this.proxyToSource[L.key][te.id]:[L];if(!Q)continue;const ie=Q;f.viewport.set([0,0,W.fb.width,W.fb.height]),H!==(te?te.id:null)&&(this._setupStencil(W,Q,U,te),H=te?te.id:null),c.renderLayer(c,te,U,ie)}this.renderedToTile?(W.dirty=!0,k.push(j.tileID)):q||--P,P===5&&(P=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}renderCacheEfficiency(o){const c=o.order.length;if(c===0)return{efficiency:100};let f,_=0,b=0,E=!1;for(let k=0;k<c;++k){const I=o._layers[o.order[k]];this._style.isLayerDraped(I)?(E&&++_,++b):E||(E=!0,f=I.id)}return b===0?{efficiency:100}:{efficiency:100*(1-_/b),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,k=1<<E.overscaledZ,{x:I,y:P}=E.canonical,L=I/k,j=(I+1)/k,V=P/k,W=(P+1)/k;return{minx:L,miny:V,maxx:j,maxy:W,t:b.dem.tree.raycastRoot(L,V,j,W,o,c,f),tile:b}});_.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of _){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,c,f);if(E!=null)return E}return null}_createFBO(){const o=this.painter.context,c=o.gl,f=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const _=new s.Texture(o,{width:f[0],height:f[1],data:null},c.RGBA);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=o.createFramebuffer(f[0],f[1],!1);return b.colorAttachment.set(_.texture),b.depthAttachment=new oc(o,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._layers[o],f=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const f of this._style._getSources())if(f instanceof F){o=!0;break}if(!o)return;const c={};for(let f=0;f<this._style.order.length;++f){const _=this._style._layers[this._style.order[f]],b=this._style._getLayerSourceCache(_);if(b&&!c[b.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof s.ZoomDependentExpression){c[b.id]=!0;for(const E of this.proxyCoords){const k=this.proxyToSource[E.key][b.id];if(k)for(const I of k)this._clearRenderCacheForTile(b.id,I)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof $){o=!0;break}if(!o)return;const c={};for(let f=0;f<this._style.order.length;++f){const _=this._style._layers[this._style.order[f]],b=this._style._getLayerSourceCache(_);if(!b||c[b.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const E=_.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const I=this.proxyToSource[k.key][b.id];if(I)for(const P of I){const L=il(b.getTile(P),b.findLoadedParent(P,0),b,this.painter.transform,E);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,P)}}}}_setupDrapedRenderBatches(){const o=this._style.order,c=o.length;if(c===0)return;const f=[];let _,b=0,E=this._style._layers[o[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<c;)E=this._style._layers[o[b]];for(;b<c;++b){const k=this._style._layers[o[b]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?_===void 0&&(_=b):_!==void 0&&(f.push({start:_,end:b-1}),_=void 0))}_!==void 0&&f.push({start:_,end:b-1}),this._drapedRenderBatches=f}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let k=0;k<E.length;++k){const I=Object.values(E[k]);c.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let E=f.length-1;E>=0;E--){const k=f[E];if(c.getTileByID(k.key),c.proxyCachedFBO[k.key]!==void 0){const I=o[k.key],P=this.proxyToSource[k.key];let L=0;for(const j in P){const V=P[j],W=I[j];if(!W||W.length!==V.length||V.some((q,H)=>q!==W[H]||_[j]&&_[j].hasOwnProperty(q.key))){L=-1;break}++L}for(const j in c.proxyCachedFBO[k.key])c.renderCache[c.proxyCachedFBO[k.key][j]].dirty=L<0||L!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort((E,k)=>k.end-k.start-(E.end-E.start));for(const E of b)for(const k of f){if(c.proxyCachedFBO[k.key])continue;let I=c.renderCachePool.pop();I===void 0&&c.renderCache.length<50&&(I=c.renderCache.length,c.renderCache.push(this._createFBO())),I!==void 0&&(c.proxyCachedFBO[k.key]={},c.proxyCachedFBO[k.key][E.start]=I,c.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let k;if(f.isTileClipped())k=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(o,c){const f=this.painter,_=this.painter.context,b=_.gl;f._tileClippingMaskIDs={},_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const E=f.useProgram("clippingMask");for(const k of o){const I=f._tileClippingMaskIDs[k.key]=--c;E.draw(_,b.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,xn(k.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const f=[o.x,o.y,1,1];s.transformMat4$1(f,f,c.pixelMatrixInverse),s.scale$1(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;const _=c._camera.position,b=s.mercatorZfromAltitude(1,c.center.lat),E=[_[0],_[1],_[2]/b,0],k=s.subtract([],f.slice(0,3),E);s.normalize(k,k);const I=this.raycast(E,k,this._exaggeration);return I!==null&&I?(s.scaleAndAdd(E,E,k,I),E[3]=E[2],E[2]*=b,E):null}drawDepth(){const o=this.painter,c=o.context,f=this.proxySourceCache,_=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=c.gl,k=c.createFramebuffer(_,b,!0);c.activeTexture.set(E.TEXTURE0);const I=new s.Texture(c,{width:_,height:b,data:null},E.RGBA);I.bind(E.NEAREST,E.CLAMP_TO_EDGE),k.colorAttachment.set(I.texture);const P=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,_,b);k.depthAttachment.set(P),this._depthFBO=k,this._depthTexture=I}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,_,b]),function(E,k,I,P){if(E.transform.projection.name==="globe")return;const L=E.context,j=L.gl;L.clear({depth:1});const V=E.useProgram("terrainDepth"),W=new s.DepthMode(j.LESS,s.DepthMode.ReadWrite,E.depthRangeFor3D);for(const q of P){const H=I.getTile(q),X=Hu(q.projMatrix,0);k.setupElevationDraw(H,V),V.draw(L,j.TRIANGLES,W,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,X,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(o,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,f){if(o.getSource()instanceof he)return this._setupProxiedCoordsForImageSource(o,c,f);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const _=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let k=0;k<b.length;k++){const I=b[k],P=this._findTileCoveringTileID(I,o);if(P){const L=this._createProxiedId(I,P,f[I.key]&&f[I.key][o.id]);_.push(L),this.proxyToSource[I.key][o.id]=[L]}}let E=!1;for(let k=0;k<c.length;k++){const I=o.getTile(c[k]);if(!I||!I.hasData())continue;const P=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==I.tileID.canonical.z){const L=this.proxyToSource[P.tileID.key][o.id],j=this._createProxiedId(P.tileID,I,f[P.tileID.key]&&f[P.tileID.key][o.id]);L?L.splice(L.length-1,0,j):this.proxyToSource[P.tileID.key][o.id]=[j],_.push(j),E=!0}}this._sourceTilesOverlap[o.id]=E}_setupProxiedCoordsForImageSource(o,c,f){if(!o.getSource().loaded())return;const _=this.proxiedCoords[o.id]=[],b=this.proxyCoords,E=o.getSource(),k=new s.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),I=E.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((L,j)=>(L.min.x=Math.min(L.min.x,j.x-k.x),L.min.y=Math.min(L.min.y,j.y-k.y),L.max.x=Math.max(L.max.x,j.x-k.x),L.max.y=Math.max(L.max.y,j.y-k.y),L),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(L,j)=>{const V=L.wrap+L.canonical.x/(1<<L.canonical.z),W=L.canonical.y/(1<<L.canonical.z),q=s.EXTENT/(1<<L.canonical.z),H=j.wrap+j.canonical.x/(1<<j.canonical.z),X=j.canonical.y/(1<<j.canonical.z);return V+q<H+I.min.x||V>H+I.max.x||W+q<X+I.min.y||W>X+I.max.y};for(let L=0;L<b.length;L++){const j=b[L];for(let V=0;V<c.length;V++){const W=o.getTile(c[V]);if(!W||!W.hasData()||P(j,W.tileID))continue;const q=this._createProxiedId(j,W,f[j.key]&&f[j.key][o.id]),H=this.proxyToSource[j.key][o.id];H?H.push(q):this.proxyToSource[j.key][o.id]=[q],_.push(q)}}}_createProxiedId(o,c,f){let _=this.orthoMatrix;if(f){const b=f.find(E=>E.key===c.tileID.key);if(b)return b}if(c.tileID.key!==o.key){const b=o.canonical.z-c.tileID.canonical.z;let E,k,I;_=s.create();const P=c.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(E=s.EXTENT>>b,k=E*((c.tileID.canonical.x<<b)-o.canonical.x+P),I=E*((c.tileID.canonical.y<<b)-o.canonical.y)):(E=s.EXTENT<<-b,k=s.EXTENT*(c.tileID.canonical.x-(o.canonical.x+P<<-b)),I=s.EXTENT*(c.tileID.canonical.y-(o.canonical.y<<-b))),s.ortho(_,0,E,0,E,0,1),s.translate(_,_,[k,I,0])}return new Yu(c.tileID,o.key,_)}_findTileCoveringTileID(o,c){let f=c.getTile(o);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[c.id],b=_[o.key];if(f=b?c.getTileByID(b):null,f&&f.hasData()||b===null)return f;let E=f?f.tileID:o,k=E.overscaledZ;const I=c.getSource().minzoom,P=[];if(!b){const j=c.getSource().maxzoom;if(o.canonical.z>=j){const V=o.canonical.z-j;c.getSource().reparseOverscaled?(k=Math.max(o.canonical.z+2,c.transform.tileZoom),E=new s.OverscaledTileID(k,o.wrap,j,o.canonical.x>>V,o.canonical.y>>V)):V!==0&&(k=j,E=new s.OverscaledTileID(k,o.wrap,j,o.canonical.x>>V,o.canonical.y>>V))}E.key!==o.key&&(P.push(E.key),f=c.getTile(E))}const L=j=>{P.forEach(V=>{_[V]=j}),P.length=0};for(k-=1;k>=I&&(!f||!f.hasData());k--){f&&L(f.tileID.key);const j=E.calculateScaledKey(k);if(f=c.getTileByID(j),f&&f.hasData())break;const V=_[j];if(V===null)break;V===void 0?P.push(j):f=c.getTileByID(V)}return L(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let f=this._tilesDirty[o];f||(f=this._tilesDirty[o]={}),f[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(c){let f=0;const _=new s.StructArrayLayout2ui4,b=131;for(let E=1;E<129;E++){for(let k=1;k<129;k++)f=E*b+k,_.emplaceBack(f,f+1),_.emplaceBack(f,f+b),_.emplaceBack(f+1,f+b),E===128&&_.emplaceBack(f+b,f+b+1);_.emplaceBack(f+1,f+1+b)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Qu{static cacheKey(o,c,f,_){let b=`${c}${_?_.cacheKey:""}`;for(const E of f)o.usedDefines.includes(E)&&(b+=`/${E}`);return b}constructor(o,c,f,_,b,E){const k=o.gl;this.program=k.createProgram();const I=function(U){const te=[];for(let Q=0;Q<U.length;Q++){if(U[Q]===null)continue;const ie=U[Q].split(" ");te.push(ie.pop())}return te}(f.staticAttributes),P=_?_.getBinderAttributes():[],L=I.concat(P);let j=_?_.defines():[];j=j.concat(E.map(U=>`#define ${U}`));const V=o.isWebGL2?`#version 300 es
`:"",W=V+j.concat(o.extStandardDerivatives&&V.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(fc):fc,fc,pc,ep.fragmentSource,Zu.fragmentSource,f.fragmentSource).join(`
`),q=V+j.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,pc,ep.vertexSource,Zu.vertexSource,Gu.vertexSource,f.vertexSource).join(`
`),H=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(H,W),k.compileShader(H),k.attachShader(this.program,H);const X=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(X,q),k.compileShader(X),k.attachShader(this.program,X),this.attributes={},this.numAttributes=L.length;for(let U=0;U<this.numAttributes;U++)L[U]&&(k.bindAttribLocation(this.program,U,L[U]),this.attributes[L[U]]=U);k.linkProgram(this.program),k.deleteShader(X),k.deleteShader(H),this.fixedUniforms=b(o),this.binderUniforms=_?_.getUniforms(o):[],E.includes("TERRAIN")&&(this.terrainUniforms=(U=>({u_dem:new s.Uniform1i(U),u_dem_prev:new s.Uniform1i(U),u_dem_unpack:new s.Uniform4f(U),u_dem_tl:new s.Uniform2f(U),u_dem_scale:new s.Uniform1f(U),u_dem_tl_prev:new s.Uniform2f(U),u_dem_scale_prev:new s.Uniform1f(U),u_dem_size:new s.Uniform1f(U),u_dem_lerp:new s.Uniform1f(U),u_exaggeration:new s.Uniform1f(U),u_depth:new s.Uniform1i(U),u_depth_size_inv:new s.Uniform2f(U),u_meter_to_dem:new s.Uniform1f(U),u_label_plane_matrix_inv:new s.UniformMatrix4f(U)}))(o)),E.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new s.Uniform3f(U),u_tile_tr_up:new s.Uniform3f(U),u_tile_br_up:new s.Uniform3f(U),u_tile_bl_up:new s.Uniform3f(U),u_tile_up_scale:new s.Uniform1f(U)}))(o)),E.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new s.UniformMatrix4f(U),u_fog_range:new s.Uniform2f(U),u_fog_color:new s.Uniform4f(U),u_fog_horizon_blend:new s.Uniform1f(U),u_fog_temporal_offset:new s.Uniform1f(U),u_frustum_tl:new s.Uniform3f(U),u_frustum_tr:new s.Uniform3f(U),u_frustum_br:new s.Uniform3f(U),u_frustum_bl:new s.Uniform3f(U),u_globe_pos:new s.Uniform3f(U),u_globe_radius:new s.Uniform1f(U),u_globe_transition:new s.Uniform1f(U),u_is_globe:new s.Uniform1i(U),u_viewport:new s.Uniform2f(U)}))(o))}}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)f[_]&&f[_].set(this.program,_,c[_])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)f[_].set(this.program,_,c[_])}}draw(o,c,f,_,b,E,k,I,P,L,j,V,W,q,H){const X=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(f),o.setStencilMode(_),o.setColorMode(b),o.setCullFace(E);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,k[te]);q&&q.setUniforms(this.program,o,this.binderUniforms,V,{zoom:W});const U={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[c];for(const te of j.get()){const Q=te.vaos||(te.vaos={});(Q[I]||(Q[I]=new el)).bind(o,this,P,q?q.getPaintVertexBuffers():[],L,te.vertexOffset,H||[]),X.drawElements(c,te.primitiveLength*U,X.UNSIGNED_SHORT,te.primitiveOffset*U*2)}}}function ip(d,o){const c=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,d.transform.tileZoom)/c,_=f*(o.tileID.canonical.x+o.tileID.wrap*c),b=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_tile_units_to_pixels:1/fi(o,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,b>>16],u_pixel_coord_lower:[65535&_,65535&b]}}const Wm=s.create(),vc=(d,o,c,f,_,b,E,k,I,P,L)=>{const j=o.style.light,V=j.properties.get("position"),W=[V.x,V.y,V.z],q=s.create$1();j.properties.get("anchor")==="viewport"&&(s.fromRotation(q,-o.transform.angle),s.transformMat3(W,W,q));const H=j.properties.get("color"),X=o.transform,U={u_matrix:d,u_lightpos:W,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:b};return X.projection.name==="globe"&&(U.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],U.u_zoom_transition=I,U.u_inv_rot_matrix=L,U.u_merc_center=P,U.u_up_dir=X.projection.upVector(new s.CanonicalTileID(0,0,0),P[0]*s.EXTENT,P[1]*s.EXTENT),U.u_height_lift=k),U},eh=(d,o,c,f,_,b,E,k,I,P,L,j)=>{const V=vc(d,o,c,f,_,b,E,I,P,L,j),W={u_height_factor:-Math.pow(2,E.overscaledZ)/k.tileSize/8};return s.extend(V,ip(o,k),W)},bc=d=>({u_matrix:d}),xc=(d,o,c)=>s.extend(bc(d),ip(o,c)),rp=(d,o)=>({u_matrix:d,u_world:o}),op=(d,o,c,f)=>s.extend(xc(d,o,c),{u_world:f}),Hm=s.create(),rl=(d,o,c,f,_,b)=>{const E=d.transform,k=E.projection.name==="globe";let I;if(b.paint.get("circle-pitch-alignment")==="map")if(k){const L=s.globePixelsToTileUnits(E.zoom,o.canonical)*E._pixelsPerMercatorPixel;I=Float32Array.from([L,0,0,L])}else I=E.calculatePixelsToTileUnitsMatrix(c);else I=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:d.translatePosMatrix(o.projMatrix,c,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:Hm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){P.u_inv_rot_matrix=f,P.u_merc_center=_,P.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],P.u_zoom_transition=s.globeToMercatorTransition(E.zoom);const L=_[0]*s.EXTENT,j=_[1]*s.EXTENT;P.u_up_dir=E.projection.upVector(new s.CanonicalTileID(0,0,0),L,j)}return P},ol=d=>{const o=[];return d.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},sp=(d,o,c,f)=>{const _=s.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:o.getCameraToCenterDistance(f),u_extrude_scale:[o.pixelsToGLUnits[0]/_,o.pixelsToGLUnits[1]/_]}},sl=(d,o,c=1)=>({u_matrix:d,u_color:o,u_overlay:0,u_overlay_scale:c}),th=s.create(),oo=(d,o,c,f,_,b,E)=>{const k=d.transform,I=k.projection.name==="globe",P=I?s.globePixelsToTileUnits(k.zoom,o.canonical)*k._pixelsPerMercatorPixel:fi(c,1,b),L={u_matrix:o.projMatrix,u_extrude_scale:P,u_intensity:E,u_inv_rot_matrix:th,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){L.u_inv_rot_matrix=f,L.u_merc_center=_,L.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],L.u_zoom_transition=s.globeToMercatorTransition(k.zoom);const j=_[0]*s.EXTENT,V=_[1]*s.EXTENT;L.u_up_dir=k.projection.upVector(new s.CanonicalTileID(0,0,0),j,V)}return L},nh=(d,o,c,f,_,b,E)=>{const k=d.transform,I=k.calculatePixelsToTileUnitsMatrix(o);return{u_matrix:ih(d,o,c,f),u_pixels_to_tile_units:I,u_device_pixel_ratio:b,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:Tc(c)?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:wc(o,d.transform),u_alpha_discard_threshold:0,u_trim_offset:E}},ap=(d,o,c,f,_)=>{const b=d.transform;return{u_matrix:ih(d,o,c,f),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:wc(o,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function wc(d,o){return 1/fi(d,1,o.tileZoom)}function ih(d,o,c,f){return d.translatePosMatrix(f||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Tc(d){const o=d.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const Xm=(d,o,c,f,_,b)=>{return{u_matrix:d,u_tl_parent:o,u_scale_parent:c,u_fade_t:f.mix,u_opacity:f.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(k=_.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(E=_.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:rh(_.paint.get("raster-hue-rotate")),u_perspective_transform:b};var E,k};function rh(d){d*=Math.PI/180;const o=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const lp=s.create(),al=(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q,H)=>{const X=_.transform,U={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:X.width/X.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:k,u_is_text:+I,u_pitch_with_map:+f,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lp,u_up_vector:[0,-1,0]};return H.name==="globe"&&(U.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],U.u_zoom_transition=j,U.u_inv_rot_matrix=W,U.u_merc_center=V,U.u_camera_forward=X._camera.forward(),U.u_ecef_origin=s.globeECEFOrigin(X.globeMatrix,L.toUnwrapped()),U.u_tile_matrix=Float32Array.from(X.globeMatrix),U.u_up_vector=q),U},cp=(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q,H,X)=>s.extend(al(d,o,c,f,_,b,E,k,I,P,j,V,W,q,H,X),{u_gamma_scale:f?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+L}),oh=(d,o,c,f,_,b,E,k,I,P,L,j,V,W,q,H)=>s.extend(cp(d,o,c,f,_,b,E,k,!0,I,!0,L,j,V,W,q,H),{u_texsize_icon:P,u_texture_icon:1}),Km=(d,o,c)=>({u_matrix:d,u_opacity:o,u_color:c}),sh=(d,o,c,f,_)=>s.extend(function(b,E,k){const I=E.imageManager.getPattern(b.toString()),{width:P,height:L}=E.imageManager.getPixelSize(),j=Math.pow(2,k.tileID.overscaledZ),V=k.tileSize*Math.pow(2,E.transform.tileZoom)/j,W=V*(k.tileID.canonical.x+k.tileID.wrap*j),q=V*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[P,L],u_pattern_size:I.displaySize,u_tile_units_to_pixels:1/fi(k,1,E.transform.tileZoom),u_pixel_coord_upper:[W>>16,q>>16],u_pixel_coord_lower:[65535&W,65535&q]}}(f,c,_),{u_matrix:d,u_opacity:o}),Ym={fillExtrusion:d=>({u_matrix:new s.UniformMatrix4f(d),u_lightpos:new s.Uniform3f(d),u_lightintensity:new s.Uniform1f(d),u_lightcolor:new s.Uniform3f(d),u_vertical_gradient:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_edge_radius:new s.Uniform1f(d),u_ao:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_up_dir:new s.Uniform3f(d),u_height_lift:new s.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_lightpos:new s.Uniform3f(d),u_lightintensity:new s.Uniform1f(d),u_lightcolor:new s.Uniform3f(d),u_vertical_gradient:new s.Uniform1f(d),u_height_factor:new s.Uniform1f(d),u_edge_radius:new s.Uniform1f(d),u_ao:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_up_dir:new s.Uniform3f(d),u_height_lift:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d)}),fill:d=>({u_matrix:new s.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),fillOutline:d=>({u_matrix:new s.UniformMatrix4f(d),u_world:new s.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_world:new s.Uniform2f(d),u_image:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new s.Uniform1f(d),u_extrude_scale:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_up_dir:new s.Uniform3f(d)}),collisionBox:d=>({u_matrix:new s.UniformMatrix4f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_extrude_scale:new s.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new s.UniformMatrix4f(d),u_inv_matrix:new s.UniformMatrix4f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_viewport_size:new s.Uniform2f(d)}),debug:d=>({u_color:new s.UniformColor(d),u_matrix:new s.UniformMatrix4f(d),u_overlay:new s.Uniform1i(d),u_overlay_scale:new s.Uniform1f(d)}),clippingMask:d=>({u_matrix:new s.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new s.Uniform1f(d),u_intensity:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_up_dir:new s.Uniform3f(d)}),heatmapTexture:d=>({u_image:new s.Uniform1i(d),u_color_ramp:new s.Uniform1i(d),u_opacity:new s.Uniform1f(d)}),hillshade:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_latrange:new s.Uniform2f(d),u_light:new s.Uniform2f(d),u_shadow:new s.UniformColor(d),u_highlight:new s.UniformColor(d),u_accent:new s.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new s.UniformMatrix4f(d),u_image:new s.Uniform1i(d),u_dimension:new s.Uniform2f(d),u_zoom:new s.Uniform1f(d),u_unpack:new s.Uniform4f(d)}),line:d=>({u_matrix:new s.UniformMatrix4f(d),u_pixels_to_tile_units:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_units_to_pixels:new s.Uniform2f(d),u_dash_image:new s.Uniform1i(d),u_gradient_image:new s.Uniform1i(d),u_image_height:new s.Uniform1f(d),u_texsize:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_alpha_discard_threshold:new s.Uniform1f(d),u_trim_offset:new s.Uniform2f(d)}),linePattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_texsize:new s.Uniform2f(d),u_pixels_to_tile_units:new s.UniformMatrix2f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_units_to_pixels:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d),u_alpha_discard_threshold:new s.Uniform1f(d)}),raster:d=>({u_matrix:new s.UniformMatrix4f(d),u_tl_parent:new s.Uniform2f(d),u_scale_parent:new s.Uniform1f(d),u_fade_t:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_image0:new s.Uniform1i(d),u_image1:new s.Uniform1i(d),u_brightness_low:new s.Uniform1f(d),u_brightness_high:new s.Uniform1f(d),u_saturation_factor:new s.Uniform1f(d),u_contrast_factor:new s.Uniform1f(d),u_spin_weights:new s.Uniform3f(d),u_perspective_transform:new s.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_camera_forward:new s.Uniform3f(d),u_tile_matrix:new s.UniformMatrix4f(d),u_up_vector:new s.Uniform3f(d),u_ecef_origin:new s.Uniform3f(d),u_texture:new s.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_texture:new s.Uniform1i(d),u_gamma_scale:new s.Uniform1f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_tile_id:new s.Uniform3f(d),u_zoom_transition:new s.Uniform1f(d),u_inv_rot_matrix:new s.UniformMatrix4f(d),u_merc_center:new s.Uniform2f(d),u_camera_forward:new s.Uniform3f(d),u_tile_matrix:new s.UniformMatrix4f(d),u_up_vector:new s.Uniform3f(d),u_ecef_origin:new s.Uniform3f(d),u_is_halo:new s.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new s.Uniform1i(d),u_is_size_feature_constant:new s.Uniform1i(d),u_size_t:new s.Uniform1f(d),u_size:new s.Uniform1f(d),u_camera_to_center_distance:new s.Uniform1f(d),u_rotate_symbol:new s.Uniform1i(d),u_aspect_ratio:new s.Uniform1f(d),u_fade_change:new s.Uniform1f(d),u_matrix:new s.UniformMatrix4f(d),u_label_plane_matrix:new s.UniformMatrix4f(d),u_coord_matrix:new s.UniformMatrix4f(d),u_is_text:new s.Uniform1i(d),u_pitch_with_map:new s.Uniform1i(d),u_texsize:new s.Uniform2f(d),u_texsize_icon:new s.Uniform2f(d),u_texture:new s.Uniform1i(d),u_texture_icon:new s.Uniform1i(d),u_gamma_scale:new s.Uniform1f(d),u_device_pixel_ratio:new s.Uniform1f(d),u_is_halo:new s.Uniform1i(d)}),background:d=>({u_matrix:new s.UniformMatrix4f(d),u_opacity:new s.Uniform1f(d),u_color:new s.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new s.UniformMatrix4f(d),u_opacity:new s.Uniform1f(d),u_image:new s.Uniform1i(d),u_pattern_tl:new s.Uniform2f(d),u_pattern_br:new s.Uniform2f(d),u_texsize:new s.Uniform2f(d),u_pattern_size:new s.Uniform2f(d),u_pixel_coord_upper:new s.Uniform2f(d),u_pixel_coord_lower:new s.Uniform2f(d),u_tile_units_to_pixels:new s.Uniform1f(d)}),terrainRaster:gc,terrainDepth:gc,skybox:d=>({u_matrix:new s.UniformMatrix4f(d),u_sun_direction:new s.Uniform3f(d),u_cubemap:new s.Uniform1i(d),u_opacity:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new s.UniformMatrix4f(d),u_color_ramp:new s.Uniform1i(d),u_center_direction:new s.Uniform3f(d),u_radius:new s.Uniform1f(d),u_opacity:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new s.UniformMatrix3f(d),u_sun_direction:new s.Uniform3f(d),u_sun_intensity:new s.Uniform1f(d),u_color_tint_r:new s.Uniform4f(d),u_color_tint_m:new s.Uniform4f(d),u_luminance:new s.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new s.UniformMatrix4f(d),u_globe_matrix:new s.UniformMatrix4f(d),u_normalize_matrix:new s.UniformMatrix4f(d),u_merc_matrix:new s.UniformMatrix4f(d),u_zoom_transition:new s.Uniform1f(d),u_merc_center:new s.Uniform2f(d),u_image0:new s.Uniform1i(d),u_grid_matrix:new s.UniformMatrix3f(d),u_skirt_height:new s.Uniform1f(d),u_frustum_tl:new s.Uniform3f(d),u_frustum_tr:new s.Uniform3f(d),u_frustum_br:new s.Uniform3f(d),u_frustum_bl:new s.Uniform3f(d),u_globe_pos:new s.Uniform3f(d),u_globe_radius:new s.Uniform1f(d),u_viewport:new s.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.Uniform3f(d),u_frustum_tr:new s.Uniform3f(d),u_frustum_br:new s.Uniform3f(d),u_frustum_bl:new s.Uniform3f(d),u_horizon:new s.Uniform1f(d),u_transition:new s.Uniform1f(d),u_fadeout_range:new s.Uniform1f(d),u_color:new s.Uniform4f(d),u_high_color:new s.Uniform4f(d),u_space_color:new s.Uniform4f(d),u_star_intensity:new s.Uniform1f(d),u_star_density:new s.Uniform1f(d),u_star_size:new s.Uniform1f(d),u_temporal_offset:new s.Uniform1f(d),u_horizon_angle:new s.Uniform1f(d),u_rotation_matrix:new s.UniformMatrix4f(d)})};let Es;function up(d,o,c,f,_,b,E){const k=d.context,I=k.gl,P=d.transform,L=d.useProgram("collisionBox"),j=[];let V=0,W=0;for(let ie=0;ie<f.length;ie++){const ue=f[ie],le=o.getTile(ue),de=le.getBucket(c);if(!de)continue;const xe=Nu(ue,de,P);let Ae=xe;_[0]===0&&_[1]===0||(Ae=d.translatePosMatrix(xe,le,_,b));const Le=E?de.textCollisionBox:de.iconCollisionBox,st=de.collisionCircleArray;if(st.length>0){const Ee=s.create(),Ve=Ae;s.mul(Ee,de.placementInvProjMatrix,P.glCoordMatrix),s.mul(Ee,Ee,de.placementViewportMatrix),j.push({circleArray:st,circleOffset:W,transform:Ve,invTransform:Ee,projection:de.getProjection()}),V+=st.length/4,W=V}Le&&(d.terrain&&d.terrain.setupElevationDraw(le,L),L.draw(k,I.LINES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,sp(Ae,P,le,de.getProjection()),c.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,P.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!E||!j.length)return;const q=d.useProgram("collisionCircle"),H=new s.StructArrayLayout2f1f2i16;H.resize(4*V),H._trim();let X=0;for(const ie of j)for(let ue=0;ue<ie.circleArray.length/4;ue++){const le=4*ue,de=ie.circleArray[le+0],xe=ie.circleArray[le+1],Ae=ie.circleArray[le+2],Le=ie.circleArray[le+3];H.emplace(X++,de,xe,Ae,Le,0),H.emplace(X++,de,xe,Ae,Le,1),H.emplace(X++,de,xe,Ae,Le,2),H.emplace(X++,de,xe,Ae,Le,3)}(!Es||Es.length<2*V)&&(Es=function(ie){const ue=2*ie,le=new s.StructArrayLayout3ui6;le.resize(ue),le._trim();for(let de=0;de<ue;de++){const xe=6*de;le.uint16[xe+0]=4*de+0,le.uint16[xe+1]=4*de+1,le.uint16[xe+2]=4*de+2,le.uint16[xe+3]=4*de+2,le.uint16[xe+4]=4*de+3,le.uint16[xe+5]=4*de+0}return le}(V));const U=k.createIndexBuffer(Es,!0),te=k.createVertexBuffer(H,s.collisionCircleLayout.members,!0);for(const ie of j){const ue={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(Q=P).getCameraToCenterDistance(ie.projection),u_viewport_size:[Q.width,Q.height]};q.draw(k,I.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,ue,c.id,te,U,s.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,P.zoom)}var Q;te.destroy(),U.destroy()}const ah=s.create();function hp({width:d,height:o,anchor:c,textOffset:f,textScale:_},b){const{horizontalAlign:E,verticalAlign:k}=s.getAnchorAlignment(c),I=-(E-.5)*d,P=-(k-.5)*o,L=s.evaluateVariableOffset(c,f);return new s.pointGeometry((I/_+L[0])*b,(P/_+L[1])*b)}function ea(d,o,c,f,_,b,E,k,I,P,L){const j=d.text.placedSymbolArray,V=d.text.dynamicLayoutVertexArray,W=d.icon.dynamicLayoutVertexArray,q={},H=d.getProjection(),X=sc(k,H,b),U=b.elevation,te=H.upVectorScale(k.canonical,b.center.lat,b.worldSize).metersToTile;V.clear();for(let Q=0;Q<j.length;Q++){const ie=j.get(Q),{tileAnchorX:ue,tileAnchorY:le,numGlyphs:de}=ie,xe=d.allowVerticalPlacement&&!ie.placedOrientation,Ae=ie.hidden||!ie.crossTileID||xe?null:f[ie.crossTileID];if(Ae){let Le=0,st=0,Ee=0;if(U){const Ct=U?U.getAtTileOffset(k,ue,le):0,[Qt,kt,vt]=H.upVector(k.canonical,ue,le);Le=Ct*Qt*te,st=Ct*kt*te,Ee=Ct*vt*te}let[Ve,Oe,Je,Ce]=lt(ie.projectedAnchorX+Le,ie.projectedAnchorY+st,ie.projectedAnchorZ+Ee,c?X:E);const ye=_n(b.getCameraToCenterDistance(H),Ce);let Re=_.evaluateSizeForFeature(d.textSizeData,P,ie)*ye/s.ONE_EM;c&&(Re*=d.tilePixelRatio/I);const He=hp(Ae,Re);c?({x:Ve,y:Oe,z:Je}=H.projectTilePoint(ue+He.x,le+He.y,k.canonical),[Ve,Oe,Je]=lt(Ve+Le,Oe+st,Je+Ee,E)):(o&&He._rotate(-b.angle),Ve+=He.x,Oe+=He.y,Je=0);const tt=d.allowVerticalPlacement&&ie.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let Ct=0;Ct<de;Ct++)s.addDynamicAttributes(V,Ve,Oe,Je,tt);L&&ie.associatedIconIndex>=0&&(q[ie.associatedIconIndex]={x:Ve,y:Oe,z:Je,angle:tt})}else Jn(de,V)}if(L){W.clear();const Q=d.icon.placedSymbolArray;for(let ie=0;ie<Q.length;ie++){const ue=Q.get(ie),{numGlyphs:le}=ue,de=q[ie];if(ue.hidden||!de)Jn(le,W);else{const{x:xe,y:Ae,z:Le,angle:st}=de;for(let Ee=0;Ee<le;Ee++)s.addDynamicAttributes(W,xe,Ae,Le,st)}}d.icon.dynamicLayoutVertexBuffer.updateData(W)}d.text.dynamicLayoutVertexBuffer.updateData(V)}function Jm(d,o,c){return c.iconsInText&&o?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function dp(d,o,c,f,_,b,E,k,I,P,L,j){const V=d.context,W=V.gl,q=d.transform,H=k==="map",X=I==="map",U=H&&c.layout.get("symbol-placement")!=="point",te=H&&!X&&!U,Q=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ie=!1;const ue=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),le=[s.mercatorXfromLng(q.center.lng),s.mercatorYfromLat(q.center.lat)],de=c.layout.get("text-variable-anchor"),xe=q.projection.name==="globe",Ae=[],Le=[0,-1,0];let st=Le;!xe&&!q.mercatorFromTransition||H||(st=function(Ee){const Ve=Ee._camera.getWorldToCamera(Ee.worldSize,1),Oe=s.multiply([],Ve,Ee.globeMatrix);s.invert(Oe,Oe);const Je=[0,0,0],Ce=[0,1,0,0];return s.transformMat4$1(Ce,Ce,Oe),Je[0]=Ce[0],Je[1]=Ce[1],Je[2]=Ce[2],s.normalize(Je,Je),Je}(q));for(const Ee of f){const Ve=o.getTile(Ee),Oe=Ve.getBucket(c);if(!Oe||Oe.projection.name==="mercator"&&xe)continue;const Je=_?Oe.text:Oe.icon;if(!Je||Oe.fullyClipped||!Je.segments.get().length)continue;const Ce=Je.programConfigurations.get(c.id),ye=_||Oe.sdfIcons,Re=_?Oe.textSizeData:Oe.iconSizeData,He=X||q.pitch!==0,tt=s.evaluateSizeForZoom(Re,q.zoom);let Ct,Qt,kt,vt,Mt=[0,0],hn=null;if(_){if(Qt=Ve.glyphAtlasTexture,kt=W.LINEAR,Ct=Ve.glyphAtlasTexture.size,Oe.iconsInText){Mt=Ve.imageAtlasTexture.size,hn=Ve.imageAtlasTexture;const Ar=Re.kind==="composite"||Re.kind==="camera";vt=He||d.options.rotating||d.options.zooming||Ar?W.LINEAR:W.NEAREST}}else{const Ar=c.layout.get("icon-size").constantOr(0)!==1||Oe.iconsNeedLinear;Qt=Ve.imageAtlasTexture,kt=ye||d.options.rotating||d.options.zooming||Ar||He?W.LINEAR:W.NEAREST,Ct=Ve.imageAtlasTexture.size}const Dt=Oe.projection.name==="globe",Dn=Dt?st:Le,Gn=Dt?s.globeToMercatorTransition(q.zoom):0,Qn=sc(Ee,Oe.getProjection(),q),Xn=q.calculatePixelsToTileUnitsMatrix(Ve),Ti=Zs(Qn,Ve.tileID.canonical,X,H,q,Oe.getProjection(),Xn),hr=d.terrain&&X&&U?s.invert(s.create(),Ti):ah,Hr=qs(Qn,Ve.tileID.canonical,X,H,q,Oe.getProjection(),Xn),xo=de&&Oe.hasTextData(),li=c.layout.get("icon-text-fit")!=="none"&&xo&&Oe.hasIconData();if(U){const Ar=q.elevation,Fr=Ar?Ar.getAtTileOffsetFunc(Ee,q.center.lat,q.worldSize,Oe.getProjection()):null,wo=Wd(Qn,Ve.tileID.canonical,X,H,q,Oe.getProjection(),Xn);ro(Oe,Qn,d,_,wo,Hr,X,P,Fr,Ee)}const Kn=U||_&&de||li,An=d.translatePosMatrix(Qn,Ve,b,E),gi=Kn?ah:Ti,Xi=d.translatePosMatrix(Hr,Ve,b,E,!0),ii=Oe.getProjection().createInversionMatrix(q,Ee.canonical),Ki=[];d.terrainRenderModeElevated()&&X&&Ki.push("PITCH_WITH_MAP_TERRAIN"),Dt&&Ki.push("PROJECTION_GLOBE_VIEW"),Kn&&Ki.push("PROJECTED_POS_ON_VIEWPORT");const Yi=ye&&c.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ho;Ho=ye?Oe.iconsInText?oh(Re.kind,tt,te,X,d,An,gi,Xi,Ct,Mt,Ee,Gn,le,ii,Dn,Oe.getProjection()):cp(Re.kind,tt,te,X,d,An,gi,Xi,_,Ct,!0,Ee,Gn,le,ii,Dn,Oe.getProjection()):al(Re.kind,tt,te,X,d,An,gi,Xi,_,Ct,Ee,Gn,le,ii,Dn,Oe.getProjection());const ha={program:d.useProgram(Jm(ye,_,Oe),Ce,Ki),buffers:Je,uniformValues:Ho,atlasTexture:Qt,atlasTextureIcon:hn,atlasInterpolation:kt,atlasInterpolationIcon:vt,isSDF:ye,hasHalo:Yi,tile:Ve,labelPlaneMatrixInv:hr};if(Q&&Oe.canOverlap){ie=!0;const Ar=Je.segments.get();for(const Fr of Ar)Ae.push({segments:new s.SegmentVector([Fr]),sortKey:Fr.sortKey,state:ha})}else Ae.push({segments:Je.segments,sortKey:0,state:ha})}ie&&Ae.sort((Ee,Ve)=>Ee.sortKey-Ve.sortKey);for(const Ee of Ae){const Ve=Ee.state;if(d.terrain&&d.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!xe,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),V.activeTexture.set(W.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,W.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(V.activeTexture.set(W.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ve.isSDF){const Oe=Ve.uniformValues;Ve.hasHalo&&(Oe.u_is_halo=1,pp(Ve.buffers,Ee.segments,c,d,Ve.program,ue,L,j,Oe)),Oe.u_is_halo=0}pp(Ve.buffers,Ee.segments,c,d,Ve.program,ue,L,j,Ve.uniformValues)}}function pp(d,o,c,f,_,b,E,k,I){const P=f.context,L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];_.draw(P,P.gl.TRIANGLES,b,E,k,s.CullFaceMode.disabled,I,c.id,d.layoutVertexBuffer,d.indexBuffer,o,c.paint,f.transform.zoom,d.programConfigurations.get(c.id),L)}function fp(d,o,c,f,_,b,E){const k=d.context.gl,I=c.paint.get("fill-pattern"),P=I&&I.constantOr(1);let L,j,V,W,q;E?(j=P&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=k.LINES):(j=P?"fillPattern":"fill",L=k.TRIANGLES);for(const H of f){const X=o.getTile(H);if(P&&!X.patternsLoaded())continue;const U=X.getBucket(c);if(!U)continue;d.prepareDrawTile();const te=U.programConfigurations.get(c.id),Q=d.useProgram(j,te);P&&(d.context.activeTexture.set(k.TEXTURE0),X.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),te.updatePaintBuffers());const ie=I.constantOr(null);if(ie&&X.imageAtlas){const le=X.imageAtlas.patternPositions[ie.toString()];le&&te.setConstantPatternPositions(le)}const ue=d.translatePosMatrix(H.projMatrix,X,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){W=U.indexBuffer2,q=U.segments2;const le=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];V=j==="fillOutlinePattern"&&P?op(ue,d,X,le):rp(ue,le)}else W=U.indexBuffer,q=U.segments,V=P?xc(ue,d,X):bc(ue);d.prepareDrawProgram(d.context,Q,H.toUnwrapped()),Q.draw(d.context,L,_,d.stencilModeForClipping(H),b,s.CullFaceMode.disabled,V,c.id,U.layoutVertexBuffer,W,q,c.paint,d.transform.zoom,te)}}function lh(d,o,c,f,_,b,E){const k=d.context,I=k.gl,P=d.transform,L=c.paint.get("fill-extrusion-pattern"),j=L.constantOr(1),V=c.paint.get("fill-extrusion-opacity"),W=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],q=c.layout.get("fill-extrusion-edge-radius"),H=P.projection.name==="globe"?s.fillExtrusionHeightLift():0,X=P.projection.name==="globe",U=X?s.globeToMercatorTransition(P.zoom):0,te=[s.mercatorXfromLng(P.center.lng),s.mercatorYfromLat(P.center.lat)],Q=[];X&&Q.push("PROJECTION_GLOBE_VIEW"),W[0]>0&&Q.push("FAUX_AO");for(const ie of f){const ue=o.getTile(ie),le=ue.getBucket(c);if(!le||le.projection.name!==P.projection.name)continue;const de=le.programConfigurations.get(c.id),xe=d.useProgram(j?"fillExtrusionPattern":"fillExtrusion",de,Q);if(d.terrain){const Je=d.terrain;if(d.style.terrainSetForDrapingOnly())Je.setupElevationDraw(ue,xe,{useMeterToDem:!0});else{if(!le.enableTerrain)continue;if(Je.setupElevationDraw(ue,xe,{useMeterToDem:!0}),Qm(k,o,ie,le,c,Je),!le.centroidVertexBuffer){const Ce=xe.attributes.a_centroid_pos;Ce!==void 0&&I.vertexAttrib2f(Ce,0,0)}}}j&&(d.context.activeTexture.set(I.TEXTURE0),ue.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),de.updatePaintBuffers());const Ae=L.constantOr(null);if(Ae&&ue.imageAtlas){const Je=ue.imageAtlas.patternPositions[Ae.toString()];Je&&de.setConstantPatternPositions(Je)}const Le=d.translatePosMatrix(ie.projMatrix,ue,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),st=P.projection.createInversionMatrix(P,ie.canonical),Ee=c.paint.get("fill-extrusion-vertical-gradient"),Ve=j?eh(Le,d,Ee,V,W,q,ie,ue,H,U,te,st):vc(Le,d,Ee,V,W,q,ie,H,U,te,st);d.prepareDrawProgram(k,xe,ie.toUnwrapped());const Oe=[];d.terrain&&Oe.push(le.centroidVertexBuffer),X&&Oe.push(le.layoutVertexExtBuffer),xe.draw(k,k.gl.TRIANGLES,_,b,E,s.CullFaceMode.backCCW,Ve,c.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,c.paint,d.transform.zoom,de,Oe)}}function Qm(d,o,c,f,_,b){const E=[U=>{let te=U.canonical.x-1,Q=U.wrap;return te<0&&(te=(1<<U.canonical.z)-1,Q--),new s.OverscaledTileID(U.overscaledZ,Q,U.canonical.z,te,U.canonical.y)},U=>{let te=U.canonical.x+1,Q=U.wrap;return te===1<<U.canonical.z&&(te=0,Q++),new s.OverscaledTileID(U.overscaledZ,Q,U.canonical.z,te,U.canonical.y)},U=>new s.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(U.canonical.y===0?1<<U.canonical.z:U.canonical.y)-1),U=>new s.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],k=U=>{const te=o.getSource().minzoom,Q=ue=>{const le=o.getTileByID(ue);if(le&&le.hasData())return le.getBucket(_)},ie=[0,-1,1];for(const ue of ie){if(U.overscaledZ+ue<te)continue;const le=Q(U.calculateScaledKey(U.overscaledZ+ue));if(le)return le}},I=[0,0,0],P=(U,te)=>(I[0]=Math.min(U.min.y,te.min.y),I[1]=Math.max(U.max.y,te.max.y),I[2]=s.EXTENT-te.min.x>U.max.x?te.min.x-s.EXTENT:U.max.x,I),L=(U,te)=>(I[0]=Math.min(U.min.x,te.min.x),I[1]=Math.max(U.max.x,te.max.x),I[2]=s.EXTENT-te.min.y>U.max.y?te.min.y-s.EXTENT:U.max.y,I),j=[(U,te)=>P(U,te),(U,te)=>P(te,U),(U,te)=>L(U,te),(U,te)=>L(te,U)],V=new s.pointGeometry(0,0);let W,q,H;const X=(U,te,Q,ie,ue)=>{const le=[[ie?Q:U,ie?U:Q,0],[ie?Q:te,ie?te:Q,0]],de=ue<0?s.EXTENT+ue:ue,xe=[ie?de:(U+te)/2,ie?(U+te)/2:de,0];return Q===0&&ue<0||Q!==0&&ue>0?b.getForTilePoints(H,[xe],!0,q):le.push(xe),b.getForTilePoints(c,le,!0,W),Math.max(le[0][2],le[1][2],xe[2])/b.exaggeration()};for(let U=0;U<4;U++){const te=(U<2?1:5)-U,Q=f.borders[U];if(Q.length===0)continue;const ie=H=E[U](c),ue=k(ie);if(!(ue&&ue instanceof s.FillExtrusionBucket&&ue.enableTerrain)||f.borderDoneWithNeighborZ[U]===ue.canonical.z&&ue.borderDoneWithNeighborZ[te]===f.canonical.z||(q=b.findDEMTileFor(ie),!q||!q.dem))continue;if(!W){const Ae=b.findDEMTileFor(c);if(!Ae||!Ae.dem)return;W=Ae}const le=ue.borders[te];let de=0;const xe=ue.borderDoneWithNeighborZ[te]!==f.canonical.z;if(f.canonical.z===ue.canonical.z){for(let Ae=0;Ae<Q.length;Ae++){const Le=f.featuresOnBorder[Q[Ae]],st=Le.borders[U];let Ee;for(;de<le.length&&(Ee=ue.featuresOnBorder[le[de]],!(Ee.borders[te][1]>st[0]+3));)xe&&ue.encodeCentroid(void 0,Ee,!1),de++;if(Ee&&de<le.length){const Ve=de;let Oe=0;for(;!(Ee.borders[te][0]>st[1]-3)&&(Oe++,++de!==le.length);)Ee=ue.featuresOnBorder[le[de]];if(Ee=ue.featuresOnBorder[le[Ve]],Le.intersectsCount()>1||Ee.intersectsCount()>1||Oe!==1){Oe!==1&&(de=Ve),f.encodeCentroid(void 0,Le,!1),xe&&ue.encodeCentroid(void 0,Ee,!1);continue}const Je=j[U](Le,Ee),Ce=U%2?s.EXTENT-1:0;V.x=X(Je[0],Math.min(s.EXTENT-1,Je[1]),Ce,U<2,Je[2]),V.y=0,f.encodeCentroid(V,Le,!1),xe&&ue.encodeCentroid(V,Ee,!1)}else f.encodeCentroid(void 0,Le,!1)}f.borderDoneWithNeighborZ[U]=ue.canonical.z,f.needsCentroidUpdate=!0,xe&&(ue.borderDoneWithNeighborZ[te]=f.canonical.z,ue.needsCentroidUpdate=!0)}else{for(const Ae of Q)f.encodeCentroid(void 0,f.featuresOnBorder[Ae],!1);if(xe){for(const Ae of le)ue.encodeCentroid(void 0,ue.featuresOnBorder[Ae],!1);ue.borderDoneWithNeighborZ[te]=f.canonical.z,ue.needsCentroidUpdate=!0}f.borderDoneWithNeighborZ[U]=ue.canonical.z,f.needsCentroidUpdate=!0}}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const ch=new s.Color(1,0,0,1),uh=new s.Color(0,1,0,1),mp=new s.Color(0,0,1,1),gp=new s.Color(1,0,1,1),_p=new s.Color(0,1,1,1);function hh(d,o,c){const f=d.context,_=d.transform,b=f.gl,E=_.projection.name==="globe",k=E?["PROJECTION_GLOBE_VIEW"]:null;let I=c.projMatrix;if(E&&s.globeToMercatorTransition(_.zoom)>0){const Le=s.transitionTileAABBinECEF(c.canonical,_),st=s.globeDenormalizeECEF(Le);I=s.multiply(new Float32Array(16),_.globeMatrix,st),s.multiply(I,_.projMatrix,I)}const P=d.useProgram("debug",null,k),L=o.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(L,P);const j=s.DepthMode.disabled,V=s.StencilMode.disabled,W=d.colorModeForRenderPass(),q="$debug";f.activeTexture.set(b.TEXTURE0),d.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),E?L._makeGlobeTileDebugBuffers(d.context,_):L._makeDebugTileBoundsBuffers(d.context,_.projection);const H=L._tileDebugBuffer||d.debugBuffer,X=L._tileDebugIndexBuffer||d.debugIndexBuffer,U=L._tileDebugSegments||d.debugSegments;P.draw(f,b.LINE_STRIP,j,V,W,s.CullFaceMode.disabled,sl(I,s.Color.red),q,H,X,U,null,null,null,[L._globeTileDebugBorderBuffer]);const te=L.latestRawTileData,Q=Math.floor((te&&te.byteLength||0)/1024),ie=o.getTile(c).tileSize,ue=512/Math.min(ie,512)*(c.overscaledZ/_.zoom)*.5;let le=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(le+=` => ${c.overscaledZ}`),le+=` ${Q}kb`,function(Le,st){Le.initDebugOverlayCanvas();const Ee=Le.debugOverlayCanvas,Ve=Le.context.gl,Oe=Le.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,Ee.width,Ee.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(st,5,5),Oe.strokeText(st,5,5),Le.debugOverlayTexture.update(Ee),Le.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(d,le);const de=L._tileDebugTextBuffer||d.debugBuffer,xe=L._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ae=L._tileDebugTextSegments||d.debugSegments;P.draw(f,b.TRIANGLES,j,V,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,sl(I,s.Color.transparent,ue),q,de,xe,Ae,null,null,null,[L._globeTileDebugTextBuffer])}function Wo(d,o,c,f){ll(d,0,o+c/2,d.transform.width,c,f)}function ta(d,o,c,f){ll(d,o-c/2,0,c,d.transform.height,f)}function ll(d,o,c,f,_,b){const E=d.context,k=E.gl;k.enable(k.SCISSOR_TEST),k.scissor(o*s.exported.devicePixelRatio,c*s.exported.devicePixelRatio,f*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio),E.clear({color:b}),k.disable(k.SCISSOR_TEST)}const na=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ia}=na;function vo(d,o,c,f){d.emplaceBack(o,c,f)}class Ec{constructor(o){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,vo(this.vertexArray,-1,-1,1),vo(this.vertexArray,1,-1,1),vo(this.vertexArray,-1,1,1),vo(this.vertexArray,1,1,1),vo(this.vertexArray,-1,-1,-1),vo(this.vertexArray,1,-1,-1),vo(this.vertexArray,-1,1,-1),vo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,ia),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function vn(d,o,c,f,_,b){const E=d.gl,k=o.paint.get("sky-atmosphere-color"),I=o.paint.get("sky-atmosphere-halo-color"),P=o.paint.get("sky-atmosphere-sun-intensity"),L=((j,V,W,q,H)=>({u_matrix_3f:j,u_sun_direction:V,u_sun_intensity:W,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),f),_,P,k,I);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),c.draw(d,E.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const kc=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class eg{constructor(o){const c=new s.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const f=new s.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,kc.members),this.indexBuffer=o.createIndexBuffer(f),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const dh={symbol:function(d,o,c,f,_){if(d.renderPass!=="translucent")return;const b=s.StencilMode.disabled,E=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(k,I,P,L,j,V,W){const q=I.transform,H=j==="map",X=V==="map";for(const U of k){const te=L.getTile(U),Q=te.getBucket(P);if(!Q||!Q.text||!Q.text.segments.get().length)continue;const ie=s.evaluateSizeForZoom(Q.textSizeData,q.zoom),ue=sc(U,Q.getProjection(),q),le=q.calculatePixelsToTileUnitsMatrix(te),de=Zs(ue,te.tileID.canonical,X,H,q,Q.getProjection(),le),xe=P.layout.get("icon-text-fit")!=="none"&&Q.hasIconData();if(ie){const Ae=Math.pow(2,q.zoom-te.tileID.overscaledZ);ea(Q,H,X,W,s.symbolSize,q,de,U,Ae,ie,xe)}}}(f,d,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_),c.paint.get("icon-opacity").constantOr(1)!==0&&dp(d,o,c,f,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,E),c.paint.get("text-opacity").constantOr(1)!==0&&dp(d,o,c,f,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,E),o.map.showCollisionBoxes&&(up(d,o,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),up(d,o,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,o,c,f){if(d.renderPass!=="translucent")return;const _=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),k=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const I=d.context,P=I.gl,L=d.transform,j=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),V=s.StencilMode.disabled,W=d.colorModeForRenderPass(),q=L.projection.name==="globe",H=[s.mercatorXfromLng(L.center.lng),s.mercatorYfromLat(L.center.lat)],X=[];for(let te=0;te<f.length;te++){const Q=f[te],ie=o.getTile(Q),ue=ie.getBucket(c);if(!ue||ue.projection.name!==L.projection.name)continue;const le=ue.programConfigurations.get(c.id),de=ol(c);q&&de.push("PROJECTION_GLOBE_VIEW");const xe=d.useProgram("circle",le,de),Ae=ue.layoutVertexBuffer,Le=ue.globeExtVertexBuffer,st=ue.indexBuffer,Ee=L.projection.createInversionMatrix(L,Q.canonical),Ve={programConfiguration:le,program:xe,layoutVertexBuffer:Ae,globeExtVertexBuffer:Le,indexBuffer:st,uniformValues:rl(d,Q,ie,Ee,H,c),tile:ie};if(k){const Oe=ue.segments.get();for(const Je of Oe)X.push({segments:new s.SegmentVector([Je]),sortKey:Je.sortKey,state:Ve})}else X.push({segments:ue.segments,sortKey:0,state:Ve})}k&&X.sort((te,Q)=>te.sortKey-Q.sortKey);const U={useDepthForOcclusion:!q};for(const te of X){const{programConfiguration:Q,program:ie,layoutVertexBuffer:ue,globeExtVertexBuffer:le,indexBuffer:de,uniformValues:xe,tile:Ae}=te.state,Le=te.segments;d.terrain&&d.terrain.setupElevationDraw(Ae,ie,U),d.prepareDrawProgram(I,ie,Ae.tileID.toUnwrapped()),ie.draw(I,P.TRIANGLES,j,V,W,s.CullFaceMode.disabled,xe,c.id,ue,de,Le,c.paint,L.zoom,Q,[le])}},heatmap:function(d,o,c,f){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,b=_.gl,E=s.StencilMode.disabled,k=new s.ColorMode([b.ONE,b.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(W,q,H,X){const U=W.gl,te=q.width*X,Q=q.height*X;W.activeTexture.set(U.TEXTURE1),W.viewport.set([0,0,te,Q]);let ie=H.heatmapFbo;if(!ie||ie&&(ie.width!==te||ie.height!==Q)){ie&&ie.destroy();const ue=U.createTexture();U.bindTexture(U.TEXTURE_2D,ue),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ie=H.heatmapFbo=W.createFramebuffer(te,Q,!1),function(le,de,xe,Ae,Le,st){const Ee=le.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,le.isWebGL2&&le.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,Le,st,0,Ee.RGBA,le.extRenderToTextureHalfFloat?le.isWebGL2?Ee.HALF_FLOAT:le.extTextureHalfFloat.HALF_FLOAT_OES:Ee.UNSIGNED_BYTE,null),Ae.colorAttachment.set(xe)}(W,0,ue,ie,te,Q)}else U.bindTexture(U.TEXTURE_2D,ie.colorAttachment.get()),W.bindFramebuffer.set(ie.framebuffer)})(_,d,c,d.transform.projection.name==="globe"?.5:.25),_.clear({color:s.Color.transparent});const I=d.transform,P=I.projection.name==="globe",L=P?["PROJECTION_GLOBE_VIEW"]:null,j=P?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,V=[s.mercatorXfromLng(I.center.lng),s.mercatorYfromLat(I.center.lat)];for(let W=0;W<f.length;W++){const q=f[W];if(o.hasRenderableParent(q))continue;const H=o.getTile(q),X=H.getBucket(c);if(!X||X.projection.name!==I.projection.name)continue;const U=X.programConfigurations.get(c.id),te=d.useProgram("heatmap",U,L),{zoom:Q}=d.transform;d.terrain&&d.terrain.setupElevationDraw(H,te),d.prepareDrawProgram(_,te,q.toUnwrapped());const ie=I.projection.createInversionMatrix(I,q.canonical);te.draw(_,b.TRIANGLES,s.DepthMode.disabled,E,k,j,oo(d,q,H,ie,V,Q,c.paint.get("heatmap-intensity")),c.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,c.paint,d.transform.zoom,U,P?[X.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,b){const E=_.context,k=E.gl,I=b.heatmapFbo;if(!I)return;E.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,I.colorAttachment.get()),E.activeTexture.set(k.TEXTURE1);let P=b.colorRampTexture;P||(P=b.colorRampTexture=new s.Texture(E,b.colorRamp,k.RGBA)),P.bind(k.LINEAR,k.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,k.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,_.colorModeForRenderPass(),s.CullFaceMode.disabled,((L,j,V,W)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,b),b.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,b.paint,_.transform.zoom)}(d,c))},line:function(d,o,c,f){if(d.renderPass!=="translucent")return;const _=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(_.constantOr(1)===0||b.constantOr(1)===0)return;const E=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),k=d.colorModeForRenderPass(),I=d.terrain&&d.terrain.renderingToTexture?1:s.exported.devicePixelRatio,P=c.paint.get("line-dasharray"),L=P.constantOr(1),j=c.layout.get("line-cap"),V=c.paint.get("line-pattern"),W=V.constantOr(1),q=c.paint.get("line-gradient"),H=W?"linePattern":"line",X=d.context,U=X.gl,te=(ie=>{const ue=[];Tc(ie)&&ue.push("RENDER_LINE_DASH"),ie.paint.get("line-gradient")&&ue.push("RENDER_LINE_GRADIENT");const le=ie.paint.get("line-trim-offset");le[0]===0&&le[1]===0||ue.push("RENDER_LINE_TRIM_OFFSET");const de=ie.paint.get("line-pattern").constantOr(1),xe=ie.paint.get("line-opacity").constantOr(1)!==1;return!de&&xe&&ue.push("RENDER_LINE_ALPHA_DISCARD"),ue})(c);let Q=te.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(const ie of f){const ue=o.getTile(ie);if(W&&!ue.patternsLoaded())continue;const le=ue.getBucket(c);if(!le)continue;d.prepareDrawTile();const de=le.programConfigurations.get(c.id),xe=d.useProgram(H,de,te),Ae=V.constantOr(null);if(Ae&&ue.imageAtlas){const ye=ue.imageAtlas.patternPositions[Ae.toString()];ye&&de.setConstantPatternPositions(ye)}const Le=P.constantOr(null),st=j.constantOr(null);if(!W&&Le&&st&&ue.lineAtlas){const ye=ue.lineAtlas.getDash(Le,st);ye&&de.setConstantPatternPositions(ye)}let[Ee,Ve]=c.paint.get("line-trim-offset");(st==="round"||st==="square")&&Ee!==Ve&&(Ee===0&&(Ee-=1),Ve===1&&(Ve+=1));const Oe=d.terrain?ie.projMatrix:null,Je=W?ap(d,ue,c,Oe,I):nh(d,ue,c,Oe,le.lineClipsArray.length,I,[Ee,Ve]);if(q){const ye=le.gradients[c.id];let Re=ye.texture;if(c.gradientVersion!==ye.version){let He=256;if(c.stepInterpolant){const tt=o.getSource().maxzoom,Ct=ie.canonical.z===tt?Math.ceil(1<<d.transform.maxZoom-ie.canonical.z):1;He=s.clamp(s.nextPowerOfTwo(le.maxLineLength/s.EXTENT*1024*Ct),256,X.maxTextureSize)}ye.gradient=s.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:He,image:ye.gradient||void 0,clips:le.lineClipsArray}),ye.texture?ye.texture.update(ye.gradient):ye.texture=new s.Texture(X,ye.gradient,U.RGBA),ye.version=c.gradientVersion,Re=ye.texture}X.activeTexture.set(U.TEXTURE1),Re.bind(c.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}L&&(X.activeTexture.set(U.TEXTURE0),ue.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),de.updatePaintBuffers()),W&&(X.activeTexture.set(U.TEXTURE0),ue.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),de.updatePaintBuffers()),d.prepareDrawProgram(X,xe,ie.toUnwrapped());const Ce=ye=>{xe.draw(X,U.TRIANGLES,E,ye,k,s.CullFaceMode.disabled,Je,c.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,c.paint,d.transform.zoom,de,[le.layoutVertexBuffer2])};if(Q){const ye=d.stencilModeForClipping(ie).ref;ye===0&&d.terrain&&X.clear({stencil:0});const Re={func:U.EQUAL,mask:255};Je.u_alpha_discard_threshold=.8,Ce(new s.StencilMode(Re,ye,255,U.KEEP,U.KEEP,U.INVERT)),Je.u_alpha_discard_threshold=0,Ce(new s.StencilMode(Re,ye,255,U.KEEP,U.KEEP,U.KEEP))}else Ce(d.stencilModeForClipping(ie))}Q&&(d.resetStencilClippingMasks(),d.terrain&&X.clear({stencil:0}))},fill:function(d,o,c,f){const _=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=d.colorModeForRenderPass(),k=c.paint.get("fill-pattern"),I=d.opaquePassEnabledForLayer()&&!k.constantOr(1)&&_.constantOr(s.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===I){const P=d.depthModeForSublayer(1,d.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);fp(d,o,c,f,P,E,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){const P=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);fp(d,o,c,f,P,E,!0)}},"fill-extrusion":function(d,o,c,f){const _=c.paint.get("fill-extrusion-opacity");if(_!==0&&d.renderPass==="translucent"){const b=new s.DepthMode(d.context.gl.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D);if(_!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))lh(d,o,c,f,b,s.StencilMode.disabled,s.ColorMode.disabled),lh(d,o,c,f,b,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const E=d.colorModeForRenderPass();lh(d,o,c,f,b,s.StencilMode.disabled,E)}}},hillshade:function(d,o,c,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const _=d.context,b=d.depthModeForSublayer(0,s.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),k=d.terrain&&d.terrain.renderingToTexture,[I,P]=d.renderPass!=="translucent"||k?[{},f]:d.stencilConfigForOverlap(f);for(const L of P){const j=o.getTile(L);if(j.needsHillshadePrepare&&d.renderPass==="offscreen")mc(d,j,c,b,s.StencilMode.disabled,E);else if(d.renderPass==="translucent"){const V=k&&d.terrain?d.terrain.stencilModeForRTTOverlap(L):I[L.overscaledZ];tl(d,L,j,c,b,V,E)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,o,c,f,_,b){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!f.length)return;const E=d.context,k=E.gl,I=o.getSource(),P=d.useProgram("raster"),L=d.colorModeForRenderPass(),j=d.terrain&&d.terrain.renderingToTexture,[V,W]=I instanceof he||j?[{},f]:d.stencilConfigForOverlap(f),q=W[W.length-1].overscaledZ,H=!d.options.moving;for(const X of W){const U=j?s.DepthMode.disabled:d.depthModeForSublayer(X.overscaledZ-q,c.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,k.LESS),te=X.toUnwrapped(),Q=o.getTile(X);if(j&&(!Q||!Q.hasData()))continue;const ie=j?X.projMatrix:d.transform.calculateProjMatrix(te,H),ue=d.terrain&&j?d.terrain.stencilModeForRTTOverlap(X):V[X.overscaledZ],le=b?0:c.paint.get("raster-fade-duration");Q.registerFadeDuration(le);const de=o.findLoadedParent(X,0),xe=il(Q,de,o,d.transform,le);let Ae,Le;d.terrain&&d.terrain.prepareDrawTile();const st=c.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;E.activeTexture.set(k.TEXTURE0),Q.texture.bind(st,k.CLAMP_TO_EDGE),E.activeTexture.set(k.TEXTURE1),de?(de.texture.bind(st,k.CLAMP_TO_EDGE),Ae=Math.pow(2,de.tileID.overscaledZ-Q.tileID.overscaledZ),Le=[Q.tileID.canonical.x*Ae%1,Q.tileID.canonical.y*Ae%1]):Q.texture.bind(st,k.CLAMP_TO_EDGE);const Ee=Xm(ie,Le||[0,0],Ae||1,xe,c,I instanceof he?I.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(E,P,te),I instanceof he)I.boundsBuffer&&I.boundsSegments&&P.draw(E,k.TRIANGLES,U,s.StencilMode.disabled,L,s.CullFaceMode.disabled,Ee,c.id,I.boundsBuffer,d.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:Oe,tileBoundsSegments:Je}=d.getTileBoundsBuffers(Q);P.draw(E,k.TRIANGLES,U,ue,L,s.CullFaceMode.disabled,Ee,c.id,Ve,Oe,Je)}}d.resetStencilClippingMasks()},background:function(d,o,c,f){const _=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b===0)return;const E=d.context,k=E.gl,I=d.transform,P=I.tileSize,L=c.paint.get("background-pattern");if(d.isPatternMissing(L))return;const j=!L&&_.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==j)return;const V=s.StencilMode.disabled,W=d.depthModeForSublayer(0,j==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),q=d.colorModeForRenderPass(),H=d.useProgram(L?"backgroundPattern":"background");let X,U=f;U||(X=d.getBackgroundTiles(),U=Object.values(X).map(te=>te.tileID)),L&&(E.activeTexture.set(k.TEXTURE0),d.imageManager.bind(d.context));for(const te of U){const Q=te.toUnwrapped(),ie=f?te.projMatrix:d.transform.calculateProjMatrix(Q);d.prepareDrawTile();const ue=o?o.getTile(te):X?X[te.key]:new s.Tile(te,P,I.zoom,d),le=L?sh(ie,b,d,L,{tileID:te,tileSize:P}):Km(ie,b,_);d.prepareDrawProgram(E,H,Q);const{tileBoundsBuffer:de,tileBoundsIndexBuffer:xe,tileBoundsSegments:Ae}=d.getTileBoundsBuffers(ue);H.draw(E,k.TRIANGLES,W,V,q,s.CullFaceMode.disabled,le,c.id,de,xe,Ae)}},sky:function(d,o,c){const f=d.transform,_=f.projection.name==="mercator"||f.projection.name==="globe"?1:s.smoothstep(7,8,f.zoom),b=c.paint.get("sky-opacity")*_;if(b===0)return;const E=d.context,k=c.paint.get("sky-type"),I=new s.DepthMode(E.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),P=d.frameCounter/1e3%1;k==="atmosphere"?d.renderPass==="offscreen"?c.needsSkyboxCapture(d)&&(function(L,j,V,W){const q=L.context,H=q.gl;let X=j.skyboxFbo;if(!X){X=j.skyboxFbo=q.createFramebuffer(32,32,!1),j.skyboxGeometry=new Ec(q),j.skyboxTexture=q.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,j.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ie=0;ie<6;++ie)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(X.framebuffer),q.viewport.set([0,0,32,32]);const U=j.getCenter(L,!0),te=L.useProgram("skyboxCapture"),Q=new Float64Array(16);s.identity(Q),s.rotateY(Q,Q,.5*-Math.PI),vn(q,j,te,Q,U,0),s.identity(Q),s.rotateY(Q,Q,.5*Math.PI),vn(q,j,te,Q,U,1),s.identity(Q),s.rotateX(Q,Q,.5*-Math.PI),vn(q,j,te,Q,U,2),s.identity(Q),s.rotateX(Q,Q,.5*Math.PI),vn(q,j,te,Q,U,3),s.identity(Q),vn(q,j,te,Q,U,4),s.identity(Q),s.rotateY(Q,Q,Math.PI),vn(q,j,te,Q,U,5),q.viewport.set([0,0,L.width,L.height])}(d,c),c.markSkyboxValid(d)):d.renderPass==="sky"&&function(L,j,V,W,q){const H=L.context,X=H.gl,U=L.transform,te=L.useProgram("skybox");H.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,j.skyboxTexture);const Q=((ie,ue,le,de,xe)=>({u_matrix:ie,u_sun_direction:ue,u_cubemap:0,u_opacity:de,u_temporal_offset:xe}))(U.skyboxMatrix,j.getCenter(L,!1),0,W,q);L.prepareDrawProgram(H,te),te.draw(H,X.TRIANGLES,V,s.StencilMode.disabled,L.colorModeForRenderPass(),s.CullFaceMode.backCW,Q,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(d,c,I,b,P):k==="gradient"&&d.renderPass==="sky"&&function(L,j,V,W,q){const H=L.context,X=H.gl,U=L.transform,te=L.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Ec(H)),H.activeTexture.set(X.TEXTURE0);let Q=j.colorRampTexture;Q||(Q=j.colorRampTexture=new s.Texture(H,j.colorRamp,X.RGBA)),Q.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ie=((ue,le,de,xe,Ae)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:le,u_radius:s.degToRad(de),u_opacity:xe,u_temporal_offset:Ae}))(U.skyboxMatrix,j.getCenter(L,!1),j.paint.get("sky-gradient-radius"),W,q);L.prepareDrawProgram(H,te),te.draw(H,X.TRIANGLES,V,s.StencilMode.disabled,L.colorModeForRenderPass(),s.CullFaceMode.backCW,ie,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(d,c,I,b,P)},debug:function(d,o,c){for(let f=0;f<c.length;f++)hh(d,o,c[f])},custom:function(d,o,c,f){const _=d.context,b=c.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&c.isLayerDraped()){if(d.renderPass==="offscreen"){const E=b.prerender;if(E){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const k=d.transform.pointMerc;E.call(b,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(d.transform.zoom),[k.x,k.y],d.transform.pixelsPerMeterRatio)}else E.call(b,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const k=b.renderToTile;if(k){const I=f[0].canonical,P=new s.MercatorCoordinate(I.x+f[0].wrap*(1<<I.z),I.y,I.z);_.setDepthMode(s.DepthMode.disabled),_.setStencilMode(s.StencilMode.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),k.call(b,_.gl,P),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(s.StencilMode.disabled);const E=b.renderingMode==="3d"?new s.DepthMode(d.context.gl.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(_.setDepthMode(E),d.transform.projection.name==="globe"){const k=d.transform.pointMerc;b.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(d.transform.zoom),[k.x,k.y],d.transform.pixelsPerMeterRatio)}else b.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class cl{constructor(o,c,f=!1){this.context=new J(o,f),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kd,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,c){const f=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ju(this,o));const _=this._terrain;this.transform.elevation=f?_:null,_.update(o,this.transform,c)}_updateFog(o){const c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=c.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const b=f+.78*(_-f);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,c){if(this.width=o*s.exported.devicePixelRatio,this.height=c*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const o=this.context,c=new s.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(s.EXTENT,0),c.emplaceBack(0,s.EXTENT),c.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=o.createVertexBuffer(f,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const _=new s.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const b=new s.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(s.EXTENT,0,s.EXTENT,0),b.emplaceBack(0,s.EXTENT,0,s.EXTENT),b.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(b,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const E=new s.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const k=new s.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])k.emplaceBack(P);this.debugIndexBuffer=o.createIndexBuffer(k),this.emptyTexture=new s.Texture(o,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=s.create();const I=this.context.gl;this.stencilClearMode=new s.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new eg(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,c.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,xn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,f){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const I of f)if(this._tileClippingMaskIDs[I.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=c.id;const _=this.context,b=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of f){const I=c.getTile(k),P=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:j,tileBoundsSegments:V}=this.getTileBoundsBuffers(I);E.draw(_,b.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,xn(k.projMatrix),"$clipping",L,j,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new s.StencilMode({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new s.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,f=o.sort((E,k)=>k.overscaledZ-E.overscaledZ),_=f[f.length-1].overscaledZ,b=f[0].overscaledZ-_+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let k=0;k<b;k++)E[k+_]=new s.StencilMode({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[E,f]}return[{[_]:s.StencilMode.disabled},f]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([o.CONSTANT_COLOR,o.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(o,c,f){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new s.DepthMode(f||this.context.gl.LEQUAL,c,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const f=this.style.order,_=this.style._sourceCaches;for(const I in _){const P=_[I];P.used&&P.prepare(this.context)}const b={},E={},k={};for(const I in _){const P=_[I];b[I]=P.getVisibleCoordinates(),E[I]=b[I].slice().reverse(),k[I]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<f.length;I++)if(this.style._layers[f[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of f){const P=this.style._layers[I],L=o._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const j=L?E[L.id]:void 0;(P.type==="custom"||P.isSky()||j&&j.length)&&this.renderLayer(this,L,P,j)}if(this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[f[this.currentLayer]],P=o._getLayerSourceCache(I);if(I.isSky())continue;const L=P?E[P.id]:void 0;this._renderTileClippingMasks(I,P,L),this.renderLayer(this,P,I,L)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,P){const L=I.context,j=L.gl,V=I.transform,W=new s.DepthMode(j.LEQUAL,s.DepthMode.ReadOnly,[0,1]),q=I.useProgram("globeAtmosphere",null,V.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),H=s.globeToMercatorTransition(V.zoom),X=P.properties.get("color").toArray01(),U=P.properties.get("high-color").toArray01(),te=P.properties.get("space-color").toArray01PremultipliedAlpha(),Q=s.identity$1([]);s.rotateY$1(Q,Q,-s.degToRad(V._center.lng)),s.rotateX$1(Q,Q,s.degToRad(V._center.lat)),s.rotateZ$1(Q,Q,V.angle),s.rotateX$1(Q,Q,-V._pitch);const ie=s.fromQuat(new Float32Array(16),Q),ue=s.mapValue(P.properties.get("star-intensity"),0,1,0,.25),le=5e-4,de=s.mapValue(P.properties.get("horizon-blend"),0,1,le,.25),xe=s.globeUseCustomAntiAliasing(I,L,V)&&de===le?V.worldSize/(2*Math.PI*1.025)-1:V.globeRadius,Ae=I.frameCounter/1e3%1,Le=s.length(V.globeCenterInViewSpace),st=Math.sqrt(Math.pow(Le,2)-Math.pow(xe,2)),Ee=Math.acos(st/Le),Ve=((Je,Ce,ye,Re,He,tt,Ct,Qt,kt,vt,Mt,hn,Dt,Dn)=>({u_frustum_tl:Je,u_frustum_tr:Ce,u_frustum_br:ye,u_frustum_bl:Re,u_horizon:He,u_transition:tt,u_fadeout_range:Ct,u_color:Qt,u_high_color:kt,u_space_color:vt,u_star_intensity:Mt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:hn,u_horizon_angle:Dt,u_rotation_matrix:Dn}))(V.frustumCorners.TL,V.frustumCorners.TR,V.frustumCorners.BR,V.frustumCorners.BL,V.frustumCorners.horizon,H,de,X,U,te,ue,Ae,Ee,ie);I.prepareDrawProgram(L,q);const Oe=I.atmosphereBuffer;Oe&&q.draw(L,j.TRIANGLES,W,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Ve,"skybox",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const I=this.style._layers[f[this.currentLayer]],P=o._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,P,I,P?E[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const I=this.style._layers[f[this.currentLayer]],P=o._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=P?(I.type==="symbol"?k:E)[P.id]:void 0;this._renderTileClippingMasks(I,P,P?b[P.id]:void 0),this.renderLayer(this,P,I,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;s.values(this.style._layers).forEach(P=>{const L=o._getLayerSourceCache(P);L&&!P.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<L.getSource().maxzoom)&&(I=L)}),I&&this.options.showTileBoundaries&&dh.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const P=I.transform.padding;Wo(I,I.transform.height-(P.top||0),3,ch),Wo(I,P.bottom||0,3,uh),ta(I,P.left||0,3,mp),ta(I,I.transform.width-(P.right||0),3,gp);const L=I.transform.centerPoint;(function(j,V,W,q){ll(j,V-1,W-10,2,20,q),ll(j,V-10,W-1,20,2,q)})(I,L.x,I.transform.height-L.y,_p)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(o,c,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(f.type)||o.terrain&&f.type==="custom")&&dh[f.type](o,c,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let f=this.gpuTimers[o.id];f||(f=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),f.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,c=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),o.beginQueryEXT(o.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const c={};for(const f in o){const _=o[f],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(_.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(_.query),c[f]=E}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let f=0;for(const _ of o)f+=c.getQueryObjectEXT(_,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(_);return f}translatePosMatrix(o,c,f,_,b){if(!f[0]&&!f[1])return o;const E=b?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const P=Math.sin(E),L=Math.cos(E);f=[f[0]*L-f[1]*P,f[0]*P+f[1]*L]}const k=[b?f[0]:fi(c,f[0],this.transform.zoom),b?f[1]:fi(c,f[1],this.transform.zoom),0],I=new Float32Array(16);return s.translate(I,o,k),I}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,f=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),this.transform.projection.name==="globe"&&_.push("GLOBE"),c&&_.push("ZERO_EXAGGERATION"),f&&!o&&f.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),o&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(o,c,f){this.cache=this.cache||{};const _=f||[],b=this.currentGlobalDefines().concat(_),E=Qu.cacheKey(qu[o],o,b,c);return this.cache[E]||(this.cache[E]=new Qu(this.context,o,qu[o],c,Ym[o],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,c,f){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const b=_.getOpacity(this.transform.pitch),E=((k,I,P,L,j,V,W,q,H,X,U)=>{const te=k.transform,Q=I.properties.get("color").toArray01();Q[3]=L;const ie=k.frameCounter/1e3%1;return{u_fog_matrix:P?te.calculateFogTileMatrix(P):k.identityMat,u_fog_range:I.getFovAdjustedRange(te._fov),u_fog_color:Q,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:ie,u_frustum_tl:j,u_frustum_tr:V,u_frustum_br:W,u_frustum_bl:q,u_globe_pos:H,u_globe_radius:X,u_viewport:U,u_globe_transition:s.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,_,f,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);c.setFogUniformValues(o,E)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)c[_.key]=o[_.key]||new s.Tile(_,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ph{constructor(o=0,c=0,f=0,_=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=f,this.right=_}interpolate(o,c,f){return c.top!=null&&o.top!=null&&(this.top=s.number(o.top,c.top,f)),c.bottom!=null&&o.bottom!=null&&(this.bottom=s.number(o.bottom,c.bottom,f)),c.left!=null&&o.left!=null&&(this.left=s.number(o.left,c.left,f)),c.right!=null&&o.right!=null&&(this.right=s.number(o.right,c.right,f)),this}getCenter(o,c){const f=s.clamp((this.left+o-this.right)/2,0,o),_=s.clamp((this.top+c-this.bottom)/2,0,c);return new s.pointGeometry(f,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ph(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yp(d,o){const c=s.getColumn(d,3);s.fromQuat(d,o),s.setColumn(d,3,c)}function Sc(d,o){const c=s.identity$1([]);return s.rotateZ$1(c,c,-o),s.rotateX$1(c,c,-d),c}function vp(d,o){const c=[d[0],d[1],0],f=[o[0],o[1],0];if(s.length(c)>=1e-15){const E=s.normalize([],c);s.scale$2(f,E,s.dot(f,E)),o[0]=f[0],o[1]=f[1]}const _=s.cross([],o,d);if(s.len(_)<1e-15)return null;const b=Math.atan2(-_[1],_[0]);return Sc(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),b)}class Ac{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){const c=o instanceof s.MercatorCoordinate?o:new s.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=s.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;const f=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(o)):0,_=this.position,b=s.MercatorCoordinate.fromLngLat(o,f),E=[b.x-_.x,b.y-_.y,b.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=vp(E,c)}setPitchBearing(o,c){this.orientation=Sc(s.degToRad(o),s.degToRad(-c))}}class ra{constructor(o,c){this._transform=s.identity([]),this.orientation=c,this.position=o}get mercatorPosition(){const o=this.position;return new s.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=s.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&s.setColumn(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.identity$1([]),o&&yp(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=Sc(o,c),yp(this._transform,this._orientation)}forward(){const o=s.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const f=new Float64Array(16);return s.invert(f,this.getWorldToCamera(o,c)),f}getWorldToCameraPosition(o,c,f){const _=this.position;s.scale$2(_,_,-o);const b=new Float64Array(16);return s.fromScaling(b,[f,f,f]),s.translate(b,b,_),b[10]*=c,b}getWorldToCamera(o,c){const f=new Float64Array(16),_=new Float64Array(4),b=this.position;return s.conjugate(_,this._orientation),s.scale$2(b,b,-o),s.fromQuat(f,_),s.translate(f,f,b),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(o,c,f,_){const b=new Float64Array(16);return s.perspective(b,o,c,f,_),b}getDistanceToElevation(o,c=!1){const f=o===0?0:s.mercatorZfromAltitude(o,c?s.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new ra([...this.position],[...this.orientation])}}function oa(d,o){const c=ks(d.projection,d.zoom,d.width,d.height),f=function(b,E,k,I,P){const L=new s.LngLat(k.lng-180*Ss,k.lat),j=new s.LngLat(k.lng+180*Ss,k.lat),V=b.project(L.lng,L.lat),W=b.project(j.lng,j.lat),q=-Math.atan2(W.y-V.y,W.x-V.x),H=s.MercatorCoordinate.fromLngLat(k);H.y=s.clamp(H.y,-.999975,.999975);const X=H.toLngLat(),U=b.project(X.lng,X.lat),te=s.MercatorCoordinate.fromLngLat(X);te.x+=Ss;const Q=te.toLngLat(),ie=b.project(Q.lng,Q.lat),ue=hl(ie.x-U.x,ie.y-U.y,q),le=s.MercatorCoordinate.fromLngLat(X);le.y+=Ss;const de=le.toLngLat(),xe=b.project(de.lng,de.lat),Ae=hl(xe.x-U.x,xe.y-U.y,q),Le=Math.abs(ue.x)/Math.abs(Ae.y),st=s.identity([]);s.rotateZ(st,st,-q*(1-(P?0:I)));const Ee=s.identity([]);return s.scale(Ee,Ee,[1,1-(1-Le)*I,1]),Ee[4]=-Ae.x/Ae.y*I,s.rotateZ(Ee,Ee,q),s.multiply(Ee,st,Ee),Ee}(d.projection,0,d.center,c,o),_=Ic(d);return s.scale(f,f,[_,_,1]),f}function Ic(d){const o=d.projection,c=ks(d.projection,d.zoom,d.width,d.height),f=ul(o,d.center),_=ul(o,s.LngLat.convert(o.center));return Math.pow(2,f*c+(1-c)*_)}function ks(d,o,c,f,_=1/0){const b=d.range;if(!b)return 0;const E=Math.min(_,Math.max(c,f)),k=Math.log(E/1024)/Math.LN2;return s.smoothstep(b[0]+k,b[1]+k,o)}const Ss=1/4e4;function ul(d,o){const c=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),f=new s.LngLat(o.lng-180*Ss,c),_=new s.LngLat(o.lng+180*Ss,c),b=d.project(f.lng,c),E=d.project(_.lng,c),k=s.MercatorCoordinate.fromLngLat(f),I=s.MercatorCoordinate.fromLngLat(_),P=E.x-b.x,L=E.y-b.y,j=I.x-k.x,V=I.y-k.y,W=Math.sqrt((j*j+V*V)/(P*P+L*L));return Math.log(W)/Math.LN2}function hl(d,o,c){const f=Math.cos(c),_=Math.sin(c);return{x:d*f-o*_,y:d*_+o*f}}class _t{constructor(o,c,f,_,b,E,k){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(E),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ph,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ra,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new _t(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o,c=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(o||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const f=!S(c,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;var f;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(f=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(_,b,E){var k=b[0],I=b[1],P=b[2],L=b[3],j=Math.sin(E),V=Math.cos(E);_[0]=k*V+P*j,_[1]=I*V+L*j,_[2]=k*-j+P*V,_[3]=I*-j+L*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=s.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.degToRad(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,b=0;for(let E=0;E<c.length;E++){const k=new s.pointGeometry(c[E][0]*this.width,f+c[E][1]*(this.height-f)),I=o.pointCoordinate(k);if(!I)continue;const P=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*P,b+=P}return b===0?NaN:_/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-f,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let f;f=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const _=s.length(s.sub([],this._camera.position,f));return s.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!s.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const f=[o.position.x,o.position.y,o.position.z];s.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new Ac;return c.position=new s.MercatorCoordinate(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!s.length$1(o))return!1;s.normalize$1(o,o);const c=s.transformQuat([],[0,0,-1],o),f=s.transformQuat([],[0,-1,0],o);if(f[2]<0)return!1;const _=vp(c,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=s.clamp(o[2],_/f,_/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,f){this._unmodified=!1,this._edgeInsets.interpolate(o,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new s.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.pointGeometry(0,0)),_=this.pointCoordinate(new s.pointGeometry(this.width,0)),b=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new s.pointGeometry(0,this.height)),k=Math.floor(Math.min(f.x,_.x,b.x,E.x)),I=Math.floor(Math.max(f.x,_.x,b.x,E.x)),P=1;for(let L=k-P;L<=I+P;L++)L!==0&&c.push(new s.UnwrappedTileID(L,o))}return c}coveringTiles(o){let c=this.coveringZoomLevel(o);const f=c,_=this.elevation&&!o.isTerrainDEM,b=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);const E=this.locationCoordinate(this.center),k=this.center.lat,I=1<<c,P=[I*E.x,I*E.y,0],L=this.projection.name==="globe",j=!L,V=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,j),W=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=I*s.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),X=[I*W.x,I*W.y,H*(j?1:q)],U=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,Q=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ie=o.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,ue=this.projection.isReprojectedInTileSpace?Ic(this):1,le=Ce=>{const Re=new s.MercatorCoordinate(Ce.x+25e-6,Ce.y,Ce.z),He=new s.MercatorCoordinate(Ce.x,Ce.y+25e-6,Ce.z),tt=Ce.toLngLat(),Ct=Re.toLngLat(),Qt=He.toLngLat(),kt=this.locationCoordinate(tt),vt=this.locationCoordinate(Ct),Mt=this.locationCoordinate(Qt),hn=Math.hypot(vt.x-kt.x,vt.y-kt.y),Dt=Math.hypot(Mt.x-kt.x,Mt.y-kt.y);return Math.sqrt(hn*Dt)*ue/25e-6},de=Ce=>{const ye=Q,Re=ie;return{aabb:s.tileAABB(this,I,0,0,0,Ce,Re,ye,this.projection),zoom:0,x:0,y:0,minZ:Re,maxZ:ye,wrap:Ce,fullyVisible:!1}},xe=[];let Ae=[];const Le=c,st=o.reparseOverscaled?f:c,Ee=Ce=>Ce*Ce,Ve=Ee((H-this._centerAltitude)*q),Oe=Ce=>{if(!this._elevation||!Ce.tileID||!b)return;const ye=this._elevation.getMinMaxForTile(Ce.tileID),Re=Ce.aabb;ye?(Re.min[2]=ye.min,Re.max[2]=ye.max,Re.center[2]=(Re.min[2]+Re.max[2])/2):(Ce.shouldSplit=Je(Ce),Ce.shouldSplit||(Re.min[2]=Re.max[2]=Re.center[2]=this._centerAltitude))},Je=Ce=>{if(Ce.zoom<te)return!0;if(Ce.zoom===Le)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;const ye=Ce.aabb.distanceX(X),Re=Ce.aabb.distanceY(X);let He=Ve,tt=1;if(L){He=Ee(Ce.aabb.distanceZ(X));const kt=Math.pow(2,Ce.zoom),vt=s.latFromMercatorY((Ce.y+1)/kt),Mt=s.latFromMercatorY(Ce.y/kt),hn=Math.min(Math.max(k,vt),Mt),Dt=s.circumferenceAtLatitude(hn)/s.circumferenceAtLatitude(k);if(tt=hn===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Dt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Ce.zoom===Le-1&&Dt>=.9)return!0}else if(_&&(He=Ee(Ce.aabb.distanceZ(X)*q)),this.projection.isReprojectedInTileSpace&&f<=5){const kt=Math.pow(2,Ce.zoom),vt=le(new s.MercatorCoordinate((Ce.x+.5)/kt,(Ce.y+.5)/kt));tt=vt>.85?1:vt}const Ct=ye*ye+Re*Re+He,Qt=Ee((1<<Le-Ce.zoom)*U*tt*((kt,vt)=>{if(vt*Ee(.707)<kt)return 1;const Mt=Math.sqrt(vt/kt);return Mt/(1.4144271570014144+(Math.pow(1.1,Mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(He,Ve),Ct));return Ct<Qt};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)xe.push(de(-Ce)),xe.push(de(Ce));for(xe.push(de(0));xe.length>0;){const Ce=xe.pop(),ye=Ce.x,Re=Ce.y;let He=Ce.fullyVisible;if(!He){const tt=Ce.aabb.intersects(V);if(tt===0)continue;He=tt===2}if(Ce.zoom!==Le&&Je(Ce))for(let tt=0;tt<4;tt++){const Ct=(ye<<1)+tt%2,Qt=(Re<<1)+(tt>>1),kt={aabb:b?Ce.aabb.quadrant(tt):s.tileAABB(this,I,Ce.zoom+1,Ct,Qt,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:Ct,y:Qt,wrap:Ce.wrap,fullyVisible:He,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};_&&!L&&(kt.tileID=new s.OverscaledTileID(Ce.zoom+1===Le?st:Ce.zoom+1,Ce.wrap,Ce.zoom+1,Ct,Qt),Oe(kt)),xe.push(kt)}else{const tt=Ce.zoom===Le?st:Ce.zoom;if(o.minzoom&&o.minzoom>tt)continue;const Ct=P[0]-(.5+ye+(Ce.wrap<<Ce.zoom))*(1<<c-Ce.zoom),Qt=P[1]-.5-Re,kt=Ce.tileID?Ce.tileID:new s.OverscaledTileID(tt,Ce.wrap,Ce.zoom,ye,Re);Ae.push({tileID:kt,distanceSq:Ct*Ct+Qt*Qt})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,ye=this.horizonLineFromTop();Ae=Ae.filter(Re=>{const He=[0,0,0,1],tt=[s.EXTENT,s.EXTENT,0,1],Ct=this.calculateFogTileMatrix(Re.tileID.toUnwrapped());s.transformMat4$1(He,He,Ct),s.transformMat4$1(tt,tt,Ct);const Qt=s.getAABBPointSquareDist(He,tt);if(Qt===0)return!0;let kt=!1;const vt=this._elevation;if(vt&&Qt>Ce&&ye!==0){const Mt=this.calculateProjMatrix(Re.tileID.toUnwrapped());let hn;o.isTerrainDEM||(hn=vt.getMinMaxForTile(Re.tileID)),hn||(hn={min:ie,max:Q});const Dt=s.furthestTileCorner(this.rotation),Dn=[Dt[0]*s.EXTENT,Dt[1]*s.EXTENT,hn.max];s.transformMat4(Dn,Dn,Mt),kt=(1-Dn[1])*this.height*.5<ye}return Qt<Ce||kt})}return Ae.sort((Ce,ye)=>Ce.distanceSq-ye.distanceSq).map(Ce=>Ce.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),f=this.projection.project(o.lng,c);return new s.pointGeometry(f.x*this.worldSize,f.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let f,_;const b=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;f=(c.x-b.x)/k,_=(c.y-b.y)/k}else{const k=this.pointCoordinate(c),I=this.pointCoordinate(b);f=k.x-I.x,_=k.y-I.y}const E=this.locationCoordinate(o);this.setLocation(new s.MercatorCoordinate(E.x-f,E.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){const f=c?s.mercatorZfromAltitude(c,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new s.MercatorCoordinate(_.x,_.y,f)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const f=c??this._centerAltitude,_=[o.x,o.y,0,1],b=[o.x,o.y,1,1];s.transformMat4$1(_,_,this.pixelMatrixInverse),s.transformMat4$1(b,b,this.pixelMatrixInverse);const E=b[3];s.scale$1(_,_,1/_[3]),s.scale$1(b,b,1/E);const k=_[2],I=b[2];return{p0:_,p1:b,t:k===I?0:(f-k)/(I-k)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],f=[o.x,o.y,1,1];return s.transformMat4$1(c,c,this.pixelMatrixInverse),s.transformMat4$1(f,f,this.pixelMatrixInverse),s.scale$1(c,c,1/c[3]),s.scale$1(f,f,1/f[3]),c[2]=s.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,f[2]=s.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,s.scale$1(c,c,1/this.worldSize),s.scale$1(f,f,1/this.worldSize),new s.Ray([c[0],c[1],c[2]],s.normalize([],s.sub([],f,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:f,t:_}=o,b=s.mercatorZfromAltitude(c[2],this._center.lat),E=s.mercatorZfromAltitude(f[2],this._center.lat);return new s.MercatorCoordinate(s.number(c[0],f[0],_)/this.worldSize,s.number(c[1],f[1],_)/this.worldSize,s.number(b,E,_))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let c=this.projection.pointCoordinate3D(this,o.x,o.y);if(c)return new s.MercatorCoordinate(c[0],c[1],c[2]);let f=0,_=this.horizonLineFromTop();if(o.y>_)return this.pointCoordinate(o);const b=.02*_,E=o.clone();for(let k=0;k<10&&_-f>b;k++){E.y=s.number(f,_,.66);const I=this.projection.pointCoordinate3D(this,E.x,E.y);I?(_=E.y,c=I):f=E.y}return c?new s.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}_coordinatePoint(o,c){const f=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,f+o.toAltitude(),1];return s.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new s.pointGeometry(_[0]/_[3],_[1]/_[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.pointGeometry(c,o)),E=this.pointLocation3D(new s.pointGeometry(_,o)),k=this.pointLocation3D(new s.pointGeometry(_,f)),I=this.pointLocation3D(new s.pointGeometry(c,f));let P=Math.min(b.lng,E.lng,k.lng,I.lng),L=Math.max(b.lng,E.lng,k.lng,I.lng),j=Math.min(b.lat,E.lat,k.lat,I.lat),V=Math.max(b.lat,E.lat,k.lat,I.lat);const W=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,H=(X,U,te,Q,ie)=>{const ue=(X+te)/2,le=(U+Q)/2,de=new s.pointGeometry(ue,le),{lng:xe,lat:Ae}=this.pointLocation3D(de),Le=Math.max(0,P-xe,j-Ae,xe-L,Ae-V);P=Math.min(P,xe),L=Math.max(L,xe),j=Math.min(j,Ae),V=Math.max(V,Ae),(ie<q||Le>W)&&(H(X,U,ue,le,ie+1),H(ue,le,te,Q,ie+1))};if(H(c,o,_,o,1),H(_,o,_,f,1),H(_,f,c,f,1),H(c,f,c,o,1),this.projection.name==="globe"){const[X,U]=s.polesInViewport(this);X?(V=90,L=180,P=-180):U&&(j=-90,L=180,P=-180)}return new s.LngLatBounds(new s.LngLat(P,j),new s.LngLat(L,V))}_getBoundsRectangular(o,c){const{top:f,left:_}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,k=new s.pointGeometry(_,f),I=new s.pointGeometry(E,f),P=new s.pointGeometry(E,b),L=new s.pointGeometry(_,b);let j=this.pointCoordinate(k,o),V=this.pointCoordinate(I,o);const W=this.pointCoordinate(P,c),q=this.pointCoordinate(L,c),H=(X,U)=>(U.y-X.y)/(U.x-X.x);return j.y>1&&V.y>=0?j=new s.MercatorCoordinate((1-q.y)/H(q,j)+q.x,1):j.y<0&&V.y<=1&&(j=new s.MercatorCoordinate(-q.y/H(q,j)+q.x,0)),V.y>1&&j.y>=0?V=new s.MercatorCoordinate((1-W.y)/H(W,V)+W.x,1):V.y<0&&j.y<=1&&(V=new s.MercatorCoordinate(-W.y/H(W,V)+W.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=o.visibleDemTiles.reduce((f,_)=>{if(_.dem){const b=_.dem.tree;f.min=Math.min(f.min,b.minimums[0]),f.max=Math.max(f.max,b.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){const c=o.key,f=this._distanceTileDataCache;if(f[c])return f[c];const _=o.canonical,b=1/this.height,E=this.cameraWorldSize,k=E/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*o.wrap)*k,P=_.y*k,L=this.point;L.x*=E/this.worldSize,L.y*=E/this.worldSize;const j=this.angle,V=Math.sin(-j),W=-Math.cos(-j);return f[c]={bearing:[V,W],center:[(L.x-I)*b,(L.y-P)*b],scale:k/s.EXTENT*b},f[c]}calculateFogTileMatrix(o){const c=o.key,f=this._fogTileMatrixCache;if(f[c])return f[c];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.multiply(_,this.worldToFogMatrix,_),f[c]=new Float32Array(_),f[c]}calculateProjMatrix(o,c=!1){const f=o.key,_=c?this._alignedProjMatrixCache:this._projMatrixCache;if(_[f])return _[f];const b=this.calculatePosMatrix(o,this.worldSize);return s.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,b),_[f]=new Float32Array(b),_[f]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];const _=function(b,E){const{scale:k}=b.tileTransform,I=k*s.EXTENT/(b.tileSize*Math.pow(2,E.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return P=new Float32Array(4),V=(L=E.inverseAdjustmentMatrix)[1],W=L[2],q=L[3],X=(j=[I,I])[1],P[0]=L[0]*(H=j[0]),P[1]=V*H,P[2]=W*X,P[3]=q*X,P;var P,L,j,V,W,q,H,X}(o,this);return f[c]=_,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,c=s.fromScaling([],[o,o,o]);return s.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const c=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),_=this._camera.forward(),b=s.mercatorZfromAltitude(1,this._center.lat);f[2]/=b,_[2]/=b,s.normalize(_,_);const E=o.raycast(f,_,o.exaggeration());if(E){const k=s.scaleAndAdd([],f,_,E),I=new s.MercatorCoordinate(k[0],k[1],s.mercatorZfromAltitude(k[2],s.latFromMercatorY(k[1]))),P=(I.z+s.length([I.x-f[0],I.y-f[1],I.z-f[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const c=this._elevation,f=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),b=c.getAtPointOrZero(new s.MercatorCoordinate(..._)),E=this.pixelsPerMeter/this.worldSize*b,k=this._minimumHeightOverTerrain(),I=_[2]-E;if(I<=k)if(I<0||o){const P=this.locationCoordinate(this._center,this._centerAltitude),L=[_[0],_[1],P.z-_[2]],j=s.length(L);L[2]-=(k-I)/this._pixelsPerMercatorPixel;const V=s.length(L);if(V===0)return;s.scale$2(L,L,j/V*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],P.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const V=this.center;return V.lat=s.clamp(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(V.lng=s.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const c=this._unmodified,{x:f,y:_}=this.point;let b=0,E=f,k=_;const I=this.width/2,P=this.height/2,L=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(_-P<L&&(k=L+P),_+P>j&&(k=j-P),j-L<this.height&&(b=Math.max(b,this.height/(j-L)),k=(j+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,q=this.worldSize/2-(V+W)/2;E=(f+q+this.worldSize)%this.worldSize-q,E-I<V&&(E=V+I),E+I>W&&(E=W-I),W-V<this.width&&(b=Math.max(b,this.width/(W-V)),E=(W+V)/2)}E===f&&k===_||(this.center=this.unproject(new s.pointGeometry(E,k))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const f=ks(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?c:1,b=this._camera.getWorldToCamera(this.worldSize,_),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-o.x/this.width,E[9]=2*o.y/this.height;let k=s.mul([],E,b);if(this.projection.isReprojectedInTileSpace){const le=this.locationCoordinate(this.center),de=s.identity([]);s.translate(de,de,[le.x*this.worldSize,le.y*this.worldSize,0]),s.multiply(de,de,oa(this)),s.translate(de,de,[-le.x*this.worldSize,-le.y*this.worldSize,0]),s.multiply(k,k,de),this.inverseAdjustmentMatrix=function(xe){const Ae=oa(xe,!0);return Ye([],[Ae[0],Ae[1],Ae[4],Ae[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],k,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=k,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const I=s.invert([],E);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);const P=new Float32Array(16);s.identity(P),s.scale(P,P,[1,-1,1]),s.rotateX(P,P,this._pitch),s.rotateZ(P,P,this.angle);const L=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-o.x/this.width,L[9]=2*(o.y+j)/this.height,this.skyboxMatrix=s.multiply(P,L,P);const V=this.point,W=V.x,q=V.y,H=this.width%2/2,X=this.height%2/2,U=Math.cos(this.angle),te=Math.sin(this.angle),Q=W-Math.round(W)+U*H+te*X,ie=q-Math.round(q)+U*X+te*H,ue=new Float64Array(k);if(s.translate(ue,ue,[Q>.5?Q-1:Q,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=ue,k=s.create(),s.scale(k,k,[this.width/2,-this.height/2,1]),s.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=s.create(),s.scale(k,k,[1,-1,1]),s.translate(k,k,[-1,-1,0]),s.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},k=s.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(le,le,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,b=[o,o,c];s.scale$2(b,b,_),s.scale$2(f,f,-1),s.multiply$2(f,f,b);const E=s.create();s.translate(E,E,f),s.scale(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,_)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*b,_.y/this.worldSize-f[1]*b,o/this.worldSize*this._centerAltitude-f[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=o[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(b=Math.min((c-f)/_,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,o,b),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),b=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),k=Math.max((o[2]-b)/Math.cos(f),E),I=this._zoomFromMercatorZ(k);s.scaleAndAdd(o,o,c,k),this._pitch=s.clamp(f,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(_,-Math.PI,Math.PI),this._setZoom(s.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,f=s.GLOBE_ZOOM_THRESHOLD_MAX,_=0,b=1/0;for(;f-c>1e-6&&f>c;){const E=c+.5*(f-c),k=this.tileSize*Math.pow(2,E),I=this.getCameraToCenterDistance(this.projection,E,k),P=this.scaleZoom(I/(o*this.tileSize)),L=Math.abs(E-P);L<b&&(b=L,_=E),E<P?c=E:f=E}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){const f=Math.min(o.x,c.x),_=Math.max(o.x,c.x),b=Math.min(o.y,c.y),E=Math.max(o.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new s.pointGeometry(f,b),new s.pointGeometry(_,E),new s.pointGeometry(f,E),new s.pointGeometry(_,b)],I=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const L of k){const j=this.pointRayIntersection(L);if(j.t<0)return!0;const V=this.rayIntersectionCoordinate(j);if(V.x<I||V.y<0||V.x>P||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,c){const f=s.length(s.sub([],this._camera.position,o)),_=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([c,f,_],b){const E=[c,f,_,1];s.transformMat4$1(E,E,b);const k=E[3]=Math.max(E[3],1e-6);return E[0]/=k,E[1]/=k,E[2]/=k,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,o))}}getCameraToCenterDistance(o,c=this.zoom,f=this.worldSize){const _=ks(o,c,this.width,this.height,1024),b=o.pixelSpaceConversion(this.center.lat,f,_);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(o,o,this.globeMatrix),o}}function Br(d,o){let c=!1,f=null;const _=()=>{f=null,c&&(d(),f=setTimeout(_,o),c=!1)};return()=>(c=!0,f||_(),f)}class bp{constructor(o){this._hashName=o&&encodeURIComponent(o),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Br(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,s.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const c=fh(o);if(this._hashName){const f=this._hashName;let _=!1;const b=s.window.location.hash.slice(1).split("&").map(E=>{const k=E.split("=")[0];return k===f?(_=!0,`${k}=${c}`):E}).filter(E=>E);return _||b.push(`${f}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const o=s.window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(f=>isNaN(f))){const f=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,o)}}function fh(d,o){const c=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),E=Math.round(c.lng*b)/b,k=Math.round(c.lat*b)/b,I=d.getBearing(),P=d.getPitch();let L=o?`/${E}/${k}/${f}`:`${f}/${k}/${E}`;return(I||P)&&(L+="/"+Math.round(10*I)/10),P&&(L+=`/${Math.round(P)}`),L}const dl={linearity:.3,easing:s.bezier(0,0,.3,1)},sa=s.extend({deceleration:2500,maxSpeed:1400},dl),xp=s.extend({deceleration:20,maxSpeed:1400},dl),Cc=s.extend({deceleration:1e3,maxSpeed:360},dl),mh=s.extend({deceleration:1e3,maxSpeed:90},dl);class Mc{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=s.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){const b=fl(c.pan.mag(),f,s.extend({},sa,o||{}));_.offset=c.pan.mult(b.amount/c.pan.mag()),_.center=this._map.transform.center,pl(_,b)}if(c.zoom){const b=fl(c.zoom,f,xp);_.zoom=this._map.transform.zoom+b.amount,pl(_,b)}if(c.bearing){const b=fl(c.bearing,f,Cc);_.bearing=this._map.transform.bearing+s.clamp(b.amount,-179,179),pl(_,b)}if(c.pitch){const b=fl(c.pitch,f,mh);_.pitch=this._map.transform.pitch+b.amount,pl(_,b)}if(_.zoom||_.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;_.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function pl(d,o){(!d.duration||d.duration<o.duration)&&(d.duration=o.duration,d.easing=o.easing)}function fl(d,o,c){const{maxSpeed:f,linearity:_,deceleration:b}=c,E=s.clamp(d*_/(o/1e3),-f,f),k=Math.abs(E)/(b*_);return{easing:c.easing,duration:1e3*k,amount:E*(k/2)}}class ji extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f,_={}){const b=fe(c.getCanvasContainer(),f),E=c.unproject(b);super(o,s.extend({point:b,lngLat:E,originalEvent:f},_)),this._defaultPrevented=!1,this.target=c}}class Pc extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){const _=o==="touchend"?f.changedTouches:f.touches,b=et(c.getCanvasContainer(),_),E=b.map(I=>c.unproject(I)),k=b.reduce((I,P,L,j)=>I.add(P.div(j.length)),new s.pointGeometry(0,0));super(o,{points:b,point:k,lngLats:E,lngLat:c.unproject(k),originalEvent:f}),this._defaultPrevented=!1}}class tg extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,f){super(o,{originalEvent:f}),this._defaultPrevented=!1}}class wp{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new tg(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new ji(o.type,this._map,o))}mouseup(o){this._map.fire(new ji(o.type,this._map,o))}preclick(o){const c=s.extend({},o);c.type="preclick",this._map.fire(new ji(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new ji(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new ji(o.type,this._map,o))}mouseover(o){this._map.fire(new ji(o.type,this._map,o))}mouseout(o){this._map.fire(new ji(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Pc(o.type,this._map,o))}touchmove(o){this._map.fire(new Pc(o.type,this._map,o))}touchend(o){this._map.fire(new Pc(o.type,this._map,o))}touchcancel(o){this._map.fire(new Pc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lc{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new ji(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new ji(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gh{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(ve(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const f=c,_=this._startPos,b=this._lastPos;if(!_||!b||b.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const E=Math.min(_.x,f.x),k=Math.max(_.x,f.x),I=Math.min(_.y,f.y),P=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${I}px)`,this._box.style.width=k-E+"px",this._box.style.height=P-I+"px")})}mouseupWindow(o,c){if(!this._active)return;const f=this._startPos,_=c;if(f&&o.button===0){if(this.reset(),qe(),f.x!==_.x||f.y!==_.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$e(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new s.Event(o,{originalEvent:c}))}}function zc(d,o){const c={};for(let f=0;f<d.length;f++)c[d[f].identifier]=o[f];return c}class Tp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const b=new s.pointGeometry(0,0);for(const E of _)b._add(E);return b.div(_.length)}(c),this.touches=zc(f,c)))}touchmove(o,c,f){if(this.aborted||!this.centroid)return;const _=zc(f,c);for(const b in this.touches){const E=this.touches[b],k=_[b];(!k||k.dist(E)>30)&&(this.aborted=!0)}}touchend(o,c,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class aa{constructor(o){this.singleTap=new Tp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,f){this.singleTap.touchstart(o,c,f)}touchmove(o,c,f){this.singleTap.touchmove(o,c,f)}touchend(o,c,f){const _=this.singleTap.touchend(o,c,f);if(_){const b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class _h{constructor(){this._zoomIn=new aa({numTouches:1,numTaps:2}),this._zoomOut=new aa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,f){this._zoomIn.touchstart(o,c,f),this._zoomOut.touchstart(o,c,f)}touchmove(o,c,f){this._zoomIn.touchmove(o,c,f),this._zoomOut.touchmove(o,c,f)}touchend(o,c,f){const _=this._zoomIn.touchend(o,c,f),b=this._zoomOut.touchend(o,c,f);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ep={0:1,2:2};class Rc{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const f=Pe(o);this._correctButton(o,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(o,c){const f=this._lastPoint;if(f){if(o.preventDefault(),this._eventButton!=null&&function(_,b){const E=Ep[b];return _.buttons===void 0||(_.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(o){this._lastPoint&&Pe(o)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kp extends Rc{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class yh extends Rc{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){const f=.8*(c.x-o.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(o){o.preventDefault()}}class vh extends Rc{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){const f=-.5*(c.y-o.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(o){o.preventDefault()}}class la{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(o,c,f){return this._calculateTransform(o,c,f)}touchmove(o,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,f)}}touchend(o,c,f){this._calculateTransform(o,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,f){f.length>0&&(this._active=!0);const _=zc(f,c),b=new s.pointGeometry(0,0),E=new s.pointGeometry(0,0);let k=0;for(const P in _){const L=_[P],j=this._touches[P];j&&(b._add(L),E._add(L.sub(j)),k++,_[P]=L)}if(this._touches=_,k<this._minTouches||!E.mag())return;const I=E.div(k);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(k),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Dc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,f){return{}}touchstart(o,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,f){const _=this._firstTwoTouches;if(!_)return;o.preventDefault();const[b,E]=_,k=ml(f,c,b),I=ml(f,c,E);if(!k||!I)return;const P=this._aroundCenter?null:k.add(I).div(2);return this._move([k,I],P,o)}touchend(o,c,f){if(!this._firstTwoTouches)return;const[_,b]=this._firstTwoTouches,E=ml(f,c,_),k=ml(f,c,b);E&&k||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ml(d,o,c){for(let f=0;f<d.length;f++)if(d[f].identifier===c)return o[f]}function Sp(d,o){return Math.log(d/o)/Math.LN2}class Ap extends Dc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Sp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sp(this._distance,f),pinchAround:c}}}function bh(d,o){return 180*d.angleWith(o)/Math.PI}class Ip extends Dc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const f=this._vector;if(this._vector=o[0].sub(o[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bh(this._vector,f),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=bh(o,f);return Math.abs(_)<c}}function Oc(d){return Math.abs(d.y)>Math.abs(d.x)}class Hi extends Dc{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Oc(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,f){const _=this._lastPoints;if(!_)return;const b=o[0].sub(_[0]),E=o[1].sub(_[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,f.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(o,c,f){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,b=c.mag()>=2;if(!_&&!b)return;if(!_||!b)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const E=o.y>0==c.y>0;return Oc(o)&&Oc(c)&&E}}const ng={panStep:100,bearingStep:15,pitchStep:10};class Cp{constructor(){const o=ng;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,f=0,_=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:k=>{const I=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:ig,zoom:c?Math.round(I)+c*(o.shiftKey?2:1):I,bearing:k.getBearing()+f*this._bearingStep,pitch:k.getPitch()+_*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:k.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ig(d){return d*(2-d)}const Mp=4.000244140625;class bo{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const f=s.exported.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%Mp==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=fe(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Mp?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&P!==0&&(P=1/P);const L=c(),j=Math.pow(2,L),V=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(V*P))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,b=this._easing;let E,k=!1;if(this._type==="wheel"&&_&&b){const I=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),P=b(I);E=s.number(_,f,P),I<1?this._frameId||(this._frameId=!0):k=!0}else E=f,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:E-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=s.ease;if(this._prevEase){const f=this._prevEase,_=(s.exported.now()-f.start)/f.duration,b=f.easing(_+.01)-f.easing(_),E=.27/Math.sqrt(b*b+1e-4)*.01,k=Math.sqrt(.0729-E*E);c=s.bezier(E,k,.25,1)}return this._prevEase={start:s.exported.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Pp{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ca{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(o.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class so{constructor(){this._tap=new aa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,f){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(o,c,f))}touchmove(o,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=c[0],b=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,c,f)}touchend(o,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(o,c,f)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bc{constructor(o,c,f){this._el=o,this._mousePan=c,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Et{constructor(o,c,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lp{constructor(o,c,f,_){this._el=o,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gl=d=>d.zoom||d.drag||d.pitch||d.rotate;class _l extends s.Event{}class yl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const f=s.sub([],c,o);this.radius=s.length(f[2]<0?s.div([],f,this.constants):[f[0],f[1],0])}projectRay(o){s.div(o,o,this.constants),s.normalize(o,o),s.mul$1(o,o,this.constants);const c=s.scale$2([],o,this.radius);if(c[2]>0){const f=s.scale$2([],[0,0,1],s.dot(c,[0,0,1])),_=s.scale$2([],s.normalize([],[c[0],c[1],0]),this.radius),b=s.add([],c,s.scale$2([],s.sub([],s.add([],_,f),c),2));c[0]=b[0],c[1]=b[1]}return c}}function vl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class zp{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mc(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[_,b,E]of this._listeners)_.addEventListener(b,_===s.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,c,f]of this._listeners)o.removeEventListener(c,o===s.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(o){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new wp(c,o));const _=c.boxZoom=new gh(c,o);this._add("boxZoom",_);const b=new _h,E=new ca;c.doubleClickZoom=new Pp(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const k=new so;this._add("tapDragZoom",k);const I=c.touchPitch=new Hi(c);this._add("touchPitch",I);const P=new yh(o),L=new vh(o);c.dragRotate=new Et(o,P,L),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const j=new kp(o),V=new la(c,o);c.dragPan=new Bc(f,j,V),this._add("mousePan",j),this._add("touchPan",V,["touchZoom","touchRotate"]);const W=new Ip,q=new Ap;c.touchZoomRotate=new Lp(f,q,W,k),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Lc(c));const H=c.scrollZoom=new bo(c,this);this._add("scrollZoom",H,["mousePan"]);const X=c.keyboard=new Cp;this._add("keyboard",X);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[U]&&c[U].enable(o[U])}_add(o,c,f){this._handlers.push({handlerName:o,handler:c,allowed:f}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,f){for(const _ in o)if(_!==f&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const f of o)this._el.contains(f.target)&&c.push(f);return c}handleEvent(o,c){this._updatingCamera=!0;const f=o.type==="renderFrame",_=f?void 0:o,b={needsRenderFrame:!1},E={},k={},I=o.touches?this._getMapTouches(o.touches):void 0,P=I?et(this._el,I):f?void 0:fe(this._el,o);for(const{handlerName:V,handler:W,allowed:q}of this._handlers){if(!W.isEnabled())continue;let H;this._blockedByActive(k,q,V)?W.reset():W[c||o.type]&&(H=W[c||o.type](o,P,I),this.mergeHandlerResult(b,E,H,V,_),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||W.isActive())&&(k[V]=W)}const L={};for(const V in this._previousActiveHandlers)k[V]||(L[V]=_);this._previousActiveHandlers=k,(Object.keys(L).length||vl(b))&&(this._changes.push([b,E,L]),this._triggerRenderFrame()),(Object.keys(k).length||vl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=b;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(o,c,f,_,b){if(!f)return;s.extend(o,f);const E={handlerName:_,originalEvent:f.originalEvent||b};f.zoomDelta!==void 0&&(c.zoom=E),f.panDelta!==void 0&&(c.drag=E),f.pitchDelta!==void 0&&(c.pitch=E),f.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const o={},c={},f={};for(const[_,b,E]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new s.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),s.extend(c,b),s.extend(f,E);this._updateMapTransform(o,c,f),this._changes=[]}_updateMapTransform(o,c,f){const _=this._map,b=_.transform,E=te=>[te.x,te.y,te.z];if((te=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!vl(o)){const te=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",te!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&_._stop(!0),!vl(o))return void this._fireEvents(c,f,!0);let{panDelta:k,zoomDelta:I,bearingDelta:P,pitchDelta:L,around:j,aroundCoord:V,pinchAround:W}=o;b._isCameraConstrained&&(I>0&&(I=0),b._isCameraConstrained=!1),W!==void 0&&(j=W),(I||(te=>c.drag&&!this._eventsInProgress.drag)())&&j&&(this._dragOrigin=E(b.pointCoordinate3D(j)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",_._stop(!0),j=j||_.transform.centerPoint,P&&(b.bearing+=P),L&&(b.pitch+=L),b._updateCameraState();const q=[0,0,0];if(k)if(b.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(j).dir),Q=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(j.sub(k)).dir);q[0]=Q[0]-te[0],q[1]=Q[1]-te[1]}else{const te=b.pointCoordinate(j);if(b.projection.name==="globe"){k=k.rotate(-b.angle);const Q=b._pixelsPerMercatorPixel/b.worldSize;q[0]=-k.x*s.mercatorScale(s.latFromMercatorY(te.y))*Q,q[1]=-k.y*s.mercatorScale(b.center.lat)*Q}else{const Q=b.pointCoordinate(j.sub(k));te&&Q&&(q[0]=Q.x-te.x,q[1]=Q.y-te.y)}}const H=b.zoom,X=[0,0,0];if(I){const te=E(V||b.pointCoordinate3D(j)),Q={dir:s.normalize([],s.sub([],te,b._camera.position))};if(Q.dir[2]<0){const ie=b.zoomDeltaToMovement(te,I);s.scale$2(X,Q.dir,ie)}}const U=s.add(q,q,X);b._translateCameraConstrained(U),I&&Math.abs(b.zoom-H)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,f,!0)}_fireEvents(o,c,f){const _=gl(this._eventsInProgress),b=gl(o),E={};for(const L in o){const{originalEvent:j}=o[L];this._eventsInProgress[L]||(E[`${L}start`]=j),this._eventsInProgress[L]=o[L]}!_&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in E)this._fireEvent(L,E[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in o){const{originalEvent:j}=o[L];this._fireEvent(L,j)}const k={};let I;for(const L in this._eventsInProgress){const{handlerName:j,originalEvent:V}=this._eventsInProgress[L];this._handlersById[j].isActive()||(delete this._eventsInProgress[L],I=c[j]||V,k[`${L}end`]=I)}for(const L in k)this._fireEvent(L,k[L]);const P=gl(this._eventsInProgress);if(f&&(_||b)&&!P){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;L?(j(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:I})):(this._map.fire(new s.Event("moveend",{originalEvent:I})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new s.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new _l("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const xh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Rp extends s.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,f){return o=s.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,s.extend({offset:o},c),f)}panTo(o,c,f){return this.easeTo(s.extend({center:o},c),f)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,f){return this.easeTo(s.extend({zoom:o},c),f)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,f){return this.easeTo(s.extend({bearing:o},c),f)}resetNorth(o,c){return this.rotateTo(0,s.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=s.LngLatBounds.convert(o);const f=c&&c.bearing||0,_=c&&c.pitch||0,b=o.getNorthWest(),E=o.getSouthEast();return this._cameraForBounds(this.transform,b,E,f,_,c)}_extendCameraOptions(o){const c={top:0,bottom:0,right:0,left:0};if(typeof(o=s.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const f=o.padding;o.padding={top:f,bottom:f,right:f,left:f}}return o.padding=s.extend(c,o.padding),o}_minimumAABBFrustumDistance(o,c){const f=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return f/_>o.aspect?f/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,f,_,b,E){const k=o.clone(),I=this._extendCameraOptions(E);k.bearing=_,k.pitch=b;const P=s.LngLat.convert(c),L=s.LngLat.convert(f),j=.5*(P.lat+L.lat),V=.5*(P.lng+L.lng),W=s.latLngToECEF(j,V),q=s.normalize([],W),H=s.normalize([],s.cross([],q,[0,1,0])),X=s.cross([],H,q),U=[H[0],H[1],H[2],0,X[0],X[1],X[2],0,q[0],q[1],q[2],0,0,0,0,1],te=[W,s.latLngToECEF(P.lat,P.lng),s.latLngToECEF(L.lat,P.lng),s.latLngToECEF(L.lat,L.lng),s.latLngToECEF(P.lat,L.lng),s.latLngToECEF(j,P.lng),s.latLngToECEF(j,L.lng),s.latLngToECEF(P.lat,V),s.latLngToECEF(L.lat,V)];let Q=s.Aabb.fromPoints(te.map(He=>[s.dot(H,He),s.dot(X,He),s.dot(q,He)]));const ie=s.transformMat4([],Q.center,U);s.squaredLength(ie)===0&&s.set(ie,0,0,1),s.normalize(ie,ie),s.scale$2(ie,ie,s.GLOBE_RADIUS),k.center=s.ecefToLatLng(ie);const ue=k.getWorldToCameraMatrix(),le=s.invert(new Float64Array(16),ue);Q=s.Aabb.applyTransform(Q,s.multiply([],ue,U)),s.transformMat4(ie,ie,ue);const de=.5*(Q.max[2]-Q.min[2]),xe=this._minimumAABBFrustumDistance(k,Q),Ae=s.scale$2([],[0,0,1],de),Le=s.add(Ae,ie,Ae),st=xe+(k.pitch===0?0:s.distance(ie,Le)),Ee=k.globeCenterInViewSpace,Ve=s.sub([],ie,[Ee[0],Ee[1],Ee[2]]);s.normalize(Ve,Ve),s.scale$2(Ve,Ve,st);const Oe=s.add([],ie,Ve);s.transformMat4(Oe,Oe,le);const Je=s.earthRadius/s.GLOBE_RADIUS,Ce=s.length(Oe),ye=s.mercatorZfromAltitude(Math.max(Ce*Je-s.earthRadius,Number.EPSILON),0),Re=Math.min(k.zoomFromMercatorZAdjusted(ye),I.maxZoom);return Re>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"mercator"}),k.zoom=Re,this._cameraForBounds(k,c,f,_,b,E)):{center:k.center,zoom:Re,bearing:_,pitch:b}}queryTerrainElevation(o,c){const f=this.transform.elevation;return f?(c=s.extend({},{exaggerated:!0},c),f.getAtPoint(s.MercatorCoordinate.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,f,_,b,E){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,f,_,b,E);const k=o.clone(),I=this._extendCameraOptions(E),P=k.padding;k.bearing=_,k.pitch=b;const L=s.LngLat.convert(c),j=s.LngLat.convert(f),V=new s.LngLat(L.lng,j.lat),W=new s.LngLat(j.lng,L.lat),q=k.project(L),H=k.project(j),X=this.queryTerrainElevation(L),U=this.queryTerrainElevation(j),te=this.queryTerrainElevation(V),Q=this.queryTerrainElevation(W),ie=[[q.x,q.y,Math.min(X||0,U||0,te||0,Q||0)],[H.x,H.y,Math.max(X||0,U||0,te||0,Q||0)]];let ue=s.Aabb.fromPoints(ie);const le=k.getWorldToCameraMatrix(),de=s.invert(new Float64Array(16),le);ue=s.Aabb.applyTransform(ue,le);const xe=s.sub([],ue.max,ue.min),Ae=P.left||0,Le=P.right||0,st=P.bottom||0,Ee=P.top||0,{left:Ve,right:Oe,top:Je,bottom:Ce}=I.padding,ye=.5*(Ae+Le),Re=.5*(Ee+st),He=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(Ae+Le+Ve+Oe))/xe[0],(k.height-(st+Ee+Ce+Je))/xe[1])),I.maxZoom),tt=k.scale/k.zoomScale(He);ue=new s.Aabb([ue.min[0]-(Ve+ye)*tt,ue.min[1]-(Ce+Re)*tt,ue.min[2]],[ue.max[0]+(Oe+ye)*tt,ue.max[1]+(Je+Re)*tt,ue.max[2]]);const Ct=.5*xe[2],Qt=this._minimumAABBFrustumDistance(k,ue),kt=[0,0,1,0];s.transformMat4$1(kt,kt,le),s.normalize$2(kt,kt);const vt=s.scale$2([],kt,Qt+Ct),Mt=s.add([],ue.center,vt),hn=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new s.pointGeometry(I.offset.x,I.offset.y):s.pointGeometry.convert(I.offset)).rotate(-s.degToRad(_));ue.center[0]-=hn.x*tt,ue.center[1]+=hn.y*tt,s.transformMat4(ue.center,ue.center,de),s.transformMat4(Mt,Mt,de);const Dt=[ue.center[0],ue.center[1],Mt[2]*k.pixelsPerMeter];s.scale$2(Dt,Dt,1/k.worldSize);const Dn=s.lngFromMercatorX(Dt[0]),Gn=s.latFromMercatorY(Dt[1]),Qn=Math.min(k._zoomFromMercatorZ(Dt[2]),I.maxZoom),Xn=new s.LngLat(Dn,Gn);return k.mercatorFromTransition&&Qn<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"globe"}),k.zoom=Qn,this._cameraForBounds(k,c,f,_,b,E)):{center:Xn,zoom:Qn,bearing:_,pitch:b}}fitBounds(o,c,f){const _=this.cameraForBounds(o,c);return this._fitInternal(_,c,f)}fitScreenCoordinates(o,c,f,_,b){const E=s.pointGeometry.convert(o),k=s.pointGeometry.convert(c),I=new s.pointGeometry(Math.min(E.x,k.x),Math.min(E.y,k.y)),P=new s.pointGeometry(Math.max(E.x,k.x),Math.max(E.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,k))return this;const L=this.transform.pointLocation3D(I),j=this.transform.pointLocation3D(P),V=this.transform.pointLocation3D(new s.pointGeometry(I.x,P.y)),W=this.transform.pointLocation3D(new s.pointGeometry(P.x,I.y)),q=[Math.min(L.lng,j.lng,V.lng,W.lng),Math.min(L.lat,j.lat,V.lat,W.lat)],H=[Math.max(L.lng,j.lng,V.lng,W.lng),Math.max(L.lat,j.lat,V.lat,W.lat)],X=_&&_.pitch?_.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,q,H,f,X,_);return this._fitInternal(U,_,b)}_fitInternal(o,c,f){return o?(delete(c=s.extend(o,c)).padding,c.linear?this.easeTo(c,f):this.flyTo(c,f)):this}jumpTo(o,c){this.stop();const f=o.preloadOnly?this.transform.clone():this.transform;let _=!1,b=!1,E=!1;return"zoom"in o&&f.zoom!==+o.zoom&&(_=!0,f.zoom=+o.zoom),o.center!==void 0&&(f.center=s.LngLat.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(b=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(E=!0,f.pitch=+o.pitch),o.padding==null||f.isPaddingEqual(o.padding)||(f.padding=o.padding),o.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),_&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),b&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),E&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(xh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.warnOnce(xh),this;this.stop();const _=f.zoom,b=f.pitch,E=f.bearing;f.setFreeCameraOptions(o);const k=_!==f.zoom,I=b!==f.pitch,P=E!==f.bearing;return this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),k&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),P&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),I&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=s.extend({offset:[0,0],duration:500,easing:s.ease},o)).animate===!1||!o.essential&&s.exported.prefersReducedMotion)&&(o.duration=0);const f=this.transform,_=this.getZoom(),b=this.getBearing(),E=this.getPitch(),k=this.getPadding(),I="zoom"in o?+o.zoom:_,P="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:E,j="padding"in o?o.padding:f.padding,V=s.pointGeometry.convert(o.offset);let W,q,H;if(f.projection.name==="globe"){const Ae=s.MercatorCoordinate.fromLngLat(f.center),Le=V.rotate(-f.angle);Ae.x+=Le.x/f.worldSize,Ae.y+=Le.y/f.worldSize;const st=Ae.toLngLat(),Ee=s.LngLat.convert(o.center||st);this._normalizeCenter(Ee),W=f.centerPoint.add(Le),q=new s.pointGeometry(Ae.x,Ae.y).mult(f.worldSize),H=new s.pointGeometry(s.mercatorXfromLng(Ee.lng),s.mercatorYfromLat(Ee.lat)).mult(f.worldSize).sub(q)}else{W=f.centerPoint.add(V);const Ae=f.pointLocation(W),Le=s.LngLat.convert(o.center||Ae);this._normalizeCenter(Le),q=f.project(Ae),H=f.project(Le).sub(q)}const X=f.zoomScale(I-_);let U,te;o.around&&(U=s.LngLat.convert(o.around),te=f.locationPoint(U));const Q=this._zooming||I!==_,ie=this._rotating||b!==P,ue=this._pitching||L!==E,le=!f.isPaddingEqual(j),de=Ae=>Le=>{if(Q&&(Ae.zoom=s.number(_,I,Le)),ie&&(Ae.bearing=s.number(b,P,Le)),ue&&(Ae.pitch=s.number(E,L,Le)),le&&(Ae.interpolatePadding(k,j,Le),W=Ae.centerPoint.add(V)),U)Ae.setLocationAtPoint(U,te);else{const st=Ae.zoomScale(Ae.zoom-_),Ee=I>_?Math.min(2,X):Math.max(.5,X),Ve=Math.pow(Ee,1-Le),Oe=Ae.unproject(q.add(H.mult(Le*Ve)).mult(st));Ae.setLocationAtPoint(Ae.renderWorldCopies?Oe.wrap():Oe,W)}return o.preloadOnly||this._fireMoveEvents(c),Ae};if(o.preloadOnly){const Ae=this._emulate(de,o.duration,f);return this._preloadTiles(Ae),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=ie,this._pitching=ue,this._padding=le,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,xe),this._ease(de(f),Ae=>{f.recenterOnTerrain(),this._afterEase(c,Ae)},o),this}_prepareEase(o,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||f.moving||this.fire(new s.Event("movestart",o)),this._zooming&&!f.zooming&&this.fire(new s.Event("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new s.Event("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new s.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.Event("move",o)),this._zooming&&this.fire(new s.Event("zoom",o)),this._rotating&&this.fire(new s.Event("rotate",o)),this._pitching&&this.fire(new s.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new s.Event("zoomend",o)),_&&this.fire(new s.Event("rotateend",o)),b&&this.fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o))}flyTo(o,c){if(!o.essential&&s.exported.prefersReducedMotion){const He=s.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,c)}this.stop(),o=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},o);const f=this.transform,_=this.getZoom(),b=this.getBearing(),E=this.getPitch(),k=this.getPadding(),I="zoom"in o?s.clamp(+o.zoom,f.minZoom,f.maxZoom):_,P="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:E,j="padding"in o?o.padding:f.padding,V=f.zoomScale(I-_),W=s.pointGeometry.convert(o.offset);let q=f.centerPoint.add(W);const H=f.pointLocation(q),X=s.LngLat.convert(o.center||H);this._normalizeCenter(X);const U=f.project(H),te=f.project(X).sub(U);let Q=o.curve;const ie=Math.max(f.width,f.height),ue=ie/V,le=te.mag();if("minZoom"in o){const He=s.clamp(Math.min(o.minZoom,_,I),f.minZoom,f.maxZoom),tt=ie/f.zoomScale(He-_);Q=Math.sqrt(tt/le*2)}const de=Q*Q;function xe(He){const tt=(ue*ue-ie*ie+(He?-1:1)*de*de*le*le)/(2*(He?ue:ie)*de*le);return Math.log(Math.sqrt(tt*tt+1)-tt)}function Ae(He){return(Math.exp(He)-Math.exp(-He))/2}function Le(He){return(Math.exp(He)+Math.exp(-He))/2}const st=xe(0);let Ee=function(He){return Le(st)/Le(st+Q*He)},Ve=function(He){return ie*((Le(st)*(Ae(tt=st+Q*He)/Le(tt))-Ae(st))/de)/le;var tt},Oe=(xe(1)-st)/Q;if(Math.abs(le)<1e-6||!isFinite(Oe)){if(Math.abs(ie-ue)<1e-6)return this.easeTo(o,c);const He=ue<ie?-1:1;Oe=Math.abs(Math.log(ue/ie))/Q,Ve=function(){return 0},Ee=function(tt){return Math.exp(He*Q*tt)}}o.duration="duration"in o?+o.duration:1e3*Oe/("screenSpeed"in o?+o.screenSpeed/Q:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Je=b!==P,Ce=L!==E,ye=!f.isPaddingEqual(j),Re=He=>tt=>{const Ct=tt*Oe,Qt=1/Ee(Ct);He.zoom=tt===1?I:_+He.scaleZoom(Qt),Je&&(He.bearing=s.number(b,P,tt)),Ce&&(He.pitch=s.number(E,L,tt)),ye&&(He.interpolatePadding(k,j,tt),q=He.centerPoint.add(W));const kt=tt===1?X:He.unproject(U.add(te.mult(Ve(Ct))).mult(Qt));return He.setLocationAtPoint(He.renderWorldCopies?kt.wrap():kt,q),He._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),He};if(o.preloadOnly){const He=this._emulate(Re,o.duration,f);return this._preloadTiles(He),this}return this._zooming=!0,this._rotating=Je,this._pitching=Ce,this._padding=ye,this._prepareEase(c,!1),this._ease(Re(f),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!o){const f=this.handlers;f&&f.stop(!1)}return this}_ease(o,c,f){f.animate===!1||f.duration===0?(o(1),c()):(this._easeStart=s.exported.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=s.wrap(o,-180,180);const f=Math.abs(o-c);return Math.abs(o-360-c)<f&&(o-=360),Math.abs(o+360-c)<f&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const f=o.lng-c.center.lng;o.lng+=f>180?-360:f<-180?360:0}_emulate(o,c,f){const _=Math.ceil(15*c/1e3),b=[],E=o(f.clone());for(let k=0;k<=_;k++){const I=E(k/_);b.push(I.clone())}return b}}class wh{constructor(o={}){this.options=o,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact;return this._map=o,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),Z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const f=this._map._getUIString(`AttributionControl.${c}`);o.setAttribute("aria-label",f),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(o){const f=c.reduce((_,b,E)=>(b.value&&(_+=`${b.key}=${b.value}${E<c.length-1?"&":""}`),_),"?");o.href=`${s.config.FEEDBACK_URL}/${f}#${fh(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const c=this._map.style._sourceCaches;for(const _ in c){const b=c[_];if(b.used){const E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((_,b)=>_.length-b.length),o=o.filter((_,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const f=o.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Th{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=Z("div","mapboxgl-ctrl");const c=Z("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const c in o){const f=o[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class bl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const _ of f)if(_.id===o)return void(_.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fc(d,o,c){if(d=new s.LngLat(d.lng,d.lat),o){const f=new s.LngLat(d.lng-360,d.lat),_=new s.LngLat(d.lng+360,d.lat),b=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),E=c.locationPoint(d).distSqr(o),k=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(f).distSqr(o)<E&&(k||Math.abs(f.lng-c.center.lng)<b)?d=f:c.locationPoint(_).distSqr(o)<E&&(k||Math.abs(_.lng-c.center.lng)<b)&&(d=_)}for(;Math.abs(d.lng-c.center.lng)>180;){const f=c.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const ua={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jc extends s.Evented{constructor(o,c){if(super(),(o instanceof s.window.HTMLElement||c)&&(o=s.extend({element:o},c)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=s.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z("div");const _=41,b=27,E=me("svg",{display:"block",height:_*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${_}`},this._element),k=me("radialGradient",{id:"shadowGradient"},me("defs",{},E));me("stop",{offset:"10%","stop-opacity":.4},k),me("stop",{offset:"100%","stop-opacity":.05},k),me("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),me("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),me("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),me("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=s.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const f=this._element.classList;for(const _ in ua)f.remove(`mapboxgl-marker-anchor-${_}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,f=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,c=this._pos;if(!o||!c)return!1;const f=o.unproject(c),_=o.getFreeCameraOptions();if(!_.position)return!1;const b=_.position.toLngLat();return b.distanceTo(f)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();const f=o.unproject(c);let _;o._showingGlobe()&&s.isLngLatBehindGlobe(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(f),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${ua[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const o=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!o||f!=="map")return"";if(!c._showingGlobe()){const I=c.getPitch();return I?`rotateX(${I}deg)`:""}const _=s.radToDeg(s.globeTiltAtLngLat(c.transform,this._lngLat)),b=o.sub(s.globeCenterToScreenPoint(c.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";const k=_/E;return`rotateX(${-b.y*k}deg) rotateY(${b.x*k}deg)`}_calculateZTransform(){const o=this._pos,c=this._map;if(!c||!o)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){const b=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);f=s.radToDeg(Math.atan2(E.y,E.x))-90}else f=-c.getBearing();else if(_==="horizon"){const b=s.smoothstep(4,6,c.getZoom()),E=s.globeCenterToScreenPoint(c.transform);E.y+=b*c.transform.height;const k=o.sub(E),I=s.radToDeg(Math.atan2(k.y,k.x));f=(I>90?I-270:I+90)*(1-b)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(o){s.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Fc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),o===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.pointGeometry.convert(o),this._update(),this}_onMove(o){const c=this._map;if(!c)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(o.point.dist(f)<b)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(o){const c=this._map,f=this._pos;c&&f&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(f),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Dp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Op=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Eh(d=new s.pointGeometry(0,0),o="bottom"){if(typeof d=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(o){case"top":return new s.pointGeometry(0,d);case"top-left":return new s.pointGeometry(c,c);case"top-right":return new s.pointGeometry(-c,c);case"bottom":return new s.pointGeometry(0,-d);case"bottom-left":return new s.pointGeometry(c,-c);case"bottom-right":return new s.pointGeometry(-c,-c);case"left":return new s.pointGeometry(d,0);case"right":return new s.pointGeometry(-d,0)}return new s.pointGeometry(0,0)}return d instanceof s.pointGeometry||Array.isArray(d)?s.pointGeometry.convert(d):s.pointGeometry.convert(d[o]||[0,0])}class Bp{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=s.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,f){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+f}}const Fp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},jp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},kh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Np{constructor(o,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new yh({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,f&&(this.mousePitch=new vh({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),ve()}move(o,c){const f=this.map,_=this.mouseRotate.mousemoveWindow(o,c),b=_&&_.bearingDelta;if(b&&f.setBearing(f.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(o,c),k=E&&E.pitchDelta;k&&f.setPitch(f.getPitch()+k)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$e(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(s.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),fe(this.element,o)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,fe(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=et(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=et(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $p={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Up={maxWidth:100,unit:"metric"};function Vp(d,o,c){const f=Nc(o),_=f/o,b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[c];this._map._requestDomTask(()=>{this._container.style.width=d*_+"px",this._container.innerHTML=`${f}&nbsp;${b}`})}function Nc(d){const o=Math.pow(10,`${Math.floor(d)}`.length-1);let c=d/o;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(f){const _=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*_)/_}(c),o*c}const xl={version:s.version,supported:z,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Rp{constructor(d){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(d=s.extend({},jp,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(d.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _t(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new bl,this._domRenderTaskQueue=new bl,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Fp,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=s.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new zp(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new bp(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,s.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new wh({customAttribution:d.customAttribution})),this._logoControl=new Th,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(d,o){if(o===void 0&&(o=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[o];return o.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(d);return o>-1&&this._controls.splice(o,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.Event("movestart",d)).fire(new s.Event("move",d)),this.fire(new s.Event("resize",d)),o&&this.fire(new s.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?s.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(o=>o==="auto"?s.window.navigator.language:o):d}setLanguage(d){const o=this._parseLanguage(d);if(!this.style||o===this._language)return this;this._language=o,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,o=d.projection.name;let c;o==="globe"&&d.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),c=!0):o==="mercator"&&d.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,o){return this._updateProjection(d||o||{name:"mercator"})}_updateProjection(d){let o;if(o=d.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),o){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(s.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(s.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,o,c){if(d==="mouseenter"||d==="mouseover"){let f=!1;const _=E=>{const k=o.filter(P=>this.getLayer(P)),I=k.length?this.queryRenderedFeatures(E.point,{layers:k}):[];I.length?f||(f=!0,c.call(this,new ji(d,this,E.originalEvent,{features:I}))):f=!1},b=()=>{f=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:_,mouseout:b}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;const _=E=>{const k=o.filter(I=>this.getLayer(I));(k.length?this.queryRenderedFeatures(E.point,{layers:k}):[]).length?f=!0:f&&(f=!1,c.call(this,new ji(d,this,E.originalEvent)))},b=E=>{f&&(f=!1,c.call(this,new ji(d,this,E.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:_,mouseout:b}}}{const f=_=>{const b=o.filter(k=>this.getLayer(k)),E=b.length?this.queryRenderedFeatures(_.point,{layers:b}):[];E.length&&(_.features=E,c.call(this,_),delete _.features)};return{layers:new Set(o),listener:c,delegates:{[d]:f}}}}on(d,o,c){if(c===void 0)return super.on(d,o);Array.isArray(o)||(o=[o]);const f=this._createDelegatedListener(d,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,o,c){if(c===void 0)return super.once(d,o);Array.isArray(o)||(o=[o]);const f=this._createDelegatedListener(d,o,c);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,o,c){if(c===void 0)return super.off(d,o);o=new Set(Array.isArray(o)?o:[o]);const f=(b,E)=>{if(b.size!==E.size)return!1;for(const k of b)if(!E.has(k))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(b=>{for(let E=0;E<b.length;E++){const k=b[E];if(k.listener===c&&f(k.layers,o)){for(const I in k.delegates)this.off(I,k.delegates[I]);return b.splice(E,1),this}}})(_),this}queryRenderedFeatures(d,o){return this.style?(o!==void 0||d===void 0||d instanceof s.pointGeometry||Array.isArray(d)||(o=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(d,o){return this.style.querySourceFeatures(d,o)}setStyle(d,o){return(o=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(d,o))}_getUIString(d){const o=this._locale[d];if(o==null)throw new Error(`Missing UI string '${d}'`);return o}_updateStyle(d,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Or(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Or(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,o){if(typeof d=="string"){const c=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(c,s.ResourceType.Style);s.getJSON(f,(_,b)=>{_?this.fire(new s.ErrorEvent(_)):b&&this._updateDiff(b,o)})}else typeof d=="object"&&this._updateDiff(d,o)}_updateDiff(d,o){try{this.style.setState(d)&&this._update(!0)}catch(c){s.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(d,o){return this._lazyInitEmptyStyle(),this.style.addSource(d,o),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const o in d){const c=d[o]._tiles;for(const f in c){const _=c[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(d,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,o,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,o,{pixelRatio:c=1,sdf:f=!1,stretchX:_,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap){const{width:k,height:I,data:P}=s.exported.getImageData(o);this.style.addImage(d,{data:new s.RGBAImage({width:k,height:I},P),pixelRatio:c,stretchX:_,stretchY:b,content:E,sdf:f,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:I}=o,P=o;this.style.addImage(d,{data:new s.RGBAImage({width:k,height:I},new Uint8Array(P.data)),pixelRatio:c,stretchX:_,stretchY:b,content:E,sdf:f,version:0,userImage:P}),P.onAdd&&P.onAdd(this,d)}}updateImage(d,o){const c=this.style.getImage(d);if(!c)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap?s.exported.getImageData(o):o,{width:_,height:b}=f;_!==void 0&&b!==void 0?_===c.data.width&&b===c.data.height?(c.data.replace(f.data,!(o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap)),this.style.updateImage(d,c)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${b})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,o){s.getImage(this._requestManager.transformRequest(d,s.ResourceType.Image),(c,f)=>{o(c,f instanceof s.window.HTMLImageElement?s.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(d,o){return this._lazyInitEmptyStyle(),this.style.addLayer(d,o),this._update(!0)}moveLayer(d,o){return this.style.moveLayer(d,o),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,o,c){return this.style.setLayerZoomRange(d,o,c),this._update(!0)}setFilter(d,o,c={}){return this.style.setFilter(d,o,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,o,c,f={}){return this.style.setPaintProperty(d,o,c,f),this._update(!0)}getPaintProperty(d,o){return this.style.getPaintProperty(d,o)}setLayoutProperty(d,o,c,f={}){return this.style.setLayoutProperty(d,o,c,f),this._update(!0)}getLayoutProperty(d,o){return this.style.getLayoutProperty(d,o)}setLight(d,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(d),this.transform):0}setFeatureState(d,o){return this.style.setFeatureState(d,o),this._update()}removeFeatureState(d,o){return this.style.removeFeatureState(d,o),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,f,_,b=this._container;for(;b&&(!f||!_);){const E=s.window.getComputedStyle(b).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),b=b.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Z("div","mapboxgl-canvas-container",d);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Z("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Z("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=Z("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,o){const c=s.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${o}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const o=this._markers.indexOf(d);o!==-1&&this._markers.splice(o,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const o=this._popups.indexOf(d);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const d=s.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._useWebGL2&&this._canvas.getContext("webgl2",d),c=o||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);c?(this._useWebGL2&&!o&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(c,!0),this.painter=new cl(c,this.transform,!!o),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(c)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let o;const c=this.painter.context.extTimerQuery,f=s.exported.now();if(this.listens("gpu-timing-frame")&&(o=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,I=this.transform.pitch,P=s.exported.now(),L=new s.EvaluationParameters(k,{now:P,fadeDuration:_,pitch:I,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const k=s.exported.now()-f;c.endQueryEXT(c.TIME_ELAPSED_EXT,o),setTimeout(()=>{const I=c.getQueryObjectEXT(o,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(o),this.fire(new s.Event("gpu-timing-frame",{cpuTime:k,gpuTime:I})),s.window.performance.mark("frame-gpu",{startTime:f,detail:{gpuTime:I}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(k);this.fire(new s.Event("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(k);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:I}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(E||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const o of this._markers)d&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!d||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(d,o=!1){const c=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((o||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const f=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const E=Math.abs(f-_);if(E>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(_),c(_);this._averageElevation.easeTo(_,d,300)}else if(E>1e-4)return this._averageElevation.jumpTo(_),c(_)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===s.AUTH_ERR_MSG||d.status===401)){const o=this.painter.context.gl;s.storeAuthState(o,!1),this._logoControl instanceof Th&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,f=c.createFramebuffer();function _(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(d,o,c){let f=c[1]-c[0];const _=d.length/4;for(let b=0;b<o.length;b++){const E=o[b];let k=0;for(let I=0;I<E.length;I+=4)E[I]===d[I]&&E[I+1]===d[I+1]&&E[I+2]===d[I+2]&&E[I+3]===d[I+3]&&(k+=1);f+=(c[b+2]-c[b+1])*(1-k/_)}return f}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.exported.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(d){const o=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(o,(c,f)=>c._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,o){s.setCacheLimits(d,o)}get version(){return s.version}},NavigationControl:class{constructor(d){this.options=s.extend({},kh,d),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const o=d.getZoom(),c=o===d.getMaxZoom(),f=o===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Np(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,o){const c=Z("button",d,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(d,o){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${o}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.Evented{constructor(d){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},$p,d),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Br(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,d(c)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(d){const o=this._map.getMaxBounds(),c=d.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",d)),this._finish()}}_updateCamera(d){const o=new s.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,f=this._map.getBearing(),_=s.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),_,{geolocateSource:!0})}_updateMarker(d){if(d){const o=new s.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,o=s.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:wh,ScaleControl:class{constructor(d){this.options=s.extend({},Up,d),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Vp.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,f=o._containerWidth/2-d/2,_=o.unproject([f,c]),b=o.unproject([f+d,c]),E=_.distanceTo(b);if(this.options.unit==="imperial"){const k=3.2808*E;k>5280?this._setScale(d,k/5280,"mile"):this._setScale(d,k,"foot")}else this.options.unit==="nautical"?this._setScale(d,E/1852,"nautical-mile"):E>=1e3?this._setScale(d,E/1e3,"kilometer"):this._setScale(d,E,"meter")}_setScale(d,o,c){const f=Nc(o),_=f/o;this._map._requestDomTask(()=>{this._container.style.width=d*_+"px",this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:c}).format(f):`${f}&nbsp;nm`})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof s.window.HTMLElement?this._container=d.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(d){super(),this.options=s.extend(Object.create(Dp),d),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(s.window.document.createTextNode(d))}setHTML(d){const o=s.window.document.createDocumentFragment(),c=s.window.document.createElement("body");let f;for(c.innerHTML=d;f=c.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(d),this.options.closeButton){const c=this._closeButton=Z("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let o;return this._classList.delete(d)?o=!1:(this._classList.add(d),o=!0),this._updateClassList(),o}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const o=this._map,c=this._container,f=this._pos;if(!o||!c||!f)return"bottom";const _=c.offsetWidth,b=c.offsetHeight,E=f.x<_/2,k=f.x>o.transform.width-_/2;if(f.y+d<b)return E?"top-left":k?"top-right":"top";if(f.y>o.transform.height-b){if(E)return"bottom-left";if(k)return"bottom-right"}return E?"left":k?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),d.className=o.join(" ")}_update(d){const o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=Z("div","mapboxgl-popup",o.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fc(this._lngLat,this._pos,o.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d?d:o.project(this._lngLat),b=Eh(this.options.offset),E=this._anchor=this._getAnchor(b.y),k=Eh(this.options.offset,E),I=_.add(k).round();o._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${ua[E]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&o._showingGlobe()){const _=s.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Op);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:jc,Style:Or,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Ac,Evented:s.Evented,config:s.config,prewarm:function(){Wt().acquire(jt)},clearPrewarmedResources:function(){const d=Lt;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(jt),Lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(d){s.config.ACCESS_TOKEN=d},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(d){s.config.API_URL=d},get workerCount(){return Rt.workerCount},set workerCount(d){Rt.workerCount=d},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return xl});var T=m;return T})})(LD);const $a=fy;var Fu=RD,zD=Object.prototype.hasOwnProperty;function RD(){for(var t={},r=0;r<arguments.length;r++){var l=arguments[r];for(var h in l)zD.call(l,h)&&(t[h]=l[h])}return t}var my={},DD={get exports(){return my},set exports(t){my=t}};(function(t,r){(function(){var l={};t.exports=l,l.simpleFilter=function(h,m){return m.filter(function(v){return l.test(h,v)})},l.test=function(h,m){return l.match(h,m)!==null},l.match=function(h,m,v){v=v||{};var T=0,s=[],S=m.length,z=0,O=0,B=v.pre||"",Z=v.post||"",me=v.caseSensitive&&m||m.toLowerCase(),_e;h=v.caseSensitive&&h||h.toLowerCase();for(var Ie=0;Ie<S;Ie++)_e=m[Ie],me[Ie]===h[T]?(_e=B+_e+Z,T+=1,O+=1+O):O=0,z+=O,s[s.length]=_e;return T===h.length?(z=me===h?1/0:z,{rendered:s.join(""),score:z}):null},l.filter=function(h,m,v){return!m||m.length===0?[]:typeof h!="string"?m:(v=v||{},m.reduce(function(T,s,S,z){var O=s;v.extract&&(O=v.extract(s));var B=l.match(h,O,v);return B!=null&&(T[T.length]={string:B.rendered,score:B.score,index:S,original:s}),T},[]).sort(function(T,s){var S=s.score-T.score;return S||T.index-s.index}))}})()})(DD);var qr=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};qr.prototype.show=function(){this.element.style.display="block"};qr.prototype.hide=function(){this.element.style.display="none"};qr.prototype.add=function(t){this.items.push(t)};qr.prototype.clear=function(){this.items=[],this.active=0};qr.prototype.isEmpty=function(){return!this.items.length};qr.prototype.isVisible=function(){return this.element.style.display==="block"};qr.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};qr.prototype.drawItem=function(t,r){var l=document.createElement("li"),h=document.createElement("a");r&&(l.className+=" active"),h.innerHTML=t.string,l.appendChild(h),this.element.appendChild(l),l.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),l.addEventListener("mouseup",function(){this.handleMouseUp.call(this,t)}.bind(this))};qr.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};qr.prototype.move=function(t){this.active=t,this.draw()};qr.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};qr.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};qr.prototype.drawError=function(t){var r=document.createElement("li");r.innerHTML=t,this.element.appendChild(r),this.show()};var OD=qr,BD=Fu,FD=my,jD=OD,kr=function(t,r,l){return l=l||{},this.options=BD({minLength:2,limit:5,filter:!0,hideOnBlur:!0},l),this.el=t,this.data=r||[],this.list=new jD(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(h){this.handleKeyUp(h.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(h){this.handleKeyDown(h)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(h){this.handlePaste(h)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};kr.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};kr.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};kr.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};kr.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var r=this;setTimeout(function(){r.handleInputChange(t.target.value)},100)}};kr.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(r){for(var l=0;l<r.length&&(this.list.add(r[l]),l!==this.options.limit-1);l++);this.list.draw()}.bind(this))};kr.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};kr.prototype.update=function(t){this.data=t,this.handleKeyUp()};kr.prototype.clear=function(){this.data=[],this.list.clear()};kr.prototype.normalize=function(t){return t=t.toLowerCase(),t};kr.prototype.match=function(t,r){return t.indexOf(r)>-1};kr.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),this.el.dispatchEvent(r)}else this.el.fireEvent("onchange")};kr.prototype.getCandidates=function(t){var r={pre:"<strong>",post:"</strong>",extract:function(h){return this.getItemValue(h)}.bind(this)},l;this.options.filter?(l=FD.filter(this.query,this.data,r),l=l.map(function(h){return{original:h.original,string:this.render(h.original,h.string)}}.bind(this))):l=this.data.map(function(h){var m=this.render(h);return{original:h,string:m}}.bind(this)),t(l)};kr.prototype.getItemValue=function(t){return t};kr.prototype.render=function(t,r){if(r)return r;for(var l=t.original?this.getItemValue(t.original):this.getItemValue(t),h=this.normalize(l),m=h.lastIndexOf(this.query);m>-1;){var v=m+this.query.length;l=l.slice(0,m)+"<strong>"+l.slice(m,v)+"</strong>"+l.slice(v),m=h.slice(0,m).lastIndexOf(this.query)}return l};kr.prototype.renderError=function(t){this.list.drawError(t)};var ND=kr,iE=ND,$D=iE;typeof window<"u"&&(window.Suggestions=iE);var UD="Expected a function",T1=0/0,VD="[object Symbol]",GD=/^\s+|\s+$/g,ZD=/^[-+]0x[0-9a-f]+$/i,qD=/^0b[01]+$/i,WD=/^0o[0-7]+$/i,HD=parseInt,XD=typeof Pr=="object"&&Pr&&Pr.Object===Object&&Pr,KD=typeof self=="object"&&self&&self.Object===Object&&self,YD=XD||KD||Function("return this")(),JD=Object.prototype,QD=JD.toString,eO=Math.max,tO=Math.min,L_=function(){return YD.Date.now()};function nO(t,r,l){var h,m,v,T,s,S,z=0,O=!1,B=!1,Z=!0;if(typeof t!="function")throw new TypeError(UD);r=E1(r)||0,gy(l)&&(O=!!l.leading,B="maxWait"in l,v=B?eO(E1(l.maxWait)||0,r):v,Z="trailing"in l?!!l.trailing:Z);function me(et){var Pe=h,Ge=m;return h=m=void 0,z=et,T=t.apply(Ge,Pe),T}function _e(et){return z=et,s=setTimeout(ve,r),O?me(et):T}function Ie(et){var Pe=et-S,Ge=et-z,Ye=r-Pe;return B?tO(Ye,v-Ge):Ye}function Te(et){var Pe=et-S,Ge=et-z;return S===void 0||Pe>=r||Pe<0||B&&Ge>=v}function ve(){var et=L_();if(Te(et))return $e(et);s=setTimeout(ve,Ie(et))}function $e(et){return s=void 0,Z&&h?me(et):(h=m=void 0,T)}function Fe(){s!==void 0&&clearTimeout(s),z=0,h=S=m=s=void 0}function qe(){return s===void 0?T:$e(L_())}function fe(){var et=L_(),Pe=Te(et);if(h=arguments,m=this,S=et,Pe){if(s===void 0)return _e(S);if(B)return s=setTimeout(ve,r),me(S)}return s===void 0&&(s=setTimeout(ve,r)),T}return fe.cancel=Fe,fe.flush=qe,fe}function gy(t){var r=typeof t;return!!t&&(r=="object"||r=="function")}function iO(t){return!!t&&typeof t=="object"}function rO(t){return typeof t=="symbol"||iO(t)&&QD.call(t)==VD}function E1(t){if(typeof t=="number")return t;if(rO(t))return T1;if(gy(t)){var r=typeof t.valueOf=="function"?t.valueOf():t;t=gy(r)?r+"":r}if(typeof t!="string")return t===0?t:+t;t=t.replace(GD,"");var l=qD.test(t);return l||WD.test(t)?HD(t.slice(2),l?2:8):ZD.test(t)?T1:+t}var oO=nO,_m={},sO={get exports(){return _m},set exports(t){_m=t}},wu=typeof Reflect=="object"?Reflect:null,k1=wu&&typeof wu.apply=="function"?wu.apply:function(r,l,h){return Function.prototype.apply.call(r,l,h)},Gf;wu&&typeof wu.ownKeys=="function"?Gf=wu.ownKeys:Object.getOwnPropertySymbols?Gf=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Gf=function(r){return Object.getOwnPropertyNames(r)};function aO(t){console&&console.warn&&console.warn(t)}var rE=Number.isNaN||function(r){return r!==r};function di(){di.init.call(this)}sO.exports=di;_m.once=hO;di.EventEmitter=di;di.prototype._events=void 0;di.prototype._eventsCount=0;di.prototype._maxListeners=void 0;var S1=10;function Um(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(di,"defaultMaxListeners",{enumerable:!0,get:function(){return S1},set:function(t){if(typeof t!="number"||t<0||rE(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");S1=t}});di.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};di.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||rE(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function oE(t){return t._maxListeners===void 0?di.defaultMaxListeners:t._maxListeners}di.prototype.getMaxListeners=function(){return oE(this)};di.prototype.emit=function(r){for(var l=[],h=1;h<arguments.length;h++)l.push(arguments[h]);var m=r==="error",v=this._events;if(v!==void 0)m=m&&v.error===void 0;else if(!m)return!1;if(m){var T;if(l.length>0&&(T=l[0]),T instanceof Error)throw T;var s=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw s.context=T,s}var S=v[r];if(S===void 0)return!1;if(typeof S=="function")k1(S,this,l);else for(var z=S.length,O=uE(S,z),h=0;h<z;++h)k1(O[h],this,l);return!0};function sE(t,r,l,h){var m,v,T;if(Um(l),v=t._events,v===void 0?(v=t._events=Object.create(null),t._eventsCount=0):(v.newListener!==void 0&&(t.emit("newListener",r,l.listener?l.listener:l),v=t._events),T=v[r]),T===void 0)T=v[r]=l,++t._eventsCount;else if(typeof T=="function"?T=v[r]=h?[l,T]:[T,l]:h?T.unshift(l):T.push(l),m=oE(t),m>0&&T.length>m&&!T.warned){T.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=r,s.count=T.length,aO(s)}return t}di.prototype.addListener=function(r,l){return sE(this,r,l,!1)};di.prototype.on=di.prototype.addListener;di.prototype.prependListener=function(r,l){return sE(this,r,l,!0)};function lO(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function aE(t,r,l){var h={fired:!1,wrapFn:void 0,target:t,type:r,listener:l},m=lO.bind(h);return m.listener=l,h.wrapFn=m,m}di.prototype.once=function(r,l){return Um(l),this.on(r,aE(this,r,l)),this};di.prototype.prependOnceListener=function(r,l){return Um(l),this.prependListener(r,aE(this,r,l)),this};di.prototype.removeListener=function(r,l){var h,m,v,T,s;if(Um(l),m=this._events,m===void 0)return this;if(h=m[r],h===void 0)return this;if(h===l||h.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete m[r],m.removeListener&&this.emit("removeListener",r,h.listener||l));else if(typeof h!="function"){for(v=-1,T=h.length-1;T>=0;T--)if(h[T]===l||h[T].listener===l){s=h[T].listener,v=T;break}if(v<0)return this;v===0?h.shift():cO(h,v),h.length===1&&(m[r]=h[0]),m.removeListener!==void 0&&this.emit("removeListener",r,s||l)}return this};di.prototype.off=di.prototype.removeListener;di.prototype.removeAllListeners=function(r){var l,h,m;if(h=this._events,h===void 0)return this;if(h.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):h[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete h[r]),this;if(arguments.length===0){var v=Object.keys(h),T;for(m=0;m<v.length;++m)T=v[m],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=h[r],typeof l=="function")this.removeListener(r,l);else if(l!==void 0)for(m=l.length-1;m>=0;m--)this.removeListener(r,l[m]);return this};function lE(t,r,l){var h=t._events;if(h===void 0)return[];var m=h[r];return m===void 0?[]:typeof m=="function"?l?[m.listener||m]:[m]:l?uO(m):uE(m,m.length)}di.prototype.listeners=function(r){return lE(this,r,!0)};di.prototype.rawListeners=function(r){return lE(this,r,!1)};di.listenerCount=function(t,r){return typeof t.listenerCount=="function"?t.listenerCount(r):cE.call(t,r)};di.prototype.listenerCount=cE;function cE(t){var r=this._events;if(r!==void 0){var l=r[t];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}di.prototype.eventNames=function(){return this._eventsCount>0?Gf(this._events):[]};function uE(t,r){for(var l=new Array(r),h=0;h<r;++h)l[h]=t[h];return l}function cO(t,r){for(;r+1<t.length;r++)t[r]=t[r+1];t.pop()}function uO(t){for(var r=new Array(t.length),l=0;l<r.length;++l)r[l]=t[l].listener||t[l];return r}function hO(t,r){return new Promise(function(l,h){function m(T){t.removeListener(r,v),h(T)}function v(){typeof t.removeListener=="function"&&t.removeListener("error",m),l([].slice.call(arguments))}hE(t,r,v,{once:!0}),r!=="error"&&dO(t,m,{once:!0})})}function dO(t,r,l){typeof t.on=="function"&&hE(t,"error",r,l)}function hE(t,r,l,h){if(typeof t.on=="function")h.once?t.once(r,l):t.on(r,l);else if(typeof t.addEventListener=="function")t.addEventListener(r,function m(v){h.once&&t.removeEventListener(r,m),l(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var pO={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function fO(t){var r=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return r?{key:r[1],value:r[2]}:null}function mO(t){var r=t.match(/<?([^>]*)>(.*)/);if(!r)return null;var l=r[1],h=r[2].split(";"),m=null,v=h.reduce(function(T,s){var S=fO(s);return S?S.key==="rel"?(m||(m=S.value),T):(T[S.key]=S.value,T):T},{});return m?{url:l,rel:m,params:v}:null}function gO(t){return t?t.split(/,\s*</).reduce(function(r,l){var h=mO(l);if(!h)return r;var m=h.rel.split(/\s+/);return m.forEach(function(v){r[v]||(r[v]={url:h.url,params:h.params})}),r},{}):{}}var _O=gO,yO=_O;function av(t,r){this.request=t,this.headers=r.headers,this.rawBody=r.body,this.statusCode=r.statusCode;try{this.body=JSON.parse(r.body||"{}")}catch{this.body=r.body}this.links=yO(this.headers.link)}av.prototype.hasNextPage=function(){return!!this.links.next};av.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var vO=av,Vm={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},A1=Vm;function bO(t){var r=t.type||A1.ERROR_HTTP,l;if(t.body)try{l=JSON.parse(t.body)}catch{l=t.body}else l=null;var h=t.message||null;h||(typeof l=="string"?h=l:l&&typeof l.message=="string"?h=l.message:r===A1.ERROR_REQUEST_ABORTED&&(h="Request aborted")),this.message=h,this.type=r,this.statusCode=t.statusCode||null,this.request=t.request,this.body=l}var xO=bO;function wO(t){var r=t.indexOf(":"),l=t.substring(0,r).trim().toLowerCase(),h=t.substring(r+1).trim();return{name:l,value:h}}function TO(t){var r={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(l){var h=wO(l);r[h.name]=h.value}),r}var EO=TO,kO=vO,I1=xO,z_=Vm,SO=EO,ym={};function AO(t){var r=ym[t.id];r&&(r.abort(),delete ym[t.id])}function IO(t,r){return new kO(t,{body:r.response,headers:SO(r.getAllResponseHeaders()),statusCode:r.status})}function C1(t){var r=t.total,l=t.loaded,h=100*l/r;return{total:r,transferred:l,percent:h}}function dE(t,r){return new Promise(function(l,h){r.onprogress=function(T){t.emitter.emit(z_.EVENT_PROGRESS_DOWNLOAD,C1(T))};var m=t.file;m&&(r.upload.onprogress=function(T){t.emitter.emit(z_.EVENT_PROGRESS_UPLOAD,C1(T))}),r.onerror=function(T){h(T)},r.onabort=function(){var T=new I1({request:t,type:z_.ERROR_REQUEST_ABORTED});h(T)},r.onload=function(){if(delete ym[t.id],r.status<200||r.status>=400){var T=new I1({request:t,body:r.response,statusCode:r.status});h(T);return}l(r)};var v=t.body;typeof v=="string"?r.send(v):v?r.send(JSON.stringify(v)):m?r.send(m):r.send(),ym[t.id]=r}).then(function(l){return IO(t,l)})}function pE(t,r){var l=t.url(r),h=new window.XMLHttpRequest;return h.open(t.method,l),Object.keys(t.headers).forEach(function(m){h.setRequestHeader(m,t.headers[m])}),h}function CO(t){return Promise.resolve().then(function(){var r=pE(t,t.client.accessToken);return dE(t,r)})}var MO={browserAbort:AO,sendRequestXhr:dE,browserSend:CO,createRequestXhr:pE},vm={},PO={get exports(){return vm},set exports(t){vm=t}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(t,r){(function(l){var h=r,m=t&&t.exports==h&&t,v=typeof Pr=="object"&&Pr;(v.global===v||v.window===v)&&(l=v);var T=function(_e){this.message=_e};T.prototype=new Error,T.prototype.name="InvalidCharacterError";var s=function(_e){throw new T(_e)},S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",z=/[\t\n\f\r ]/g,O=function(_e){_e=String(_e).replace(z,"");var Ie=_e.length;Ie%4==0&&(_e=_e.replace(/==?$/,""),Ie=_e.length),(Ie%4==1||/[^+a-zA-Z0-9/]/.test(_e))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var Te=0,ve,$e,Fe="",qe=-1;++qe<Ie;)$e=S.indexOf(_e.charAt(qe)),ve=Te%4?ve*64+$e:$e,Te++%4&&(Fe+=String.fromCharCode(255&ve>>(-2*Te&6)));return Fe},B=function(_e){_e=String(_e),/[^\0-\xFF]/.test(_e)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var Ie=_e.length%3,Te="",ve=-1,$e,Fe,qe,fe,et=_e.length-Ie;++ve<et;)$e=_e.charCodeAt(ve)<<16,Fe=_e.charCodeAt(++ve)<<8,qe=_e.charCodeAt(++ve),fe=$e+Fe+qe,Te+=S.charAt(fe>>18&63)+S.charAt(fe>>12&63)+S.charAt(fe>>6&63)+S.charAt(fe&63);return Ie==2?($e=_e.charCodeAt(ve)<<8,Fe=_e.charCodeAt(++ve),fe=$e+Fe,Te+=S.charAt(fe>>10)+S.charAt(fe>>4&63)+S.charAt(fe<<2&63)+"="):Ie==1&&(fe=_e.charCodeAt(ve),Te+=S.charAt(fe>>2)+S.charAt(fe<<4&63)+"=="),Te},Z={encode:B,decode:O,version:"0.1.0"};if(h&&!h.nodeType)if(m)m.exports=Z;else for(var me in Z)Z.hasOwnProperty(me)&&(h[me]=Z[me]);else l.base64=Z})(Pr)})(PO,vm);var LO=vm,R_={};function zO(t){if(R_[t])return R_[t];var r=t.split("."),l=r[0],h=r[1];if(!h)throw new Error("Invalid token");var m=RO(h),v={usage:l,user:m.u};return Fl(m,"a")&&(v.authorization=m.a),Fl(m,"exp")&&(v.expires=m.exp*1e3),Fl(m,"iat")&&(v.created=m.iat*1e3),Fl(m,"scopes")&&(v.scopes=m.scopes),Fl(m,"client")&&(v.client=m.client),Fl(m,"ll")&&(v.lastLogin=m.ll),Fl(m,"iu")&&(v.impersonator=m.iu),R_[t]=v,v}function RO(t){try{return JSON.parse(LO.decode(t))}catch{throw new Error("Invalid token")}}function Fl(t,r){return Object.prototype.hasOwnProperty.call(t,r)}var fE=zO,_y={},DO={get exports(){return _y},set exports(t){_y=t}};(function(t){var r=Object.prototype.hasOwnProperty,l="~";function h(){}Object.create&&(h.prototype=Object.create(null),new h().__proto__||(l=!1));function m(S,z,O){this.fn=S,this.context=z,this.once=O||!1}function v(S,z,O,B,Z){if(typeof O!="function")throw new TypeError("The listener must be a function");var me=new m(O,B||S,Z),_e=l?l+z:z;return S._events[_e]?S._events[_e].fn?S._events[_e]=[S._events[_e],me]:S._events[_e].push(me):(S._events[_e]=me,S._eventsCount++),S}function T(S,z){--S._eventsCount===0?S._events=new h:delete S._events[z]}function s(){this._events=new h,this._eventsCount=0}s.prototype.eventNames=function(){var z=[],O,B;if(this._eventsCount===0)return z;for(B in O=this._events)r.call(O,B)&&z.push(l?B.slice(1):B);return Object.getOwnPropertySymbols?z.concat(Object.getOwnPropertySymbols(O)):z},s.prototype.listeners=function(z){var O=l?l+z:z,B=this._events[O];if(!B)return[];if(B.fn)return[B.fn];for(var Z=0,me=B.length,_e=new Array(me);Z<me;Z++)_e[Z]=B[Z].fn;return _e},s.prototype.listenerCount=function(z){var O=l?l+z:z,B=this._events[O];return B?B.fn?1:B.length:0},s.prototype.emit=function(z,O,B,Z,me,_e){var Ie=l?l+z:z;if(!this._events[Ie])return!1;var Te=this._events[Ie],ve=arguments.length,$e,Fe;if(Te.fn){switch(Te.once&&this.removeListener(z,Te.fn,void 0,!0),ve){case 1:return Te.fn.call(Te.context),!0;case 2:return Te.fn.call(Te.context,O),!0;case 3:return Te.fn.call(Te.context,O,B),!0;case 4:return Te.fn.call(Te.context,O,B,Z),!0;case 5:return Te.fn.call(Te.context,O,B,Z,me),!0;case 6:return Te.fn.call(Te.context,O,B,Z,me,_e),!0}for(Fe=1,$e=new Array(ve-1);Fe<ve;Fe++)$e[Fe-1]=arguments[Fe];Te.fn.apply(Te.context,$e)}else{var qe=Te.length,fe;for(Fe=0;Fe<qe;Fe++)switch(Te[Fe].once&&this.removeListener(z,Te[Fe].fn,void 0,!0),ve){case 1:Te[Fe].fn.call(Te[Fe].context);break;case 2:Te[Fe].fn.call(Te[Fe].context,O);break;case 3:Te[Fe].fn.call(Te[Fe].context,O,B);break;case 4:Te[Fe].fn.call(Te[Fe].context,O,B,Z);break;default:if(!$e)for(fe=1,$e=new Array(ve-1);fe<ve;fe++)$e[fe-1]=arguments[fe];Te[Fe].fn.apply(Te[Fe].context,$e)}}return!0},s.prototype.on=function(z,O,B){return v(this,z,O,B,!1)},s.prototype.once=function(z,O,B){return v(this,z,O,B,!0)},s.prototype.removeListener=function(z,O,B,Z){var me=l?l+z:z;if(!this._events[me])return this;if(!O)return T(this,me),this;var _e=this._events[me];if(_e.fn)_e.fn===O&&(!Z||_e.once)&&(!B||_e.context===B)&&T(this,me);else{for(var Ie=0,Te=[],ve=_e.length;Ie<ve;Ie++)(_e[Ie].fn!==O||Z&&!_e[Ie].once||B&&_e[Ie].context!==B)&&Te.push(_e[Ie]);Te.length?this._events[me]=Te.length===1?Te[0]:Te:T(this,me)}return this},s.prototype.removeAllListeners=function(z){var O;return z?(O=l?l+z:z,this._events[O]&&T(this,O)):(this._events=new h,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=l,s.EventEmitter=s,t.exports=s})(DO);function OO(t){return t.map(encodeURIComponent).join(",")}function mE(t){return Array.isArray(t)?OO(t):encodeURIComponent(String(t))}function gE(t,r,l){if(l===!1||l===null)return t;var h=/\?/.test(t)?"&":"?",m=encodeURIComponent(r);return l!==void 0&&l!==""&&l!==!0&&(m+="="+mE(l)),""+t+h+m}function BO(t,r){if(!r)return t;var l=t;return Object.keys(r).forEach(function(h){var m=r[h];m!==void 0&&(Array.isArray(m)&&(m=m.filter(function(v){return v!=null}).join(",")),l=gE(l,h,m))}),l}function FO(t,r){if(!r||t.slice(0,4)==="http")return t;var l=t[0]==="/"?"":"/";return""+r.replace(/\/$/,"")+l+t}function jO(t,r){return r?t.replace(/\/:([a-zA-Z0-9]+)/g,function(l,h){var m=r[h];if(m===void 0)throw new Error("Unspecified route parameter "+h);var v=mE(m);return"/"+v}):t}var NO={appendQueryObject:BO,appendQueryParam:gE,prependOrigin:FO,interpolateRouteParams:jO},$O=fE,lv=Fu,UO=_y,Nf=NO,M1=Vm,VO=1;function Ua(t,r){if(!t)throw new Error("MapiRequest requires a client");if(!r||!r.path||!r.method)throw new Error("MapiRequest requires an options object with path and method properties");var l={};r.body&&(l["content-type"]="application/json");var h=lv(l,r.headers),m=Object.keys(h).reduce(function(v,T){return v[T.toLowerCase()]=h[T],v},{});this.id=VO++,this._options=r,this.emitter=new UO,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=r.path,this.method=r.method,this.origin=r.origin||t.origin,this.query=r.query||{},this.params=r.params||{},this.body=r.body||null,this.file=r.file||null,this.encoding=r.encoding||"utf8",this.sendFileAs=r.sendFileAs||null,this.headers=m}Ua.prototype.url=function(r){var l=Nf.prependOrigin(this.path,this.origin);l=Nf.appendQueryObject(l,this.query);var h=this.params,m=r??this.client.accessToken;if(m){l=Nf.appendQueryParam(l,"access_token",m);var v=$O(m).user;h=lv({ownerId:v},h)}return l=Nf.interpolateRouteParams(l,h),l};Ua.prototype.send=function(){var r=this;if(r.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return r.sent=!0,r.client.sendRequest(r).then(function(l){return r.response=l,r.emitter.emit(M1.EVENT_RESPONSE,l),l},function(l){throw r.error=l,r.emitter.emit(M1.EVENT_ERROR,l),l})};Ua.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Ua.prototype.eachPage=function(r){var l=this;function h(T){function s(){delete l._nextPageRequest;var S=T.nextPage();S&&(l._nextPageRequest=S,v(S))}r(null,T,s)}function m(T){r(T,null,function(){})}function v(T){T.send().then(h,m)}v(this)};Ua.prototype.clone=function(){return this._extend()};Ua.prototype._extend=function(r){var l=lv(this._options,r);return new Ua(this.client,l)};var GO=Ua,ZO=fE,qO=GO,WO=Vm;function _E(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");ZO(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||WO.API_ORIGIN}_E.prototype.createRequest=function(r){return new qO(this,r)};var yE=_E,vE=MO,bE=yE;function zu(t){bE.call(this,t)}zu.prototype=Object.create(bE.prototype);zu.prototype.constructor=zu;zu.prototype.sendRequest=vE.browserSend;zu.prototype.abortRequest=vE.browserAbort;function HO(t){return new zu(t)}var xE=HO,XO=xE,KO=XO,YO=Object.prototype.toString,JO=function(t){var r;return YO.call(t)==="[object Object]"&&(r=Object.getPrototypeOf(t),r===null||r===Object.getPrototypeOf({}))},QO=JO,e3=Fu,wE="value",D_=`
  `,mi={};mi.assert=function(t,r){return r=r||{},function(l){var h=Va(t,l);if(h){var m=cv(h,r);throw r.apiName&&(m=r.apiName+": "+m),new Error(m)}}};mi.shape=function(r){var l=r3(r);return function(m){var v=Va(mi.plainObject,m);if(v)return v;for(var T,s,S=[],z=0;z<l.length;z++)T=l[z].key,s=l[z].value,v=Va(s,m[T]),v&&S.push([T].concat(v));return S.length<2?S[0]:function(O){S=S.map(function(me){var _e=me[0],Ie=cv(me,O).split(`
`).join(D_);return"- "+_e+": "+Ie});var B=O.path.join("."),Z=B===wE?"":" of "+B;return"The following properties"+Z+" have invalid values:"+D_+S.join(D_)}}};mi.strictShape=function(r){var l=mi.shape(r);return function(m){var v=l(m);if(v)return v;var T=Object.keys(m).reduce(function(s,S){return r[S]===void 0&&s.push(S),s},[]);if(T.length!==0)return function(){return"The following keys are invalid: "+T.join(", ")}}};mi.arrayOf=function(r){return TE(r)};mi.tuple=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return TE(r)};function TE(t){var r=Array.isArray(t),l=function(h){return r?t[h]:t};return function(m){var v=Va(mi.plainArray,m);if(v)return v;if(r&&m.length!==t.length)return"an array with "+t.length+" items";for(var T=0;T<m.length;T++)if(v=Va(l(T),m[T]),v)return[T].concat(v)}}mi.required=function(r){function l(h){return h==null?function(m){return EE(m,kE(m.path)?"cannot be undefined/null.":"is required.")}:r.apply(this,arguments)}return l.__required=!0,l};mi.oneOfType=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(h){var m=r.map(function(v){return Va(v,h)}).filter(Boolean);if(m.length===r.length)return m.every(function(v){return v.length===1&&typeof v[0]=="string"})?t3(m.map(function(v){return v[0]})):m.reduce(function(v,T){return T.length>v.length?T:v})}};mi.equal=function(r){return function(h){if(h!==r)return JSON.stringify(r)}};mi.oneOf=function(){var r=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),l=r.map(function(h){return mi.equal(h)});return mi.oneOfType.apply(this,l)};mi.range=function(r){var l=r[0],h=r[1];return function(v){var T=Va(mi.number,v);if(T||v<l||v>h)return"number between "+l+" & "+h+" (inclusive)"}};mi.any=function(){};mi.boolean=function(r){if(typeof r!="boolean")return"boolean"};mi.number=function(r){if(typeof r!="number")return"number"};mi.plainArray=function(r){if(!Array.isArray(r))return"array"};mi.plainObject=function(r){if(!QO(r))return"object"};mi.string=function(r){if(typeof r!="string")return"string"};mi.func=function(r){if(typeof r!="function")return"function"};function Va(t,r){if(!(r==null&&!t.hasOwnProperty("__required"))){var l=t(r);if(l)return Array.isArray(l)?l:[l]}}function cv(t,r){var l=t.length,h=t[l-1],m=t.slice(0,l-1);return m.length===0&&(m=[wE]),r=e3(r,{path:m}),typeof h=="function"?h(r):EE(r,n3(h))}function t3(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function n3(t){return"must be "+i3(t)+"."}function i3(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function EE(t,r){var l=kE(t.path),h=t.path.join(".")+" "+r,m=l?"Item at position ":"";return m+h}function kE(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function r3(t){return Object.keys(t||{}).map(function(r){return{key:r,value:t[r]}})}mi.validate=Va;mi.processMessage=cv;var o3=mi,s3=Fu,Tu=o3;function a3(t){if(typeof window<"u")return t instanceof Pr.Blob||t instanceof Pr.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function l3(t,r){return Tu.assert(Tu.strictShape(t),r)}function c3(t){var r="date";if(typeof t=="boolean")return r;try{var l=new Date(t);if(l.getTime&&isNaN(l.getTime()))return r}catch{return r}}function u3(t){return Tu.tuple(Tu.number,Tu.number)(t)}var h3=s3(Tu,{file:a3,date:c3,coordinates:u3,assertShape:l3});function d3(t,r){var l=function(h,m){return r.indexOf(h)!==-1&&m!==void 0};return typeof r=="function"&&(l=r),Object.keys(t).filter(function(h){return l(h,t[h])}).reduce(function(h,m){return h[m]=t[m],h},{})}var p3=d3;function f3(t,r){return Object.keys(t).reduce(function(l,h){return l[h]=r(h,t[h]),l},{})}var m3=f3,g3=m3;function _3(t){return g3(t,function(r,l){return typeof l=="boolean"?JSON.stringify(l):l})}var y3=_3,v3=yE,b3=xE;function x3(t){return function(r){var l;v3.prototype.isPrototypeOf(r)?l=r:l=b3(r);var h=Object.create(t);return h.client=l,h}}var w3=x3,SE=Fu,On=h3,bm=p3,AE=y3,T3=w3,uv={},IE=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];uv.forwardGeocode=function(t){On.assertShape({query:On.required(On.string),mode:On.oneOf("mapbox.places","mapbox.places-permanent"),countries:On.arrayOf(On.string),proximity:On.oneOf(On.coordinates,"ip"),types:On.arrayOf(On.oneOf(IE)),autocomplete:On.boolean,bbox:On.arrayOf(On.number),limit:On.number,language:On.arrayOf(On.string),routing:On.boolean,fuzzyMatch:On.boolean,worldview:On.string})(t),t.mode=t.mode||"mapbox.places";var r=AE(SE({country:t.countries},bm(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:bm(t,["mode","query"]),query:r})};uv.reverseGeocode=function(t){On.assertShape({query:On.required(On.coordinates),mode:On.oneOf("mapbox.places","mapbox.places-permanent"),countries:On.arrayOf(On.string),types:On.arrayOf(On.oneOf(IE)),bbox:On.arrayOf(On.number),limit:On.number,language:On.arrayOf(On.string),reverseMode:On.oneOf("distance","score"),routing:On.boolean,worldview:On.string})(t),t.mode=t.mode||"mapbox.places";var r=AE(SE({country:t.countries},bm(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:bm(t,["mode","query"]),query:r})};var E3=T3(uv);let k3="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",CE=t=>crypto.getRandomValues(new Uint8Array(t)),ME=(t,r,l)=>{let h=(2<<Math.log(t.length-1)/Math.LN2)-1,m=-~(1.6*h*r/t.length);return(v=r)=>{let T="";for(;;){let s=l(m),S=m;for(;S--;)if(T+=t[s[S]&h]||"",T.length===v)return T}}},S3=(t,r=21)=>ME(t,r,CE),A3=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((r,l)=>(l&=63,l<36?r+=l.toString(36):l<62?r+=(l-26).toString(36).toUpperCase():l>62?r+="-":r+="_",r),"");const I3=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:S3,customRandom:ME,nanoid:A3,random:CE,urlAlphabet:k3},Symbol.toStringTag,{value:"Module"})),C3=PD(I3);var M3=C3.nanoid;function PE(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}PE.prototype={select:function(t,r){var l=this.getSelectedIndex(t,r),h=this.getEventPayload("search.select",r);if(h.resultIndex=l,h.resultPlaceName=t.place_name,h.resultId=t.id,!(l===this.lastSentIndex&&h.queryString===this.lastSentInput||l==-1)&&(this.lastSentIndex=l,this.lastSentInput=h.queryString,!!h.queryString))return this.push(h)},start:function(t){var r=this.getEventPayload("search.start",t);if(r.queryString)return this.push(r)},keyevent:function(t,r){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var l=this.getEventPayload("search.keystroke",r);if(l.lastAction=t.key,!!l.queryString)return this.push(l)}},send:function(t,r){if(!this.enableEventLogging)return r?r():void 0;var l=this.getRequestOptions(t);this.request(l,function(h){if(h)return this.handleError(h,r);if(r)return r()}.bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var r={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return r},getEventPayload:function(t,r){var l;r.options.proximity?typeof r.options.proximity=="object"?l=[r.options.proximity.longitude,r.options.proximity.latitude]:r.options.proximity==="ip"?l=[999,999]:l=r.options.proximity:l=null;var h=r._map?r._map.getZoom():void 0,m={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:r.options.autocomplete,fuzzyMatch:r.options.fuzzyMatch,proximity:l,limit:r.options.limit,routing:r.options.routing,worldview:r.options.worldview,mapZoom:h,keyboardLocale:this.locale};return t==="search.select"?m.queryString=r.inputString:t!="search.select"&&r._inputEl?m.queryString=r._inputEl.value:m.queryString=r.inputString,m},request:function(t,r){var l=new XMLHttpRequest;l.onreadystatechange=function(){if(this.readyState==4)return this.status==204?r(null):r(this.statusText)},l.open(t.method,t.host+"/"+t.path,!0);for(var h in t.headers){var m=t.headers[h];l.setRequestHeader(h,m)}l.send(t.body)},handleError:function(t,r){if(r)return r(t)},generateSessionID:function(){return M3()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,r){if(r._typeahead){var l=r._typeahead.data,h=t.id,m=l.map(function(T){return T.id}),v=m.indexOf(h);return v}},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com"||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,r){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||r)&&this.flush()},remove:function(){this.flush()}};var P3=PE,L3={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},z3={placeholder:L3},yy={},R3={get exports(){return yy},set exports(t){yy=t}};(function(t){(function(r,l,h){t.exports?t.exports=h():r[l]=h()})(Pr,"subtag",function(){var r="",l=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function h(S){return S.match(l)||[]}function m(S){return h(S).filter(function(z,O){return z&&O})}function v(S){return S=h(S),{language:S[1]||r,extlang:S[2]||r,script:S[3]||r,region:S[4]||r}}function T(S,z,O){Object.defineProperty(S,z,{value:O,enumerable:!0})}function s(S,z,O){function B(Z){return h(Z)[S]||r}T(B,"pattern",z),T(v,O,B)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),T(v,"split",m),v})})(R3);function LE(){}LE.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(r,l){window.navigator.geolocation.getCurrentPosition(r,l,t)})}};var D3=LE;function O3(t,r){const l=zE(t),h=["address","street","place","country"];var m;if(typeof r=="function")return r(l);const v=h.indexOf(r);return v===-1?m=h:m=h.slice(v),m.reduce(function(T,s){return l[s]?(T!==""&&(T=T+", "),T+l[s]):T},"")}function zE(t){const r=t.address||"",l=t.text||"",h=t.place_name||"",v={address:h.split(",")[0],houseNumber:r,street:l,placeName:h};return t.context.forEach(function(T){const s=T.id.split(".")[0];v[s]=T.text}),v}const B3=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var F3={transformFeatureToGeolocationText:O3,getAddressInfo:zE,REVERSE_GEOCODE_COORD_RGX:B3},j3=$D,N3=oO,Nl=Fu,$3=_m.EventEmitter,P1=pO,O_=KO,B_=E3,U3=P3,V3=z3,G3=yy,Z3=D3,L1=F3;const ka={FORWARD:0,LOCAL:1,REVERSE:2};function q3(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function RE(t){this._eventEmitter=new $3,this.options=Nl({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Z3}RE.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var r=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+r[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+r.splice(1,r.length).join(",")+"</div></div>"}},addTo:function(t){function r(l,h){if(!document.body.contains(h))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const m=l.onAdd();h.appendChild(m)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)r(this,t);else if(typeof t=="string"){const l=document.querySelectorAll(t);if(l.length===0)throw new Error("Element ",t,"not found.");if(l.length>1)throw new Error("Geocoder can only be added to a single html element");r(this,l[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=B_(O_({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new U3(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var r=this.container=document.createElement("div");r.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var l=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",N3(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(z){this.eventManager.keyevent(z,this)}.bind(this));var h=document.createElement("div");h.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var m=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(m),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),h.appendChild(this._clearEl),h.appendChild(this._loadingEl),r.appendChild(l),r.appendChild(this._inputEl),r.appendChild(h),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var v=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(v),h.appendChild(this._geolocateEl),this._showGeolocateButton()}var T=this._typeahead=new j3(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),T.getItemValue=this.options.getItemValue;var s=T.list.draw,S=this._footerNode=q3();return T.list.draw=function(){s.call(this),S.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),S.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(S)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),r},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(t){this._hideLoadingIcon();const r={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(r),this._fly(r),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(r),this._showClearButton(),this.fresh=!1;const l={limit:1,language:[this.options.language],query:r.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const h=r.geometry.coordinates[0]+","+r.geometry.coordinates[1];this._setInputValue(h),this._eventEmitter.emit("result",{result:r})}else this.geocoderService.reverseGeocode(l).send().then(function(h){const m=h.body.features[0];if(m){const v=L1.transformFeatureToGeolocationText(m,this.options.addressAccuracy);this._setInputValue(v),m.user_coordinates=r.geometry.coordinates,this._eventEmitter.emit("result",{result:m})}else this._eventEmitter.emit("result",{result:{user_coordinates:r.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(t,r){var l=document.createElementNS("http://www.w3.org/2000/svg","svg");return l.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),l.setAttribute("viewBox","0 0 18 18"),l.setAttribute("xml:space","preserve"),l.setAttribute("width",18),l.setAttribute("height",18),l.innerHTML=r,l},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(t){var r=(t.clipboardData||window.clipboardData).getData("text");r.length>=this.options.minLength&&this._geocode(r)},_onKeyDown:function(t){var r=27,l=9;if(t.keyCode===r&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var h=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,m=h?h.value:"";if(!m)return this.fresh=!0,t.keyCode!==l&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[l,r,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&h.value.length>=this.options.minLength&&this._geocode(h.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var r;if(t.properties&&P1[t.properties.short_code])r=Nl({},this.options.flyTo),this._map&&this._map.fitBounds(P1[t.properties.short_code].bbox,r);else if(t.bbox){var l=t.bbox;r=Nl({},this.options.flyTo),this._map&&this._map.fitBounds([[l[0],l[1]],[l[2],l[3]]],r)}else{var h={zoom:this.options.zoom};r=Nl({},h,this.options.flyTo),t.center?r.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(r.center=t.geometry.coordinates),this._map&&this._map.flyTo(r)}},_requestType:function(t,r){var l;return t.localGeocoderOnly?l=ka.LOCAL:t.reverseGeocode&&L1.REVERSE_GEOCODE_COORD_RGX.test(r)?l=ka.REVERSE:l=ka.FORWARD,l},_setupConfig:function(t,r){const l=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],h=/[\s,]+/;var m=this,v=l.reduce(function(s,S){if(m.options[S]===void 0||m.options[S]===null)return s;["countries","types","language"].indexOf(S)>-1?s[S]=m.options[S].split(h):s[S]=m.options[S];const z=typeof m.options[S].longitude=="number"&&typeof m.options[S].latitude=="number";if(S==="proximity"&&z){const O=m.options[S].longitude,B=m.options[S].latitude;s[S]=[O,B]}return s},{});switch(t){case ka.REVERSE:{var T=r.split(h).map(function(s){return parseFloat(s,10)});m.options.flipCoordinates||T.reverse(),v.types&&v.types[0],v=Nl(v,{query:T,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(s){s in v&&delete v[s]})}break;case ka.FORWARD:{const s=r.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(s)&&(r=r.replace(/,/g," ")),v=Nl(v,{query:r})}break}return v},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const r=this._requestType(this.options,t),l=this._setupConfig(r,t);var h;switch(r){case ka.LOCAL:h=Promise.resolve();break;case ka.FORWARD:h=this.geocoderService.forwardGeocode(l).send();break;case ka.REVERSE:h=this.geocoderService.reverseGeocode(l).send();break}var m=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],v=[],T=null;return h.catch(function(s){T=s}.bind(this)).then(function(s){this._hideLoadingIcon();var S={};return s?s.statusCode=="200"&&(S=s.body,S.request=s.request,S.headers=s.headers):S={type:"FeatureCollection",features:[]},S.config=l,this.fresh&&(this.eventManager.start(this),this.fresh=!1),S.features=S.features?m.concat(S.features):m,this.options.externalGeocoder?(v=this.options.externalGeocoder(t,S.features)||Promise.resolve([]),v.then(function(z){return S.features=S.features?z.concat(S.features):z,S},function(){return S})):S}.bind(this)).then(function(s){if(T)throw T;this.options.filter&&s.features.length&&(s.features=s.features.filter(this.options.filter)),s.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",s),this._typeahead.update(s.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",s))}.bind(this)).catch(function(s){this._hideLoadingIcon(),this._hideAttribution(),m.length&&this.options.localGeocoder||v.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(m)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:m}),this._eventEmitter.emit("error",{error:s})}.bind(this)),h},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var r=this;t.relatedTarget&&r._clear(t)},_onQueryResult:function(t){var r=t.body;if(r.features.length){var l=r.features[0];this._typeahead.selected=l,this._inputEl.value=l.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],r=G3.language(t),l=V3.placeholder[r];if(l)return l}return"Search"},setInput:function(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this._geocode(t),this},setProximity:function(t,r=!0){return this.options.proximity=t,r&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var r=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||r,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=B_(O_({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=B_(O_({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var r={color:"#4668F2"},l=Nl({},r,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(l),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,r){return this._eventEmitter.on(t,r),this},off:function(t,r){return this._eventEmitter.removeListener(t,r),this.eventManager.remove(),this}};var W3=RE;function DE(){return{map:$i("mapbox-map")}}var F_=new Map,H3=/onMb([A-Z])(.+)/;function X3(t){return F_.has(t)||F_.set(t,t.replace(H3,(r,l,h)=>l.toLowerCase()+h)),F_.get(t)}function hv(t,r,l=[],h=null){const m=dI(),v=zi(()=>Object.entries(m).filter(([z,O])=>z.startsWith("on")&&typeof O=="function").map(([z])=>z)),T=new Map;function s(z){Array.isArray(z)&&z.forEach(O=>{const B=T.get(O);typeof B=="function"&&B()})}function S(z){Array.isArray(z)&&z.forEach(O=>{const B=X3(O);if(!l.includes(B))return;const Z=(...me)=>{t(`mb-${B}`,...me)};h?(fn(r).on(B,h,Z),T.set(O,()=>{fn(r).off(B,h,Z)})):(fn(r).on(B,Z),T.set(O,()=>{fn(r).off(B,Z)}))})}vr(v,(z,O)=>{const B=Array.isArray(z)?(O??[]).filter(me=>!z.includes(me)):O??[],Z=Array.isArray(O)?(z??[]).filter(me=>!O.includes(me)):z??[];if(fn(r))s(B),S(Z);else{const me=vr(r,_e=>{_e&&(s(B),S(Z),me())})}},{immediate:!0})}function K3(t){return t.charAt(0).toUpperCase()+t.slice(1)}function dv(t,r,l){function h(m){Object.keys(t).filter(v=>t[v]!==void 0&&t[v]!==null).forEach(v=>{var T,s;const S=v==="mapStyle"?"setStyle":`set${K3(v)}`,z=typeof m[S]=="function",O=typeof l[v]>"u"||"bind"in l[v]?(s=(T=l[v])==null?void 0:T.bind)!=null?s:!1:!0;if(!z||!O)return;const{type:B}=t[v],Z={deep:B===Object||Array.isArray(B)&&B.includes(Object)};vr(()=>t[v],me=>{m[S](me)},Z)})}if(fn(r))h(fn(r));else{const m=vr(r,v=>{v&&(h(v),m())})}}var pv=(t,r)=>{const l=t.__vccOpts||t;for(const[h,m]of r)l[h]=m;return l};if(!$a)throw new Error("mapboxgl is not installed.");if(!W3)throw new Error("MapboxGeocoder is not installed.");var Y3={key:0},J3={key:1};if(!$a)throw new Error("mapboxgl is not installed.");var{LngLatBounds:z1,LngLat:Q3}=$a,R1={accessToken:{type:String,default:"no-token"},container:{type:[typeof HTMLElement<"u"&&HTMLElement,String],default:void 0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],required:!0},hash:{type:Boolean,default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!0},customAttribution:{type:[String,Array],default:null},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean,default:!1},preserveDrawingBuffer:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1},refreshExpiredTiles:{type:Boolean,default:!0},maxBounds:{type:[z1,Array],default:void 0},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean,default:!0},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Boolean,Object],default:!0},keyboard:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{type:[Q3,Array,Object],default:()=>[0,0]},zoom:{type:Number,default:0},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[z1,Array],default:void 0},fitBoundsOptions:{type:Object,default:null},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0}},eB=["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","render","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchmove","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],tB={inheritAttrs:!1},nB=Object.assign(tB,{__name:"MapboxMap",props:R1,setup(t,{expose:r,emit:l}){const h=t,m=Ni();ql("mapbox-map",m);const v=Ni(),T=Ni(!1),s=zi(()=>{const{accessToken:S,mapStyle:z,...O}=h;return!O.container&&v.value&&(O.container=v.value),{style:z,...O}});return hv(l,m,eB),dv(h,m,R1),Pm(()=>{$a.accessToken=h.accessToken,m.value=new $a.Map(s.value),m.value.on("load",()=>{T.value=!0}),l("mb-created",m.value);const S=new ResizeObserver(()=>{m.value.resize()});S.observe(s.value.container),ec(()=>{S.disconnect(),m.value.remove()})}),r({map:m}),(S,z)=>(Lr(),Ra(eo,null,[Gr("div",Ny({ref_key:"root",ref:v},S.$attrs),null,16),T.value?(Lr(),Ra("div",Y3,[xd(S.$slots,"default")])):(Lr(),Ra("div",J3,[xd(S.$slots,"loader")]))],64))}}),iB=pv(nB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMap.vue"]]);if(!$a)throw new Error("mapboxgl is not installed.");var{Popup:rB,Point:oB,LngLat:sB}=$a,D1={lngLat:{type:[sB,Array,Object],required:!0},closeButton:{type:Boolean,default:!0},closeOnClick:{type:Boolean,default:!0},closeOnMove:{type:Boolean,default:!1},anchor:{type:String,default:null},offset:{type:[Number,oB,Array,Object],default:0},className:{type:String,default:null},maxWidth:{type:String,default:"240px"},renderless:{type:Boolean,default:!1,bind:!1}},aB=["open","close"],lB={__name:"MapboxPopup",props:D1,setup(t,{expose:r,emit:l}){const h=t,m=Ni(),v=Ni(),T=zi(()=>{const{lngLat:s,...S}=h;return S});return dv(h,m,D1),hv(l,m,aB),Pm(()=>{const{map:s}=DE();m.value=new rB(T.value).setLngLat(h.lngLat).setDOMContent(v.value),h.renderless||m.value.addTo(s.value),l("mb-open",m.value)}),ec(()=>{m.value&&m.value.remove()}),r({popup:m}),(s,S)=>(Lr(),Ra("div",{ref_key:"root",ref:v},[xd(s.$slots,"default")],512))}},cB=pv(lB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxPopup.vue"]]),{Marker:uB,Point:hB}=$a,O1={lngLat:{type:Array,required:!0},popup:{type:[Object,Boolean],default:!1,bind:!1},element:{type:typeof HTMLElement<"u"?HTMLElement:Object,default:null},offset:{type:[hB,Array],default:null},anchor:{type:String,default:"center"},color:{type:String,default:null},scale:{type:Number,default:1},draggable:{type:Boolean,default:!1},rotation:{type:Number,default:0},pitchAlignment:{type:String,default:"auto"},rotationAlignment:{type:String,default:"auto"}},dB=["dragstart","drag","dragend"],pB={__name:"MapboxMarker",props:O1,setup(t,{emit:r}){const l=t,h=hI(),m=Ni(),v=Ni(),T=Ni(),s=zi(()=>typeof h.popup<"u"),S=zi(()=>s.value?T.value.popup:null),z=zi(()=>({lngLat:l.lngLat,...l.popup?l.popup:{},renderless:!0})),O=zi(()=>{const{lngLat:B,popup:Z,...me}=l;return h.default&&(me.element=v.value),me});return dv(l,m,O1),hv(r,m,dB),Pm(()=>{const{map:B}=DE();m.value=new uB(O.value).setLngLat(l.lngLat).addTo(B.value),s.value&&m.value.setPopup(S.value)}),ec(()=>{m.value&&m.value.remove()}),(B,Z)=>(Lr(),Ra("div",null,[Gr("div",{ref_key:"contentRef",ref:v},[xd(B.$slots,"default")],512),fn(s)?(Lr(),tc(cB,Ny({key:0,ref_key:"popupRef",ref:T},fn(z)),{default:$n(()=>[xd(B.$slots,"popup")]),_:3},16)):Mw("v-if",!0)]))}},fB=pv(pB,[["__file","/home/runner/work/vue-mapbox-gl/vue-mapbox-gl/packages/vue-mapbox-gl/components/MapboxMarker.vue"]]);const mB="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M464 256c0-114.87-93.13-208-208-208S48 141.13 48 256s93.13 208 208 208 208-93.13 208-208zm-100.69-28.69l-96 96a16 16 0 01-22.62 0l-96-96a16 16 0 0122.62-22.62L256 289.37l84.69-84.68a16 16 0 0122.62 22.62z'/></svg>",gB="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M421.83 293.82A144 144 0 00218.18 90.17M353.94 225.94a48 48 0 00-67.88-67.88' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/><path stroke-linecap='round' stroke-miterlimit='10' d='M192 464v-48M90.18 421.82l33.94-33.94M48 320h48' class='ionicon-stroke-width'/><path d='M286.06 158.06L172.92 271.19a32 32 0 01-45.25 0L105 248.57a32 32 0 010-45.26L218.18 90.17M421.83 293.82L308.69 407a32 32 0 01-45.26 0l-22.62-22.63a32 32 0 010-45.26l113.13-113.17M139.6 169.98l67.88 67.89M275.36 305.75l67.89 67.88' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>",_B="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M336.76 161l-186.53 82.35c-10.47 4.8-6.95 20.67 4.57 20.67H244a4 4 0 014 4v89.18c0 11.52 16 15 20.78 4.56L351 175.24A10.73 10.73 0 00336.76 161z'/><path d='M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/></svg>",yB=t=>(mA("data-v-a0dff802"),t=t(),gA(),t),vB=yB(()=>Gr("p",{class:"currentPosition-marker"},[Gr("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[Gr("circle",{cx:"20",cy:"20",r:"15",fill:"#4770FF"}),Gr("circle",{cx:"20",cy:"20",r:"19.5",stroke:"#87B7FF"})])],-1)),bB=Dr({__name:"BasicMap",setup(t){const r=tE(),l=Ni(),h=Ga({isTracking:!1}),m=()=>{l.value.setCenter([r.currentLocation.lng,r.currentLocation.lat])};vr(r.currentLocation,()=>{h.isTracking&&m()});const v=()=>{r.currentLocation.lat+=.1},T=()=>{h.isTracking=!h.isTracking,h.isTracking&&m()};return(s,S)=>(Lr(),Ra(eo,null,[en(fn(iB),{class:"w-full h-full","access-token":"pk.eyJ1IjoiY3JldG9udiIsImEiOiJjbGV5b2Fld2QwNnh4M3JvOGIxNHZ5a3VkIn0.WdHz6eP4SsoCqMuejCRpRg","map-style":"mapbox://styles/mapbox/streets-v12",center:[-122.02703037,37.3302088],zoom:14,onMbCreated:S[0]||(S[0]=z=>l.value=z)},{default:$n(()=>[en(fn(fB),{"lng-lat":[fn(r).currentLocation.lng,fn(r).currentLocation.lat]},{default:$n(()=>[vB]),_:1},8,["lng-lat"])]),_:1},8,["center"]),en(fn(gd),{onClick:v},{default:$n(()=>[to("Modifier la localisation")]),_:1}),en(fn(Iz),{slot:"fixed",vertical:"top",horizontal:"start"},{default:$n(()=>[en(fn(A_),null,{default:$n(()=>[en(fn(C_),{icon:fn(mB)},null,8,["icon"])]),_:1}),en(fn(Cz),{side:"bottom"},{default:$n(()=>[en(fn(A_),{onClick:m},{default:$n(()=>[en(fn(C_),{icon:fn(_B)},null,8,["icon"])]),_:1}),en(fn(A_),{color:h.isTracking?"primary":void 0,onClick:T},{default:$n(()=>[en(fn(C_),{icon:fn(gB)},null,8,["icon"])]),_:1},8,["color"])]),_:1})]),_:1})],64))}});const xB=(t,r)=>{const l=t.__vccOpts||t;for(const[h,m]of r)l[h]=m;return l},wB=xB(bB,[["__scopeId","data-v-a0dff802"]]),TB={class:"h-full flex flex-col items-center justify-center"},EB={key:0},kB=Dr({__name:"PocGeolocation",setup(t){const r=tE(),l=()=>{r.startWatching(),r.startReporting()},h=eE();return h.setId("bth1emonizvk3bh"),(m,v)=>{const T=gr("IonBackButton"),s=gr("IonButtons"),S=gr("IonTitle"),z=gr("IonToolbar"),O=gr("IonHeader"),B=gr("IonButton"),Z=gr("IonContent"),me=gr("IonPage");return Lr(),tc(me,null,{default:$n(()=>[en(O,null,{default:$n(()=>[en(z,null,{default:$n(()=>[en(s,{slot:"start"},{default:$n(()=>[en(T,{"default-href":"#"},{default:$n(()=>[to("Retour")]),_:1})]),_:1}),en(S,null,{default:$n(()=>[to("POC Geolocation")]),_:1})]),_:1})]),_:1}),en(Z,null,{default:$n(()=>[Gr("div",TB,[fn(h).team?(Lr(),Ra("p",EB,"Equipe: "+N_(fn(h).team.name),1)):Mw("",!0),en(wB,{class:"w-full flex-grow"}),en(B,{onClick:l},{default:$n(()=>[to("Activer la localisation en background ")]),_:1})])]),_:1})]),_:1})}}}),SB=Gr("p",null,"Notif reçue !",-1),AB=Dr({__name:"Notif",setup(t){return(r,l)=>{const h=gr("IonBackButton"),m=gr("IonButtons"),v=gr("IonTitle"),T=gr("IonToolbar");return Lr(),tc(fn(iv),null,{default:$n(()=>[en(fn(DT),null,{default:$n(()=>[en(T,null,{default:$n(()=>[en(m,{slot:"start"},{default:$n(()=>[en(h,{"default-href":"#"},{default:$n(()=>[to("Retour")]),_:1})]),_:1}),en(v,null,{default:$n(()=>[to("Notif")]),_:1})]),_:1})]),_:1}),en(fn(RT),null,{default:$n(()=>[SB]),_:1})]),_:1})}}}),vy=Zz({history:qz("/"),routes:[{path:"/",redirect:"/home"},{path:"/home",name:"home",component:Yz},{path:"/geolocation",name:"geolocation",component:kB},{path:"/notif",name:"notif",component:AB}]});var Gm={},fv={},mv={};Object.defineProperty(mv,"__esModule",{value:!0});var IB=function(){function t(r){this.notificationId=r.notificationId,this.body=r.body,this.title=r.title,this.additionalData=r.additionalData,typeof r.rawPayload=="string"?this.rawPayload=JSON.parse(r.rawPayload):this.rawPayload=r.rawPayload,this.launchURL=r.launchURL,this.sound=r.sound,r.actionButtons&&(this.actionButtons=r.actionButtons),r.groupKey&&(this.groupKey=r.groupKey),r.ledColor&&(this.ledColor=r.ledColor),typeof r.priority<"u"&&(this.priority=r.priority),r.smallIcon&&(this.smallIcon=r.smallIcon),r.largeIcon&&(this.largeIcon=r.largeIcon),r.bigPicture&&(this.bigPicture=r.bigPicture),r.collapseId&&(this.collapseId=r.collapseId),r.groupMessage&&(this.groupMessage=r.groupMessage),r.fromProjectNumber&&(this.fromProjectNumber=r.fromProjectNumber),r.smallIconAccentColor&&(this.smallIconAccentColor=r.smallIconAccentColor),r.lockScreenVisibility&&(this.lockScreenVisibility=r.lockScreenVisibility),r.androidNotificationId&&(this.androidNotificationId=r.androidNotificationId),r.groupedNotifications&&r.groupedNotifications.length&&(this.groupedNotifications=r.groupedNotifications),r.badge&&(this.badge=r.badge),r.category&&(this.category=r.category),r.threadId&&(this.threadId=r.threadId),r.subtitle&&(this.subtitle=r.subtitle),r.templateId&&(this.templateId=r.templateId),r.attachments&&(this.attachments=r.attachments),r.templateName&&(this.templateName=r.templateName),r.mutableContent&&(this.mutableContent=r.mutableContent),r.badgeIncrement&&(this.badgeIncrement=r.badgeIncrement),r.contentAvailable&&(this.contentAvailable=r.contentAvailable),r.relevanceScore&&(this.relevanceScore=r.relevanceScore),r.interruptionLevel&&(this.interruptionLevel=r.interruptionLevel)}return t}();mv.default=IB;var CB=Pr&&Pr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(fv,"__esModule",{value:!0});var MB=CB(mv),PB=function(){function t(r){this.notification=new MB.default(r)}return t.prototype.complete=function(r){if(!r){cordova.exec(function(){},function(){},"OneSignalPush","completeNotification",[this.notification.notificationId,!1]);return}cordova.exec(function(){},function(){},"OneSignalPush","completeNotification",[this.notification.notificationId,!0])},t.prototype.getNotification=function(){return this.notification},t}();fv.default=PB;var Zm={};Object.defineProperty(Zm,"__esModule",{value:!0});Zm.DeviceState=void 0;var LB=function(){function t(r){this.userId=r.userId,this.pushToken=r.pushToken,this.emailUserId=r.emailUserId,this.emailAddress=r.emailAddress,this.smsUserId=r.smsUserId,this.smsNumber=r.smsNumber,this.pushDisabled=r.isPushDisabled,this.subscribed=r.isSubscribed,this.emailSubscribed=r.isEmailSubscribed,this.smsSubscribed=r.isSMSSubscribed,r.areNotificationsEnabled!==void 0?this.hasNotificationPermission=r.areNotificationsEnabled:this.hasNotificationPermission=r.hasNotificationPermission}return t}();Zm.DeviceState=LB;var zB=Pr&&Pr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Gm,"__esModule",{value:!0});Gm.OneSignalPlugin=void 0;var RB=zB(fv),DB=Zm,OE=function(){function t(){this._appID="",this._notificationWillShowInForegroundDelegate=function(r){},this._notificationOpenedDelegate=function(r){},this._inAppMessageClickDelegate=function(r){},this._onWillDisplayInAppMessageDelegate=function(r){},this._onDidDisplayInAppMessageDelegate=function(r){},this._onWillDismissInAppMessageDelegate=function(r){},this._onDidDismissInAppMessageDelegate=function(r){},this._permissionObserverList=[],this._subscriptionObserverList=[],this._emailSubscriptionObserverList=[],this._smsSubscriptionObserverList=[]}return t.prototype._processFunctionList=function(r,l){for(var h=0;h<r.length;h++)r[h](l)},t.prototype.setAppId=function(r){this._appID=r,window.cordova.exec(function(){},function(){},"OneSignalPush","init",[this._appID])},t.prototype.setNotificationWillShowInForegroundHandler=function(r){var l=this;this._notificationWillShowInForegroundDelegate=r;var h=function(m){l._notificationWillShowInForegroundDelegate(new RB.default(m))};window.cordova.exec(h,function(){},"OneSignalPush","setNotificationWillShowInForegroundHandler",[])},t.prototype.setNotificationOpenedHandler=function(r){var l=this;this._notificationOpenedDelegate=r;var h=function(m){l._notificationOpenedDelegate(m)};window.cordova.exec(h,function(){},"OneSignalPush","setNotificationOpenedHandler",[])},t.prototype.setInAppMessageClickHandler=function(r){var l=this;this._inAppMessageClickDelegate=r;var h=function(m){l._inAppMessageClickDelegate(m)};window.cordova.exec(h,function(){},"OneSignalPush","setInAppMessageClickHandler",[])},t.prototype.setInAppMessageLifecycleHandler=function(r){var l=this;if(r.onWillDisplayInAppMessage){this._onWillDisplayInAppMessageDelegate=r.onWillDisplayInAppMessage;var h=function(s){l._onWillDisplayInAppMessageDelegate(s)};window.cordova.exec(h,function(){},"OneSignalPush","setOnWillDisplayInAppMessageHandler",[])}if(r.onDidDisplayInAppMessage){this._onDidDisplayInAppMessageDelegate=r.onDidDisplayInAppMessage;var m=function(s){l._onDidDisplayInAppMessageDelegate(s)};window.cordova.exec(m,function(){},"OneSignalPush","setOnDidDisplayInAppMessageHandler",[])}if(r.onWillDismissInAppMessage){this._onWillDismissInAppMessageDelegate=r.onWillDismissInAppMessage;var v=function(s){l._onWillDismissInAppMessageDelegate(s)};window.cordova.exec(v,function(){},"OneSignalPush","setOnWillDismissInAppMessageHandler",[])}if(r.onDidDismissInAppMessage){this._onDidDismissInAppMessageDelegate=r.onDidDismissInAppMessage;var T=function(s){l._onDidDismissInAppMessageDelegate(s)};window.cordova.exec(T,function(){},"OneSignalPush","setOnDidDismissInAppMessageHandler",[])}window.cordova.exec(function(){},function(){},"OneSignalPush","setInAppMessageLifecycleHandler",[])},t.prototype.getDeviceState=function(r){var l=function(h){r(new DB.DeviceState(h))};window.cordova.exec(l,function(){},"OneSignalPush","getDeviceState",[])},t.prototype.setLanguage=function(r,l,h){l==null&&(l=function(){}),h==null&&(h=function(){}),window.cordova.exec(l,h,"OneSignalPush","setLanguage",[r])},t.prototype.addSubscriptionObserver=function(r){var l=this;this._subscriptionObserverList.push(r);var h=function(m){l._processFunctionList(l._subscriptionObserverList,m)};window.cordova.exec(h,function(){},"OneSignalPush","addSubscriptionObserver",[])},t.prototype.addEmailSubscriptionObserver=function(r){var l=this;this._emailSubscriptionObserverList.push(r);var h=function(m){l._processFunctionList(l._emailSubscriptionObserverList,m)};window.cordova.exec(h,function(){},"OneSignalPush","addEmailSubscriptionObserver",[])},t.prototype.addSMSSubscriptionObserver=function(r){var l=this;this._smsSubscriptionObserverList.push(r);var h=function(m){l._processFunctionList(l._smsSubscriptionObserverList,m)};window.cordova.exec(h,function(){},"OneSignalPush","addSMSSubscriptionObserver",[])},t.prototype.addPermissionObserver=function(r){var l=this;this._permissionObserverList.push(r);var h=function(m){l._processFunctionList(l._permissionObserverList,m)};window.cordova.exec(h,function(){},"OneSignalPush","addPermissionObserver",[])},t.prototype.getTags=function(r){window.cordova.exec(r,function(){},"OneSignalPush","getTags",[])},t.prototype.sendTag=function(r,l){var h,m=(h={},h[r]=l,h);window.cordova.exec(function(){},function(){},"OneSignalPush","sendTags",[m])},t.prototype.sendTags=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","sendTags",[r])},t.prototype.deleteTag=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","deleteTags",[r])},t.prototype.deleteTags=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","deleteTags",r)},t.prototype.registerForProvisionalAuthorization=function(r){window.cordova.exec(r,function(){},"OneSignalPush","registerForProvisionalAuthorization",[])},t.prototype.promptForPushNotificationsWithUserResponse=function(r,l){var h=!1;typeof r=="function"?l=r:typeof r=="boolean"&&(h=r);var m=function(v){l&&l(v)};window.cordova.exec(m,function(){},"OneSignalPush","promptForPushNotificationsWithUserResponse",[h])},t.prototype.clearOneSignalNotifications=function(){window.cordova.exec(function(){},function(){},"OneSignalPush","clearOneSignalNotifications",[])},t.prototype.unsubscribeWhenNotificationsAreDisabled=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","unsubscribeWhenNotificationsAreDisabled",[r])},t.prototype.removeNotification=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","removeNotification",[r])},t.prototype.removeGroupedNotifications=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","removeGroupedNotifications",[r])},t.prototype.disablePush=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","disablePush",[r])},t.prototype.postNotification=function(r,l,h){l==null&&(l=function(){}),h==null&&(h=function(){}),window.cordova.exec(l,h,"OneSignalPush","postNotification",[r])},t.prototype.setLaunchURLsInApp=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","setLaunchURLsInApp",[r])},t.prototype.setLogLevel=function(r,l){window.cordova.exec(function(){},function(){},"OneSignalPush","setLogLevel",[r,l])},t.prototype.userProvidedPrivacyConsent=function(r){window.cordova.exec(r,function(){},"OneSignalPush","userProvidedPrivacyConsent",[])},t.prototype.requiresUserPrivacyConsent=function(r){window.cordova.exec(r,function(){},"OneSignalPush","requiresUserPrivacyConsent",[])},t.prototype.setRequiresUserPrivacyConsent=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","setRequiresUserPrivacyConsent",[r])},t.prototype.provideUserConsent=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","provideUserConsent",[r])},t.prototype.setEmail=function(r,l,h,m){h==null&&(h=function(){}),m==null&&(m=function(){}),typeof l=="function"?(m=h,h=l,window.cordova.exec(h,m,"OneSignalPush","setUnauthenticatedEmail",[r])):l==null?window.cordova.exec(h,m,"OneSignalPush","setUnauthenticatedEmail",[r]):window.cordova.exec(h,m,"OneSignalPush","setEmail",[r,l])},t.prototype.logoutEmail=function(r,l){r==null&&(r=function(){}),l==null&&(l=function(){}),window.cordova.exec(r,l,"OneSignalPush","logoutEmail",[])},t.prototype.setSMSNumber=function(r,l,h,m){h==null&&(h=function(){}),m==null&&(m=function(){}),typeof l=="function"?(m=h,h=l,window.cordova.exec(h,m,"OneSignalPush","setUnauthenticatedSMSNumber",[r])):l==null?window.cordova.exec(h,m,"OneSignalPush","setUnauthenticatedSMSNumber",[r]):window.cordova.exec(h,m,"OneSignalPush","setSMSNumber",[r,l])},t.prototype.logoutSMSNumber=function(r,l){r==null&&(r=function(){}),l==null&&(l=function(){}),window.cordova.exec(r,l,"OneSignalPush","logoutSMSNumber",[])},t.prototype.setExternalUserId=function(r,l,h){r==null&&(r=null);var m=null,v=function(s){};if(typeof l=="function")v=l;else if(typeof l=="string")m=l,h&&(v=h);else if(!(typeof l>"u")){console.error("OneSignal: setExternalUserId: Invalid param types. Definition is setExternalUserId(externalId: string?, externalIdAuthCode: string?, handler: function?): void");return}var T=[r];m!==null&&T.push(m),window.cordova.exec(v,function(){},"OneSignalPush","setExternalUserId",T)},t.prototype.removeExternalUserId=function(r){r==null&&(r=function(){}),window.cordova.exec(r,function(){},"OneSignalPush","removeExternalUserId",[])},t.prototype.addTriggers=function(r){Object.keys(r).forEach(function(l){typeof r[l]!="string"&&(r[l]=JSON.stringify(r[l]))}),window.cordova.exec(function(){},function(){},"OneSignalPush","addTriggers",[r])},t.prototype.addTrigger=function(r,l){var h,m=(h={},h[r]=l,h);this.addTriggers(m)},t.prototype.removeTriggerForKey=function(r){this.removeTriggersForKeys([r])},t.prototype.removeTriggersForKeys=function(r){Array.isArray(r)||console.error("OneSignal: removeTriggersForKeys: argument must be of type Array"),window.cordova.exec(function(){},function(){},"OneSignalPush","removeTriggersForKeys",[r])},t.prototype.getTriggerValueForKey=function(r,l){var h=function(m){l(m.value)};window.cordova.exec(h,function(){},"OneSignalPush","getTriggerValueForKey",[r])},t.prototype.pauseInAppMessages=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","pauseInAppMessages",[r])},t.prototype.sendOutcome=function(r,l){var h=function(m){l&&l(m)};window.cordova.exec(h,function(){},"OneSignalPush","sendOutcome",[r])},t.prototype.sendUniqueOutcome=function(r,l){var h=function(m){l&&l(m)};window.cordova.exec(h,function(){},"OneSignalPush","sendUniqueOutcome",[r])},t.prototype.sendOutcomeWithValue=function(r,l,h){if(typeof h>"u"&&(h=function(){}),typeof h!="function"){console.error("OneSignal: sendOutcomeWithValue: must provide a valid callback");return}var m=function(v){h&&h(v)};window.cordova.exec(m,function(){},"OneSignalPush","sendOutcomeWithValue",[r,Number(l)])},t.prototype.promptLocation=function(){window.cordova.exec(function(){},function(){},"OneSignalPush","promptLocation",[])},t.prototype.setLocationShared=function(r){window.cordova.exec(function(){},function(){},"OneSignalPush","setLocationShared",[r])},t.prototype.isLocationShared=function(r){window.cordova.exec(r,function(){},"OneSignalPush","isLocationShared",[])},t.prototype.enterLiveActivity=function(r,l,h,m){h==null&&(h=function(){}),m==null&&(m=function(){}),window.cordova.exec(h,m,"OneSignalPush","enterLiveActivity",[r,l])},t.prototype.exitLiveActivity=function(r,l,h){l==null&&(l=function(){}),h==null&&(h=function(){}),window.cordova.exec(l,h,"OneSignalPush","exitLiveActivity",[r])},t}();Gm.OneSignalPlugin=OE;var BE=new OE;window.plugins||(window.plugins={});window.plugins.OneSignal||(window.plugins.OneSignal=BE);var j_=Gm.default=BE;function OB(){return j_.setAppId("5124aae4-c3bc-45ae-b35b-f41791fc22c9"),j_.promptForPushNotificationsWithUserResponse(function(t){console.log("User accepted notifications: "+t)}),j_}function BB(){document.addEventListener("deviceready",()=>{OB().setNotificationOpenedHandler(async()=>{await vy.push("/"),await vy.push("/notif")})})}function FB(){BB()}FB();const fo=DI($z),jB=FI();fo.use(Oz);fo.component("IonButton",gd);fo.component("IonButtons",Az);fo.component("IonBackButton",Bz);fo.component("IonHeader",DT);fo.component("IonContent",RT);fo.component("IonPage",iv);fo.component("IonTitle",Mz);fo.component("IonToolbar",Pz);fo.use(jB);fo.use(vy);fo.mount("#app");export{Sd as a,NB as b,cT as c,$B as d,lT as e,ZB as f,Fx as g,WB as h,RM as i,GB as j,ho as k,UB as n,VB as p,kd as r,qB as s,Ba as w};
